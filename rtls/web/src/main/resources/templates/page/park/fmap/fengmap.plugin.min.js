/**Released Version v3.1.2,BUILD 8,Time 1681293328514. Fengmap Javascript SDK , see: https://www.fengmap.com for details**/
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.fengmap=i():t.fengmap=i()}(this,function(){return e={},r.m=n=[function(t,i,n){"use strict";!function(o){function u(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var h=null;i.a=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}var i,n,e,r;function s(){return r.apply(this,arguments)}return i=t,n=null,e=[{key:"global",value:(r=function(){if("undefined"!=typeof self&&null!==self&&0!==Object.keys(self).length)return self;if("undefined"!=typeof window&&null!==window&&0!==Object.keys(window).length)return window;if(null!=o&&0!==Object.keys(o).length)return o;if("undefined"==typeof my)throw new Error("unable to locate global object");var t;return h||(t=my.getAppIdSync(),h={location:{host:t.appId+".hybrid.alipay-eco.com"}}),h},s.toString=function(){return r.toString()},s)}],n&&u(i.prototype,n),e&&u(i,e),t}()}.call(this,n(2))},function(t,i,n){var e;void 0===(e="function"==typeof(e=function(){var c=function t(i){return i.reduce(function(t,i){return t*2+i},0)},f=function t(i){var n=[];for(var e=7;e>=0;e--)n.push(!!(i&1<<e));return n},it=function t(i){this.data=i;this.len=this.data.length;this.pos=0;this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");if(i instanceof Uint8Array)return i[this.pos++];else return i.charCodeAt(this.pos++)&255};this.readBytes=function(t){var i=[];for(var n=0;n<t;n++)i.push(this.readByte());return i};this.read=function(t){var i="";for(var n=0;n<t;n++)i+=String.fromCharCode(this.readByte());return i};this.readUnsigned=function(){var t=this.readBytes(2);return(t[1]<<8)+t[0]}},l=function t(n,r){var s=0;var i=function t(i){var n=0;for(var e=0;e<i;e++){if(r.charCodeAt(s>>3)&1<<(s&7))n|=1<<e;s++}return n};var e=[];var o=1<<n;var u=o+1;var h=n+1;var a=[];var c=function t(){a=[];h=n+1;for(var i=0;i<o;i++)a[i]=[i];a[o]=[];a[u]=null};var f;var l;while(true){l=f;f=i(h);if(f===o){c();continue}if(f===u)break;if(f<a.length){if(l!==o)a.push(a[l].concat(a[f][0]))}else{if(f!==a.length)throw new Error("Invalid LZW code.");a.push(a[l].concat(a[l][0]))}e.push.apply(e,a[f]);if(a.length===1<<h&&h<12)h++}return e},nt=function t(u,h){h||(h={});var s=function t(i){var n=[];for(var e=0;e<i;e++)n.push(u.readBytes(3));return n};var a=function t(){var i,n;n="";do{i=u.readByte();n+=u.read(i)}while(i!==0);return n};var i=function t(){var i={};i.sig=u.read(3);i.ver=u.read(3);if(i.sig!=="GIF")throw new Error("Not a GIF file.");i.width=u.readUnsigned();i.height=u.readUnsigned();var n=f(u.readByte());i.gctFlag=n.shift();i.colorRes=c(n.splice(0,3));i.sorted=n.shift();i.gctSize=c(n.splice(0,3));i.bgColor=u.readByte();i.pixelAspectRatio=u.readByte();if(i.gctFlag)i.gct=s(1<<i.gctSize+1);h.hdr&&h.hdr(i)};var n=function t(i){var n=function t(i){var n=u.readByte();var e=f(u.readByte());i.reserved=e.splice(0,3);i.disposalMethod=c(e.splice(0,3));i.userInput=e.shift();i.transparencyGiven=e.shift();i.delayTime=u.readUnsigned();i.transparencyIndex=u.readByte();i.terminator=u.readByte();h.gce&&h.gce(i)};var e=function t(i){i.comment=a();h.com&&h.com(i)};var r=function t(i){var n=u.readByte();i.ptHeader=u.readBytes(12);i.ptData=a();h.pte&&h.pte(i)};var s=function t(i){var n=function t(i){var n=u.readByte();i.unknown=u.readByte();i.iterations=u.readUnsigned();i.terminator=u.readByte();h.app&&h.app.NETSCAPE&&h.app.NETSCAPE(i)};var e=function t(i){i.appData=a();h.app&&h.app[i.identifier]&&h.app[i.identifier](i)};var r=u.readByte();i.identifier=u.read(8);i.authCode=u.read(3);switch(i.identifier){case"NETSCAPE":n(i);break;default:e(i);break}};var o=function t(i){i.data=a();h.unknown&&h.unknown(i)};i.label=u.readByte();switch(i.label){case 249:i.extType="gce";n(i);break;case 254:i.extType="com";e(i);break;case 1:i.extType="pte";r(i);break;case 255:i.extType="app";s(i);break;default:i.extType="unknown";o(i);break}};var e=function t(i){var n=function t(r,s){var o=new Array(r.length);var i=r.length/s;var n=function t(i,n){var e=r.slice(n*s,(n+1)*s);o.splice.apply(o,[i*s,s].concat(e))};var e=[0,4,2,1];var u=[8,8,4,2];var h=0;for(var a=0;a<4;a++)for(var c=e[a];c<i;c+=u[a]){n(c,h);h++}return o};i.leftPos=u.readUnsigned();i.topPos=u.readUnsigned();i.width=u.readUnsigned();i.height=u.readUnsigned();var e=f(u.readByte());i.lctFlag=e.shift();i.interlaced=e.shift();i.sorted=e.shift();i.reserved=e.splice(0,2);i.lctSize=c(e.splice(0,3));if(i.lctFlag)i.lct=s(1<<i.lctSize+1);i.lzwMinCodeSize=u.readByte();var r=a();i.pixels=l(i.lzwMinCodeSize,r);if(i.interlaced)i.pixels=n(i.pixels,i.width);h.img&&h.img(i)};var r=function t(){var i={};i.sentinel=u.readByte();switch(String.fromCharCode(i.sentinel)){case"!":i.type="ext";n(i);break;case",":i.type="img";e(i);break;case";":i.type="eof";h.eof&&h.eof(i);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}if(i.type!=="eof")setTimeout(t,0)};var o=function t(){i();setTimeout(r,0)};o()},t;return function t(i){var v={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var n in i)v[n]=i[n];if(v.vp_w&&v.vp_h)v.is_vp=true;var r;var s;var c=null;var e=false;var o=null;var u=null;var h=null;var a=null;var f=null;var l=null;var d=null;var y=true;var p=true;var b=false;var m=[];var w=[];var g=v.gif;if(typeof v.auto_play=="undefined")v.auto_play=!g.getAttribute("rel:auto_play")||g.getAttribute("rel:auto_play")=="1";var M=v.hasOwnProperty("on_end")?v.on_end:null;var k=v.hasOwnProperty("loop_delay")?v.loop_delay:0;var E=v.hasOwnProperty("loop_mode")?v.loop_mode:"auto";var O=v.hasOwnProperty("draw_while_loading")?v.draw_while_loading:true;var R=O?v.hasOwnProperty("show_progress_bar")?v.show_progress_bar:true:false;var T=v.hasOwnProperty("progressbar_height")?v.progressbar_height:25;var S=v.hasOwnProperty("progressbar_background_color")?v.progressbar_background_color:"rgba(255,255,255,0.4)";var j=v.hasOwnProperty("progressbar_foreground_color")?v.progressbar_foreground_color:"rgba(255,0,22,.8)";var A=function t(){o=null;u=null;f=h;h=null;l=null};var x=function t(){try{nt(r,z)}catch(t){P("parse")}};var C=function t(i){W.innerHTML=i;W.style.visibility="visible"};var L=function t(i,n){Y.width=i*Z();Y.height=n*Z();W.style.minWidth=i*Z()+"px";Q.width=i;Q.height=n;Q.style.width=i+"px";Q.style.height=n+"px";Q.getContext("2d").setTransform(1,0,0,1,0,0)};var _=function t(i,n){if(!w[i]){w[i]=n;return}if(typeof n.x!=="undefined")w[i].x=n.x;if(typeof n.y!=="undefined")w[i].y=n.y};var I=function t(i,n,e){if(e&&R){var r=T;var s,o,u,h;if(v.is_vp){if(!b){u=v.vp_t+v.vp_h-r;r=r;s=v.vp_l;o=s+i/n*v.vp_w;h=Y.width}else{u=(v.vp_t+v.vp_h-r)/Z();r=r/Z();s=v.vp_l/Z();o=s+i/n*(v.vp_w/Z());h=Y.width/Z()}if(false)var a,c,f,l}else{u=(Y.height-r)/(b?Z():1);o=i/n*Y.width/(b?Z():1);h=Y.width/(b?Z():1);r/=b?Z():1}X.fillStyle=S;X.fillRect(o,u,h-o,r);X.fillStyle=j;X.fillRect(0,u,o,r)}};var P=function t(i){var n=function t(){X.fillStyle="black";X.fillRect(0,0,v.c_w?v.c_w:s.width,v.c_h?v.c_h:s.height);X.strokeStyle="red";X.lineWidth=3;X.moveTo(0,0);X.lineTo(v.c_w?v.c_w:s.width,v.c_h?v.c_h:s.height);X.moveTo(0,v.c_h?v.c_h:s.height);X.lineTo(v.c_w?v.c_w:s.width,0);X.stroke()};c=i;s={width:g.width,height:g.height};m=[];n()};var B=function t(i){s=i;L(s.width,s.height)};var F=function t(i){N();A();o=i.transparencyGiven?i.transparencyIndex:null;u=i.delayTime;h=i.disposalMethod};var N=function t(){if(!l)return;m.push({data:l.getImageData(0,0,s.width,s.height),delay:u});w.push({x:0,y:0})};var D=function t(i){if(!l)l=Q.getContext("2d");var n=m.length;var e=i.lctFlag?i.lct:s.gct;if(n>0){if(f===3)if(a!==null)l.putImageData(m[a].data,0,0);else l.clearRect(d.leftPos,d.topPos,d.width,d.height);else a=n-1;if(f===2)l.clearRect(d.leftPos,d.topPos,d.width,d.height)}var r=l.getImageData(i.leftPos,i.topPos,i.width,i.height);i.pixels.forEach(function(t,i){if(t!==o){r.data[i*4+0]=e[t][0];r.data[i*4+1]=e[t][1];r.data[i*4+2]=e[t][2];r.data[i*4+3]=255}});l.putImageData(r,i.leftPos,i.topPos);if(!b){X.scale(Z(),Z());b=true}if(O){X.drawImage(Q,0,0);O=v.auto_play}d=i};var H=function(){var s=-1;var n=0;var t=false;var i=false;var o=function t(){var i=p?1:-1;return(s+i+m.length)%m.length};var u=function t(i){s=s+i;r()};var e=function(){var e=false;var r=function t(){if(M!==null)M(g);n++;if(E!==false||n<0)i();else{e=false;y=false}};var i=function t(){e=y;if(!e)return;u(1);var i=m[s].delay*10;if(!i)i=100;var n=o();if(n===0){i+=k;setTimeout(r,i)}else setTimeout(t,i)};return function(){if(!e)setTimeout(i,0)}}();var r=function t(){var i;s=parseInt(s,10);if(s>m.length-1)s=0;if(s<0)s=0;i=w[s];Q.getContext("2d").putImageData(m[s].data,i.x,i.y);X.globalCompositeOperation="copy";X.drawImage(Q,0,0)};var h=function t(){y=true;e()};var a=function t(){y=false};return{init:function t(){if(c)return;if(!(v.c_w&&v.c_h))X.scale(Z(),Z());if(v.auto_play)e();else{s=0;r()}},step:e,play:h,pause:a,playing:y,move_relative:u,current_frame:function t(){return s},length:function t(){return m.length},move_to:function t(i){s=i;r()}}}();var U=function t(i){I(r.pos,r.data.length,i)};var V=function t(){};var G=function t(i,n){return function(t){i(t);U(n)}};var z={hdr:G(B),gce:G(F),com:G(V),app:{NETSCAPE:G(V)},img:G(D,true),eof:function t(i){N();U(false);if(!(v.c_w&&v.c_h)){Y.width=s.width*Z();Y.height=s.height*Z()}H.init();e=false;if(J)J(g)}};var q=function t(){var i=g.parentNode;var n=document.createElement("div");Y=document.createElement("canvas");X=Y.getContext("2d");W=document.createElement("div");Q=document.createElement("canvas");n.width=Y.width=g.width;n.height=Y.height=g.height;W.style.minWidth=g.width+"px";n.className="jsgif";W.className="jsgif_toolbar";n.appendChild(Y);n.appendChild(W);i.insertBefore(n,g);i.removeChild(g);if(v.c_w&&v.c_h)L(v.c_w,v.c_h);K=true};var Z=function t(){var i;if(v.max_width&&s&&s.width>v.max_width)i=v.max_width/s.width;else i=1;return i};var Y,X,W,Q;var K=false;var J=false;var $=function t(i){if(e)return false;if(i)J=i;else J=false;e=true;m=[];A();a=null;f=null;l=null;d=null;return true};var tt=function t(){return m.reduce(function(t,i){return t+i.delay},0)};return{play:H.play,pause:H.pause,move_relative:H.move_relative,move_to:H.move_to,get_playing:function t(){return y},get_canvas:function t(){return Y},get_canvas_scale:function t(){return Z()},get_loading:function t(){return e},get_auto_play:function t(){return v.auto_play},get_length:function t(){return H.length()},get_frames:function t(){return m},get_duration:function t(){return tt()},get_duration_ms:function t(){return tt()*10},get_current_frame:function t(){return H.current_frame()},load_url:function t(i,n){if(!$(n))return;var e=new XMLHttpRequest;e.open("GET",i,true);if("overrideMimeType"in e)e.overrideMimeType("text/plain; charset=x-user-defined");else if("responseType"in e)e.responseType="arraybuffer";else e.setRequestHeader("Accept-Charset","x-user-defined");e.onloadstart=function(){if(!K)q()};e.onload=function(t){if(this.status!=200)P("xhr - response");if(!("response"in this))this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join("");var i=this.response;if(i.toString().indexOf("ArrayBuffer")>0)i=new Uint8Array(i);r=new it(i);setTimeout(x,0)};e.onprogress=function(t){if(t.lengthComputable)I(t.loaded,t.total,true)};e.onerror=function(){P("xhr")};e.send()},load:function t(i){this.load_url(g.getAttribute("rel:animated_src")||g.src,i)},load_raw:function t(i,n){if(!$(n))return;if(!K)q();r=new it(i);setTimeout(x,0)},set_frame_offset:_}}})?e.apply(i,[]):e)||(t.exports=e)},function(t,i){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,i,n){"use strict";n.r(i);var h={};n.r(h),n.d(h,"ShadowMaterial",function(){return gv}),n.d(h,"SpriteMaterial",function(){return Mv}),n.d(h,"RawShaderMaterial",function(){return Tv}),n.d(h,"ShaderMaterial",function(){return Rv}),n.d(h,"PointsMaterial",function(){return Sv}),n.d(h,"MeshPhysicalMaterial",function(){return Av}),n.d(h,"MeshStandardMaterial",function(){return jv}),n.d(h,"MeshPhongMaterial",function(){return xv}),n.d(h,"MeshToonMaterial",function(){return Cv}),n.d(h,"MeshNormalMaterial",function(){return Lv}),n.d(h,"MeshLambertMaterial",function(){return _v}),n.d(h,"MeshDepthMaterial",function(){return Iv}),n.d(h,"MeshDistanceMaterial",function(){return Pv}),n.d(h,"MeshBasicMaterial",function(){return Wn}),n.d(h,"MeshMatcapMaterial",function(){return Bv}),n.d(h,"LineDashedMaterial",function(){return Nv}),n.d(h,"LineBasicMaterial",function(){return Fv}),n.d(h,"Material",function(){return Xn});var l={LEFT_TOP:1,LEFT_BOTTOM:2,RIGHT_TOP:3,RIGHT_BOTTOM:4};function r(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var e=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),t=t||{},this.u=null,this.v=t,this.M=null,this.k=null}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.O()}},{key:"remove",value:function(){this.v.contain.removeChild(this.k)}},{key:"on",value:function(t,i){this.k.onclick=function(){i&&i()},this.k.addEventListener("touchend",function(){i&&i()},!1)}},{key:"checkPosition",value:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto";break;case l.RIGHT_TOP:n.style.right=-(i=i||{x:-10,y:10}).x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.left="auto";break;case l.LEFT_BOTTOM:n.style.left=(i=i||{x:10,y:-10}).x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.right="auto";break;case l.RIGHT_BOTTOM:n.style.right=-(i=i||{x:-10,y:-10}).x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.left="auto";break;default:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto"}}}])&&r(t.prototype,n),e&&r(t,e),i}();Object.assign(e.prototype,{O:function(){var t=this,i=document.createElement("div");i.classList.add("fm-compass-container"),void 0!==this.v.backgroundImageSize&&(i.style.width=this.v.backgroundImageSize+"px",i.style.height=this.v.backgroundImageSize+"px"),void 0!==this.v.backgroundImageURL&&(i.style.backgroundImage="url('"+this.v.backgroundImageURL+"')"),void 0===this.v.position&&void 0===this.v.offset||this.checkPosition(this.v.position,this.v.offset,i),this.v.contain?this.v.contain.appendChild(i):(this.v.contain=this.u.getContainer(),this.u.getContainer().appendChild(i));var n=-this.u.getRotation();this.M=document.createElement("div"),this.M.classList.add("fm-compass-element"),this.M.style.transform="rotate("+n+"deg)",this.M.style.msTransform="rotate("+n+"deg)",this.M.style.mozTransform="rotate("+n+"deg)",this.M.style.webkitTransform="rotate("+n+"deg)",this.M.style.oTransform="rotate("+n+"deg)",void 0!==this.v.pointerImageURL&&(this.M.style.backgroundImage="url('"+this.v.pointerImageURL+"')"),void 0!==this.v.pointerImageSize&&(this.M.style.width=this.v.pointerImageSize+"px",this.M.style.height=this.v.pointerImageSize+"px"),i.appendChild(this.M),this.k=i,this.u.on("update",function(){t.R()})},R:function(){var t=-this.u.getRotation();this.M.style.transform="rotate("+t+"deg)",this.M.style.msTransform="rotate("+t+"deg)",this.M.style.mozTransform="rotate("+t+"deg)",this.M.style.webkitTransform="rotate("+t+"deg)",this.M.style.oTransform="rotate("+t+"deg)"}});var s=e;function o(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var u=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)}var i,n,e;return i=t,e=[{key:"toColor",value:function(t){if("number"==typeof t)return t;var i=t.split(",");return 3<=i.length?parseInt(i[0])<<16|parseInt(i[1])<<8|parseInt(i[2]):(console.error("color format error",t),0)}},{key:"bindEvent",value:function(t,r,i,s){t.addEventListener(i,function(t){var i=t||window.event,n=i.target||i.srcElement,e=i.currentTarget;for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var i=(this.document||this.ownerDocument).querySelectorAll(t),n=i.length;0<=--n&&i.item(n)!==this;);return-1<n});n!==e;)n.matches(r)&&s.call(n,i),n=n.parentNode})}},{key:"scrollTopAnFun",value:function(){var f,e=!1;return function i(n){var r=n.el,s=n.to,t=n.form,o=(n.time,s<t?"up":"bottom"),u=10,h=(t<s?s-t:s==t?0:t-s)/u,a=0;function c(){if(--f<=0)return f=e=!1,void(r.scrollTop=0==t?0:t);window.setTimeout(function(){var t,i,n,e;!1!==f&&(i=(t={val:u,nbak:h,n:f,elTop:s,VDIRECTIONE:o}).val,n=t.nbak,e=t.n,t=t.elTop,(a="up"==o?t+(n-e)*i:t-(n-e)*i)&&(r.scrollTop=a),c())},u)}!function(){if(e)return f=0,window.setTimeout(function(){var t=Object(n,{to:r.scrollTop});e=!1,i(t)},u+1);e=!0,f=h,c()}()}}},{key:"sleep",value:function(t){for(var i=(new Date).getTime(),n=0;n<1e7&&!((new Date).getTime()-i>t);n++);}},{key:"getClikEventName",value:function(){return window.PointerEvent?"pointerdown":"click"}}],(n=null)&&o(i.prototype,n),e&&o(i,e),t}(),a={FMMap_CONTROL_SMALL:"small",FMMap_CONTROL_NORMAL:"normal"};var c=function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=a.FMMap_CONTROL_NORMAL,this.position=l.LEFT_TOP,this.offset={x:10,y:10},this.imgURL="resource/style/wedgets/img/",this.floorButtonCount=5,this.needAllLayerBtn=!0,Object.assign(this,i)};function f(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var v=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),t=t||{},this.u=null,this.T=new c(t),this.T.position||(this.T.position=l.LEFT_TOP),this.S=t.contain,this.T.offset||(this.T.offset={x:10,y:10}),this.j=null,this.A=t.imgURL||"resource/style/wedgets/img/"}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.S||(this.S=this.u.getContainer()),this.init()}},{key:"remove",value:function(){this.S.removeChild(this.j)}},{key:"init",value:function(){var t=this.createPanel();this.j=t;var i=this;this.checkPosition(this.T.position,this.T.offset,t),u.bindEvent(t,"img","mouseover",function(t){this.src=this.dataset.on}),u.bindEvent(t,"img","mouseout",function(t){this.src=this.dataset.leave}),u.bindEvent(t,"div","click",function(t){"in"===this.dataset.type?i.u.zoomIn():i.u.zoomOut()}),u.bindEvent(t,"div","touchend",function(t){"in"===this.dataset.type?i.u.zoomIn():i.u.zoomOut()})}},{key:"showZoom",value:function(t){this.j.style.display=t?"block":"none"}},{key:"createPanel",value:function(){var t=document.createElement("div");t.setAttribute("class","fm-control-zoom"),t.style.zIndex=20,t.style.position="absolute",t.style.backgroundColor="white",t.style.boxShadow="2px 2px 3px rgba(0,0,0, 0.3)",t.style.borderRadius="2px",t.style.left=0,t.style.top=0,this.S.appendChild(t);return t.innerHTML=this.createInnerHtml("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOAgMAAABiJsVCAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACVBMVEUAAABmZmYAAABV8S+1AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAATSURBVAjXY2DAC0JDQwMgBF4AAFvvAp8tw46tAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAIElEQVQokWNgGAXUB4zGsrL/ydHIwsDAcI/KjhkFZAMA5XkCUOIdNxMAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOAgMAAABiJsVCAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACVBMVEUAAABmZmYAAABV8S+1AAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAXSURBVAjXY2BgZQACXERoaGgAhMCrDgBkQQLbnsbDyQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAOElEQVQokWM0lpVlwAE+QGkBbJJMuHQRAiNBIwsDA8M7HHJ8UBqrPEU2CuGQg8UjVvkhFKr01wgAH8cEixbYBa8AAAAASUVORK5CYII="),t}},{key:"createInnerHtml",value:function(t,i,n,e){return'\n\n            <div data-type="in" style="padding: 14px; cursor: pointer;">\n            <img src='.concat(n," data-leave=").concat(n," data-on=").concat(e,' style="width: 14px; height: 14px;"/>\n             </div>\n            <hr style="height: 1px; border-top: 1px solid rgba(153, 153, 153, 0.45); border-right: none; border-bottom: none; border-left: none; border-image: initial; width: 60%; margin: 0px 20%;">\n            <div data-type="out" style="padding: 14px; cursor: pointer;">\n            <img src=').concat(t," data-leave=").concat(t," data-on=").concat(i,' style="width: 14px; height: 14px;"/>\n            </div>\n        ')}},{key:"checkPosition",value:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=i.x+"px",n.style.top=i.y+"px";break;case l.RIGHT_TOP:n.style.right=-i.x+"px",n.style.top=i.y+"px";break;case l.LEFT_BOTTOM:n.style.left=i.x+"px",n.style.bottom=-i.y+"px";break;case l.RIGHT_BOTTOM:n.style.right=-i.x+"px",n.style.bottom=-i.y+"px"}}}])&&f(t.prototype,n),e&&f(t,e),i}();function d(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var y=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),t=t||{},this.u=null,this.T=new c(t),this.T.position||(this.T.position=l.LEFT_TOP),this.S=t.contain,this.T.offset||(this.T.offset={x:10,y:10}),this.j=null,this.A=t.imgURL||"resource/style/wedgets/img/"}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.S||(this.S=this.u.getContainer()),this.init()}},{key:"remove",value:function(){this.S.removeChild(this.j)}},{key:"init",value:function(){var t=this.createPanel();this.j=t;var i=this;this.checkPosition(this.T.position,this.T.offset,t),u.bindEvent(t,"img","mouseover",function(t){this.src=this.dataset.on}),u.bindEvent(t,"img","mouseout",function(t){this.src=this.dataset.leave}),u.bindEvent(t,"div","click",function(t){"in"===this.dataset.type?i.u.zoomIn():i.u.zoomOut()}),u.bindEvent(t,"div","touchend",function(t){"in"===this.dataset.type?i.u.zoomIn():i.u.zoomOut()})}},{key:"showZoom",value:function(t){this.j.style.display=t?"block":"none"}},{key:"createPanel",value:function(){var t=document.createElement("div");return t.setAttribute("class","fm-control-zoom-bar"),t.style.left=0,t.style.top=0,this.S.appendChild(t),t.innerHTML=this.createInnerHtml(),t}},{key:"createInnerHtml",value:function(){return'\n            <div data-type="in" class="fm-control-zoom-bar-button fm-control-zoom-button-bar-in"></div>\n            <hr class="fm-control-zoom-bar-hr"/>\n            <div data-type="out" class="fm-control-zoom-bar-button fm-control-zoom-button-bar-out"></div>\n        '}},{key:"checkPosition",value:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=i.x+"px",n.style.top=i.y+"px";break;case l.RIGHT_TOP:n.style.right=-i.x+"px",n.style.top=i.y+"px";break;case l.LEFT_BOTTOM:n.style.left=i.x+"px",n.style.bottom=-i.y+"px";break;case l.RIGHT_BOTTOM:n.style.right=-i.x+"px",n.style.bottom=-i.y+"px"}}}])&&d(t.prototype,n),e&&d(t,e),i}(),p={MODE_3D:2,MODE_2D:4};Object.freeze(p);var b=p;function m(t,i){var n=document.createElement("div"),i='<div class="fm-scroll" id="scroll_'.concat(t+i,'"></div>');return n.innerHTML=i.trim(),n.firstChild}function w(t,i){t&&i?t.appendChild(i):console.error(t,i)}for(var g=[],M=0;M<256;M++)g[M]=(M<16?"0":"")+M.toString(16);var Y={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return(g[255&t]+g[t>>8&255]+g[t>>16&255]+g[t>>24&255]+"-"+g[255&i]+g[i>>8&255]+"-"+g[i>>16&15|64]+g[i>>24&255]+"-"+g[63&n|128]+g[n>>8&255]+"-"+g[n>>16&255]+g[n>>24&255]+g[255&e]+g[e>>8&255]+g[e>>16&255]+g[e>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,e,r){return e+(t-i)*(r-e)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Y.DEG2RAD},radToDeg:function(t){return t*Y.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,e,r){var s=Math.cos,o=Math.sin,u=s(n/2),h=o(n/2),a=s((i+e)/2),c=o((i+e)/2),f=s((i-e)/2),n=o((i-e)/2),s=s((e-i)/2),i=o((e-i)/2);"XYX"===r?t.set(u*c,h*f,h*n,u*a):"YZY"===r?t.set(h*n,u*c,h*f,u*a):"ZXZ"===r?t.set(h*f,h*n,u*c,u*a):"XZX"===r?t.set(u*c,h*i,h*s,u*a):"YXY"===r?t.set(h*s,u*c,h*i,u*a):"ZYZ"===r?t.set(h*i,h*s,u*c,u*a):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function k(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,k);var n=t.getState().viewBuildingID,e=!0,r=i.buildingID,s=t.getMapOptions().buildingID,o=r&&r!==s&&n===s,u=r&&n!==s,i=document.querySelector(".fm-enter-exit-building-button-enter"),s=document.querySelector(".fm-enter-exit-building-button-exit");o?i.classList.remove("fm-hide"):u&&s.classList.remove("fm-hide"),i.addEventListener("click",function(){null!==r&&!1!==e&&(e=!1,t.enterBuilding({buildingID:r,finish:function(){e=!0}}),n=r)}),s.addEventListener("click",function(){!1!==e&&(e=!1,t.exitBuilding({finish:function(){e=!0}}))})}var E;function O(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var R=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.S=(t=t||{}).contain,this.C=new c(t),this.L=this.C.floorButtonCount,this.u=null,this._=!1,this.I=!0,this.P=10,this.B=null,this.F=null,this.N=[],this.D=null,this.H=null,this.U=null,this.uuid=null,this.V=null,this.scrollTopAn_=new u.scrollTopAnFun,this.viewModeControl=void 0===t.viewModeControl||t.viewModeControl,this.floorModeControl=void 0===t.floorModeControl||t.floorModeControl,this.timer=null,this.G=t.buildingID,this.q=void 0===t.showMap||t.showMap,this.hasDOM=!1,this.enable=!0,this.Z=void 0===t.entranceIcon||t.entranceIcon}var t,n,e;return t=i,(n=[{key:"applicationBuilding",value:function(){this.D=this.u.getBuilding(this.G),0!==this.D.getFloorInfos().length&&(null!=this.D.level?this.V=this.D.level:this.D.setLevel({level:this.V}),this.S||(this.S=this.u.getContainer()),this.createDOM(),1<this.D.visibleLevels.length?this.setLayerStatus(!0):this.setLayerStatus(!1))}},{key:"buildingIsInZoomRange",value:function(t){var i=this.u.getZoom(),n=t.zoomRange,t=!0;return t=n&&(i<n.minLevel||i>n.maxLevel)?!1:t}},{key:"findBuilding",value:function(){var t,i=!1,n=this.u.getState(),e=!1,r=!1,s=this.u.focusBuilding;return s?s.buildingID===n.viewBuildingID?(i=!0,this.G!==s.buildingID&&(r=!0),this.G=s.buildingID,e=!0):(n=this.buildingIsInZoomRange(s),s.overviewMode!==fengmap.FMOverviewMode.OUTDOOR&&n?(i=!0,this.G!==s.buildingID&&(r=!0),this.G=s.buildingID,e=!0):!0===this.q&&(i=!0,t=this.u.getMapOptions().buildingID,this.G!==t&&(r=!0),this.G=t,e=!0)):!0===this.q&&(i=!0,t=this.u.getMapOptions().buildingID,this.G!==t&&(r=!0),this.G=t,e=!0),!1===i&&(null!==this.G&&(r=!0),this.G=null),{isShowToolbar:e,isBuildingChange:r}}},{key:"addTo",value:function(t){((this.u=t).toolBar=this).initEvent(),this.findBuilding().isShowToolbar&&this.applicationBuilding()}},{key:"switchBuilding",value:function(){this.removeDOM(),this.G=null,this.D=null,this.findBuilding().isShowToolbar&&this.applicationBuilding()}},{key:"remove",value:function(){this.removeEvent(),this.removeDOM(),delete this.u.toolBar}},{key:"removeDOM",value:function(){this.F&&this.S.removeChild(this.F),this.F=null,this.hasDOM=!1}},{key:"removeEvent",value:function(){this.u.off("levelChanged",this.gidchange),this.u.off("visibleLevelsLoaded",this.handleLayerChangeStyle),this.u.off("buildingEntered",this.handleBuildingEntered),this.u.off("buildingExited",this.handleBuildingExited),this.u.off("buildingOverviewModeChanged",this.handleBuildingOverviewModeChanged),this.u.off("ViewBuildingChange",this.handleViewBuildingChange),this.u.off("zoom",this.handleCheckZoom)}},{key:"initEvent",value:function(){function t(t){var i;n.enable&&n.D&&(t.buildingID&&t.buildingID!==n.D.buildingID||!t.buildingID&&n.D.buildingID!==n.u.getMapOptions().buildingID||(i=n.D.getFloorInfos().map(function(t){return t.level}),t.level<i[0]||t.level>i[i.length-1]||(n.B.scrollTop=n.getCenterScrolltopById(t.level,i.length),n.setGidStyleByEvent(t.level,"levelChanged"))))}var n=this;this.gidchange=t,this.u.on("levelChanged",t),this.Y=function(t){return(n.map?n.map.mapView.container_:document).querySelector(t)},this.handleBuildingEntered=this.handleBuildingEntered.bind(this),this.handleBuildingExited=this.handleBuildingExited.bind(this),this.handleBuildingOverviewModeChanged=this.handleBuildingOverviewModeChanged.bind(this),this.handleLayerChangeStyle=this.handleLayerChangeStyle.bind(this),this.handleViewBuildingChange=this.handleViewBuildingChange.bind(this),this.handleCheckZoom=this.handleCheckZoom.bind(this),this.u.on("ViewBuildingChange",this.handleViewBuildingChange),this.u.on("buildingEntered",this.handleBuildingEntered),this.u.on("buildingExited",this.handleBuildingExited),this.u.on("buildingOverviewModeChanged",this.handleBuildingOverviewModeChanged),this.u.on("visibleLevelsLoaded",this.handleLayerChangeStyle),this.u.on("visibleLevelsLoaded",this.handleLayerChangeStyle),this.u.on("zoom",this.handleCheckZoom)}},{key:"handleCheckZoom",value:function(){this.findBuilding().isBuildingChange&&this.switchBuilding()}},{key:"createDOM",value:function(){this.hasDOM=!0,this.uuid=Y.generateUUID();var t=((f=document.createElement("div")).innerHTML='\n    <div class="fm-control-groups" </div>'.trim(),f.firstChild);this.F=t,function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=i.x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto";break;case l.RIGHT_TOP:n.style.right=-i.x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.left="auto";break;case l.LEFT_BOTTOM:n.style.left=i.x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.right="auto";break;case l.RIGHT_BOTTOM:n.style.right=-i.x+"px",n.style.bottom=-i.y+"px",n.style.top="auto",n.style.left="auto";break;default:n.style.left=i.x+"px",n.style.top=i.y+"px",n.style.bottom="auto",n.style.right="auto"}}(this.C.position,this.C.offset,t),w(this.S,t);var i=this.D.getFloorInfos().map(function(t){return t.level}),n=i.length,e=this.L,r=!0;this.viewModeControl&&(this.u.getViewMode()===b.MODE_3D?this.I=!1:this.I=!0,this.H=((s=document.createElement("div")).innerHTML='\n    <div class="fm-view fm-view-3d"></div>'.trim(),s.firstChild),this.initViewModePanelEvent(this.H),w(t,this.H),this.setViewModeToStyle(this.H,this.I?"2d":"3d"));var s=((f=document.createElement("div")).innerHTML='\n      <div class="fm-layer">\n        <div class="fm-layer-image-many"> </div>\n      </div>'.trim(),f.firstChild);if(this.C.needAllLayerBtn&&w(t,s),this.X=s,this.eventSwitchBtn(s),this.handleLayerChangeStyle=this.handleLayerChangeStyle.bind(this),this.floorModeControl){n<=this.L&&(e=n,r=!1);this.W;this._&&this.Q;s=((f=document.createElement("div")).innerHTML='<div class = "fm-floor-list-group" > </div'.trim(),f.firstChild);w(t,s),r&&s.appendChild(m("up",this.uuid));var o=((n=document.createElement("div")).innerHTML='<div class = "fm-floor-list" > </div'.trim(),n.firstChild);w(s,o),this.B=o,this.N=this.D.getFloorInfos();for(var u,h,a,c=this.N.length-1;-1<c;c--)o.appendChild((u=this.N[c],h=this.uuid,a=void 0,a=document.createElement("div"),u='\n    <div class="fm-floor-name-container">\n      <label\n        class="fm-floor-name fm-floor-name-normal"\n        data-gid='.concat(u.level,'\n        id="gid_').concat(u.level+h,'"\n        <span>').concat(u.alias&&u.alias.toUpperCase()||u.name.toUpperCase(),"</span>\n      </label>\n    </div>\n    "),a.innerHTML=u.trim(),a.firstChild)),0<c&&o.appendChild((a=void 0,(a=document.createElement("div")).innerHTML='\n  <hr class="fm-floor-line" />'.trim(),a.firstChild));var f=document.querySelector(".fm-floor-line"),n=0;f&&(n=f.getBoundingClientRect().height),this.K=document.querySelector(".fm-floor-name-container").clientHeight+n,document.querySelector(".fm-floor-list").style.height=this.K*e+"px",r&&s.appendChild(m("down",this.uuid)),o.scrollTop=this.getCenterScrolltopById(this.V,i.length);s=document.getElementById("gid_"+this.V+this.uuid);null!=s&&(s.classList.remove("fm-floor-name-normal"),s.classList.add("fm-floor-name-active")),this.eventBtnPanelInit(o),this.eventPanelInit(t,o,i),this.Z&&(w(t,((t=document.createElement("div")).classList.add("fm-enter-exit-building"),t.innerHTML='\n   <div class="fm-enter-exit-building-button fm-enter-exit-building-button-enter fm-hide">\n    </div>\n    <div class="fm-enter-exit-building-button fm-enter-exit-building-button-exit fm-hide">\n    </div>\n  '.trim(),t)),new k(this.u,{buildingID:this.G}))}}},{key:"handleLayerChange",value:function(){var t,i;this.hasDOM&&(i=!(t=this)._,this.changeLevelsSelect(i),t.u.followFocus&&t.D&&(i=t.D.level,-1==t.D.visibleLevels.indexOf(i)&&t.D.visibleLevels.push(i),t.changeFocusLevel(i)))}},{key:"handleLayerChangeStyle",value:function(t){this.hasDOM&&this.D&&t.buildingID===this.D.buildingID&&(1<this.D.visibleLevels.length?this.setLayerStatus(!0):this.setLayerStatus(!1))}},{key:"eventSwitchBtn",value:function(t){var i;this.hasDOM&&(i=u.getClikEventName(),this.handleLayerChange=this.handleLayerChange.bind(this),t.addEventListener(i,this.handleLayerChange))}},{key:"setViewModeToStyle",value:function(t,i){this.hasDOM&&("2d"==i?(t.classList.remove("fm-view-3d"),t.classList.add("fm-view-2d")):(t.classList.remove("fm-view-2d"),t.classList.add("fm-view-3d")))}},{key:"initViewModePanelEvent",value:function(t){var i=this,n=u.getClikEventName(),e=!0;t.addEventListener(n,function(){!1!==e&&(e=!1,i.u.getViewMode()===b.MODE_3D?(i.u.setViewMode({mode:b.MODE_2D,finish:function(){e=!0}}),i.setViewModeToStyle(this,"2d")):(i.u.setViewMode({mode:b.MODE_3D,finish:function(){e=!0}}),i.setViewModeToStyle(this,"3d")))})}},{key:"eventBtnPanelInit",value:function(n){var e=this,r=this;r.changeScrollBtnPic(),u.bindEvent(n,"label","click",function(){var t;r.enable&&r.V!==parseInt(this.dataset.gid)&&(r.foucusId=parseInt(this.dataset.gid),t=r.D.getFloorInfos().map(function(t){return t.level}),this.dataset.gid<t[0]||this.dataset.gid>t[t.length-1]||(n.scrollTop=r.getCenterScrolltopById(parseInt(this.dataset.gid),t.length),r.setGidStyleByClick(this.dataset.gid,"click")))});function t(t){r.changeScrollBtnPic();var i=0;t.wheelDelta?i+=-t.wheelDelta:t.detail&&(i+=t.detail),e.scrollTopAn_({el:n,to:n.scrollTop,form:n.scrollTop+i}),t.stopPropagation()}n.addEventListener("mousewheel",t,{passive:!0}),n.addEventListener("MozMousePixelScroll",t,!1),n.addEventListener("touchstart",this.touchstart.bind(this),!1),n.addEventListener("touchmove",this.touchmove.bind(this),!1),n.addEventListener("touchend",this.touchend.bind(this),!0)}},{key:"touchstart",value:function(t){t.preventDefault(),this.touchStartPointY=t.touches[0].pageY,this.touchPointX=t.touches[0].pageX,this.touchPointY=t.touches[0].pageY,t.stopPropagation()}},{key:"touchmove",value:function(t){t.preventDefault(),this.touchEndPointX=t.touches[0].pageX,this.touchEndPointY=t.touches[0].pageY,this.handleTouchEnd(t),t.stopPropagation()}},{key:"handleTouchEnd",value:function(t){var i,n=this,e=0;0<(t=t||window.event).changedTouches.length&&(n.touchEndPointX=t.changedTouches[0].pageX,n.touchEndPointY=t.changedTouches[0].pageY),(i=t.target)instanceof HTMLSpanElement==!0&&i.parentElement,0!=(e=-(n.touchEndPointY-n.touchPointY))&&(n.touchPointX=n.touchEndPointX,n.touchPointY=n.touchEndPointY,n=n.Y(".fm-floor-list"),this.scrollTopAn_({el:n,to:n.scrollTop,form:n.scrollTop+e}))}},{key:"touchend",value:function(t){var i=this,n=null;0<(t=t||window.event).changedTouches.length&&(i.touchEndPointX=t.changedTouches[0].pageX,i.touchEndPointY=t.changedTouches[0].pageY),(n=t.target)instanceof HTMLSpanElement==!0&&(n=n.parentElement);var e=Math.abs(i.touchEndPointY-i.touchStartPointY);e<5&&0<=e&&n&&(n=parseInt(n.dataset.gid),isNaN(n)||(i.foucusId=n,i.setGidStyleByClick(n,"click"))),t.stopPropagation()}},{key:"eventPanelInit",value:function(t,i,n){var e=this;t.onselectstart=function(){return!1},t.style.MozUserSelect="none",u.bindEvent(t,".fm-scroll","click",function(t){var i;this.id==="scroll_up"+e.uuid?(i=e.V+1,i=Math.min(n[n.length-1],i),e.foucusId!=i&&(e.foucusId=i,e.setGidStyleByClick(i,"click"))):(i=e.V-1,i=Math.max(n[0],i),e.foucusId!=i&&(e.foucusId=i,e.setGidStyleByClick(i,"click")))}),u.bindEvent(t,".fm-scroll","touchend",function(t){var i;this.id==="scroll_up"+e.uuid?(i=e.V+1,i=Math.min(n[n.length-1],i),e.foucusId!=i&&(e.foucusId=i,e.setGidStyleByClick(i,"click"))):(i=e.V-1,i=Math.max(n[0],i),e.foucusId!=i&&(e.foucusId=i,e.setGidStyleByClick(i,"click")))})}},{key:"getCenterScrolltopById",value:function(t,i){return(i-t-Math.floor(this.L/2))*this.K}},{key:"changeScrollBtnPic",value:function(){var t=this.V,i=this.D.getFloorInfos().map(function(t){return t.level});i.sort(function(t,i){return t-i});var n=document.getElementById("scroll_down"+this.uuid),e=document.getElementById("scroll_up"+this.uuid);t==i[0]&&n?(n.classList.remove("fm-scroll-down"),n.classList.add("fm-scroll-down-grey")):n&&(n.classList.remove("fm-scroll-down-grey"),n.classList.add("fm-scroll-down")),t==i[i.length-1]&&e?(e.classList.remove("fm-scroll-up"),e.classList.add("fm-scroll-up-grey")):e&&(e.classList.remove("fm-scroll-up-grey"),e.classList.add("fm-scroll-up"))}},{key:"changeFocusLevel",value:function(t){this.foucusId=t}},{key:"changeLevelsSelect",value:function(t){this.allLayer=t,this.setLayerStatus(t)}},{key:"setLayerStatus",value:function(t){this._=t,this._?(this.X.firstElementChild.classList.remove("fm-layer-image-one"),this.X.firstElementChild.classList.add("fm-layer-image-many")):(this.X.firstElementChild.classList.remove("fm-layer-image-many"),this.X.firstElementChild.classList.add("fm-layer-image-one"))}},{key:"onChange",value:function(t){E=t}},{key:"foucusId",get:function(){return this.V},set:function(t){var i=this;this.D&&(null!==this.U&&!1===this.J&&this.U.finish(),this.J=!1,this.D.setLevel({level:t,finish:function(){i.J=!0},callback:function(t){i.U=t}}),E&&E([t]))}},{key:"setGidStyleByEvent",value:function(t){this.setGidStyleByClick(t)}},{key:"setGidStyleByClick",value:function(t){var i=document.getElementById("gid_"+this.V+this.uuid);i&&(i.classList.remove("fm-floor-name-active"),i.classList.add("fm-floor-name-normal"),this.V=parseInt(t),(t=document.getElementById("gid_"+t+this.uuid)).classList.remove("fm-floor-name-normal"),t.classList.add("fm-floor-name-active"),this.changeScrollBtnPic())}},{key:"allLayer",get:function(){return this._},set:function(t){this.D&&((this._=t)?this.D.setVisibleLevels(this.D.getFloorInfos().map(function(t){return t.level})):this.D.setVisibleLevels([this.D.level]))}},{key:"handleBuildingEntered",value:function(i){var n=this;null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){var t;n.switchBuilding(),n.u.followFocus&&(n.D=n.u.getBuilding(i.buildingID),n.D&&(n.D.overviewMode==fengmap.FMOverviewMode.NORMAL||n.D.overviewMode==fengmap.FMOverviewMode.INDOOR||n.u.focusBuilding&&n.u.focusBuilding.buildingID==n.u.getState().viewBuildingID)&&(t=n.D.level,n.changeFocusLevel(t)))},200)}},{key:"handleBuildingExited",value:function(t){var i=this;null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){var t;i.switchBuilding(),i.u.followFocus&&(t=i.D,(t=null==i.D?i.u.getBuilding(i.u.getMapOptions().buildingID):t)&&(null!==i.U&&!1===i.J&&i.U.finish(),i.J=!1,t.setLevel({level:t.level,finish:function(){i.J=!0},callback:function(t){i.U=t}})))},200)}},{key:"handleBuildingOverviewModeChanged",value:function(){this.switchBuilding()}},{key:"handleViewBuildingChange",value:function(){this.switchBuilding()}}])&&O(t.prototype,n),e&&O(t,e),i}(),T={MODULE_SHORTEST:1,MODULE_BEST:2},S={PRIORITY_DEFAULT:1,PRIORITY_LIFTFIRST:2,PRIORITY_ESCALATORFIRST:3,PRIORITY_STAIRFIRST:4,PRIORITY_LIFTONLY:5,PRIORITY_ESCALATORONLY:6,PRIORITY_STAIRONLY:7,PRIORITY_ACCESSIBLEONLY:8,PRIORITY_LIFTFIRST1:9,PRIORITY_ESCALATORFIRST1:10,PRIORITY_STAIRFIRST1:11},j={ZH:"zh",EN:"en"};var A=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)};Object.assign(A.prototype,{$:function(t,i){void 0===this.tt&&(this.tt={});var n=this.tt;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},it:function(t,i){if(void 0===this.tt)return!1;var n=this.tt;return void 0!==n[t]&&-1!==n[t].indexOf(i)},nt:function(t,i){void 0!==this.tt&&(void 0===(t=this.tt[t])||-1!==(i=t.indexOf(i))&&t.splice(i,1))},et:function(t){if(void 0!==this.tt){var i=this.tt[t.type];if(void 0!==i)for(var n=i.slice(0),e=0,r=n.length;e<r;e++)n[e].call(this,t)}}});var x=A;function C(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var L=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}var t,n,e;return t=i,(n=[{key:"start",value:function(){this.startTime=_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t,i=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(i=((t=_())-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=i),i)}}])&&C(t.prototype,n),e&&C(t,e),i}();function _(){return("undefined"==typeof performance?Date:performance).now()}for(var I=[],P=0;P<256;P++)I[P]=(P<16?"0":"")+P.toString(16);var B=1234567,F={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return(I[255&t]+I[t>>8&255]+I[t>>16&255]+I[t>>24&255]+"-"+I[255&i]+I[i>>8&255]+"-"+I[i>>16&15|64]+I[i>>24&255]+"-"+I[63&n|128]+I[n>>8&255]+"-"+I[n>>16&255]+I[n>>24&255]+I[255&e]+I[e>>8&255]+I[e>>16&255]+I[e>>24&255]).toUpperCase()},clamp:function(t,i,n){return Math.max(i,Math.min(n,t))},euclideanModulo:function(t,i){return(t%i+i)%i},mapLinear:function(t,i,n,e,r){return e+(t-i)*(r-e)/(n-i)},lerp:function(t,i,n){return(1-n)*t+n*i},smoothstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*(3-2*t)},smootherstep:function(t,i,n){return t<=i?0:n<=t?1:(t=(t-i)/(n-i))*t*t*(t*(6*t-15)+10)},randInt:function(t,i){return t+Math.floor(Math.random()*(i-t+1))},randFloat:function(t,i){return t+Math.random()*(i-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return((B=16807*(B=void 0!==t?t%2147483647:B)%2147483647)-1)/2147483646},degToRad:function(t){return t*F.DEG2RAD},radToDeg:function(t){return t*F.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,i,n,e,r){var s=Math.cos,o=Math.sin,u=s(n/2),h=o(n/2),a=s((i+e)/2),c=o((i+e)/2),f=s((i-e)/2),l=o((i-e)/2),v=s((e-i)/2),d=o((e-i)/2);switch(r){case"XYX":t.set(u*c,h*f,h*l,u*a);break;case"YZY":t.set(h*l,u*c,h*f,u*a);break;case"ZXZ":t.set(h*f,h*l,u*c,u*a);break;case"XZX":t.set(u*c,h*d,h*v,u*a);break;case"YXY":t.set(h*v,u*c,h*d,u*a);break;case"ZYZ":t.set(h*d,h*v,u*c,u*a);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};function N(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var D=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),Object.defineProperty(this,"isQuaternion",{value:!0}),this.rt=t,this.st=i,this.ot=n,this.ut=e}var t,i,n;return t=r,n=[{key:"slerp",value:function(t,i,n,e){return n.copy(t).slerp(i,e)}},{key:"slerpFlat",value:function(t,i,n,e,r,s,o){var u=n[e+0],h=n[e+1],a=n[e+2],c=n[e+3],f=r[s+0],l=r[s+1],v=r[s+2],d=r[s+3];c===d&&u===f&&h===l&&a===v||(n=1-o,r=0<=(e=u*f+h*l+a*v+c*d)?1:-1,(s=1-e*e)>Number.EPSILON&&(s=Math.sqrt(s),e=Math.atan2(s,e*r),n=Math.sin(n*e)/s,o=Math.sin(o*e)/s),u=u*n+f*(r=o*r),h=h*n+l*r,a=a*n+v*r,c=c*n+d*r,n===1-o&&(u*=o=1/Math.sqrt(u*u+h*h+a*a+c*c),h*=o,a*=o,c*=o)),t[i]=u,t[i+1]=h,t[i+2]=a,t[i+3]=c}},{key:"multiplyQuaternionsFlat",value:function(t,i,n,e,r,s){var o=n[e],u=n[e+1],h=n[e+2],a=n[e+3],c=r[s],n=r[s+1],e=r[s+2],s=r[s+3];return t[i]=o*s+a*c+u*e-h*n,t[i+1]=u*s+a*n+h*c-o*e,t[i+2]=h*s+a*e+o*n-u*c,t[i+3]=a*s-o*c-u*n-h*e,t}}],(i=[{key:"x",get:function(){return this.rt},set:function(t){this.rt=t,this.ht()}},{key:"y",get:function(){return this.st},set:function(t){this.st=t,this.ht()}},{key:"z",get:function(){return this.ot},set:function(t){this.ot=t,this.ht()}},{key:"w",get:function(){return this.ut},set:function(t){this.ut=t,this.ht()}},{key:"set",value:function(t,i,n,e){return this.rt=t,this.st=i,this.ot=n,this.ut=e,this.ht(),this}},{key:"clone",value:function(){return new this.constructor(this.rt,this.st,this.ot,this.ut)}},{key:"copy",value:function(t){return this.rt=t.x,this.st=t.y,this.ot=t.z,this.ut=t.w,this.ht(),this}},{key:"setFromEuler",value:function(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t.rt,e=t.st,r=t.ot,s=t.ct,o=Math.cos,t=Math.sin,u=o(n/2),h=o(e/2),a=o(r/2),c=t(n/2),f=t(e/2),l=t(r/2);switch(s){case"XYZ":this.rt=c*h*a+u*f*l,this.st=u*f*a-c*h*l,this.ot=u*h*l+c*f*a,this.ut=u*h*a-c*f*l;break;case"YXZ":this.rt=c*h*a+u*f*l,this.st=u*f*a-c*h*l,this.ot=u*h*l-c*f*a,this.ut=u*h*a+c*f*l;break;case"ZXY":this.rt=c*h*a-u*f*l,this.st=u*f*a+c*h*l,this.ot=u*h*l+c*f*a,this.ut=u*h*a-c*f*l;break;case"ZYX":this.rt=c*h*a-u*f*l,this.st=u*f*a+c*h*l,this.ot=u*h*l-c*f*a,this.ut=u*h*a+c*f*l;break;case"YZX":this.rt=c*h*a+u*f*l,this.st=u*f*a+c*h*l,this.ot=u*h*l-c*f*a,this.ut=u*h*a-c*f*l;break;case"XZY":this.rt=c*h*a-u*f*l,this.st=u*f*a-c*h*l,this.ot=u*h*l+c*f*a,this.ut=u*h*a+c*f*l;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==i&&this.ht(),this}},{key:"setFromAxisAngle",value:function(t,i){var n=i/2,i=Math.sin(n);return this.rt=t.x*i,this.st=t.y*i,this.ot=t.z*i,this.ut=Math.cos(n),this.ht(),this}},{key:"setFromRotationMatrix",value:function(t){var i,n=t.elements,e=n[0],r=n[4],s=n[8],o=n[1],u=n[5],h=n[9],a=n[2],c=n[6],t=n[10],n=e+u+t;return 0<n?(n=.5/Math.sqrt(n+1),this.ut=.25/n,this.rt=(c-h)*n,this.st=(s-a)*n,this.ot=(o-r)*n):u<e&&t<e?(i=2*Math.sqrt(1+e-u-t),this.ut=(c-h)/i,this.rt=.25*i,this.st=(r+o)/i,this.ot=(s+a)/i):t<u?(i=2*Math.sqrt(1+u-e-t),this.ut=(s-a)/i,this.rt=(r+o)/i,this.st=.25*i,this.ot=(h+c)/i):(u=2*Math.sqrt(1+t-e-u),this.ut=(o-r)/u,this.rt=(s+a)/u,this.st=(h+c)/u,this.ot=.25*u),this.ht(),this}},{key:"setFromUnitVectors",value:function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this.rt=-t.y,this.st=t.x,this.ot=0):(this.rt=0,this.st=-t.z,this.ot=t.y)):(this.rt=t.y*i.z-t.z*i.y,this.st=t.z*i.x-t.x*i.z,this.ot=t.x*i.y-t.y*i.x),this.ut=n,this.normalize()}},{key:"angleTo",value:function(t){return 2*Math.acos(Math.abs(F.clamp(this.dot(t),-1,1)))}},{key:"rotateTowards",value:function(t,i){var n=this.angleTo(t);if(0===n)return this;n=Math.min(1,i/n);return this.slerp(t,n),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.rt*=-1,this.st*=-1,this.ot*=-1,this.ht(),this}},{key:"dot",value:function(t){return this.rt*t.rt+this.st*t.st+this.ot*t.ot+this.ut*t.ut}},{key:"lengthSq",value:function(){return this.rt*this.rt+this.st*this.st+this.ot*this.ot+this.ut*this.ut}},{key:"length",value:function(){return Math.sqrt(this.rt*this.rt+this.st*this.st+this.ot*this.ot+this.ut*this.ut)}},{key:"normalize",value:function(){var t=this.length();return 0===t?(this.rt=0,this.st=0,this.ot=0,this.ut=1):(this.rt=this.rt*(t=1/t),this.st=this.st*t,this.ot=this.ot*t,this.ut=this.ut*t),this.ht(),this}},{key:"multiply",value:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"multiplyQuaternions",value:function(t,i){var n=t.rt,e=t.st,r=t.ot,s=t.ut,o=i.rt,u=i.st,t=i.ot,i=i.ut;return this.rt=n*i+s*o+e*t-r*u,this.st=e*i+s*u+r*o-n*t,this.ot=r*i+s*t+n*u-e*o,this.ut=s*i-n*o-e*u-r*t,this.ht(),this}},{key:"slerp",value:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var n=this.rt,e=this.st,r=this.ot,s=this.ut,o=s*t.ut+n*t.rt+e*t.st+r*t.ot;if(o<0?(this.ut=-t.ut,this.rt=-t.rt,this.st=-t.st,this.ot=-t.ot,o=-o):this.copy(t),1<=o)return this.ut=s,this.rt=n,this.st=e,this.ot=r,this;t=1-o*o;if(t<=Number.EPSILON){var u=1-i;return this.ut=u*s+i*this.ut,this.rt=u*n+i*this.rt,this.st=u*e+i*this.st,this.ot=u*r+i*this.ot,this.normalize(),this.ht(),this}u=Math.sqrt(t),t=Math.atan2(u,o),o=Math.sin((1-i)*t)/u,u=Math.sin(i*t)/u;return this.ut=s*o+this.ut*u,this.rt=n*o+this.rt*u,this.st=e*o+this.st*u,this.ot=r*o+this.ot*u,this.ht(),this}},{key:"equals",value:function(t){return t.rt===this.rt&&t.st===this.st&&t.ot===this.ot&&t.ut===this.ut}},{key:"fromArray",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.rt=t[i],this.st=t[i+1],this.ot=t[i+2],this.ut=t[i+3],this.ht(),this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.rt,t[i+1]=this.st,t[i+2]=this.ot,t[i+3]=this.ut,t}},{key:"fromBufferAttribute",value:function(t,i){return this.rt=t.getX(i),this.st=t.getY(i),this.ot=t.getZ(i),this.ut=t.getW(i),this}},{key:"_onChange",value:function(t){return this.ht=t,this}},{key:"_onChangeCallback",value:function(){}}])&&N(t.prototype,i),n&&N(t,n),r}();function H(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var U=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=i,this.z=n}var t,i,n;return t=e,(i=[{key:"set",value:function(t,i,n){return void 0===n&&(n=this.z),this.x=t,this.y=i,this.z=n,this}},{key:"setScalar",value:function(t){return this.x=t,this.y=t,this.z=t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setZ",value:function(t){return this.z=t,this}},{key:"setComponent",value:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}},{key:"getComponent",value:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"add",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}},{key:"sub",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}},{key:"multiply",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}},{key:"applyEuler",value:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(G.setFromEuler(t))}},{key:"applyAxisAngle",value:function(t,i){return this.applyQuaternion(G.setFromAxisAngle(t,i))}},{key:"applyMatrix3",value:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6]*e,this.y=t[1]*i+t[4]*n+t[7]*e,this.z=t[2]*i+t[5]*n+t[8]*e,this}},{key:"applyNormalMatrix",value:function(t){return this.applyMatrix3(t).normalize()}},{key:"applyMatrix4",value:function(t){var i=this.x,n=this.y,e=this.z,r=t.elements,t=1/(r[3]*i+r[7]*n+r[11]*e+r[15]);return this.x=(r[0]*i+r[4]*n+r[8]*e+r[12])*t,this.y=(r[1]*i+r[5]*n+r[9]*e+r[13])*t,this.z=(r[2]*i+r[6]*n+r[10]*e+r[14])*t,this}},{key:"applyQuaternion",value:function(t){var i=this.x,n=this.y,e=this.z,r=t.x,s=t.y,o=t.z,u=t.w,h=u*i+s*e-o*n,a=u*n+o*i-r*e,t=u*e+r*n-s*i,e=-r*i-s*n-o*e;return this.x=h*u+e*-r+a*-o-t*-s,this.y=a*u+e*-s+t*-r-h*-o,this.z=t*u+e*-o+h*-s-a*-r,this}},{key:"project",value:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}},{key:"unproject",value:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}},{key:"transformDirection",value:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*e,this.y=t[1]*i+t[5]*n+t[9]*e,this.z=t[2]*i+t[6]*n+t[10]*e,this.normalize()}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}},{key:"clampScalar",value:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}},{key:"clampLength",value:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"lerp",value:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}},{key:"lerpVectors",value:function(t,i,n){return this.x=t.x+(i.x-t.x)*n,this.y=t.y+(i.y-t.y)*n,this.z=t.z+(i.z-t.z)*n,this}},{key:"cross",value:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)}},{key:"crossVectors",value:function(t,i){var n=t.x,e=t.y,r=t.z,s=i.x,t=i.y,i=i.z;return this.x=e*i-r*t,this.y=r*s-n*i,this.z=n*t-e*s,this}},{key:"projectOnVector",value:function(t){var i=t.lengthSq();if(0===i)return this.set(0,0,0);i=t.dot(this)/i;return this.copy(t).multiplyScalar(i)}},{key:"projectOnPlane",value:function(t){return V.copy(this).projectOnVector(t),this.sub(V)}},{key:"reflect",value:function(t){return this.sub(V.copy(t).multiplyScalar(2*this.dot(t)))}},{key:"angleTo",value:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;i=this.dot(t)/i;return Math.acos(F.clamp(i,-1,1))}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return i*i+n*n+t*t}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"setFromSpherical",value:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}},{key:"setFromSphericalCoords",value:function(t,i,n){var e=Math.sin(i)*t;return this.x=e*Math.sin(n),this.y=Math.cos(i)*t,this.z=e*Math.cos(n),this}},{key:"setFromCylindrical",value:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}},{key:"setFromCylindricalCoords",value:function(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this}},{key:"setFromMatrixPosition",value:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=t,this}},{key:"setFromMatrixColumn",value:function(t,i){return this.fromArray(t.elements,4*i)}},{key:"setFromMatrix3Column",value:function(t,i){return this.fromArray(t.elements,3*i)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"fromArray",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},{key:"fromBufferAttribute",value:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}])&&H(t.prototype,i),n&&H(t,n),e}(),V=new U,G=new D;function z(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var q=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.ft={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.lt={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}var i,n,e;return i=t,(n=[{key:"min",get:function(){return this.ft}},{key:"max",get:function(){return this.lt}},{key:"center",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=(this.min.x+this.max.x)/2,t.y=(this.min.y+this.max.y)/2),t}},{key:"size",get:function(){var t={x:Number.NaN,y:Number.NaN};return this.valid()&&(t.x=this.max.x-this.min.x,t.y=this.max.y-this.min.y),t}},{key:"copy",value:function(t){return this.lt.x=t.max.x,this.lt.y=t.max.y,this.ft.x=t.min.x,this.ft.y=t.min.y,this}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"reset",value:function(){this.ft={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.lt={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE}}},{key:"toObject",value:function(){return{min:this.min,max:this.max,center:this.center,size:this.size}}},{key:"expand",value:function(t){this.vt(t)}},{key:"expandByCoords",value:function(t){this.dt(t)}},{key:"valid",value:function(){return this.yt()}},{key:"isCross",value:function(t){var i=!0;return t.max.x<this.min.x&&(i=!1),t.min.x>this.max.x&&(i=!1),t.max.y<this.min.y&&(i=!1),i=t.min.y>this.max.y?!1:i}}])&&z(i.prototype,n),e&&z(i,e),t}();Object.assign(q.prototype,{yt:function(){return!(this.min.x>this.max.x||this.min.y>this.max.y)},vt:function(t){t&&t.valid()&&(t.min.x<this.min.x&&(this.min.x=t.min.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.x>this.max.x&&(this.max.x=t.max.x),t.max.y>this.max.y&&(this.max.y=t.max.y))},dt:function(t){var i=this;t&&0!=t.length&&t.forEach(function(t){t.x<i.min.x&&(i.min.x=t.x),t.y<i.min.y&&(i.min.y=t.y),t.x>i.max.x&&(i.max.x=t.x),t.y>i.max.y&&(i.max.y=t.y)})}});var Z=q,X=function(t,i,n){n=n||2;var e,r,s,o,u,h=i&&i.length,a=h?i[0]*n:t.length,c=W(t,0,a,n,!0),f=[];if(!c||c.next===c.prev)return f;if(h&&(c=function(t,i,n,e){var r,s,o,u,h=[];for(r=0,s=i.length;r<s;r++)o=i[r]*e,u=r<s-1?i[r+1]*e:t.length,(u=W(t,o,u,e,!1))===u.next&&(u.steiner=!0),h.push(function(t){var i=t,n=t;for(;(i.x<n.x||i.x===n.x&&i.y<n.y)&&(n=i),i=i.next,i!==t;);return n}(u));for(h.sort(J),r=0;r<h.length;r++)!function(t,i){(i=function(t,i){var n,e=i,r=t.x,s=t.y,o=-1/0;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var u=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=r&&o<u){if((o=u)===r){if(s===e.y)return e;if(s===e.next.y)return e.next}n=e.x<e.next.x?e:e.next}}}while(e=e.next,e!==i);if(!n)return null;if(r===o)return n;var h,a=n,c=n.x,f=n.y,l=1/0;e=n;for(;r>=e.x&&e.x>=c&&r!==e.x&&tt(s<f?r:o,s,c,f,s<f?o:r,s,e.x,e.y)&&(h=Math.abs(s-e.y)/(r-e.x),ot(e,t)&&(h<l||h===l&&(e.x>n.x||e.x===n.x&&function(t,i){return it(t.prev,t,i.prev)<0&&it(i.next,t,t.next)<0}(n,e)))&&(n=e,l=h)),e=e.next,e!==a;);return n}(t,i))&&(t=ut(i,t),Q(i,i.next),Q(t,t.next))}(h[r],n),n=Q(n,n.next);return n}(t,i,c,n)),t.length>80*n){for(var l=e=t[0],v=r=t[1],d=n;d<a;d+=n)(s=t[d])<l&&(l=s),(o=t[d+1])<v&&(v=o),e<s&&(e=s),r<o&&(r=o);u=0!==(u=Math.max(e-l,r-v))?1/u:0}return K(c,f,n,l,v,u),f};function W(t,i,n,e,r){var s,o;if(r===0<function(t,i,n,e){for(var r=0,s=i,o=n-e;s<n;s+=e)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,i,n,e))for(s=i;s<n;s+=e)o=ht(s,t[s],t[s+1],o);else for(s=n-e;i<=s;s-=e)o=ht(s,t[s],t[s+1],o);return o&&nt(o,o.next)&&(at(o),o=o.next),o}function Q(t,i){if(!t)return t;i=i||t;var n,e=t;do{if(n=!1,e.steiner||!nt(e,e.next)&&0!==it(e.prev,e,e.next))e=e.next;else{if(at(e),(e=i=e.prev)===e.next)break;n=!0}}while(n||e!==i);return i}function K(t,i,n,e,r,s,o){if(t){!o&&s&&function(t,i,n,e){var r=t;for(;null===r.z&&(r.z=$(r.x,r.y,i,n,e)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var i,n,e,r,s,o,u,h,a=1;do{for(n=t,s=t=null,o=0;n;){for(o++,e=n,i=u=0;i<a&&(u++,e=e.nextZ);i++);for(h=a;0<u||0<h&&e;)0!==u&&(0===h||!e||n.z<=e.z)?(n=(r=n).nextZ,u--):(e=(r=e).nextZ,h--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=e}}while(s.nextZ=null,a*=2,1<o)}(r)}(t,e,r,s);for(var u,h,a=t;t.prev!==t.next;)if(u=t.prev,h=t.next,s?function(t,i,n,e){var r=t.prev,s=t,o=t.next;if(0<=it(r,s,o))return!1;var u=(r.x<s.x?r.x<o.x?r:o:s.x<o.x?s:o).x,h=(r.y<s.y?r.y<o.y?r:o:s.y<o.y?s:o).y,a=(r.x>s.x?r.x>o.x?r:o:s.x>o.x?s:o).x,c=(r.y>s.y?r.y>o.y?r:o:s.y>o.y?s:o).y,f=$(u,h,i,n,e),l=$(a,c,i,n,e),v=t.prevZ,d=t.nextZ;for(;v&&v.z>=f&&d&&d.z<=l;){if(v!==t.prev&&v!==t.next&&tt(r.x,r.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=it(v.prev,v,v.next))return!1;if(v=v.prevZ,d!==t.prev&&d!==t.next&&tt(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=it(d.prev,d,d.next))return!1;d=d.nextZ}for(;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&tt(r.x,r.y,s.x,s.y,o.x,o.y,v.x,v.y)&&0<=it(v.prev,v,v.next))return!1;v=v.prevZ}for(;d&&d.z<=l;){if(d!==t.prev&&d!==t.next&&tt(r.x,r.y,s.x,s.y,o.x,o.y,d.x,d.y)&&0<=it(d.prev,d,d.next))return!1;d=d.nextZ}return!0}(t,e,r,s):function(t){var i=t.prev,n=t,e=t.next;if(0<=it(i,n,e))return!1;var r=t.next.next;for(;r!==t.prev;){if(tt(i.x,i.y,n.x,n.y,e.x,e.y,r.x,r.y)&&0<=it(r.prev,r,r.next))return!1;r=r.next}return!0}(t))i.push(u.i/n),i.push(t.i/n),i.push(h.i/n),at(t),t=h.next,a=h.next;else if((t=h)===a){o?1===o?K(t=function(t,i,n){var e=t;do{var r=e.prev,s=e.next.next}while(!nt(r,s)&&et(r,e,e.next,s)&&ot(r,s)&&ot(s,r)&&(i.push(r.i/n),i.push(e.i/n),i.push(s.i/n),at(e),at(e.next),e=t=s),e=e.next,e!==t);return Q(e)}(Q(t),i,n),i,n,e,r,s,2):2===o&&function(t,i,n,e,r,s){var o=t;do{for(var u=o.next.next;u!==o.prev;){if(o.i!==u.i&&function(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==i.i&&n.next.i!==i.i&&et(n,n.next,t,i))return!0}while(n=n.next,n!==t);return!1}(t,i)&&(ot(t,i)&&ot(i,t)&&function(t,i){var n=t,e=!1,r=(t.x+i.x)/2,s=(t.y+i.y)/2;for(;n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(e=!e),n=n.next,n!==t;);return e}(t,i)&&(it(t.prev,t,i.prev)||it(t,i.prev,i))||nt(t,i)&&0<it(t.prev,t,t.next)&&0<it(i.prev,i,i.next))}(o,u)){var h=ut(o,u);return o=Q(o,o.next),h=Q(h,h.next),K(o,i,n,e,r,s),K(h,i,n,e,r,s)}u=u.next}}while(o=o.next,o!==t)}(t,i,n,e,r,s):K(Q(t),i,n,e,r,s,1);break}}}function J(t,i){return t.x-i.x}function $(t,i,n,e,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-e)*r)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function tt(t,i,n,e,r,s,o,u){return 0<=(r-o)*(i-u)-(t-o)*(s-u)&&0<=(t-o)*(e-u)-(n-o)*(i-u)&&0<=(n-o)*(s-u)-(r-o)*(e-u)}function it(t,i,n){return(i.y-t.y)*(n.x-i.x)-(i.x-t.x)*(n.y-i.y)}function nt(t,i){return t.x===i.x&&t.y===i.y}function et(t,i,n,e){var r=st(it(t,i,n)),s=st(it(t,i,e)),o=st(it(n,e,t)),u=st(it(n,e,i));return r!==s&&o!==u||(0===r&&rt(t,n,i)||(0===s&&rt(t,e,i)||(0===o&&rt(n,t,e)||!(0!==u||!rt(n,i,e)))))}function rt(t,i,n){return i.x<=Math.max(t.x,n.x)&&i.x>=Math.min(t.x,n.x)&&i.y<=Math.max(t.y,n.y)&&i.y>=Math.min(t.y,n.y)}function st(t){return 0<t?1:t<0?-1:0}function ot(t,i){return it(t.prev,t,t.next)<0?0<=it(t,i,t.next)&&0<=it(t,t.prev,i):it(t,i,t.prev)<0||it(t,t.next,i)<0}function ut(t,i){var n=new ct(t.i,t.x,t.y),e=new ct(i.i,i.x,i.y),r=t.next,s=i.prev;return(t.next=i).prev=t,(n.next=r).prev=n,(e.next=n).prev=e,(s.next=e).prev=s,e}function ht(t,i,n,e){n=new ct(t,i,n);return e?(n.next=e.next,(n.prev=e).next.prev=n,e.next=n):(n.prev=n).next=n,n}function at(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ct(t,i,n){this.i=t,this.x=i,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ft(t){return function(t){if(Array.isArray(t))return lt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,i){if(t){if("string"==typeof t)return lt(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(t,i):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}var vt={area:function(t){for(var i=t.length,n=0,e=i-1,r=0;r<i;e=r++)n+=t[e].x*t[r].y-t[r].x*t[e].y;return.5*n},isClockWise:function(t){return vt.area(t)<0},triangulateShape:function(t,i){var n=[],e=[],r=[];dt(t),yt(n,t);var s=t.length;i.forEach(dt);for(var o=0;o<i.length;o++)e.push(s),s+=i[o].length,yt(n,i[o]);for(var u=X(n,e),h=0;h<u.length;h+=3)r.push(u.slice(h,h+3));return r},triangulate:function(t){(r=[]).push.apply(r,ft(t[0]));for(var i=[],n=1;n<t.length;n++){var e=[];e.push.apply(e,ft(t[n])),i.push(e)}if(!vt.isClockWise(r))for(var r=r.reverse(),s=0,o=i.length;s<o;s++){var u=i[s];vt.isClockWise(u)&&(i[s]=u.reverse())}return vt.triangulateShape(r,i)}};function dt(t){var i,n=t.length;2<n&&(i=t[n-1],n=t[0],i.x===n.x&&i.y===n.y)&&t.pop()}function yt(t,i){for(var n=0;n<i.length;n++)t.push(i[n].x),t.push(i[n].y)}var pt=1e-5,bt=.001,mt=Math.PI/180,wt=180/Math.PI,gt=function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t)};Object.assign(gt.prototype,{pt:function(){return pt},bt:function(){return mt},mt:function(){return wt},wt:function(t){return t<pt&&-pt<t},gt:function(t){return pt<t},Mt:function(t){return t<-pt},kt:function(t,i,n){n=(t.x-n.x)*(i.y-n.y)-(i.x-n.x)*(t.y-n.y);return Math.abs(n)<pt?0:n},distanceOfTwoPoints:function(t,i){return t&&i?Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)):Number.NaN},distance:function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))},isPolygonContainPoint:function(t,i){for(var n=0,e=0;e<t.length;e++){var r=t[e].x,s=t[e].y,o=0,u=0,u=e<t.length-1?(o=t[e+1].x,t[e+1].y):(o=t[0].x,t[0].y);if(r===i.x&&s===i.y||o===i.x&&u===i.y)return!0;if(u!==s){var h=r+(i.y-s)*(o-r)/(u-s);if(h===i.x)return!0;r!==o?h<=Math.max(r,o)&&h>=Math.min(r,o)&&h>i.x&&h!==r&&(h===o&&0<(s-i.y)*(u-i.y)?n+=2:n++):h<=Math.max(r,o)&&h>=Math.min(r,o)&&h>i.x&&(h===o&&0<(s-i.y)*(u-i.y)?n+=2:n++)}}return 0<n%2},Et:function(t,i,n,e){return!(Math.max(t.x,i.x)<Math.min(n.x,e.x))&&(!(Math.max(t.y,i.y)<Math.min(n.y,e.y))&&(!(Math.max(n.x,e.x)<Math.min(t.x,i.x))&&!(Math.max(n.y,e.y)<Math.min(t.y,i.y))))},Ot:function(t,i,n,e){return!(Math.max(t.x,i.x)<Math.min(n.x,e.x))&&(!(Math.max(t.y,i.y)<Math.min(n.y,e.y))&&(!(Math.max(n.x,e.x)<Math.min(t.x,i.x))&&(!(Math.max(n.y,e.y)<Math.min(t.y,i.y))&&((0!==this.kt(n,i,t)||0!==this.kt(i,e,t))&&(!(this.kt(n,i,t)*this.kt(i,e,t)<0)&&!(this.kt(t,e,n)*this.kt(e,i,n)<0))))))},Rt:function(t,i,n){return!(t.x<i.x)&&(!(t.y<i.y)&&(!(t.x>n.x)&&!(t.y>n.y)))},Tt:function(t,i,n){var e=Math.min(i.x,n.x),r=Math.max(i.x,n.x),s=Math.min(i.y,n.y),n=Math.max(i.y,n.y);return!(t.x<e||t.x>r||t.y<s||t.y>n)},St:function(t,i,n){var e=Math.min(n.x,i.x),r=Math.max(n.x,i.x),s=Math.min(n.y,i.y),i=Math.max(n.y,i.y);return!(t.x<e||t.x>r||t.y<s||t.y>i)},jt:function(t,i,n){for(var e,r,s=!1,o=0;o<n;o++)e=i[o],r=i[(o+1)%n],(e.y<t.y&&r.y>=t.y||r.y<t.y&&e.y>=t.y)&&(e.x<=t.x||r.x<=t.x)&&e.x+(t.y-e.y)/(r.y-e.y)*(r.x-e.x)<t.x&&(s=!s);return s},At:function(t,i,n){return(t.x-i.x)*(n.y-i.y)==(n.x-i.x)*(t.y-i.y)&&Math.min(i.x,n.x)<=t.x&&t.x<=Math.max(i.x,n.x)&&Math.min(i.y,n.y)<=t.y&&t.y<=Math.max(i.y,n.y)},xt:function(t,i){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))},Ct:function(t,i){return(t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y)},Lt:function(t,i,n){var e=i.x,r=i.y,s=n.x,o=n.y,u=t.x,h=t.y,a=s-e,c=o-r,f=a*a+c*c,i=u-e,n=h-r,t=i*i+n*n;if(this.wt(f))return l=this.wt(t)?0:t;var l,f=Math.sqrt(f),a=a/f,c=c/f,n=a*i+c*n;return l=this.gt(n)?this.Mt(n-f)?(a=u-(e+n*a))*a+(c=h-(r+n*c))*c:(s=u-s)*s+(o=h-o)*o:t,this.wt(l)?0:l},_t:function(t,i,n,e){var r=i.x,s=i.y,o=n.x,u=n.y,h=t.x,a=t.y,c=o-r,f=u-s,l=Math.sqrt(c*c+f*f),v=h-r,d=a-s,t=Math.sqrt(v*v+d*d);if(this.wt(l))return e.x=i.x,e.y=i.y,this.wt(y=t)?0:y;var c=c/l,f=f/l,d=c*v+f*d,y=this.gt(d)?this.Mt(d-l)?(c=h-(r=r+d*c),f=a-(d=s+d*f),f=Math.sqrt(c*c+f*f),e.x=r,e.y=d,f):(o=h-o,u=a-u,u=Math.sqrt(o*o+u*u),e.x=n.x,e.y=n.y,u):(e.x=i.x,e.y=i.y,t);return this.wt(y)?0:y},It:function(t,i){for(var n=0,e=0,r=0,s=0;s<i;s++){var o=t[s],u=t[(s+1)%i],h=(o.x*u.y-o.y*u.x)/2;n+=h,e+=h*(o.x+u.x)/3,r+=h*(o.y+u.y)/3}return{x:e/=n,y:r/=n}},Pt:function(t){for(var i=vt.triangulate([t]),n=0,e=0,r=0,s=0;s<i.length;s++){var o=t[i[s][0]],u=t[i[s][1]],h=t[i[s][2]],a=u.x-o.x,c=u.y-o.y,f=h.x-o.x,c=(a*(h.y-o.y)-f*c)/2;n+=c,e+=(o.x+u.x+h.x)/3*c,r+=(o.y+u.y+h.y)/3*c}return{x:e/n,y:r/n}},Bt:function(t,i){if(i<3)return 0;for(var n=0,e=0;e<i;++e){var r=t[e],s=t[(e+1)%i];n+=r.x*s.y-r.y*s.x}return Math.abs(n/2)},Ft:function(t,i,n,e,r){if(this.Ot(t,i,n,e)){var s=(e.x-n.x)*(t.y-i.y)-(i.x-t.x)*(n.y-e.y),o=(t.y-n.y)*(i.x-t.x)*(e.x-n.x)+n.x*(e.y-n.y)*(i.x-t.x)-t.x*(i.y-t.y)*(e.x-n.x);return r.x=o/s,s=(t.x-i.x)*(e.y-n.y)-(i.y-t.y)*(n.x-e.x),o=i.y*(t.x-i.x)*(e.y-n.y)+(e.x-i.x)*(e.y-n.y)*(t.y-i.y)-e.y*(n.x-e.x)*(i.y-t.y),r.y=o/s,1}return 0},Nt:function(t,i,n,e,r){var s=Math.min(n.x,e.x),o=Math.max(n.x,e.x),u=Math.min(n.y,e.y),h=Math.max(n.y,e.y),a=t.x,c=t.y,f=n.x,l=n.y,v=e.x,d=e.y;if(90==i){if(t.x<s||t.x>o)return!1;if(Math.abs(o-s<bt))return t.y>=l&&t.y<=d||t.y>=d&&t.y<=l?(r.x=t.x,r.y=t.y,!0):l<d&&t.x<l?(r.x=f,r.y=l,!0):d<l&&t.x<d&&(r.x=v,r.y=d,!0);var y=(d-l)/(v-f)*(a-f)+l;return r.y=y,r.x=a,y<c?!1:!!this.St(r,n,e)}if(270==i){if(t.x<s||t.x>o)return!1;if(Math.abs(o-s<bt))return t.y>=l&&t.y<=d||t.y>=d&&t.y<=l?(r.x=t.x,r.y=t.y,!0):l<d&&t.y>d?(r.x=v,r.y=d,!0):d<l&&t.y>l&&(r.x=f,r.y=l,!0);t=(d-l)/(v-f)*(a-f)+l;return r.y=t,r.x=a,c<t?!1:!!this.St(r,n,e)}if(270!=i&&90!=i&&Math.abs(o-s<bt)){o=s,s=Math.tan(i/180*Math.PI)*(o-a)+c;if(r.y=s,r.x=o,this.St(r,n,e)){o=o-a,s=s-c;return 0<o/Math.sqrt(o*o+s*s)*Math.cos(i/180*Math.PI)}}if(Math.abs(h-u<=bt)){h=u,u=1/Math.tan(i/180*Math.PI)*(h-c)+a;if(r.x=u,r.y=h,this.St(r,n,e)){var u=u-a,p=h-c;return 0<u/Math.sqrt(u*u+p*p)*Math.cos(i/180*Math.PI)}return!1}p=Math.tan(i/180*Math.PI),v=(d-l)/(v-f),v=(l-c-(v*f-p*a))/(p-v),p=c+p*(v-a);if(r.x=v,r.y=p,this.St(r,n,e)){a=v-a,c=p-c;return Math.abs(a)<=bt&&Math.abs(c)<=bt?!0:0<a/Math.sqrt(a*a+c*c)*Math.cos(i/180*Math.PI)}return!1},Dt:function(t,i){return Math.abs(t.x-i.x)<pt&&Math.abs(t.y-i.y)<pt},Ht:function(t,i,n,e){var r=t.x,s=t.y,o=i.x,u=i.y,h=n.x,a=n.y;if(this.Dt(t,i)||this.Dt(t,n))return e.x=r,e.y=s,!0;var c=Math.min(i.x,n.x),f=Math.max(i.x,n.x),l=Math.min(i.y,n.y),v=Math.max(i.y,n.y);if(Math.abs(o-h)<1e-5)return e.x=o,l<=(e.y=s)&&s<=v;if(Math.abs(u-a)<1e-5)return e.x=r,e.y=u,c<=r&&r<=f;f=-1/((a-u)/(h-o)),h=(a-u)/(h-o),h=(u-s-(h*o-f*r))/(f-h),r=s+f*(h-r);return e.x=h,e.y=r,!!this.St(e,i,n)||!(!this.Dt(t,i)&&!this.Dt(t,n))},Ut:function(t,i){return{x:t.y*i.z-t.z*i.y,y:t.z*i.x-t.x*i.z,z:t.x*i.y-t.y*i.x}},Vt:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},Gt:function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},zt:function(t,i){return t.x*i.x+t.y*i.y},qt:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},Zt:function(t,i){if(0==t.x&&0==t.y||0==i.x&&0==i.y)return 0;var n={x:t.x,y:t.y,z:0},e={x:i.x,y:i.y,z:0},n=this.Ut(n,e),e=this.zt(t,i),i=Math.acos(e/(this.qt(t)*this.qt(i)));return 0<n.z?i/Math.PI*180:360-i/Math.PI*180},Yt:function(t,i,n,e){for(var r=0;r<n.length;r++){var s=n[r],o=n[(r+1)%n.length];if(1==this.Ft(t,i,s,o,e))return!0}return!1},Xt:function(t,i,n,e,r){var s=Math.min(t.x,n.x,e.x),o=Math.max(t.x,n.x,e.x),u=Math.min(t.y,n.y,e.y),h=Math.max(t.y,n.y,e.y),h=Math.sqrt((o-s)*(o-s)+(h-u)*(h-u)),u=i/180*Math.PI,i=h*Math.cos(u)+t.x,u=h*Math.sin(u)+t.y;return 1==this.Ft(t,{x:i,y:u},n,e,r)},Wt:function(t){for(var i={x:null,y:null},n=0,e=0,r=0;r<t.length;r++)n+=t[r].x,e+=t[r].y;return i.x=n/t.length,i.y=e/t.length,i},Qt:function(t,i,n,e){var r=[],s=t.x-i,o=t.x+i,u=t.y-i,h=t.y+i,a=Math.min(n.x,e.x),c=Math.max(n.x,e.x),f=Math.min(n.y,e.y),l=Math.max(n.y,e.y);if(c<s||o<a||l<u||h<f)return r;s=e.x-n.x,o=e.y-n.y,u=t.x-n.x,h=t.y-n.y,e=s*s+o*o,t=(s*u+o*h)/e,i=t*t-(u*u+h*h-i*i)/e;if(i<0)return r;e=Math.sqrt(i),i=-t+e,t=-t-e,e={x:n.x-s*i,y:n.y-o*i},o={x:n.x-s*t,y:n.y-o*t};return i===t||(a<=e.x&&e.x<=c&&f<=e.y&&e.y<=l&&r.push(e),a<=o.x&&o.x<=c&&f<=o.y&&o.y<=l&&r.push(o)),r}});var Mt=new gt,kt={Drive:1,Walk:0};function Et(t,i){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=Rt(t))||i&&t&&"number"==typeof t.length){n&&(t=n);var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw r}}}}function Ot(t){return function(t){if(Array.isArray(t))return Tt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Rt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rt(t,i){if(t){if("string"==typeof t)return Tt(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tt(t,i):void 0}}function Tt(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function St(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var jt=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.Kt=t.type,this.stepLength=.7,this.Jt=180/Math.PI,this.$t=[295829355.45,147914677.73,73957338.86,36978669.43,18489334.72,9244667.36,4622333.68,2311166.84,1155583.42,577791.71,288895.85,144447.93,72223.96,36111.98,18056,9028,4514,2257,1128,564,282,141,70,35,17,8,4,2,1],this.u=null,this.ti=null,this.ii=5,this.ni=!0,this.ei=.2,this.ri=!1,this.si=!0,this.oi=!1,this.ui=1.2,this.hi=80,this.ai=30,this.ci=21,this.fi=!0,this.li=22,this.vi=1.3,this.di="",this.yi=100,this.pi=3,this.bi=1,this.mi=6,this.wi=10,this.gi=5,this.Mi=0,this.ki=!1,this.Ei=!1,this.Oi=!1,this.Ri=!1,this.Ti=0,this.Si=0,this.ji=0,this.Ai=0,this.xi=null,this.Ci=null,this.Li=!1,this._i=null,this.Ii=null,this.Pi=!1,this.Bi=!1,this.Fi=null,this.Ni=0,this.Di=fengmap.FMLanguageType.ZH,this.Hi=fengmap.FMNaviMode.MODULE_SHORTEST,this.Ui=fengmap.FMNaviPriority.PRIORITY_DEFAULT,this.Vi=!1,this.Gi=!0,this.zi=[],this.qi=!1,this.Zi=new Map,this.Yi=!0,this.crossCircles,this.Xi={radius:.5,dash:{size:4,gap:2}},this.Wi="#002FA7",this.Qi=!0,this.Ki=0,this.Ji=new L,this.$i=new x,this.tn(t),this.O()}var t,n,e;return t=i,(n=[{key:"locationMarker",get:function(){return this.in},set:function(t){this.in=t}},{key:"naviResult",get:function(){return this.nn}},{key:"followPosition",get:function(){return this.ni},set:function(t){this.ni=t}},{key:"on",value:function(t,i){this.$i.$(t,i)}},{key:"off",value:function(t,i){this.$i.nt(t,i)}},{key:"dispose",value:function(){this.stop(),this.u=null,this.ti&&(this.ti.dispose(),this.ti=null)}},{key:"setLanguage",value:function(t){this.Di!=t&&(this.Di=t,this.en())}},{key:"setObstructions",value:function(t){this.ti.setObstructions(t)}},{key:"setStartPoint",value:function(t,i){this.rn=Object.assign({},this.rn,t,{x:t.x,y:t.y,level:t.level,buildingID:t.buildingID,height:"number"==typeof t.height?t.height:this.mi});var n=null;return n=t.url&&!i?this.sn(this.rn,!0):n}},{key:"setDestPoint",value:function(t,i){this.hn=Object.assign({},this.hn,t,{x:t.x,y:t.y,level:t.level,buildingID:t.buildingID,height:"number"==typeof t.height?t.height:this.mi});var n=null;return n=t.url&&!i?this.sn(this.hn,!1):n}},{key:"route",value:function(t,i,n){this.tn(t),this.an(),this.cn({mode:this.Hi,priority:this.Ui,toDoors:this.Vi,obstruct:this.Gi,viapoints:this.zi,barrierFree:this.qi},i,n)}},{key:"naviConstraint",value:function(t){if(this.rn&&this.hn){null==this.fn&&this.ln(),t.buildingID=void 0!==t.buildingID?t.buildingID:null;for(var i={},n=[],e=Number.MAX_VALUE,r=0,s={index:-1,coords:{level:t.level,buildingID:t.buildingID},angle:null,distance:Number.MAX_VALUE,distanceToNext:Number.MAX_VALUE,remain:this.vn,relDirection:1,time:null,dots:[],insertIndex:-1,toNext:null,buildingIndex:-1},o=0;o<this.fn.length;o++)if(this.fn[o].bid===t.buildingID){for(var u=this.fn[o].naviPoints,h=1;h<u.length;h++){var a,c=u[h-1],f=u[h],l=c.index-r,v=this.dn[o].result.naviDescriptionsData[l].endPoint;c.level!==t.level||f.level!==t.level||(a=Mt._t(t,c,f,i))<=e&&(null!=this.yn&&(l=(t.x-this.yn.x)*(f.x-c.x)+(t.y-this.yn.y)*(f.y-c.y),0===Math.abs(l)&&null!=this.pn?s.relDirection=this.pn.relDirection:l<0&&(s.relDirection=-1)),s.distance=a,Object.assign(s.coords,i),s.angle=this.bn(c,f),s.index=c.index,s.distanceToNext=Mt.xt(i,v),s.insertIndex=h,s.toNext=Mt.xt(i,f),s.buildingIndex=o,n.push(s),e=a)}r+=this.dn[o].result.naviDescriptionsData.length}else r+=this.dn[o].result.naviDescriptionsData.length;var d=s,y=this.mn(n,e);return y&&(this.wn(d=y),d.time=t.time),this.yn=t,this.pn=d}}},{key:"pathConstraint",value:function(t,i){return this.ti?this.ti.pathConstraint(t,i):null}},{key:"locate",value:function(t,i){this.Ei&&this.stop(),this.gn(t,i),this.yn=t}},{key:"locateNoConstraint",value:function(t,i){this.Ei&&this.stop(),this.Mn(t,i),this.yn=t}},{key:"clearLocationMarker",value:function(){this.in&&(this.in.remove(),this.in=null)}},{key:"clearMarkers",value:function(){this.kn&&(this.kn.remove(),this.kn=null,this.rn=null),this.En&&(this.En.remove(),this.En=null,this.hn=null)}},{key:"drawNaviLine",value:function(t){if(this.rn&&this.hn)return this.On=this.Rn(this.Tn,t),this.On}},{key:"clearNaviLine",value:function(){this.On&&(this.On.remove(),this.On=null)}},{key:"clearAll",value:function(){this.clearMarkers(),this.clearNaviLine(),this.clearLocationMarker()}},{key:"overview",value:function(t,i){var n=this;if(0!==this.Tn.length){for(var e=new Z,r=[],s=0;s<this.Tn.length;s++)!function(t){var i=[Number.MAX_VALUE,-Number.MAX_VALUE];n.Tn[t].resultbuild.forEach(function(t){i[0]=Math.min(i[0],t.level),i[1]=Math.max(i[1],t.level),e.dt(t.pointList)}),r.push({bid:n.Tn[t].bid,levelRange:i})}(s);this.Sn(t,e,r,i)}}},{key:"focusNaviLineSegment",value:function(t,i,n){if(0!=this.dn.length){for(var e,r,s,o=null,u=null,h=0;h<this.dn.length;h++){var a=this.dn[h].result.naviDescriptionsData;if(t-a.length<0){o=a[t],u=this.dn[h].bid;break}t-=a.length}u&&o&&((e=new Z).dt([o.startPoint,o.endPoint]),r=[Math.min(o.startLevel,o.endLevel),Math.max(o.startLevel,o.endLevel)],s=this.u.getBuilding(u),this.Sn(i,e,r,s,n))}}},{key:"simulate",value:function(t){var i,n,e=this;this.rn&&this.hn&&0!==this.Tn.length&&(this.Ei&&this.stop(),this.Ei=!0,this.tn(t),this.Li=!(i={}),this._i=this.u.getRotation(),n=i.ui||this.ui,i.ci=i.ci||this.ci||0,this.jn(),this.in.rotateTo({heading:-this._i}),this.ni?this.An(this.rn.level,this.rn.buildingID,n,function(){e.Ei&&e.xn(e.rn,n,function(){var t;e.Ei&&(t=i.ci>e.li?e.li:i.ci,e.fi?e.Cn(e.hi,n,function(){e.Ei&&e.Ln(t,n,function(){e.Ei&&e._n()})}):e.Ln(t,n,function(){e.Ei&&e._n()}))})}):this.Ei&&this._n())}},{key:"pause",value:function(){this.Ri=!0}},{key:"resume",value:function(){this.Ri=!1}},{key:"stop",value:function(){this.ki=!0,this.Ji.stop(),this.In&&this.u.off("update",this.In),this.Ri=!1,this.Ci=null,this.Ii=null,this.ji=0,this.Li=!1,this.Fi=null,this.Ni=0,this.Pi=!1,this.Bi=!1,this.In=null,this.Ei=!1,this.Oi=!1,this.Ti=0,this.Si=0,this.xi=null}},{key:"getSpeed",value:function(){return this.ii}},{key:"setSpeed",value:function(t){this.ii=t}},{key:"addZoomCircle",value:function(t){if(0!=t.length){var i,n=null==t[0].buildingID?null:t[0].buildingID;this.Zi.has(n)?i=this.Zi.get(n):(i=new Map,this.Zi.set(n,i));for(var e,r=0;r<t.length;r++)i.has(t[r].level)||i.set(t[r].level,[]),(e=i.get(t[r].level)).push.apply(e,Ot(t[r].circle))}}},{key:"stopZoomCircle",value:function(){this.Yi=!1}},{key:"constraintTrack",value:function(t){return this.ti.constraintTrack(t)}}])&&St(t.prototype,n),e&&St(t,e),i}();Object.assign(jt.prototype,{tn:function(t){t&&(void 0!==t.map&&(this.u=t.map),void 0!==t.analyser&&(this.ti=t.analyser),void 0!==t.speed&&(this.ii=t.speed),void 0!==t.followSpeed&&(this.ei=t.followSpeed),void 0!==t.followPosition&&(this.ni=t.followPosition),void 0!==t.followAngle&&(this.ri=t.followAngle),void 0!==t.locationMarkerFollowAngle&&(this.si=t.locationMarkerFollowAngle),void 0!==t.isMultiLevels&&(this.oi=t.isMultiLevels),void 0!==t.inTime&&(this.ui=t.inTime),void 0!==t.tiltAngle&&(this.hi=t.tiltAngle),void 0!==t.changeFloorTiltAngle&&(this.ai=t.changeFloorTiltAngle),void 0!==t.changeTiltAngle&&(this.fi=t.changeTiltAngle),void 0!==t.zoom&&(this.ci=t.zoom),void 0!==t.maxZoom&&(this.li=t.maxZoom),void 0!==t.extendScale&&(this.vi=t.extendScale),void 0!==t.locationMarkerUrl&&(this.di=t.locationMarkerUrl),void 0!==t.locationMarkerSize&&(this.yi=t.locationMarkerSize),void 0!==t.locationMarkerHeight&&(this.pi=t.locationMarkerHeight),void 0!==t.lineMarkerHeight&&(this.bi=t.lineMarkerHeight),void 0!==t.imageMarkerHeight&&(this.mi=t.imageMarkerHeight),void 0!==t.directionAssert&&(this.wi=t.directionAssert),void 0!==t.combineAsset&&(this.gi=t.combineAsset),void 0!==t.completeDistance&&(this.Mi=t.completeDistance),void 0!==t.Di&&(this.wi=t.directionAssert),void 0!==t.mode&&(this.Hi=t.mode),void 0!==t.priority&&(this.Ui=t.priority),void 0!==t.toDoors&&(this.Vi=t.toDoors),void 0!==t.obstruct&&(this.Gi=t.obstruct),void 0!==t.viapoints&&(this.zi=t.viapoints),void 0!==t.barrierFree&&(this.qi=t.barrierFree),void 0!==t.lineStyle&&Object.assign(this.Xi,t.lineStyle),void 0!==t.linePassed&&(this.Qi=t.linePassed))},O:function(){1===this.Kt?this.Pn=void 0!==fengmap.FMNaviDriveAnalyser&&this.ti instanceof fengmap.FMNaviDriveAnalyser:this.Pn=void 0!==fengmap.FMNaviAnalyser&&(this.ti instanceof fengmap.FMNaviAnalyser||this.ti instanceof fengmap.FMNaviWalkAnalyser),this.rn=null,this.hn=null,this.kn=null,this.En=null,this.in=null,this.In=null,this.an()},jn:function(){this.in instanceof fengmap.FMLocationMarker?this.in.moveTo({buildingID:this.rn.buildingID,level:this.rn.level,x:this.rn.x,y:this.rn.y}):this.in=new fengmap.FMLocationMarker({id:"location",buildingID:this.rn.buildingID,level:this.rn.level,x:this.rn.x,y:this.rn.y,url:this.di||"",size:this.yi,height:this.pi}),this.in.addTo(this.u)},Bn:function(t){for(var i,n=arguments.length<=1?0:arguments.length-1,e=0;e<n;e++){var r=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(t[r])return t[r]}return(i=(arguments.length<=1?0:arguments.length-1)-1+1)<1||arguments.length<=i?void 0:arguments[i]},Fn:function(t){if(this.rn&&this.hn)return t==this.rn.level||t==this.Nn.level},an:function(){this.nn=null,this.Dn=[],this.Hn=[],this.Tn=[],this.Un=[],this.dn=[],this.fn=[],this.Vn=[],this.Gn=[],this.vn=0,this.zn=[],this.pn=null,this.yn=null},sn:function(t,i){if(t.level){var n=t.url||(i?"image/small/marker/nav_location_start.png":"image/small/marker/nav_location_dest.png"),e=i?this.kn:this.En;e&&e.remove();var r=(null!=t.buildingID?this.u.getBuilding(t.buildingID):this.u).getFloor(t.level);if(r)return(e=new fengmap.FMImageMarker(Object.assign({map:this.u,url:n,callback:function(){t.callback&&t.callback(e)},anchor:fengmap.FMMarkerAnchor.BOTTOM,depth:!1,collision:!1},t))).addTo(r),i?this.kn=e:this.En=e,e}},cn:function(t,i,n){var e=this;this.rn&&this.hn&&(t=Object.assign({start:Object.assign({},this.rn),dest:Object.assign({},this.hn)},t),this.qn(t,function(t){e.nn=t,e.Zn(),e.crossCircles=e.Yn(e.Tn,e.Zi),e.Xn(),e.Wn(),e.Qn(),e.ln(),i&&i(t)},function(t){n&&n(t)}))},Zn:function(){if(this.nn&&this.nn.subs&&0!=this.nn.subs.length){for(var t=this.nn.subs[0].buildingID,i=[],n=[],e=[],r=0;r<this.nn.subs.length;r++){var s=this.nn.subs[r];s.buildingID!==t&&(e.push({bid:t,result:i}),i=[],t=s.buildingID),i.push(s),r==this.nn.subs.length-1&&e.push({bid:t,result:i})}for(var o=0;o<e.length;o++){var u=this.Kn(e[o].result);n.push({bid:e[o].bid,resultbuild:u})}this.Dn=e,this.Tn=n}},Kn:function(t){for(var i=[],n=Number.NaN,e=null,r=0;r<t.length;r++){var s,o=t[r];n!=o.levels[0]&&((e={length:0,level:o.levels[0],pointList:[]}).pointList.push(o.waypoint.points[0]),i.push(e),n=o.levels[0]),o.levels[0]==o.levels[1]?((s=e.pointList).push.apply(s,Ot(o.waypoint.points.slice(1))),e.length+=o.distance):(e={length:0,level:o.levels[0],pointList:[o.waypoint.points[0]]},i.push(e),e={length:0,level:o.levels[1],pointList:[o.waypoint.points[1]]},i.push(e))}return i},Xn:function(){for(var t=0;t<this.Tn.length;t++){var i=this.Tn[t].resultbuild;this.Jn(i)}},Jn:function(t){for(var i=0;i<t.length-1;i++){var n,e,r=t[i];r.length&&(n=r.pointList[r.pointList.length-1],e=t[i+1].pointList[0],.2<Mt.xt(n,e)&&r.pointList.push(Object.assign({},e)))}},Wn:function(){for(var t=0;t<this.Tn.length;t++){var i=this.Tn[t].resultbuild,i=this.$n(i);this.Un.push({bid:this.Tn[t].bid,groupsPoints:i})}},$n:function(t){for(var i=[],n=null,e=null,r=0;r<t.length;r++){var s=t[r],o=n==s.level;0==s.length&&0!=r&&r!=t.length-1||(o||(n=s.level,e&&i.push(e),e={level:s.level,pointList:[]}),e.pointList=e.pointList.concat(s.pointList))}return e&&i.push(e),i},Qn:function(){if(this.nn)for(var t=0;t<this.Dn.length;t++){var i=this.Dn[t].bid,n=this.Dn[t].result,n=this.en(n);this.dn.push({bid:i,result:n}),this.vn+=n.naviDistance}},en:function(t){if(t){for(var i=[],n=[],e=[],r=0,s=this.Di,o=t,u=0,h=null,a=0;a<o.length;a++){var c=o[a],f=c.waypoint.points,l=c.waypoint.direction[s];i.push(c.instruction[s]);l={startDirection:l[0],startIndex:void 0,startLevel:c.levels[0],startPoint:f[0],endDirection:l[1],endIndex:void 0,endLevel:c.levels[1],endPoint:f.slice(-1)[0],distance:c.distance};c.levels[0]==c.levels[1]?(l.startIndex=u,u+=f.length-1,l.endIndex=u):u=0,n.push(l),null!=h&&c.levels[0]==c.levels[1]||(h={level:c.levels[1],distance:0},e.push(h)),h.distance+=c.distance,r+=c.distance}return{naviDescriptions:i,naviDescriptionsData:n,naviFloorsDistance:e,naviDistance:r}}},ln:function(){if(this.Dn){for(var t=0,i=[],n=0;n<this.Dn.length;n++){for(var e=this.Dn[n].result,r=this.Dn[n].bid,s=this.te(e),o=this.ie(e),u=0;u<s.length;u++)s[u].index+=t;for(var h=0;h<o.length;h++)o[h].index+=t;var a=this.dn[n].result.naviDistance;t+=e.length,i.push({bid:r,distance:a,naviPoints:s,naviSubPoints:o})}this.fn=i}},te:function(t){if(!t)return[];for(var i=[],n=t,e=0;e<n.length;e++){var r=n[e];if(r.levels[0]==r.levels[1])for(var s=e+1==n.length?null:n[e+1],o=r.waypoint.points,u=null==s||s.levels[0]!=s.levels[1]?o.length:o.length-1,h=0;h<u;h++){var a={x:o[h].x,y:o[h].y,z:0,level:r.levels[0],index:e};i.push(a)}}return i},ie:function(t){if(!t)return[];for(var i=[],n=t,e=0;e<n.length;e++){var r=n[e].waypoint.points,s={x:r[0].x,y:r[0].y,level:r[0].level,index:e};i.push(s),e==n.length-1&&(r={x:r.slice(-1)[0].x,y:r.slice(-1)[0].y,level:r.slice(-1)[0].level,index:n.length},i.push(r))}return i},mn:function(t,i){var n=null;if(0==t.length)return n;for(var e=[],r=0;r<t.length;)t[r].distance==i&&e.push(t[r]),r+=1;if(1<e.length){for(var s=0;s<e.length;s++)if(0<=e[s].relDirection){n=e[s];break}n=n||e[0]}else 1==e.length&&(n=e[0]);return n},wn:function(t){if(-1!=t.buildingIndex&&-1!==t.insertIndex){for(var i,n,e=t.buildingIndex,r=this.fn[e].naviPoints,s=0,o=r.length-1;o>t.insertIndex;o--)o-1>=t.insertIndex&&(i=r[o],n=r[o-1],i.level===n.level&&(s+=Mt.xt(i,n)));r[t.insertIndex]&&r[t.insertIndex].level===t.coords.level&&(s+=Mt.xt(r[t.insertIndex],t.coords));for(var u=e+1;u<this.fn.length;u++)s+=this.fn[u].distance;t.remain=s}},Rn:function(t,i){if(0===t.length)return null;1===this.Kt&&(this.Xi.hasOwnProperty("color")||(this.Xi.color=this.Wi));var n=Object.assign({},this.Xi);i&&i.style&&Object.assign(n,i.style);for(var s=i&&i.height?i.height:this.bi,o=[],e=0;e<t.length;e++)for(var u=t[e].bid,h=t[e].resultbuild,r=0;r<h.length;r++)(function(t){var i=h[t],n=i.pointList;if(0===n.length)return;var t=i.level,e=[];n.forEach(function(t){var i=parseFloat(""+t.x),t=parseFloat(""+t.y);e.push({x:i,y:t,z:s})}),n.length<2&&(i=parseFloat(""+n[0].x),r=parseFloat(""+n[0].y),e.push({x:i,y:r,z:s}));var r=new fengmap.FMSegment;r.level=t,r.points=e,r.buildingID=u,o.push(r)})(r);n=new fengmap.FMLineMarker(Object.assign({segments:o},n));return n.passed=i&&null!=i.passed?i.passed:this.Qi,n.addTo(this.u),n},qn:function(t,i,n){var e=this;this.ti.route(t,function(t){e.Vi&&t.door&&(e.hn.x=t.door.x,e.hn.y=t.door.y),i&&i(t)},function(t){n&&n(t)})},xn:function(t,i,n){this.u.setCenter({x:t.x,y:t.y,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n})},Cn:function(t,i,n){this.u.setTilt({tilt:t,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n})},ne:function(t,i,n){this.u.setRotation({rotation:t,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n})},Ln:function(t,i,n){this.u.setZoom({zoom:t,animate:"number"==typeof i,duration:"number"==typeof i?i:0,finish:n},!0)},An:function(t,i,n,e){var r,i=null==i?((r=this.u).setVisibleLevels([t]),r.getLevel()):((r=this.u.getBuilding(i)).setVisibleLevels([t]),r.level);return i==t?(e&&e(),null):r.setLevel({level:t,animate:"number"==typeof n,duration:"number"==typeof n?n:0,finish:e})},ee:function(t){var i=this.Hn;if(0===i.length)return[];for(var n=[],e=0,r=0;r<i.length;r++){var s=i[r];if(!(s.pointList.length<=1))for(var o=s.level,u=0;u<s.pointList.length;u++){var h=s.pointList[u],h=new U(h.x,0,h.y);h.level=o;for(var a=-1,c=1;c<t.length;c++)if(e<t[c].re){a=t[c-1].se;break}h.se=-1!==a?a:t[t.length-1].se,n.push(h),e++}}return n},oe:function(t,i){if(0===i)return t[0];for(var n,e=0,r=0,s=t[0],o=1;o<t.length;o++)if((n=t[o]).bid===s.bid)if(n.level===s.level){if(i<=(e+=(u=n.clone().sub(s)).length())){u.normalize();var u=s.clone().add(u.clone().multiplyScalar(i-r));return u.level=n.level,u.index=n.se!=s.index?s.index:n.se,u.bid=(n.bid!=s.bid?s:n).bid,u}(s=n.clone()).level=n.level,s.index=n.se,s.bid=n.bid,r=e}else s=n;else s=n;var h=t[t.length-1];return h.index=h.se,h.bid=h.bid,h},ue:function(t){if(!t||0===t.length)return[];var e=-1,r=0,s=-1,i=t.map(function(t,i){var n=new U(t.startPoint.x,0,t.startPoint.y);return n.level=t.startLevel,n.se=i,e=i,t.startLevel!==t.endLevel?(r+=s,n.re=r,r++):n.re=t.startIndex+r,s=t.endIndex,n}),n=this.he[this.he.length-1],t=new U(n.endPoint.x,0,n.endPoint.y);return t.level=n.endLevel,t.se=e+1,t.re=n.endIndex+r,i.push(t),i},ae:function(t){var i=this;if(this.in){if(this.Bi){var n={x:t.x,y:t.y,height:this.in.height,level:t.level,buildingID:t.bid};return this.in.moveTo(n),void(this.Bi=!1)}var e={},r=e.ui||this.ui;e.ci=e.ci||this.ci||0;var s=e.ci>this.li?this.li:e.ci;this.oi||(n={x:this.in.x,y:this.in.y,height:this.in.height,level:t.level,buildingID:t.bid},(e=this.Un[this.Ti].groupsPoints[this.Si])&&e.pointList&&0<e.pointList.length&&(n=Object.assign(n,e.pointList[0])),this.in.moveTo(n),this.in.visible=!0),this.fi&&this.Cn(this.hi,r,null),this.xn(t,r,function(){i.Ln(s,r,function(){i.Pi=!1})})}},ce:function(t){var i;this.in&&(i={x:this.in.x,y:this.in.y,height:this.in.height,level:t.level,buildingID:t.bid},(t=this.Un[this.Ti].groupsPoints[this.Si])&&t.pointList&&0<t.pointList.length&&(i=Object.assign(i,t.pointList[0])),this.in.moveTo(i),this.Bi=!1)},bn:function(t,i){var n=new U(0,0,1),t=new U(t.x,0,t.y),i=new U(i.x,0,i.y).clone().sub(t).normalize(),t=i.angleTo(n)*Mt.mt();return 0<i.clone().cross(n).y?360-t:t},fe:function(t,i,n){return t===i?t:(180<Math.abs(i-t)&&(t<i?t+=360:i+=360),(t*(1-n)+i*n)%360)},le:function(t,i){var n=this.$t,e=Math.floor(t),r=n[e-1]*(1-t%1)+n[e]*(t%1);for(r*=i,e=0;r<n[e];)e++;return e+1-(r-n[e])/(n[e-1]-n[e])},ve:function(t){if(this.ki||requestAnimationFrame(this.ve.bind(this,t)),!this.Oi&&(t.cnt++,t.cnt===t.step)){t.cnt=0;var i=this.Ji.getDelta();if(!(this.Bi||this.Pi||this.Ri||(this.ji+=this.ii*i,this.ji<=0))){var n=Object.assign({},this.oe(t.ps,this.ji)),e=this.vn-this.ji,i=n.y;if(n.y=n.z,n.z=i,this.xi={distance:0,remain:e<this.Ai?this.Ai:e,walk:this.ji,point:n,level:n.level,buildingID:n.bid,index:n.index-1},null!=this.Ci&&(this.Ii=this.bn(this.Ci,n)),this.Ci=Object.assign({},n),!n||e<this.Ai&&this.Li)this.Oi=!0;else if(e<this.Ai&&!this.Li&&(this.Li=!0),this.Ni||(this.Ni=t.ps[0].level),null==this.Fi&&(this.Fi=t.ps[0].bid||"outdoor"),this.Ei){t=n.bid||"outdoor";if(this.Fi!==t){this.Bi=!0,this.Fi=t,this.Ti++,this.Si=0,this.Ni=n.level;return this.de(1,n),void this.$i.et({type:"transit",level:n.level,buildingID:n.bid})}this.Ni!==n.level&&(this.Ni=n.level,this.Si++,this.de(0,n),this.$i.et({type:"transit",level:n.level,buildingID:n.bid}))}}}},de:function(t,i){var n=this;if(this.ni){var e={},r=e.ui||this.ui;e.ci=e.ci||this.ci||0;var s=e.ci>this.li?this.li:e.ci;if(1===t)return this.ye(i.level,i.bid,function(){n.An(i.level,i.bid,r,function(){n.ae(i)})});this.Pi=!0,this.fi&&this.Cn(this.ai,r,null),this.oi||(this.in.visible=!1),this.ye(i.level,i.bid,function(){n.An(i.level,i.bid,r,function(){n.Ln(s,r,function(){n.xn(i,r,function(){n.fi?n.Cn(n.hi,r,function(){n.ae(i)}):n.ae(i)})})})})}},pe:function(){this.ki=!1;for(var t=[],i=0;i<this.fn.length;i++){for(var n=this.fn[i].naviPoints,e=[],r=0;r<n.length;r++){var s=new U(n[r].x,0,n[r].y);s.se=n[r].index,s.level=n[r].level,s.bid=this.fn[i].bid,e.push(s)}t.push.apply(t,e)}this.Ji.start(),this.Oi=!1,this.Ti=0,this.Si=0,this.ve({step:2,cnt:0,ps:t})},be:function(){if(!(this.Pi||this.Bi||this.Ri)){if(this.Ci){var t=new U(this.in.x,this.in.y,0).lerp(this.Ci,this.Li?1:this.ei);t.level=this.Ci.level,t.buildingID=this.Ci.bid;var i,n,e=this.naviConstraint(t);if(e.index<0)return;if(this.in.moveTo({x:t.x,y:t.y,height:this.pi,level:t.level,buildingID:t.buildingID}),this.On&&(this.On.passed?this.On.moveProportion(1-e.remain/this.vn):this.On.moveProportion(0)),this.Yi)for(var r=0;r<this.crossCircles.length;r++)e.coords.buildingID==this.crossCircles[r].bid&&e.coords.level==this.crossCircles[r].level&&e.remain<=this.crossCircles[r].point.remain&&e.remain>=this.crossCircles[r].remain&&(i=!0,n=this.crossCircles[r].point);if(this.Kt===kt.Drive?this.$i.et(Object.assign({},this.xi,{type:"driving",distance:e.distance,remain:e.remain,walk:this.vn-e.remain,distanceToNext:e.distanceToNext,angle:e.angle,point:e.coords,level:e.coords.level,buildingID:e.coords.buildindID,index:e.index,enterCircle:i,intersect:n})):this.$i.et(Object.assign({},this.xi,{type:"walking",distance:e.distance,remain:e.remain,walk:this.vn-e.remain,distanceToNext:e.distanceToNext,angle:e.angle,point:e.coords,level:e.coords.level,buildingID:e.coords.buildindID,index:e.index,enterCircle:i,intersect:n})),i=!1,n=null,this.ni?this.xn(t):this.u.updateCountDown_=0,this.Oi)return this.stop(),void this.$i.et({type:"complete"})}null!=this.Ii&&(t=this.fe(this._i,this.Ii,this.ei),this._i=t,this.in.rotateTo({heading:-t}),this.ri&&this.ne(t))}},_n:function(){this.pe(),this.In=this.be.bind(this),this.u.on("update",this.In)},gn:function(t,i){var n=this.naviConstraint(t);if(this.On&&(this.On.passed?this.On.moveProportion(1-n.remain/this.vn):this.On.moveProportion(0)),this.Yi)for(var e=0;e<this.crossCircles.length;e++)n.coords.buildingID==this.crossCircles[e].bid&&n.coords.leve==this.crossCircles[e].level&&n.remain<=this.crossCircles[e].point.remain&&n.remain>=this.crossCircles[e].remain&&(r=!0,s=this.crossCircles[e].point);var t=null,t=this.Kt===kt.Drive?{type:"driving",distance:n.distance,remain:n.remain,drive:this.vn-n.remain,distanceToNext:n.distanceToNext,angle:n.angle,point:n.coords,level:n.coords.level,buildingID:n.coords.buildingID,index:n.index,enterCircle:r,intersect:s}:{type:"walking",distance:n.distance,remain:n.remain,walk:this.vn-n.remain,distanceToNext:n.distanceToNext,angle:n.angle,point:n.coords,level:n.coords.level,buildingID:n.coords.buildingID,index:n.index,enterCircle:r,intersect:s},r=!1,s=null;this.$i.et(t),this.in&&(n.coords.height=this.pi,this.in.moveTo(n.coords),void 0!==i?this.in.rotateTo({heading:i}):this.in.rotateTo({heading:-n.angle}))},Mn:function(t,i){var n,e,r=this.naviConstraint(t);if(this.Yi)for(var s=0;s<this.crossCircles.length;s++)r.coords.buildingID==this.crossCircles[s].bid&&r.coords.leve==this.crossCircles[s].level&&r.remain<=this.crossCircles[s].point.remain&&r.remain>=this.crossCircles[s].remain&&(n=!0,e=this.crossCircles[s].point);this.Kt===kt.Drive?this.$i.et({type:"driving",distance:r.distance,remain:r.remain,drive:this.vn-r.remain,distanceToNext:r.distanceToNext,angle:r.angle,point:r.coords,level:r.coords.level,buildingID:r.coords.buildingID,index:r.index,enterCircle:n,intersect:e}):this.$i.et({type:"walking",distance:r.distance,remain:r.remain,walk:this.vn-r.remain,distanceToNext:r.distanceToNext,angle:r.angle,point:r.coords,level:r.coords.level,buildingID:r.coords.buildingID,index:r.index,enterCircle:n,intersect:e}),n=!1,e=null,this.in&&(t.height=this.pi,this.in.moveTo(t),void 0!==i?this.in.rotateTo({heading:i}):this.in.rotateTo({heading:-r.angle}))},me:function(t,i){for(var n=[{x:t.min.x,y:t.min.y},{x:t.min.x,y:t.max.y},{x:t.max.x,y:t.max.y},{x:t.max.x,y:t.min.y}],e=new Z,r=0;r<i.length;r++)for(var s=i[r].levelRange,o=0;o<s.length;o++)for(var u=0,u=o===s.length-1?this.bi+2*this.Xi.radius:this.bi,h=0;h<n.length;h++){var a=fengmap.FMUtil.coordsMapToScreen(this.u,{x:n[h].x,y:n[h].y,buildingID:i[r].bid,level:s[o],height:u});a&&e.dt([a])}return e},we:function(t,i){var n=this.me(t,i).size,t=this.u.getContainer().clientHeight,i=this.u.getContainer().clientWidth;return i/t>n.x/n.y?n.y/t:n.x/i},ge:function(t,i,n,e,r,s){var o=this,u=this.we(t,i),h=this.u.getZoom();u?(h=this.le(this.u.getZoom(),u*(n||1)),r=e-1):h-=1,this.u.setZoom({zoom:h,animate:!1,finish:function(){++r===e?s&&s({zoom:h}):o.ge(t,i,n,e,r,s)}})},Me:function(t,i){for(var n=this.me(t,i),e=[],r=0;r<i.length;r++)for(var s=i[r].levelRange,o=(o=i[r].bid)||this.u.getMapOptions().buildingID,u=0;u<s.length;u++){var h=this.u.getBuilding(o).getFloor(s[u]).height;e.push(fengmap.FMUtil.coordsScreenToMap(this.u,{x:(n.max.x+n.min.x)/2,y:(n.max.y+n.min.y)/2,z:h+2*this.Xi.radius}))}for(var a=new U,c=0;c<e.length;c++)a.add(e[c]);return a.divideScalar(e.length),a},ke:function(n,e,r,s,o,u){var h=this;this.ge(n,e,r,10,0,function(t){var i=h.Me(n,e);h.u.setCenter({animate:!1,x:i.x,y:i.y,finish:function(){++o===s?u&&u({zoom:t.zoom,center:i}):h.ke(n,e,r,s,o,u)}})})},Sn:function(t,s,o,u){for(var h=this,a=t&&void 0!==t.ratio?t.ratio:1,i=t&&void 0!==t.rotation?t.rotation:0,n=t&&void 0!==t.tilt?t.tilt:30,c=!t||void 0===t.animate||t.animate,e=1,r=[1],f=0;f<o.length;f++){for(var l=o[f].levelRange,v=[],d=l[0];d<=l[1];)v.push(d),d++;null==o[f].bid?e=(r=v)[Math.floor((v.length-1)/2)]:this.u.getBuilding(o[f].bid).setVisibleLevels(v)}this.u.setVisibleLevels(r,function(){h.u.setLevel({level:e,animate:c,finish:function(){var t=r.length%2==0?h.u.getFloorSpace()/2:0;h.u.getInteracations().controls.panAdd({x:0,y:t,z:0}),h.u.setCenter({animate:c,x:s.center.x,y:s.center.y,finish:function(){h.u.setTilt({tilt:n,animate:c,finish:function(){h.u.setRotation({rotation:i,animate:c,finish:function(){var i=h.u.getInteracations(),t=h.u.copyCamera(),n=i.copyControls(t),e=i.controls,r=h.u.camera;i.controls=n,h.u.camera=t,h.u.getInteracations().controls.update(),h.ke(s,o,a,10,0,function(t){i.controls=e,h.u.camera=r,n.dispose(),n=null,h.u.enableUpdateRender(),h.u.setZoom({animate:c,zoom:t.zoom,duration:.5}),h.u.setCenter({animate:c,x:t.center.x,y:t.center.y,duration:.5,finish:function(){u&&u()}})})}})}})}})}})})},ye:function(t,i,n){if(null==t||null==i)return n&&n(),null;for(var e=this.u.getBuilding(i).levelChart,r=this.u.getVisibleLevels(),s=null,o=0;o<e.length;o++)if(o%2==1&&e[o]===t&&(s=e[o-1],r.indexOf(s)<0)){this.u.setVisibleLevels([s]);break}return null==s||this.u.getLevel()===s?(n&&n(),null):this.u.setLevel({level:s,animate:"number"==typeof duration,duration:"number"==typeof duration?duration:0,finish:n})},Yn:function(t,i){if(!i)return[];for(var n=0,e=0,r=[],s=0;s<t.length;s++)for(var o=t[s].resultbuild,u=0;u<o.length;u++)e+=o[u].length;for(var h=0;h<t.length;h++)for(var a=t[h].bid,c=t[h].resultbuild,f=0;f<c.length;f++){var l=c[f].level,v=c[f].pointList;if(0<f&&(n+=c[f-1].length),!(v.length<=1)&&(i.has(a)&&i.get(a).has(l)))for(var d=0,y=i.get(a).get(l),p=0;p<v.length;p++){0<p&&(d+=Mt.distance(v[p-1],v[p]));var b,m=Et(y);try{for(m.s();!(b=m.n()).done;){var w,g=b.value,M=this.Ee(v,g,p);M&&(M.remain=0==p?e-(n+d):e-(n+d-M.disIntersectToPoint),w=e-(n+d-M.disCenterToPoint),r.push({center:g.center,radius:g.radius,remain:w,point:M,level:l,bid:a}))}}catch(t){m.e(t)}finally{m.f()}}}return r},Ee:function(t,i,n){var e=0;if(0==n)return Mt.Ct(t[n],i.center)<=.001?Object.assign({disIntersectToCenter:disIntersectToCenter,disIntersectToPoint:e},t[n]):null;if(Mt.Ct(i.center,t[n-1])<=.001)return null;if(Mt.Lt(i.center,t[n-1],t[n])<=.001){var r,s=Et(i.points);try{for(s.s();!(r=s.n()).done;){var o=r.value;if(!Mt.St(o,i.center,t[n]))for(var u=n;0<u;u--)if(Mt.St(o,t[u-1],t[u])&&Mt.Lt(o,t[u-1],t[u])<=.001){for(var h=[o],a=u;a<=n;a++)h.push(t[a]);for(var c=0;c<h.length-1;c++)e+=Mt.distance(h[c],h[c+1]);return o.disIntersectToPoint=e,o.disCenterToPoint=Mt.distance(i.center,t[n]),o}}}catch(t){s.e(t)}finally{s.f()}}return null}});var At=jt;function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ct(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Lt(t,i,n){return(Lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Pt(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function _t(t,i){return(_t=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function It(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Pt(n);return t=e?(t=Pt(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==xt(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bt=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&_t(t,i)}(r,At);var t,i,n,e=It(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),e.call(this,t,i,n)}return t=r,(i=[{key:"on",value:function(t,i){Lt(Pt(r.prototype),"on",this).call(this,t,i)}},{key:"off",value:function(t,i){Lt(Pt(r.prototype),"off",this).call(this,t,i)}}])&&Ct(t.prototype,i),n&&Ct(t,n),r}();function Ft(t){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nt(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Dt(t,i,n){return(Dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Vt(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Ht(t,i){return(Ht=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ut(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Vt(n);return t=e?(t=Vt(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Ft(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Vt(t){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}e=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ht(t,i)}(r,At);var t,i,n,e=Ut(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),t.type=kt.Drive,(n=e.call(this,t,i,n)).ii=7,n.ei=.2,n}return t=r,(i=[{key:"on",value:function(t,i){Dt(Vt(r.prototype),"on",this).call(this,t,i)}},{key:"off",value:function(t,i){Dt(Vt(r.prototype),"off",this).call(this,t,i)}},{key:"locate",value:function(t,i){Dt(Vt(r.prototype),"locate",this).call(this,t,i)}},{key:"locateNoConstraint",value:function(t,i){Dt(Vt(r.prototype),"locateNoConstraint",this).call(this,t,i)}},{key:"simulate",value:function(t){Dt(Vt(r.prototype),"simulate",this).call(this,t)}},{key:"naviResult",get:function(){return this.nn}}])&&Nt(t.prototype,i),n&&Nt(t,n),r}();function Gt(t){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zt(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function qt(t,i,n){return(qt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Xt(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Zt(t,i){return(Zt=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Yt(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Xt(n);return t=e?(t=Xt(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Gt(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Xt(t){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}p=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Zt(t,i)}(r,At);var t,i,n,e=Yt(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),t.type=kt.Walk,e.call(this,t,i,n)}return t=r,(i=[{key:"on",value:function(t,i){qt(Xt(r.prototype),"on",this).call(this,t,i)}},{key:"off",value:function(t,i){qt(Xt(r.prototype),"off",this).call(this,t,i)}}])&&zt(t.prototype,i),n&&zt(t,n),r}();function Wt(t,i,n,e){this.rt=t||0,this.st=i||0,this.ot=n||0,this.ut=void 0!==e?e:1}Object.assign(Wt,{slerp:function(t,i,n,e){return n.copy(t).slerp(i,e)},slerpFlat:function(t,i,n,e,r,s,o){var u=n[e+0],h=n[e+1],a=n[e+2],c=n[e+3],f=r[s+0],l=r[s+1],v=r[s+2],d=r[s+3];c===d&&u===f&&h===l&&a===v||(n=1-o,r=0<=(e=u*f+h*l+a*v+c*d)?1:-1,(s=1-e*e)>Number.EPSILON&&(s=Math.sqrt(s),e=Math.atan2(s,e*r),n=Math.sin(n*e)/s,o=Math.sin(o*e)/s),u=u*n+f*(r=o*r),h=h*n+l*r,a=a*n+v*r,c=c*n+d*r,n===1-o&&(u*=o=1/Math.sqrt(u*u+h*h+a*a+c*c),h*=o,a*=o,c*=o)),t[i]=u,t[i+1]=h,t[i+2]=a,t[i+3]=c}}),Object.defineProperties(Wt.prototype,{x:{get:function(){return this.rt},set:function(t){this.rt=t,this.ht()}},y:{get:function(){return this.st},set:function(t){this.st=t,this.ht()}},z:{get:function(){return this.ot},set:function(t){this.ot=t,this.ht()}},w:{get:function(){return this.ut},set:function(t){this.ut=t,this.ht()}}}),Object.assign(Wt.prototype,{isQuaternion:!0,set:function(t,i,n,e){return this.rt=t,this.st=i,this.ot=n,this.ut=e,this.ht(),this},clone:function(){return new this.constructor(this.rt,this.st,this.ot,this.ut)},copy:function(t){return this.rt=t.x,this.st=t.y,this.ot=t.z,this.ut=t.w,this.ht(),this},setFromEuler:function(t,i){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t.rt,e=t.st,r=t.ot,s=t.order,o=Math.cos,u=Math.sin,h=o(n/2),t=o(e/2),o=o(r/2),n=u(n/2),e=u(e/2),r=u(r/2);return"XYZ"===s?(this.rt=n*t*o+h*e*r,this.st=h*e*o-n*t*r,this.ot=h*t*r+n*e*o,this.ut=h*t*o-n*e*r):"YXZ"===s?(this.rt=n*t*o+h*e*r,this.st=h*e*o-n*t*r,this.ot=h*t*r-n*e*o,this.ut=h*t*o+n*e*r):"ZXY"===s?(this.rt=n*t*o-h*e*r,this.st=h*e*o+n*t*r,this.ot=h*t*r+n*e*o,this.ut=h*t*o-n*e*r):"ZYX"===s?(this.rt=n*t*o-h*e*r,this.st=h*e*o+n*t*r,this.ot=h*t*r-n*e*o,this.ut=h*t*o+n*e*r):"YZX"===s?(this.rt=n*t*o+h*e*r,this.st=h*e*o+n*t*r,this.ot=h*t*r-n*e*o,this.ut=h*t*o-n*e*r):"XZY"===s&&(this.rt=n*t*o-h*e*r,this.st=h*e*o-n*t*r,this.ot=h*t*r+n*e*o,this.ut=h*t*o+n*e*r),!1!==i&&this.ht(),this},setFromAxisAngle:function(t,i){var n=i/2,i=Math.sin(n);return this.rt=t.x*i,this.st=t.y*i,this.ot=t.z*i,this.ut=Math.cos(n),this.ht(),this},setFromRotationMatrix:function(t){var i,n=t.elements,e=n[0],r=n[4],s=n[8],o=n[1],u=n[5],h=n[9],a=n[2],c=n[6],t=n[10],n=e+u+t;return 0<n?(i=.5/Math.sqrt(n+1),this.ut=.25/i,this.rt=(c-h)*i,this.st=(s-a)*i,this.ot=(o-r)*i):u<e&&t<e?(i=2*Math.sqrt(1+e-u-t),this.ut=(c-h)/i,this.rt=.25*i,this.st=(r+o)/i,this.ot=(s+a)/i):t<u?(i=2*Math.sqrt(1+u-e-t),this.ut=(s-a)/i,this.rt=(r+o)/i,this.st=.25*i,this.ot=(h+c)/i):(i=2*Math.sqrt(1+t-e-u),this.ut=(o-r)/i,this.rt=(s+a)/i,this.st=(h+c)/i,this.ot=.25*i),this.ht(),this},setFromUnitVectors:function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this.rt=-t.y,this.st=t.x,this.ot=0):(this.rt=0,this.st=-t.z,this.ot=t.y)):(this.rt=t.y*i.z-t.z*i.y,this.st=t.z*i.x-t.x*i.z,this.ot=t.x*i.y-t.y*i.x),this.ut=n,this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Y.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,i){var n=this.angleTo(t);if(0===n)return this;n=Math.min(1,i/n);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this.rt*=-1,this.st*=-1,this.ot*=-1,this.ht(),this},dot:function(t){return this.rt*t.rt+this.st*t.st+this.ot*t.ot+this.ut*t.ut},lengthSq:function(){return this.rt*this.rt+this.st*this.st+this.ot*this.ot+this.ut*this.ut},length:function(){return Math.sqrt(this.rt*this.rt+this.st*this.st+this.ot*this.ot+this.ut*this.ut)},normalize:function(){var t=this.length();return 0===t?(this.rt=0,this.st=0,this.ot=0,this.ut=1):(this.rt=this.rt*(t=1/t),this.st=this.st*t,this.ot=this.ot*t,this.ut=this.ut*t),this.ht(),this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,i)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,i){var n=t.rt,e=t.st,r=t.ot,s=t.ut,o=i.rt,u=i.st,t=i.ot,i=i.ut;return this.rt=n*i+s*o+e*t-r*u,this.st=e*i+s*u+r*o-n*t,this.ot=r*i+s*t+n*u-e*o,this.ut=s*i-n*o-e*u-r*t,this.ht(),this},slerp:function(t,i){if(0===i)return this;if(1===i)return this.copy(t);var n=this.rt,e=this.st,r=this.ot,s=this.ut,o=s*t.ut+n*t.rt+e*t.st+r*t.ot;if(o<0?(this.ut=-t.ut,this.rt=-t.rt,this.st=-t.st,this.ot=-t.ot,o=-o):this.copy(t),1<=o)return this.ut=s,this.rt=n,this.st=e,this.ot=r,this;t=1-o*o;if(t<=Number.EPSILON){var u=1-i;return this.ut=u*s+i*this.ut,this.rt=u*n+i*this.rt,this.st=u*e+i*this.st,this.ot=u*r+i*this.ot,this.normalize(),this.ht(),this}u=Math.sqrt(t),t=Math.atan2(u,o),o=Math.sin((1-i)*t)/u,u=Math.sin(i*t)/u;return this.ut=s*o+this.ut*u,this.rt=n*o+this.rt*u,this.st=e*o+this.st*u,this.ot=r*o+this.ot*u,this.ht(),this},equals:function(t){return t.rt===this.rt&&t.st===this.st&&t.ot===this.ot&&t.ut===this.ut},fromArray:function(t,i){return this.rt=t[i=void 0===i?0:i],this.st=t[i+1],this.ot=t[i+2],this.ut=t[i+3],this.ht(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.rt,t[i+1]=this.st,t[i+2]=this.ot,t[i+3]=this.ut,t},fromBufferAttribute:function(t,i){return this.rt=t.getX(i),this.st=t.getY(i),this.ot=t.getZ(i),this.ut=t.getW(i),this},Oe:function(t){return this.ht=t,this},ht:function(){}});var Qt=new Jt,Kt=new Wt;function Jt(t,i,n){this.x=t||0,this.y=i||0,this.z=n||0}Object.assign(Jt.prototype,{isVector3:!0,set:function(t,i,n){return this.x=t,this.y=i,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,i)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Kt.setFromEuler(t))},applyAxisAngle:function(t,i){return this.applyQuaternion(Kt.setFromAxisAngle(t,i))},applyMatrix3:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6]*e,this.y=t[1]*i+t[4]*n+t[7]*e,this.z=t[2]*i+t[5]*n+t[8]*e,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var i=this.x,n=this.y,e=this.z,r=t.elements,t=1/(r[3]*i+r[7]*n+r[11]*e+r[15]);return this.x=(r[0]*i+r[4]*n+r[8]*e+r[12])*t,this.y=(r[1]*i+r[5]*n+r[9]*e+r[13])*t,this.z=(r[2]*i+r[6]*n+r[10]*e+r[14])*t,this},applyQuaternion:function(t){var i=this.x,n=this.y,e=this.z,r=t.x,s=t.y,o=t.z,u=t.w,h=u*i+s*e-o*n,a=u*n+o*i-r*e,t=u*e+r*n-s*i,e=-r*i-s*n-o*e;return this.x=h*u+e*-r+a*-o-t*-s,this.y=a*u+e*-s+t*-r-h*-o,this.z=t*u+e*-o+h*-s-a*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var i=this.x,n=this.y,e=this.z,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*e,this.y=t[1]*i+t[5]*n+t[9]*e,this.z=t[2]*i+t[6]*n+t[10]*e,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},cross:function(t,i){return void 0!==i?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,i)):this.crossVectors(this,t)},crossVectors:function(t,i){var n=t.x,e=t.y,r=t.z,s=i.x,t=i.y,i=i.z;return this.x=e*i-r*t,this.y=r*s-n*i,this.z=n*t-e*s,this},projectOnVector:function(t){var i=t.lengthSq();if(0===i)return this.set(0,0,0);i=t.dot(this)/i;return this.copy(t).multiplyScalar(i)},projectOnPlane:function(t){return Qt.copy(this).projectOnVector(t),this.sub(Qt)},reflect:function(t){return this.sub(Qt.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var i=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===i)return Math.PI/2;i=this.dot(t)/i;return Math.acos(Y.clamp(i,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return i*i+n*n+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,i,n){var e=Math.sin(i)*t;return this.x=e*Math.sin(n),this.y=Math.cos(i)*t,this.z=e*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,i,n){return this.x=t*Math.sin(i),this.y=n,this.z=t*Math.cos(i),this},setFromMatrixPosition:function(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=t,this},setFromMatrixColumn:function(t,i){return this.fromArray(t.elements,4*i)},setFromMatrix3Column:function(t,i){return this.fromArray(t.elements,3*i)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}});var $t=new Jt,ti=new oi,ii=new Jt(0,0,0),ni=new Jt(1,1,1),ei=new Jt,ri=new Jt,si=new Jt;function oi(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function ui(){}Object.assign(oi.prototype,{isMatrix4:!0,set:function(t,i,n,e,r,s,o,u,h,a,c,f,l,v,d,y){var p=this.elements;return p[0]=t,p[4]=i,p[8]=n,p[12]=e,p[1]=r,p[5]=s,p[9]=o,p[13]=u,p[2]=h,p[6]=a,p[10]=c,p[14]=f,p[3]=l,p[7]=v,p[11]=d,p[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new oi).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],this},copyPosition:function(t){var i=this.elements,t=t.elements;return i[12]=t[12],i[13]=t[13],i[14]=t[14],this},extractBasis:function(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var i=this.elements,n=t.elements,e=1/$t.setFromMatrixColumn(t,0).length(),r=1/$t.setFromMatrixColumn(t,1).length(),t=1/$t.setFromMatrixColumn(t,2).length();return i[0]=n[0]*e,i[1]=n[1]*e,i[2]=n[2]*e,i[3]=0,i[4]=n[4]*r,i[5]=n[5]*r,i[6]=n[6]*r,i[7]=0,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var i,n,e,r,s,o,u,h,a,c,f,l,v=this.elements,d=t.x,y=t.y,p=t.z,b=Math.cos(d),m=Math.sin(d),w=Math.cos(y),d=Math.sin(y),y=Math.cos(p),p=Math.sin(p);return"XYZ"===t.order?(s=b*y,o=b*p,u=m*y,h=m*p,v[0]=w*y,v[4]=-w*p,v[8]=d,v[1]=o+u*d,v[5]=s-h*d,v[9]=-m*w,v[2]=h-s*d,v[6]=u+o*d,v[10]=b*w):"YXZ"===t.order?(n=w*p,e=d*y,v[0]=(i=w*y)+(r=d*p)*m,v[4]=e*m-n,v[8]=b*d,v[1]=b*p,v[5]=b*y,v[9]=-m,v[2]=n*m-e,v[6]=r+i*m,v[10]=b*w):"ZXY"===t.order?(n=w*p,e=d*y,v[0]=(i=w*y)-(r=d*p)*m,v[4]=-b*p,v[8]=e+n*m,v[1]=n+e*m,v[5]=b*y,v[9]=r-i*m,v[2]=-b*d,v[6]=m,v[10]=b*w):"ZYX"===t.order?(s=b*y,o=b*p,u=m*y,h=m*p,v[0]=w*y,v[4]=u*d-o,v[8]=s*d+h,v[1]=w*p,v[5]=h*d+s,v[9]=o*d-u,v[2]=-d,v[6]=m*w,v[10]=b*w):"YZX"===t.order?(a=b*w,c=b*d,f=m*w,l=m*d,v[0]=w*y,v[4]=l-a*p,v[8]=f*p+c,v[1]=p,v[5]=b*y,v[9]=-m*y,v[2]=-d*y,v[6]=c*p+f,v[10]=a-l*p):"XZY"===t.order&&(a=b*w,c=b*d,f=m*w,l=m*d,v[0]=w*y,v[4]=-p,v[8]=d*y,v[1]=a*p+l,v[5]=b*y,v[9]=c*p-f,v[2]=f*p-c,v[6]=m*y,v[10]=l*p+a),v[3]=0,v[7]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(ii,t,ni)},lookAt:function(t,i,n){var e=this.elements;return si.subVectors(t,i),0===si.lengthSq()&&(si.z=1),si.normalize(),ei.crossVectors(n,si),0===ei.lengthSq()&&(1===Math.abs(n.z)?si.x+=1e-4:si.z+=1e-4,si.normalize(),ei.crossVectors(n,si)),ei.normalize(),ri.crossVectors(si,ei),e[0]=ei.x,e[4]=ri.x,e[8]=si.x,e[1]=ei.y,e[5]=ri.y,e[9]=si.y,e[2]=ei.z,e[6]=ri.z,e[10]=si.z,this},multiply:function(t,i){return void 0!==i?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,i)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var n=t.elements,e=i.elements,r=this.elements,s=n[0],o=n[4],u=n[8],h=n[12],a=n[1],c=n[5],f=n[9],l=n[13],v=n[2],d=n[6],y=n[10],p=n[14],b=n[3],m=n[7],w=n[11],g=n[15],M=e[0],k=e[4],E=e[8],O=e[12],R=e[1],T=e[5],S=e[9],j=e[13],A=e[2],x=e[6],C=e[10],L=e[14],t=e[3],i=e[7],n=e[11],e=e[15];return r[0]=s*M+o*R+u*A+h*t,r[4]=s*k+o*T+u*x+h*i,r[8]=s*E+o*S+u*C+h*n,r[12]=s*O+o*j+u*L+h*e,r[1]=a*M+c*R+f*A+l*t,r[5]=a*k+c*T+f*x+l*i,r[9]=a*E+c*S+f*C+l*n,r[13]=a*O+c*j+f*L+l*e,r[2]=v*M+d*R+y*A+p*t,r[6]=v*k+d*T+y*x+p*i,r[10]=v*E+d*S+y*C+p*n,r[14]=v*O+d*j+y*L+p*e,r[3]=b*M+m*R+w*A+g*t,r[7]=b*k+m*T+w*x+g*i,r[11]=b*E+m*S+w*C+g*n,r[15]=b*O+m*j+w*L+g*e,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[4],e=t[8],r=t[12],s=t[1],o=t[5],u=t[9],h=t[13],a=t[2],c=t[6],f=t[10],l=t[14];return t[3]*(+r*u*c-e*h*c-r*o*f+n*h*f+e*o*l-n*u*l)+t[7]*(+i*u*l-i*h*f+r*s*f-e*s*l+e*h*a-r*u*a)+t[11]*(+i*h*c-i*o*l-r*s*c+n*s*l+r*o*a-n*h*a)+t[15]*(-e*o*a-i*u*c+i*o*f+e*s*c-n*s*f+n*u*a)},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this},setPosition:function(t,i,n){var e=this.elements;return t.isVector3?(e[12]=t.x,e[13]=t.y,e[14]=t.z):(e[12]=t,e[13]=i,e[14]=n),this},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var n=this.elements,e=t.elements,r=e[0],s=e[1],o=e[2],u=e[3],h=e[4],a=e[5],c=e[6],f=e[7],l=e[8],v=e[9],d=e[10],y=e[11],p=e[12],b=e[13],m=e[14],w=e[15],g=v*m*f-b*d*f+b*c*y-a*m*y-v*c*w+a*d*w,M=p*d*f-l*m*f-p*c*y+h*m*y+l*c*w-h*d*w,i=l*b*f-p*v*f+p*a*y-h*b*y-l*a*w+h*v*w,t=p*v*c-l*b*c-p*a*d+h*b*d+l*a*m-h*v*m,e=r*g+s*M+o*i+u*t;if(0==e)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);e=1/e;return n[0]=g*e,n[1]=(b*d*u-v*m*u-b*o*y+s*m*y+v*o*w-s*d*w)*e,n[2]=(a*m*u-b*c*u+b*o*f-s*m*f-a*o*w+s*c*w)*e,n[3]=(v*c*u-a*d*u-v*o*f+s*d*f+a*o*y-s*c*y)*e,n[4]=M*e,n[5]=(l*m*u-p*d*u+p*o*y-r*m*y-l*o*w+r*d*w)*e,n[6]=(p*c*u-h*m*u-p*o*f+r*m*f+h*o*w-r*c*w)*e,n[7]=(h*d*u-l*c*u+l*o*f-r*d*f-h*o*y+r*c*y)*e,n[8]=i*e,n[9]=(p*v*u-l*b*u-p*s*y+r*b*y+l*s*w-r*v*w)*e,n[10]=(h*b*u-p*a*u+p*s*f-r*b*f-h*s*w+r*a*w)*e,n[11]=(l*a*u-h*v*u-l*s*f+r*v*f+h*s*y-r*a*y)*e,n[12]=t*e,n[13]=(l*b*o-p*v*o+p*s*d-r*b*d-l*s*m+r*v*m)*e,n[14]=(p*a*o-h*b*o-p*s*c+r*b*c+h*s*m-r*a*m)*e,n[15]=(h*v*o-l*a*o+l*s*c-r*v*c-h*s*d+r*a*d)*e,this},invert:function(){var t=this.elements,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],o=t[5],u=t[6],h=t[7],a=t[8],c=t[9],f=t[10],l=t[11],v=t[12],d=t[13],y=t[14],p=t[15],b=c*y*h-d*f*h+d*u*l-o*y*l-c*u*p+o*f*p,m=v*f*h-a*y*h-v*u*l+s*y*l+a*u*p-s*f*p,w=a*d*h-v*c*h+v*o*l-s*d*l-a*o*p+s*c*p,g=v*c*u-a*d*u-v*o*f+s*d*f+a*o*y-s*c*y,M=i*b+n*m+e*w+r*g;if(0==M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);M=1/M;return t[0]=b*M,t[1]=(d*f*r-c*y*r-d*e*l+n*y*l+c*e*p-n*f*p)*M,t[2]=(o*y*r-d*u*r+d*e*h-n*y*h-o*e*p+n*u*p)*M,t[3]=(c*u*r-o*f*r-c*e*h+n*f*h+o*e*l-n*u*l)*M,t[4]=m*M,t[5]=(a*y*r-v*f*r+v*e*l-i*y*l-a*e*p+i*f*p)*M,t[6]=(v*u*r-s*y*r-v*e*h+i*y*h+s*e*p-i*u*p)*M,t[7]=(s*f*r-a*u*r+a*e*h-i*f*h-s*e*l+i*u*l)*M,t[8]=w*M,t[9]=(v*c*r-a*d*r-v*n*l+i*d*l+a*n*p-i*c*p)*M,t[10]=(s*d*r-v*o*r+v*n*h-i*d*h-s*n*p+i*o*p)*M,t[11]=(a*o*r-s*c*r-a*n*h+i*c*h+s*n*l-i*o*l)*M,t[12]=g*M,t[13]=(a*d*e-v*c*e+v*n*f-i*d*f-a*n*y+i*c*y)*M,t[14]=(v*o*e-s*d*e-v*n*u+i*d*u+s*n*y-i*o*y)*M,t[15]=(s*c*e-a*o*e+a*n*u-i*c*u-s*n*f+i*o*f)*M,this},scale:function(t){var i=this.elements,n=t.x,e=t.y,t=t.z;return i[0]*=n,i[4]*=e,i[8]*=t,i[1]*=n,i[5]*=e,i[9]*=t,i[2]*=n,i[6]*=e,i[10]*=t,i[3]*=n,i[7]*=e,i[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,t))},makeTranslation:function(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,i,-t,0,0,t,i,0,0,0,0,1),this},makeRotationY:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,0,t,0,0,1,0,0,-t,0,i,0,0,0,0,1),this},makeRotationZ:function(t){var i=Math.cos(t),t=Math.sin(t);return this.set(i,-t,0,0,t,i,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,i){var n=Math.cos(i),e=Math.sin(i),r=1-n,s=t.x,o=t.y,u=t.z,i=r*s,t=r*o;return this.set(i*s+n,i*o-e*u,i*u+e*o,0,i*o+e*u,t*o+n,t*u-e*s,0,i*u-e*o,t*u+e*s,r*u*u+n,0,0,0,0,1),this},makeScale:function(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,i,n){return this.set(1,i,n,0,t,1,n,0,t,i,1,0,0,0,0,1),this},compose:function(t,i,n){var e=this.elements,r=i.rt,s=i.st,o=i.ot,u=i.ut,h=r+r,a=s+s,c=o+o,f=r*h,l=r*a,v=r*c,i=s*a,r=s*c,s=o*c,o=u*h,h=u*a,a=u*c,u=n.x,c=n.y,n=n.z;return e[0]=(1-(i+s))*u,e[1]=(l+a)*u,e[2]=(v-h)*u,e[3]=0,e[4]=(l-a)*c,e[5]=(1-(f+s))*c,e[6]=(r+o)*c,e[7]=0,e[8]=(v+h)*n,e[9]=(r-o)*n,e[10]=(1-(f+i))*n,e[11]=0,e[12]=t.x,e[13]=t.y,e[14]=t.z,e[15]=1,this},decompose:function(t,i,n){var e=this.elements,r=$t.set(e[0],e[1],e[2]).length(),s=$t.set(e[4],e[5],e[6]).length(),o=$t.set(e[8],e[9],e[10]).length();this.determinant()<0&&(r=-r),t.x=e[12],t.y=e[13],t.z=e[14],ti.copy(this);var u=1/r,t=1/s,e=1/o;return ti.elements[0]*=u,ti.elements[1]*=u,ti.elements[2]*=u,ti.elements[4]*=t,ti.elements[5]*=t,ti.elements[6]*=t,ti.elements[8]*=e,ti.elements[9]*=e,ti.elements[10]*=e,i.setFromRotationMatrix(ti),n.x=r,n.y=s,n.z=o,this},makePerspective:function(t,i,n,e,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,u=2*r/(n-e),h=(i+t)/(i-t),n=(n+e)/(n-e),e=-(s+r)/(s-r),s=-2*s*r/(s-r);return o[0]=2*r/(i-t),o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=u,o[9]=n,o[13]=0,o[2]=0,o[6]=0,o[10]=e,o[14]=s,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,i,n,e,r,s){var o=this.elements,u=1/(i-t),h=1/(n-e),a=1/(s-r),t=(i+t)*u,e=(n+e)*h,r=(s+r)*a;return o[0]=2*u,o[4]=0,o[8]=0,o[12]=-t,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-e,o[2]=0,o[6]=0,o[10]=-2*a,o[14]=-r,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var i=this.elements,n=t.elements,e=0;e<16;e++)if(i[e]!==n[e])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<16;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t[i+9]=n[9],t[i+10]=n[10],t[i+11]=n[11],t[i+12]=n[12],t[i+13]=n[13],t[i+14]=n[14],t[i+15]=n[15],t}}),Object.assign(ui.prototype,{addEventListener:function(t,i){void 0===this.tt&&(this.tt={});var n=this.tt;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(i)&&n[t].push(i)},hasEventListener:function(t,i){if(void 0===this.tt)return!1;var n=this.tt;return void 0!==n[t]&&-1!==n[t].indexOf(i)},removeEventListener:function(t,i){void 0!==this.tt&&(void 0===(t=this.tt[t])||-1!==(i=t.indexOf(i))&&t.splice(i,1))},dispatchEvent:function(t){if(void 0!==this.tt){var i=this.tt[t.type];if(void 0!==i){t.target=this;for(var n=i.slice(0),e=0,r=n.length;e<r;e++)n[e].call(this,t)}}}});var hi=new oi,ai=new Wt;function ci(t,i,n,e){this.rt=t||0,this.st=i||0,this.ot=n||0,this.ct=e||ci.DefaultOrder}function fi(){this.mask=1}function li(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}ci.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ci.DefaultOrder="XYZ",Object.defineProperties(ci.prototype,{x:{get:function(){return this.rt},set:function(t){this.rt=t,this.ht()}},y:{get:function(){return this.st},set:function(t){this.st=t,this.ht()}},z:{get:function(){return this.ot},set:function(t){this.ot=t,this.ht()}},order:{get:function(){return this.ct},set:function(t){this.ct=t,this.ht()}}}),Object.assign(ci.prototype,{isEuler:!0,set:function(t,i,n,e){return this.rt=t,this.st=i,this.ot=n,this.ct=e||this.ct,this.ht(),this},clone:function(){return new this.constructor(this.rt,this.st,this.ot,this.ct)},copy:function(t){return this.rt=t.rt,this.st=t.st,this.ot=t.ot,this.ct=t.ct,this.ht(),this},setFromRotationMatrix:function(t,i,n){var e=Y.clamp,r=t.elements,s=r[0],o=r[4],u=r[8],h=r[1],a=r[5],c=r[9],f=r[2],t=r[6],r=r[10];return"XYZ"===(i=i||this.ct)?(this.st=Math.asin(e(u,-1,1)),Math.abs(u)<.9999999?(this.rt=Math.atan2(-c,r),this.ot=Math.atan2(-o,s)):(this.rt=Math.atan2(t,a),this.ot=0)):"YXZ"===i?(this.rt=Math.asin(-e(c,-1,1)),Math.abs(c)<.9999999?(this.st=Math.atan2(u,r),this.ot=Math.atan2(h,a)):(this.st=Math.atan2(-f,s),this.ot=0)):"ZXY"===i?(this.rt=Math.asin(e(t,-1,1)),Math.abs(t)<.9999999?(this.st=Math.atan2(-f,r),this.ot=Math.atan2(-o,a)):(this.st=0,this.ot=Math.atan2(h,s))):"ZYX"===i?(this.st=Math.asin(-e(f,-1,1)),Math.abs(f)<.9999999?(this.rt=Math.atan2(t,r),this.ot=Math.atan2(h,s)):(this.rt=0,this.ot=Math.atan2(-o,a))):"YZX"===i?(this.ot=Math.asin(e(h,-1,1)),Math.abs(h)<.9999999?(this.rt=Math.atan2(-c,a),this.st=Math.atan2(-f,s)):(this.rt=0,this.st=Math.atan2(u,r))):"XZY"===i?(this.ot=Math.asin(-e(o,-1,1)),Math.abs(o)<.9999999?(this.rt=Math.atan2(t,a),this.st=Math.atan2(u,s)):(this.rt=Math.atan2(-c,r),this.st=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+i),this.ct=i,!1!==n&&this.ht(),this},setFromQuaternion:function(t,i,n){return hi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(hi,i,n)},setFromVector3:function(t,i){return this.set(t.x,t.y,t.z,i||this.ct)},reorder:function(t){return ai.setFromEuler(this),this.setFromQuaternion(ai,t)},equals:function(t){return t.rt===this.rt&&t.st===this.st&&t.ot===this.ot&&t.ct===this.ct},fromArray:function(t){return this.rt=t[0],this.st=t[1],this.ot=t[2],void 0!==t[3]&&(this.ct=t[3]),this.ht(),this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.rt,t[i+1]=this.st,t[i+2]=this.ot,t[i+3]=this.ct,t},toVector3:function(t){return t?t.set(this.rt,this.st,this.ot):new Jt(this.rt,this.st,this.ot)},Oe:function(t){return this.ht=t,this},ht:function(){}}),Object.assign(fi.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}}),Object.assign(li.prototype,{isMatrix3:!0,set:function(t,i,n,e,r,s,o,u,h){var a=this.elements;return a[0]=t,a[1]=e,a[2]=o,a[3]=i,a[4]=r,a[5]=u,a[6]=n,a[7]=s,a[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var i=this.elements,t=t.elements;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},extractBasis:function(t,i,n){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,i){var n=t.elements,e=i.elements,r=this.elements,s=n[0],o=n[3],u=n[6],h=n[1],a=n[4],c=n[7],f=n[2],l=n[5],v=n[8],d=e[0],y=e[3],p=e[6],b=e[1],m=e[4],t=e[7],i=e[2],n=e[5],e=e[8];return r[0]=s*d+o*b+u*i,r[3]=s*y+o*m+u*n,r[6]=s*p+o*t+u*e,r[1]=h*d+a*b+c*i,r[4]=h*y+a*m+c*n,r[7]=h*p+a*t+c*e,r[2]=f*d+l*b+v*i,r[5]=f*y+l*m+v*n,r[8]=f*p+l*t+v*e,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},determinant:function(){var t=this.elements,i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],o=t[5],u=t[6],h=t[7],t=t[8];return i*s*t-i*o*h-n*r*t+n*o*u+e*r*h-e*s*u},getInverse:function(t,i){void 0!==i&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var n=t.elements,e=this.elements,r=n[0],s=n[1],o=n[2],u=n[3],h=n[4],a=n[5],c=n[6],f=n[7],l=n[8],v=l*h-a*f,i=a*c-l*u,t=f*u-h*c,n=r*v+s*i+o*t;if(0==n)return this.set(0,0,0,0,0,0,0,0,0);n=1/n;return e[0]=v*n,e[1]=(o*f-l*s)*n,e[2]=(a*s-o*h)*n,e[3]=i*n,e[4]=(l*r-o*c)*n,e[5]=(o*u-a*r)*n,e[6]=t*n,e[7]=(s*c-f*r)*n,e[8]=(h*r-s*u)*n,this},transpose:function(){var t=this.elements,i=t[1];return t[1]=t[3],t[3]=i,i=t[2],t[2]=t[6],t[6]=i,i=t[5],t[5]=t[7],t[7]=i,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this},setUvTransform:function(t,i,n,e,r,s,o){var u=Math.cos(r),r=Math.sin(r);this.set(n*u,n*r,-n*(u*s+r*o)+s+t,-e*r,e*u,-e*(-r*s+u*o)+o+i,0,0,1)},scale:function(t,i){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=i,n[4]*=i,n[7]*=i,this},rotate:function(t){var i=Math.cos(t),n=Math.sin(t),e=this.elements,r=e[0],s=e[3],o=e[6],u=e[1],h=e[4],t=e[7];return e[0]=i*r+n*u,e[3]=i*s+n*h,e[6]=i*o+n*t,e[1]=-n*r+i*u,e[4]=-n*s+i*h,e[7]=-n*o+i*t,this},translate:function(t,i){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=i*n[2],n[4]+=i*n[5],n[7]+=i*n[8],this},equals:function(t){for(var i=this.elements,n=t.elements,e=0;e<9;e++)if(i[e]!==n[e])return!1;return!0},fromArray:function(t,i){void 0===i&&(i=0);for(var n=0;n<9;n++)this.elements[n]=t[n+i];return this},toArray:function(t,i){var n=this.elements;return(t=void 0===t?[]:t)[i=void 0===i?0:i]=n[0],t[i+1]=n[1],t[i+2]=n[2],t[i+3]=n[3],t[i+4]=n[4],t[i+5]=n[5],t[i+6]=n[6],t[i+7]=n[7],t[i+8]=n[8],t}});var vi=0,di=new Jt,yi=new Wt,pi=new oi,bi=new Jt,mi=new Jt,wi=new Jt,gi=new Wt,Mi=new Jt(1,0,0),ki=new Jt(0,1,0),Ei=new Jt(0,0,1),Oi={type:"added"},Ri={type:"removed"};function Ti(){Object.defineProperty(this,"id",{value:vi++}),this.uuid=Y.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ti.DefaultUp.clone();var t=new Jt,i=new ci,n=new Wt,e=new Jt(1,1,1);i.Oe(function(){n.setFromEuler(i,!1)}),n.Oe(function(){i.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:e},modelViewMatrix:{value:new oi},normalMatrix:{value:new li}}),this.matrix=new oi,this.matrixWorld=new oi,this.matrixAutoUpdate=Ti.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Si(){Ti.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ti.DefaultUp=new Jt(0,1,0),Ti.DefaultMatrixAutoUpdate=!0,Ti.prototype=Object.assign(Object.create(ui.prototype),{constructor:Ti,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,i){this.quaternion.setFromAxisAngle(t,i)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,i){return yi.setFromAxisAngle(t,i),this.quaternion.multiply(yi),this},rotateOnWorldAxis:function(t,i){return yi.setFromAxisAngle(t,i),this.quaternion.premultiply(yi),this},rotateX:function(t){return this.rotateOnAxis(Mi,t)},rotateY:function(t){return this.rotateOnAxis(ki,t)},rotateZ:function(t){return this.rotateOnAxis(Ei,t)},translateOnAxis:function(t,i){return di.copy(t).applyQuaternion(this.quaternion),this.position.add(di.multiplyScalar(i)),this},translateX:function(t){return this.translateOnAxis(Mi,t)},translateY:function(t){return this.translateOnAxis(ki,t)},translateZ:function(t){return this.translateOnAxis(Ei,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(pi.getInverse(this.matrixWorld))},lookAt:function(t,i,n){t.isVector3?bi.copy(t):bi.set(t,i,n);n=this.parent;this.updateWorldMatrix(!0,!1),mi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pi.lookAt(mi,bi,this.up):pi.lookAt(bi,mi,this.up),this.quaternion.setFromRotationMatrix(pi),n&&(pi.extractRotation(n.matrixWorld),yi.setFromRotationMatrix(pi),this.quaternion.premultiply(yi.inverse()))},add:function(t){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(Oi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this},remove:function(t){if(1<arguments.length){for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}var n=this.children.indexOf(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(Ri)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),pi.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),pi.multiply(t.parent.matrixWorld)),t.applyMatrix4(pi),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,i){if(this[t]===i)return this;for(var n=0,e=this.children.length;n<e;n++){var r=this.children[n].getObjectByProperty(t,i);if(void 0!==r)return r}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Jt),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Wt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(mi,t,wi),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Jt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(mi,gi,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Jt),this.updateMatrixWorld(!0);var i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].traverseVisible(t)}},traverseAncestors:function(t){var i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t=!(this.matrixWorldNeedsUpdate=!1));for(var i=this.children,n=0,e=i.length;n<e;n++)i[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,i){var n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i)for(var e=this.children,r=0,s=e.length;r<s;r++)e[r].updateWorldMatrix(!1,!0)},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,i){if(void 0===i&&(i=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(var n=0;n<t.children.length;n++){var e=t.children[n];this.add(e.clone())}return this}}),Si.prototype=Object.assign(Object.create(Ti.prototype),{constructor:Si,isScene:!0,copy:function(t,i){return Ti.prototype.copy.call(this,t,i),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ji={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ai={h:0,s:0,l:0},xi={h:0,s:0,l:0};function Ci(t,i,n){return void 0===i&&void 0===n?this.set(t):this.setRGB(t,i,n)}function Li(t,i,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(i-t)*n:n<.5?i:n<2/3?t+6*(i-t)*(2/3-n):t}function _i(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ii(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Pi(t,i,n){this.name="",this.color=new Ci(t),this.near=void 0!==i?i:1,this.far=void 0!==n?n:1e3}Object.assign(Ci.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,n){return this.r=t,this.g=i,this.b=n,this},setHSL:function(t,i,n){return t=Y.euclideanModulo(t,1),i=Y.clamp(i,0,1),n=Y.clamp(n,0,1),0===i?this.r=this.g=this.b=n:(this.r=Li(i=2*n-(n=n<=.5?n*(1+i):n+i-n*i),n,t+1/3),this.g=Li(i,n,t),this.b=Li(i,n,t-1/3)),this},setStyle:function(i){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}if(h=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(i)){var n,e=h[1],r=h[2];switch(e){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){var s=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,u=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(s,o,u)}}}else if(h=/^\#([A-Fa-f0-9]+)$/.exec(i)){var e=h[1],h=e.length;if(3===h)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===h)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return i&&0<i.length?this.setColorName(i):this},setColorName:function(t){var i=ji[t];return void 0!==i?this.setHex(i):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,i){return void 0===i&&(i=2),this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},copyLinearToGamma:function(t,i){i=0<(i=void 0===i?2:i)?1/i:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=_i(t.r),this.g=_i(t.g),this.b=_i(t.b),this},copyLinearToSRGB:function(t){return this.r=Ii(t.r),this.g=Ii(t.g),this.b=Ii(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var i,n=this.r,e=this.g,r=this.b,s=Math.max(n,e,r),o=Math.min(n,e,r),u=(o+s)/2;if(o===s)a=i=0;else{var h=s-o,a=u<=.5?h/(s+o):h/(2-s-o);switch(s){case n:i=(e-r)/h+(e<r?6:0);break;case e:i=(r-n)/h+2;break;case r:i=(n-e)/h+4}i/=6}return t.h=i,t.s=a,t.l=u,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,i,n){return this.getHSL(Ai),Ai.h+=t,Ai.s+=i,Ai.l+=n,this.setHSL(Ai.h,Ai.s,Ai.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this},lerpHSL:function(t,i){this.getHSL(Ai),t.getHSL(xi);var n=Y.lerp(Ai.h,xi.h,i),t=Y.lerp(Ai.s,xi.s,i),i=Y.lerp(Ai.l,xi.l,i);return this.setHSL(n,t,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,i){return this.r=t[i=void 0===i?0:i],this.g=t[i+1],this.b=t[i+2],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}}),Ci.NAMES=ji,Object.assign(Pi.prototype,{isFog:!0,clone:function(){return new Pi(this.color,this.near,this.far)}});var Bi=[new Jt,new Jt,new Jt,new Jt,new Jt,new Jt,new Jt,new Jt],Fi=new Jt,Ni=new Wi,Di=new Jt,Hi=new Jt,Ui=new Jt,Vi=new Jt,Gi=new Jt,zi=new Jt,qi=new Jt,Zi=new Jt,Yi=new Jt,Xi=new Jt;function Wi(t,i){this.min=void 0!==t?t:new Jt(1/0,1/0,1/0),this.max=void 0!==i?i:new Jt(-1/0,-1/0,-1/0)}function Qi(t,i,n,e,r){for(var s=0,o=t.length-3;s<=o;s+=3){Xi.fromArray(t,s);var u=r.x*Math.abs(Xi.x)+r.y*Math.abs(Xi.y)+r.z*Math.abs(Xi.z),h=i.dot(Xi),a=n.dot(Xi),c=e.dot(Xi);if(Math.max(-Math.max(h,a,c),Math.min(h,a,c))>u)return!1}return!0}function Ki(t,i,n,e){this.x=t||0,this.y=i||0,this.z=n||0,this.w=void 0!==e?e:1}function Ji(t,i){this.x=t||0,this.y=i||0}Object.assign(Wi.prototype,{isBox3:!0,set:function(t,i){return this.min.copy(t),this.max.copy(i),this},setFromArray:function(t){for(var i=1/0,n=1/0,e=1/0,r=-1/0,s=-1/0,o=-1/0,u=0,h=t.length;u<h;u+=3){var a=t[u],c=t[u+1],f=t[u+2];a<i&&(i=a),c<n&&(n=c),f<e&&(e=f),r<a&&(r=a),s<c&&(s=c),o<f&&(o=f)}return this.min.set(i,n,e),this.max.set(r,s,o),this},setFromBufferAttribute:function(t){for(var i=1/0,n=1/0,e=1/0,r=-1/0,s=-1/0,o=-1/0,u=0,h=t.count;u<h;u++){var a=t.getX(u),c=t.getY(u),f=t.getZ(u);a<i&&(i=a),c<n&&(n=c),f<e&&(e=f),r<a&&(r=a),s<c&&(s=c),o<f&&(o=f)}return this.min.set(i,n,e),this.max.set(r,s,o),this},setFromPoints:function(t){this.makeEmpty();for(var i=0,n=t.length;i<n;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,i){i=Fi.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Jt),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Jt),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var i=t.geometry;void 0!==i&&(null===i.boundingBox&&i.computeBoundingBox(),Ni.copy(i.boundingBox),Ni.applyMatrix4(t.matrixWorld),this.union(Ni));for(var n=t.children,e=0,r=n.length;e<r;e++)this.expandByObject(n[e]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .getParameter() target is now required"),i=new Jt),i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Fi),Fi.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var i,n=0<t.normal.x?(i=t.normal.x*this.min.x,t.normal.x*this.max.x):(i=t.normal.x*this.max.x,t.normal.x*this.min.x);return 0<t.normal.y?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(qi),Zi.subVectors(this.max,qi),Di.subVectors(t.a,qi),Hi.subVectors(t.b,qi),Ui.subVectors(t.c,qi),Vi.subVectors(Hi,Di),Gi.subVectors(Ui,Hi),zi.subVectors(Di,Ui);t=[0,-Vi.z,Vi.y,0,-Gi.z,Gi.y,0,-zi.z,zi.y,Vi.z,0,-Vi.x,Gi.z,0,-Gi.x,zi.z,0,-zi.x,-Vi.y,Vi.x,0,-Gi.y,Gi.x,0,-zi.y,zi.x,0];return!!Qi(t,Di,Hi,Ui,Zi)&&(!!Qi(t=[1,0,0,0,1,0,0,0,1],Di,Hi,Ui,Zi)&&(Yi.crossVectors(Vi,Gi),Qi(t=[Yi.x,Yi.y,Yi.z],Di,Hi,Ui,Zi)))},clampPoint:function(t,i){return void 0===i&&(console.warn("THREE.Box3: .clampPoint() target is now required"),i=new Jt),i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Fi.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Fi).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(Bi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Bi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Bi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Bi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Bi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Bi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Bi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Bi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Bi)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),Object.defineProperties(Ki.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Ki.prototype,{isVector4:!0,set:function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var i=this.x,n=this.y,e=this.z,r=this.w,t=t.elements;return this.x=t[0]*i+t[4]*n+t[8]*e+t[12]*r,this.y=t[1]*i+t[5]*n+t[9]*e+t[13]*r,this.z=t[2]*i+t[6]*n+t[10]*e+t[14]*r,this.w=t[3]*i+t[7]*n+t[11]*e+t[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},setAxisAngleFromRotationMatrix:function(t){var i,n,e,r=t.elements,s=r[0],o=r[4],u=r[8],h=r[1],a=r[5],c=r[9],f=r[2],l=r[6],v=r[10];if(Math.abs(o-h)<.01&&Math.abs(u-f)<.01&&Math.abs(c-l)<.01){if(Math.abs(o+h)<.1&&Math.abs(u+f)<.1&&Math.abs(c+l)<.1&&Math.abs(s+a+v-3)<.1)return this.set(1,0,0,0),this;var d=Math.PI,y=(s+1)/2,p=(a+1)/2,b=(v+1)/2,m=(o+h)/4,t=(u+f)/4,r=(c+l)/4;return p<y&&b<y?e=y<.01?(i=0,n=.707106781):(n=m/(i=Math.sqrt(y)),t/i):b<p?e=p<.01?(n=0,i=.707106781):(i=m/(n=Math.sqrt(p)),r/n):b<.01?(n=i=.707106781,e=0):(i=t/(e=Math.sqrt(b)),n=r/e),this.set(i,n,e,d),this}d=Math.sqrt((l-c)*(l-c)+(u-f)*(u-f)+(h-o)*(h-o));return Math.abs(d)<.001&&(d=1),this.x=(l-c)/d,this.y=(u-f)/d,this.z=(h-o)/d,this.w=Math.acos((s+a+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}}),Object.defineProperties(Ji.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Ji.prototype,{isVector2:!0,set:function(t,i){return this.x=t,this.y=i,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},sub:function(t,i){return void 0!==i?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var i=this.x,n=this.y,t=t.elements;return this.x=t[0]*i+t[3]*n+t[6],this.y=t[1]*i+t[4]*n+t[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},clampScalar:function(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this},clampLength:function(t,i){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(i,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,t=this.y-t.y;return i*i+t*t},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},lerpVectors:function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,i){return this.x=t[i=void 0===i?0:i],this.y=t[i+1],this},toArray:function(t,i){return(t=void 0===t?[]:t)[i=void 0===i?0:i]=this.x,t[i+1]=this.y,t},fromBufferAttribute:function(t,i,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(i),this.y=t.getY(i),this},rotateAround:function(t,i){var n=Math.cos(i),e=Math.sin(i),r=this.x-t.x,i=this.y-t.y;return this.x=r*n-i*e+t.x,this.y=r*e+i*n+t.y,this}});var $i=0,tn=1,nn=2,en=1,rn=100,sn=204,on=205,un=3,hn=0,an=1001,cn=1006,fn=1008,ln=1009,vn=1022,dn=1023,yn=2300,pn=2301,bn=2,mn=3e3,wn=3200,gn=0,Mn=7680,kn=519,En=35044,On=new Jt;function Rn(t,i,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=i,this.count=void 0!==t?t.length/i:0,this.normalized=!0===n,this.usage=En,this.updateRange={offset:0,count:-1},this.version=0}function Tn(t,i,n){Rn.call(this,new Int8Array(t),i,n)}function Sn(t,i,n){Rn.call(this,new Uint8Array(t),i,n)}function jn(t,i,n){Rn.call(this,new Uint8ClampedArray(t),i,n)}function An(t,i,n){Rn.call(this,new Int16Array(t),i,n)}function xn(t,i,n){Rn.call(this,new Uint16Array(t),i,n)}function Cn(t,i,n){Rn.call(this,new Int32Array(t),i,n)}function Ln(t,i,n){Rn.call(this,new Uint32Array(t),i,n)}function _n(t,i,n){Rn.call(this,new Float32Array(t),i,n)}function In(t,i,n){Rn.call(this,new Float64Array(t),i,n)}Object.defineProperty(Rn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Rn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.itemSize,n*=i.itemSize;for(var e=0,r=this.itemSize;e<r;e++)this.array[t+e]=i.array[n+e];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),s=new Ci),i[n++]=s.r,i[n++]=s.g,i[n++]=s.b}return this},copyVector2sArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),s=new Ji),i[n++]=s.x,i[n++]=s.y}return this},copyVector3sArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),s=new Jt),i[n++]=s.x,i[n++]=s.y,i[n++]=s.z}return this},copyVector4sArray:function(t){for(var i=this.array,n=0,e=0,r=t.length;e<r;e++){var s=t[e];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),s=new Ki),i[n++]=s.x,i[n++]=s.y,i[n++]=s.z,i[n++]=s.w}return this},applyMatrix3:function(t){for(var i=0,n=this.count;i<n;i++)On.x=this.getX(i),On.y=this.getY(i),On.z=this.getZ(i),On.applyMatrix3(t),this.setXYZ(i,On.x,On.y,On.z);return this},applyMatrix4:function(t){for(var i=0,n=this.count;i<n;i++)On.x=this.getX(i),On.y=this.getY(i),On.z=this.getZ(i),On.applyMatrix4(t),this.setXYZ(i,On.x,On.y,On.z);return this},applyNormalMatrix:function(t){for(var i=0,n=this.count;i<n;i++)On.x=this.getX(i),On.y=this.getY(i),On.z=this.getZ(i),On.applyNormalMatrix(t),this.setXYZ(i,On.x,On.y,On.z);return this},transformDirection:function(t){for(var i=0,n=this.count;i<n;i++)On.x=this.getX(i),On.y=this.getY(i),On.z=this.getZ(i),On.transformDirection(t),this.setXYZ(i,On.x,On.y,On.z);return this},set:function(t,i){return this.array.set(t,i=void 0===i?0:i),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,i){return this.array[t*this.itemSize]=i,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,i){return this.array[t*this.itemSize+1]=i,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,i){return this.array[t*this.itemSize+2]=i,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,i){return this.array[t*this.itemSize+3]=i,this},setXY:function(t,i,n){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this},setXYZ:function(t,i,n,e){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=e,this},setXYZW:function(t,i,n,e,r){return t*=this.itemSize,this.array[t+0]=i,this.array[t+1]=n,this.array[t+2]=e,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(Tn.prototype=Object.create(Rn.prototype)).constructor=Tn,(Sn.prototype=Object.create(Rn.prototype)).constructor=Sn,(jn.prototype=Object.create(Rn.prototype)).constructor=jn,(An.prototype=Object.create(Rn.prototype)).constructor=An,xn.prototype=Object.create(Rn.prototype),xn.prototype.constructor=xn,(Cn.prototype=Object.create(Rn.prototype)).constructor=Cn,Ln.prototype=Object.create(Rn.prototype),Ln.prototype.constructor=Ln,(_n.prototype=Object.create(Rn.prototype)).constructor=_n,(In.prototype=Object.create(Rn.prototype)).constructor=In;var Pn=new Wi;function Bn(t,i){this.center=void 0!==t?t:new Jt,this.radius=void 0!==i?i:0}function Fn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(Bn.prototype,{set:function(t,i){return this.center.copy(t),this.radius=i,this},setFromPoints:function(t,i){var n=this.center;void 0!==i?n.copy(i):Pn.setFromPoints(t).getCenter(n);for(var e=0,r=0,s=t.length;r<s;r++)e=Math.max(e,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,i){var n=this.center.distanceToSquared(t);return void 0===i&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),i=new Jt),i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Wi),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),Object.assign(Fn.prototype,{computeGroups:function(t){for(var i,n=[],e=void 0,r=t.faces,s=0;s<r.length;s++){var o=r[s];o.materialIndex!==e&&(e=o.materialIndex,void 0!==i&&(i.count=3*s-i.start,n.push(i)),i={start:3*s,materialIndex:e})}void 0!==i&&(i.count=3*s-i.start,n.push(i)),this.groups=n},fromGeometry:function(t){var i=t.faces,n=t.vertices,e=t.faceVertexUvs,r=e[0]&&0<e[0].length,s=e[1]&&0<e[1].length,o=t.morphTargets,u=o.length;if(0<u){for(var h=[],a=0;a<u;a++)h[a]={name:o[a].name,data:[]};this.morphTargets.position=h}var c=t.morphNormals,f=c.length;if(0<f){for(var l=[],a=0;a<f;a++)l[a]={name:c[a].name,data:[]};this.morphTargets.normal=l}var v=t.skinIndices,d=t.skinWeights,y=v.length===n.length,p=d.length===n.length;0<n.length&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(a=0;a<i.length;a++){var b=i[a];this.vertices.push(n[b.a],n[b.b],n[b.c]);var m=b.vertexNormals;3===m.length?this.normals.push(m[0],m[1],m[2]):(g=b.normal,this.normals.push(g,g,g));var w,g=b.vertexColors;3===g.length?this.colors.push(g[0],g[1],g[2]):(g=b.color,this.colors.push(g,g,g)),!0===r&&(void 0!==(w=e[0][a])?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",a),this.uvs.push(new Ji,new Ji,new Ji))),!0===s&&(void 0!==(w=e[1][a])?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",a),this.uvs2.push(new Ji,new Ji,new Ji)));for(var M=0;M<u;M++){var k=o[M].vertices;h[M].data.push(k[b.a],k[b.b],k[b.c])}for(M=0;M<f;M++){var E=c[M].vertexNormals[a];l[M].data.push(E.a,E.b,E.c)}y&&this.skinIndices.push(v[b.a],v[b.b],v[b.c]),p&&this.skinWeights.push(d[b.a],d[b.b],d[b.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var Nn=1,Dn=new oi,Hn=new Ti,Un=new Jt,Vn=new Wi,Gn=new Wi,zn=new Jt;function qn(){Object.defineProperty(this,"id",{value:Nn+=2}),this.uuid=Y.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Zn(t,i,n,e){qn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:i,widthSegments:n,heightSegments:e};for(var r=(t=t||1)/2,s=(i=i||1)/2,o=Math.floor(n)||1,u=Math.floor(e)||1,h=o+1,a=u+1,c=t/o,f=i/u,l=[],v=[],d=[],y=[],p=0;p<a;p++)for(var b=p*f-s,m=0;m<h;m++)v.push(m*c-r,-b,0),d.push(0,0,1),y.push(m/o),y.push(1-p/u);for(p=0;p<u;p++)for(m=0;m<o;m++){var w=m+h*(p+1),g=m+1+h*(p+1),M=m+1+h*p;l.push(m+h*p,w,M),l.push(w,g,M)}this.setIndex(l),this.setAttribute("position",new _n(v,3)),this.setAttribute("normal",new _n(d,3)),this.setAttribute("uv",new _n(y,2))}qn.prototype=Object.assign(Object.create(ui.prototype),{constructor:qn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(65535<function(t){if(0===t.length)return-1/0;for(var i=t[0],n=1,e=t.length;n<e;++n)t[n]>i&&(i=t[n]);return i}(t)?Ln:xn)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,i){return this.attributes[t]=i,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,i,n){this.groups.push({start:t,count:i,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,i){this.drawRange.start=t,this.drawRange.count=i},applyMatrix4:function(t){var i=this.attributes.position;void 0!==i&&(i.applyMatrix4(t),i.needsUpdate=!0);var n=this.attributes.normal;void 0!==n&&(i=(new li).getNormalMatrix(t),n.applyNormalMatrix(i),n.needsUpdate=!0);n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Dn.makeRotationX(t),this.applyMatrix4(Dn),this},rotateY:function(t){return Dn.makeRotationY(t),this.applyMatrix4(Dn),this},rotateZ:function(t){return Dn.makeRotationZ(t),this.applyMatrix4(Dn),this},translate:function(t,i,n){return Dn.makeTranslation(t,i,n),this.applyMatrix4(Dn),this},scale:function(t,i,n){return Dn.makeScale(t,i,n),this.applyMatrix4(Dn),this},lookAt:function(t){return Hn.lookAt(t),Hn.updateMatrix(),this.applyMatrix4(Hn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Un).negate(),this.translate(Un.x,Un.y,Un.z),this},setFromObject:function(t){var i,n,e=t.geometry;return t.isPoints||t.isLine?(i=new _n(3*e.vertices.length,3),n=new _n(3*e.colors.length,3),this.setAttribute("position",i.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length&&(n=new _n(e.lineDistances.length,1),this.setAttribute("lineDistance",n.copyArray(e.lineDistances))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())):t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e),this},setFromPoints:function(t){for(var i=[],n=0,e=t.length;n<e;n++){var r=t[n];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new _n(i,3)),this},updateFromObject:function(t){var i,n=t.geometry;if(t.isMesh){var e=n.Re;if(!0===n.elementsNeedUpdate&&(e=void 0,n.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(n);e.verticesNeedUpdate=n.verticesNeedUpdate,e.normalsNeedUpdate=n.normalsNeedUpdate,e.colorsNeedUpdate=n.colorsNeedUpdate,e.uvsNeedUpdate=n.uvsNeedUpdate,e.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=e}return!0===n.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(n.vertices),i.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(n.normals),i.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(n.colors),i.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(n.uvs),i.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(n.lineDistances),i.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(t.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.Re=(new Fn).fromGeometry(t),this.fromDirectGeometry(t.Re)},fromDirectGeometry:function(t){var i,n,e,r,s=new Float32Array(3*t.vertices.length);for(e in this.setAttribute("position",new Rn(s,3).copyVector3sArray(t.vertices)),0<t.normals.length&&(i=new Float32Array(3*t.normals.length),this.setAttribute("normal",new Rn(i,3).copyVector3sArray(t.normals))),0<t.colors.length&&(i=new Float32Array(3*t.colors.length),this.setAttribute("color",new Rn(i,3).copyColorsArray(t.colors))),0<t.uvs.length&&(n=new Float32Array(2*t.uvs.length),this.setAttribute("uv",new Rn(n,2).copyVector2sArray(t.uvs))),0<t.uvs2.length&&(n=new Float32Array(2*t.uvs2.length),this.setAttribute("uv2",new Rn(n,2).copyVector2sArray(t.uvs2))),this.groups=t.groups,t.morphTargets){for(var o=[],u=t.morphTargets[e],h=0,a=u.length;h<a;h++){var c=u[h],f=new _n(3*c.data.length,3);f.name=c.name,o.push(f.copyVector3sArray(c.data))}this.morphAttributes[e]=o}return 0<t.skinIndices.length&&(r=new _n(4*t.skinIndices.length,4),this.setAttribute("skinIndex",r.copyVector4sArray(t.skinIndices))),0<t.skinWeights.length&&(r=new _n(4*t.skinWeights.length,4),this.setAttribute("skinWeight",r.copyVector4sArray(t.skinWeights))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Wi);var t=this.attributes.position,i=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),i)for(var n=0,e=i.length;n<e;n++){var r=i[n];Vn.setFromBufferAttribute(r),this.morphTargetsRelative?(zn.addVectors(this.boundingBox.min,Vn.min),this.boundingBox.expandByPoint(zn),zn.addVectors(this.boundingBox.max,Vn.max),this.boundingBox.expandByPoint(zn)):(this.boundingBox.expandByPoint(Vn.min),this.boundingBox.expandByPoint(Vn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Bn);var t=this.attributes.position,i=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(Vn.setFromBufferAttribute(t),i)for(var e=0,r=i.length;e<r;e++){var s=i[e];Gn.setFromBufferAttribute(s),this.morphTargetsRelative?(zn.addVectors(Vn.min,Gn.min),Vn.expandByPoint(zn),zn.addVectors(Vn.max,Gn.max),Vn.expandByPoint(zn)):(Vn.expandByPoint(Gn.min),Vn.expandByPoint(Gn.max))}Vn.getCenter(n);for(var o=0,e=0,r=t.count;e<r;e++)zn.fromBufferAttribute(t,e),o=Math.max(o,n.distanceToSquared(zn));if(i)for(e=0,r=i.length;e<r;e++)for(var s=i[e],u=this.morphTargetsRelative,h=0,a=s.count;h<a;h++)zn.fromBufferAttribute(s,h),u&&(Un.fromBufferAttribute(t,h),zn.add(Un)),o=Math.max(o,n.distanceToSquared(zn));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,i=this.attributes;if(i.position){var n=i.position.array;if(void 0===i.normal)this.setAttribute("normal",new Rn(new Float32Array(n.length),3));else for(var e=i.normal.array,r=0,s=e.length;r<s;r++)e[r]=0;var o,u,h,a=i.normal.array,c=new Jt,f=new Jt,l=new Jt,v=new Jt,d=new Jt;if(t)for(var y=t.array,r=0,s=t.count;r<s;r+=3)o=3*y[r+0],u=3*y[r+1],h=3*y[r+2],c.fromArray(n,o),f.fromArray(n,u),l.fromArray(n,h),v.subVectors(l,f),d.subVectors(c,f),v.cross(d),a[o]+=v.x,a[1+o]+=v.y,a[2+o]+=v.z,a[u]+=v.x,a[1+u]+=v.y,a[2+u]+=v.z,a[h]+=v.x,a[1+h]+=v.y,a[2+h]+=v.z;else for(r=0,s=n.length;r<s;r+=9)c.fromArray(n,r),f.fromArray(n,r+3),l.fromArray(n,r+6),v.subVectors(l,f),d.subVectors(c,f),v.cross(d),a[r]=v.x,a[r+1]=v.y,a[r+2]=v.z,a[r+3]=v.x,a[r+4]=v.y,a[r+5]=v.z,a[r+6]=v.x,a[r+7]=v.y,a[r+8]=v.z;this.normalizeNormals(),i.normal.needsUpdate=!0}},normalizeNormals:function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)zn.x=t.getX(i),zn.y=t.getY(i),zn.z=t.getZ(i),zn.normalize(),t.setXYZ(i,zn.x,zn.y,zn.z)},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(Zn.prototype=Object.create(qn.prototype)).constructor=Zn;var Yn=0;function Xn(){Object.defineProperty(this,"id",{value:Yn++}),this.uuid=Y.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=en,this.side=$i,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=sn,this.blendDst=on,this.blendEquation=rn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=un,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=kn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Mn,this.stencilZFail=Mn,this.stencilZPass=Mn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Wn(t){Xn.call(this),this.type="MeshBasicMaterial",this.color=new Ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Xn.prototype=Object.assign(Object.create(ui.prototype),{constructor:Xn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var i in t){var n,e=t[i];void 0!==e?"shading"!==i?void 0!==(n=this[i])?n&&n.isColor?n.set(e):n&&n.isVector3&&e&&e.isVector3?n.copy(e):this[i]=e:console.warn("THREE."+this.type+": '"+i+"' is not a property of this material."):(console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e):console.warn("THREE.Material: '"+i+"' parameter is undefined.")}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var i=t.clippingPlanes,n=null;if(null!==i)for(var e=i.length,n=new Array(e),r=0;r!==e;++r)n[r]=i[r].clone();return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Xn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((Wn.prototype=Object.create(Xn.prototype)).constructor=Wn).prototype.isMeshBasicMaterial=!0,Wn.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var Qn=0;function Kn(t,i,n,e,r,s,o,u,h,a){Object.defineProperty(this,"id",{value:Qn++}),this.uuid=Y.generateUUID(),this.name="",this.image=void 0!==t?t:Kn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==i?i:Kn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:an,this.wrapT=void 0!==e?e:an,this.magFilter=void 0!==r?r:cn,this.minFilter=void 0!==s?s:fn,this.anisotropy=void 0!==h?h:1,this.format=void 0!==o?o:dn,this.internalFormat=null,this.type=void 0!==u?u:ln,this.offset=new Ji(0,0),this.repeat=new Ji(1,1),this.center=new Ji(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new li,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==a?a:mn,this.version=0,this.onUpdate=null}function Jn(t,i,n,e,r,s,o,u,h){Kn.call(this,t,i,n,e,r,s,o,u,h),this.needsUpdate=!0}Kn.DEFAULT_IMAGE=void 0,Kn.DEFAULT_MAPPING=300,Kn.prototype=Object.assign(Object.create(ui.prototype),{constructor:Kn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case an:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case an:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Kn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),((Jn.prototype=Object.create(Kn.prototype)).constructor=Jn).prototype.isCanvasTexture=!0;var $n=new Jt,te=new Jt,ie=new li;function ne(t,i){this.normal=void 0!==t?t:new Jt(1,0,0),this.constant=void 0!==i?i:0}Object.assign(ne.prototype,{isPlane:!0,set:function(t,i){return this.normal.copy(t),this.constant=i,this},setComponents:function(t,i,n,e){return this.normal.set(t,i,n),this.constant=e,this},setFromNormalAndCoplanarPoint:function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this},setFromCoplanarPoints:function(t,i,n){i=$n.subVectors(n,i).cross(te.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,i){return void 0===i&&(console.warn("THREE.Plane: .projectPoint() target is now required"),i=new Jt),i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,i){void 0===i&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new Jt);var n=t.delta($n),e=this.normal.dot(n);if(0===e)return 0===this.distanceToPoint(t.start)?i.copy(t.start):void 0;e=-(t.start.dot(this.normal)+this.constant)/e;return e<0||1<e?void 0:i.copy(n).multiplyScalar(e).add(t.start)},intersectsLine:function(t){var i=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return i<0&&0<t||t<0&&0<i},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Jt),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,i){i=i||ie.getNormalMatrix(t),t=this.coplanarPoint($n).applyMatrix4(t),i=this.normal.applyMatrix3(i).normalize();return this.constant=-t.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var ee=new Jt,re=new Jt,se=new Jt,oe=new Jt,ue=new Jt,he=new Jt,ae=new Jt;function ce(t,i){this.origin=void 0!==t?t:new Jt,this.direction=void 0!==i?i:new Jt(0,0,-1)}Object.assign(ce.prototype,{set:function(t,i){return this.origin.copy(t),this.direction.copy(i),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,i){return void 0===i&&(console.warn("THREE.Ray: .at() target is now required"),i=new Jt),i.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,ee)),this},closestPointToPoint:function(t,i){void 0===i&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),i=new Jt),i.subVectors(t,this.origin);t=i.dot(this.direction);return t<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(t).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var i=ee.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(ee.copy(this.direction).multiplyScalar(i).add(this.origin),ee.distanceToSquared(t))},distanceSqToSegment:function(t,i,n,e){re.copy(t).add(i).multiplyScalar(.5),se.copy(i).sub(t).normalize(),oe.copy(this.origin).sub(re);var r,s,o=.5*t.distanceTo(i),u=-this.direction.dot(se),h=oe.dot(this.direction),a=-oe.dot(se),c=oe.lengthSq(),t=Math.abs(1-u*u);return c=0<t?(s=u*h-a,i=o*t,0<=(r=u*a-h)?-i<=s?s<=i?(r*=t=1/t)*(r+u*(s*=t)+2*h)+s*(u*r+s+2*a)+c:(s=o,-(r=Math.max(0,-(u*s+h)))*r+s*(s+2*a)+c):(s=-o,-(r=Math.max(0,-(u*s+h)))*r+s*(s+2*a)+c):s<=-i?-(r=Math.max(0,-(-u*o+h)))*r+(s=0<r?-o:Math.min(Math.max(-o,-a),o))*(s+2*a)+c:s<=i?(r=0,(s=Math.min(Math.max(-o,-a),o))*(s+2*a)+c):-(r=Math.max(0,-(u*o+h)))*r+(s=0<r?o:Math.min(Math.max(-o,-a),o))*(s+2*a)+c):(s=0<u?-o:o,-(r=Math.max(0,-(u*s+h)))*r+s*(s+2*a)+c),n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),e&&e.copy(se).multiplyScalar(s).add(re),c},intersectSphere:function(t,i){ee.subVectors(t.center,this.origin);var n=ee.dot(this.direction),e=ee.dot(ee)-n*n,t=t.radius*t.radius;if(t<e)return null;t=Math.sqrt(t-e),e=n-t,t=n+t;return e<0&&t<0?null:e<0?this.at(t,i):this.at(e,i)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var i=t.normal.dot(this.direction);if(0===i)return 0===t.distanceToPoint(this.origin)?0:null;i=-(this.origin.dot(t.normal)+t.constant)/i;return 0<=i?i:null},intersectPlane:function(t,i){t=this.distanceToPlane(t);return null===t?null:this.at(t,i)},intersectsPlane:function(t){var i=t.distanceToPoint(this.origin);return 0===i||t.normal.dot(this.direction)*i<0},intersectBox:function(t,i){var n,e,r,s=1/this.direction.x,o=1/this.direction.y,u=1/this.direction.z,h=this.origin,s=0<=s?(n=(t.min.x-h.x)*s,(t.max.x-h.x)*s):(n=(t.max.x-h.x)*s,(t.min.x-h.x)*s),o=0<=o?(e=(t.min.y-h.y)*o,(t.max.y-h.y)*o):(e=(t.max.y-h.y)*o,(t.min.y-h.y)*o);return o<n||s<e?null:((o<s||s!=s)&&(s=o),(u=0<=u?(r=(t.min.z-h.z)*u,(t.max.z-h.z)*u):(r=(t.max.z-h.z)*u,(t.min.z-h.z)*u))<(n=n<e||n!=n?e:n)||s<r?null:((n<r||n!=n)&&(n=r),(s=u<s||s!=s?u:s)<0?null:this.at(0<=n?n:s,i)))},intersectsBox:function(t){return null!==this.intersectBox(t,ee)},intersectTriangle:function(t,i,n,e,r){ue.subVectors(i,t),he.subVectors(n,t),ae.crossVectors(ue,he);n=this.direction.dot(ae);if(0<n){if(e)return null;s=1}else{if(!(n<0))return null;s=-1,n=-n}oe.subVectors(this.origin,t);e=s*this.direction.dot(he.crossVectors(oe,he));if(e<0)return null;t=s*this.direction.dot(ue.cross(oe));if(t<0)return null;if(n<e+t)return null;var s=-s*oe.dot(ae);return s<0?null:this.at(s/n,r)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var fe=new Jt,le=new Jt,ve=new Jt,de=new Jt,ye=new Jt,pe=new Jt,be=new Jt,me=new Jt,we=new Jt,ge=new Jt;function Me(t,i,n){this.a=void 0!==t?t:new Jt,this.b=void 0!==i?i:new Jt,this.c=void 0!==n?n:new Jt}function ke(t,i,n,e,r,s){this.a=t,this.b=i,this.c=n,this.normal=e&&e.isVector3?e:new Jt,this.vertexNormals=Array.isArray(e)?e:[],this.color=r&&r.isColor?r:new Ci,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==s?s:0}Object.assign(Me,{getNormal:function(t,i,n,e){void 0===e&&(console.warn("THREE.Triangle: .getNormal() target is now required"),e=new Jt),e.subVectors(n,i),fe.subVectors(t,i),e.cross(fe);i=e.lengthSq();return 0<i?e.multiplyScalar(1/Math.sqrt(i)):e.set(0,0,0)},getBarycoord:function(t,i,n,e,r){fe.subVectors(e,i),le.subVectors(n,i),ve.subVectors(t,i);var s=fe.dot(fe),o=fe.dot(le),e=fe.dot(ve),n=le.dot(le),t=le.dot(ve),i=s*n-o*o;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new Jt),0==i)return r.set(-2,-1,-1);i=1/i,n=(n*e-o*t)*i,i*=s*t-o*e;return r.set(1-n-i,i,n)},containsPoint:function(t,i,n,e){return Me.getBarycoord(t,i,n,e,de),0<=de.x&&0<=de.y&&de.x+de.y<=1},getUV:function(t,i,n,e,r,s,o,u){return this.getBarycoord(t,i,n,e,de),u.set(0,0),u.addScaledVector(r,de.x),u.addScaledVector(s,de.y),u.addScaledVector(o,de.z),u},isFrontFacing:function(t,i,n,e){return fe.subVectors(n,i),le.subVectors(t,i),fe.cross(le).dot(e)<0}}),Object.assign(Me.prototype,{set:function(t,i,n){return this.a.copy(t),this.b.copy(i),this.c.copy(n),this},setFromPointsAndIndices:function(t,i,n,e){return this.a.copy(t[i]),this.b.copy(t[n]),this.c.copy(t[e]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return fe.subVectors(this.c,this.b),le.subVectors(this.a,this.b),.5*fe.cross(le).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Jt),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Me.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new ne),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,i){return Me.getBarycoord(t,this.a,this.b,this.c,i)},getUV:function(t,i,n,e,r){return Me.getUV(t,this.a,this.b,this.c,i,n,e,r)},containsPoint:function(t){return Me.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return Me.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,i){void 0===i&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),i=new Jt);var n=this.a,e=this.b,r=this.c;ye.subVectors(e,n),pe.subVectors(r,n),me.subVectors(t,n);var s=ye.dot(me),o=pe.dot(me);if(s<=0&&o<=0)return i.copy(n);we.subVectors(t,e);var u=ye.dot(we),h=pe.dot(we);if(0<=u&&h<=u)return i.copy(e);var a=s*h-u*o;if(a<=0&&0<=s&&u<=0)return f=s/(s-u),i.copy(n).addScaledVector(ye,f);ge.subVectors(t,r);var c=ye.dot(ge),t=pe.dot(ge);if(0<=t&&c<=t)return i.copy(r);s=c*o-s*t;if(s<=0&&0<=o&&t<=0)return l=o/(o-t),i.copy(n).addScaledVector(pe,l);o=u*t-c*h;if(o<=0&&0<=h-u&&0<=c-t)return be.subVectors(r,e),l=(h-u)/(h-u+(c-t)),i.copy(e).addScaledVector(be,l);var o=1/(o+s+a),f=s*o,l=a*o;return i.copy(n).addScaledVector(ye,f).addScaledVector(pe,l)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),Object.assign(ke.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var i=0,n=t.vertexNormals.length;i<n;i++)this.vertexNormals[i]=t.vertexNormals[i].clone();for(i=0,n=t.vertexColors.length;i<n;i++)this.vertexColors[i]=t.vertexColors[i].clone();return this}});var Ee=new oi,Oe=new ce,Re=new Bn,Te=new Jt,Se=new Jt,je=new Jt,Ae=new Jt,xe=new Jt,Ce=new Jt,Le=new Jt,_e=new Jt,Ie=new Jt,Pe=new Ji,Be=new Ji,Fe=new Ji,Ne=new Jt,De=new Jt;function He(t,i){Ti.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new qn,this.material=void 0!==i?i:new Wn,this.updateMorphTargets()}function Ue(t,i,n,e,r,s,o,u){i=i.side===tn?e.intersectTriangle(o,s,r,!0,u):e.intersectTriangle(r,s,o,i.side!==nn,u);if(null===i)return null;De.copy(u),De.applyMatrix4(t.matrixWorld);u=n.ray.origin.distanceTo(De);return u<n.near||u>n.far?null:{distance:u,point:De.clone(),object:t}}function Ve(t,i,n,e,r,s,o,u,h,a,c,f){Te.fromBufferAttribute(r,a),Se.fromBufferAttribute(r,c),je.fromBufferAttribute(r,f);var l=t.morphTargetInfluences;if(i.morphTargets&&s&&l){Le.set(0,0,0),_e.set(0,0,0),Ie.set(0,0,0);for(var v=0,d=s.length;v<d;v++){var y=l[v],p=s[v];0!==y&&(Ae.fromBufferAttribute(p,a),xe.fromBufferAttribute(p,c),Ce.fromBufferAttribute(p,f),o?(Le.addScaledVector(Ae,y),_e.addScaledVector(xe,y),Ie.addScaledVector(Ce,y)):(Le.addScaledVector(Ae.sub(Te),y),_e.addScaledVector(xe.sub(Se),y),Ie.addScaledVector(Ce.sub(je),y)))}Te.add(Le),Se.add(_e),je.add(Ie)}e=Ue(t,i,n,e,Te,Se,je,Ne);return e&&(u&&(Pe.fromBufferAttribute(u,a),Be.fromBufferAttribute(u,c),Fe.fromBufferAttribute(u,f),e.uv=Me.getUV(Ne,Te,Se,je,Pe,Be,Fe,new Ji)),h&&(Pe.fromBufferAttribute(h,a),Be.fromBufferAttribute(h,c),Fe.fromBufferAttribute(h,f),e.uv2=Me.getUV(Ne,Te,Se,je,Pe,Be,Fe,new Ji)),h=new ke(a,c,f),Me.getNormal(Te,Se,je,h.normal),e.face=h),e}function Ge(t,i,n,e){this.ray=new ce(t,i),this.near=n||0,this.far=e||1/0,this.camera=null,this.layers=new fi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ze(t,i){return t.distance-i.distance}function qe(t,i,n,e){if(t.layers.test(i.layers)&&t.raycast(i,n),!0===e)for(var r=t.children,s=0,o=r.length;s<o;s++)qe(r[s],i,n,!0)}He.prototype=Object.assign(Object.create(Ti.prototype),{constructor:He,isMesh:!0,copy:function(t){return Ti.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,i,n,e=this.geometry;if(e.isBufferGeometry){var r=e.morphAttributes,s=Object.keys(r);if(0<s.length){var o=r[s[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,i=o.length;t<i;t++)n=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,i){var n=this.geometry,e=this.material,r=this.matrixWorld;if(void 0!==e&&(null===n.boundingSphere&&n.computeBoundingSphere(),Re.copy(n.boundingSphere),Re.applyMatrix4(r),!1!==t.ray.intersectsSphere(Re)&&(Ee.getInverse(r),Oe.copy(t.ray).applyMatrix4(Ee),null===n.boundingBox||!1!==Oe.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var s,o,u,h,a,c,f,l,v,d=n.index,y=n.attributes.position,p=n.morphAttributes.position,b=n.morphTargetsRelative,m=n.attributes.uv,w=n.attributes.uv2,g=n.groups,M=n.drawRange;if(null!==d)if(Array.isArray(e))for(h=0,c=g.length;h<c;h++)for(v=e[(l=g[h]).materialIndex],a=Math.max(l.start,M.start),f=Math.min(l.start+l.count,M.start+M.count);a<f;a+=3)s=d.getX(a),o=d.getX(a+1),u=d.getX(a+2),(C=Ve(this,v,t,Oe,y,p,b,m,w,s,o,u))&&(C.faceIndex=Math.floor(a/3),C.face.materialIndex=l.materialIndex,i.push(C));else for(h=Math.max(0,M.start),c=Math.min(d.count,M.start+M.count);h<c;h+=3)s=d.getX(h),o=d.getX(h+1),u=d.getX(h+2),(C=Ve(this,e,t,Oe,y,p,b,m,w,s,o,u))&&(C.faceIndex=Math.floor(h/3),i.push(C));else if(void 0!==y)if(Array.isArray(e))for(h=0,c=g.length;h<c;h++)for(v=e[(l=g[h]).materialIndex],a=Math.max(l.start,M.start),f=Math.min(l.start+l.count,M.start+M.count);a<f;a+=3)(C=Ve(this,v,t,Oe,y,p,b,m,w,s=a,o=a+1,u=a+2))&&(C.faceIndex=Math.floor(a/3),C.face.materialIndex=l.materialIndex,i.push(C));else for(h=Math.max(0,M.start),c=Math.min(y.count,M.start+M.count);h<c;h+=3)(C=Ve(this,e,t,Oe,y,p,b,m,w,s=h,o=h+1,u=h+2))&&(C.faceIndex=Math.floor(h/3),i.push(C))}else if(n.isGeometry){var k,E=Array.isArray(e),O=n.vertices,R=n.faces,n=n.faceVertexUvs[0];0<n.length&&(k=n);for(var T=0,S=R.length;T<S;T++){var j,A,x,C,L=R[T],_=E?e[L.materialIndex]:e;void 0!==_&&(j=O[L.a],A=O[L.b],x=O[L.c],(C=Ue(this,_,t,Oe,j,A,x,Ne))&&(k&&k[T]&&(_=k[T],Pe.copy(_[0]),Be.copy(_[1]),Fe.copy(_[2]),C.uv=Me.getUV(Ne,j,A,x,Pe,Be,Fe,new Ji)),C.face=L,C.faceIndex=T,i.push(C)))}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Ge.prototype,{set:function(t,i){this.ray.set(t,i)},setFromCamera:function(t,i){i&&i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i&&i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,i,n){n=n||[];return qe(t,this,n,i),n.sort(ze),n},intersectObjects:function(t,i,n){var e=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var r=0,s=t.length;r<s;r++)qe(t[r],this,e,i);return e.sort(ze),e}});var Ze={AMAP_SATELLITE:1,AMAP_VECTOR:2,BAIDU_VECTOR:4,BAIDU_SATELLITE:8,TD_VECTOR:16,TD_SATELLITE:32,OSM:64},A={FOV:35,CAMERA_NEAR:1,CAMERA_FAR:1e5,ZOOM_UPPER_BOUND:30,TILT_UPPER_BOUND:90,THOUSAND:1e3,DEG2RAD:.0174532,RAD2DEG:57.2957795,DRAW_TIME:500,EPS:.001};Object.freeze(A);var Ye=A;function Xe(){Ti.call(this),this.type="Group"}function We(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}Xe.prototype=Object.assign(Object.create(Ti.prototype),{constructor:Xe,isGroup:!0});var Qe=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.disposed=!1}var i,n,e;return i=t,(n=[{key:"dispose",value:function(){this.disposed||(this.disposed=!0,this.disposeInternal())}},{key:"disposeInternal",value:function(){}}])&&We(i.prototype,n),e&&We(i,e),t}();function Ke(t,i){return i<t?1:t<i?-1:0}function Je(t,i,n){var e,r=t.length;if(t[0]<=i)return 0;if(i<=t[r-1])return r-1;if(0<n){for(e=1;e<r;++e)if(t[e]<i)return e-1}else if(n<0){for(e=1;e<r;++e)if(t[e]<=i)return e}else for(e=1;e<r;++e){if(t[e]==i)return e;if(t[e]<i)return"function"==typeof n?0<n(i,t[e-1],t[e])?e-1:e:t[e-1]-i<i-t[e]?e-1:e}return r-1}function $e(t,i){for(var n=Array.isArray(i)?i:[i],e=n.length,r=0;r<e;r++)t[t.length]=n[r]}function tr(t,i){var n=t.length;if(n===i.length){for(var e=0;e<n;e++)if(t[e]!==i[e])return;return 1}}function ir(){return!0}function nr(){}function er(){return function(){throw new Error("Unimplemented abstract method.")}()}var rr=0;function sr(t){return t.ol_uid||(t.ol_uid=String(++rr))}var or="latest",D="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",ur=(D.indexOf("firefox"),-1!==D.indexOf("safari")&&D.indexOf("chrom"),-1!==D.indexOf("webkit")&&D.indexOf("edge"),D.indexOf("macintosh"),"undefined"!=typeof devicePixelRatio?devicePixelRatio:1),hr="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,ar="undefined"!=typeof Image&&Image.prototype.decode;!function(){var t=!1;try{var i=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,i),window.removeEventListener("_",null,i)}catch(t){}}();function cr(t){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fr(n){var e=dr();return function(){var t,i=pr(n);return t=e?(t=pr(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==cr(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function lr(t){var e="function"==typeof Map?new Map:void 0;return(lr=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return vr(t,arguments,pr(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),yr(n,t)})(t)}function vr(t,i,n){return(vr=dr()?Reflect.construct:function(t,i,n){var e=[null];e.push.apply(e,i);e=new(Function.bind.apply(t,e));return n&&yr(e,n.prototype),e}).apply(null,arguments)}function dr(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function yr(t,i){return(yr=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function pr(t){return(pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var br=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&yr(t,i)}(r,lr(Error));var e=fr(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i,n="Assertion failed. See https://openlayers.org/en/"+("latest"===or?or:"v"+or.split("-")[0])+"/doc/errors/#"+t+" for details.";return(i=e.call(this,n)).code=t,i.name="AssertionError",i.message=n,i}return r}();function mr(t,i){if(!t)throw new br(i)}new Array(6);function wr(){return[1,0,0,1,0,0]}function gr(t,i){var n=i[0],e=i[1];return i[0]=t[0]*n+t[2]*e+t[4],i[1]=t[1]*n+t[3]*e+t[5],i}function Mr(t,i,n,e,r,s,o,u){var h=Math.sin(s),s=Math.cos(s);return t[0]=e*s,t[1]=r*h,t[2]=-e*h,t[3]=r*s,t[4]=o*e*s-u*e*h+i,t[5]=o*r*h+u*r*s+n,t}function kr(t,i){var n=(u=i)[0]*u[3]-u[1]*u[2];mr(0!=n,32);var e=i[0],r=i[1],s=i[2],o=i[3],u=i[4],i=i[5];return t[0]=o/n,t[1]=-r/n,t[2]=-s/n,t[3]=e/n,t[4]=(s*i-o*u)/n,t[5]=-(e*i-r*u)/n,t}var Er={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Or={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Rr(t,i,n){i=i<t[0]?t[0]-i:t[2]<i?i-t[2]:0,t=n<t[1]?t[1]-n:t[3]<n?n-t[3]:0;return i*i+t*t}function Tr(t,i){return Sr(t,i[0],i[1])}function Sr(t,i,n){return t[0]<=i&&i<=t[2]&&t[1]<=n&&n<=t[3]}function jr(t,i){var n=t[0],e=t[1],r=t[2],s=t[3],o=i[0],t=i[1],i=Or.UNKNOWN;return o<n?i|=Or.LEFT:r<o&&(i|=Or.RIGHT),t<e?i|=Or.BELOW:s<t&&(i|=Or.ABOVE),i=i===Or.UNKNOWN?Or.INTERSECTING:i}function Ar(){return[1/0,1/0,-1/0,-1/0]}function xr(t,i,n,e,r){return r?(r[0]=t,r[1]=i,r[2]=n,r[3]=e,r):[t,i,n,e]}function Cr(t){return xr(1/0,1/0,-1/0,-1/0,t)}function Lr(t,i){return t[0]==i[0]&&t[2]==i[2]&&t[1]==i[1]&&t[3]==i[3]}function _r(t,i,n,e,r){for(;n<e;n+=r)s=t,o=i[n],u=i[n+1],s[0]=Math.min(s[0],o),s[1]=Math.min(s[1],u),s[2]=Math.max(s[2],o),s[3]=Math.max(s[3],u);var s,o,u;return t}function Ir(t){return[t[0],t[1]]}function Pr(t){return[t[2],t[1]]}function Br(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Fr(t,i,n,e,r){var s=i*e[0]/2,o=i*e[1]/2,u=Math.cos(n),h=Math.sin(n),a=s*u,c=s*h,i=o*u,e=o*h,n=t[0],s=t[1],u=n-a+e,o=n-a-e,h=n+a-e,t=n+a+e,n=s-c-i,a=s-c+i,e=s+c+i,i=s+c-i;return xr(Math.min(u,o,h,t),Math.min(n,a,e,i),Math.max(u,o,h,t),Math.max(n,a,e,i),r)}function Nr(t){return t[3]-t[1]}function Dr(t,i,n){n=n||Ar();return Gr(t,i)?(t[0]>i[0]?n[0]=t[0]:n[0]=i[0],t[1]>i[1]?n[1]=t[1]:n[1]=i[1],t[2]<i[2]?n[2]=t[2]:n[2]=i[2],t[3]<i[3]?n[3]=t[3]:n[3]=i[3]):Cr(n),n}function Hr(t){return[t[0],t[3]]}function Ur(t){return[t[2],t[3]]}function Vr(t){return t[2]-t[0]}function Gr(t,i){return t[0]<=i[2]&&t[2]>=i[0]&&t[1]<=i[3]&&t[3]>=i[1]}function zr(t){return t[2]<t[0]||t[3]<t[1]}function qr(t,i,n,e){var r=[];if(1<e)for(var s=t[2]-t[0],o=t[3]-t[1],u=0;u<e;++u)r.push(t[0]+s*u/e,t[1],t[2],t[1]+o*u/e,t[2]-s*u/e,t[3],t[0],t[3]-o*u/e);else r=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];i(r,r,2);for(var h,a=[],c=[],f=0,l=r.length;f<l;f+=2)a.push(r[f]),c.push(r[f+1]);return h=a,i=c,n=n,xr(Math.min.apply(null,h),Math.min.apply(null,i),Math.max.apply(null,h),Math.max.apply(null,i),n)}function Zr(t,i,n){return Math.min(Math.max(t,i),n)}var Yr="cosh"in Math?Math.cosh:function(t){t=Math.exp(t);return(t+1/t)/2};"log2"in Math&&Math.log2;function Xr(t,i,n,e){t=n-t,i=e-i;return t*t+i*i}function Wr(t){return t*Math.PI/180}function Qr(t,i){t%=i;return t*i<0?t+i:t}function Kr(t,i){i=Math.pow(10,i);return Math.round(t*i)/i}function Jr(t,i){return Math.floor(Kr(t,i))}function $r(t,i){return Math.ceil(Kr(t,i))}var ts=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,is=/^([a-z]*)$|^hsla?\(.*\)$/i;function ns(t){return"string"==typeof t?t:function(t){var i=t[0];i!=(0|i)&&(i=i+.5|0);var n=t[1];n!=(0|n)&&(n=n+.5|0);var e=t[2];e!=(0|e)&&(e=e+.5|0);t=void 0===t[3]?1:Math.round(100*t[3])/100;return"rgba("+i+","+n+","+e+","+t+")"}(t)}function es(t){var i=document.createElement("div");if(i.style.color=t,""===i.style.color)return"";document.body.appendChild(i);t=getComputedStyle(i).color;return document.body.removeChild(i),t}var rs,ss,os=(rs={},ss=0,function(t){var i;if(rs.hasOwnProperty(t))i=rs[t];else{if(1024<=ss){var n,e=0;for(n in rs)0==(3&e++)&&(delete rs[n],--ss)}i=function(t){var i,n,e,r;is.exec(t)&&(t=es(t));{var s,o;ts.exec(t)?(s=t.length-1,r=s<=4?1:2,o=4==s||8==s,i=parseInt(t.substr(1+0*r,r),16),n=parseInt(t.substr(+r+1,r),16),e=parseInt(t.substr(1+2*r,r),16),s=o?parseInt(t.substr(1+3*r,r),16):255,1==r&&(i=(i<<4)+i,n=(n<<4)+n,e=(e<<4)+e,o&&(s=(s<<4)+s)),s=[i,n,e,s/255]):0==t.indexOf("rgba(")?hs(s=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((s=t.slice(4,-1).split(",").map(Number)).push(1),hs(s)):mr(!1,14)}return s}(t),rs[t]=i,++ss}return i});function us(t){return Array.isArray(t)?t:os(t)}function hs(t){return t[0]=Zr(t[0]+.5|0,0,255),t[1]=Zr(t[1]+.5|0,0,255),t[2]=Zr(t[2]+.5|0,0,255),t[3]=Zr(t[3],0,1),t}function as(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}q=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}var i,n,e;return i=t,(n=[{key:"clear",value:function(){this.cache_={},this.cacheSize_=0}},{key:"canExpireCache",value:function(){return this.cacheSize_>this.maxCacheSize_}},{key:"expire",value:function(){if(this.canExpireCache()){var t,i=0;for(t in this.cache_){var n=this.cache_[t];0!=(3&i++)||n.hasListener()||(delete this.cache_[t],--this.cacheSize_)}}}},{key:"get",value:function(t,i,n){n=cs(t,i,n);return n in this.cache_?this.cache_[n]:null}},{key:"set",value:function(t,i,n,e){n=cs(t,i,n);this.cache_[n]=e,++this.cacheSize_}},{key:"setSize",value:function(t){this.maxCacheSize_=t,this.expire()}}])&&as(i.prototype,n),e&&as(i,e),t}();function cs(t,i,n){return i+":"+t+":"+(n?ns(n):"null")}var fs=new q;function ls(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var vs=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}var t,n,e;return t=i,(n=[{key:"preventDefault",value:function(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}])&&ls(t.prototype,n),e&&ls(t,e),i}(),ds="propertychange",ys="function"==typeof Object.assign?Object.assign:function(t,i){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),e=1,r=arguments.length;e<r;++e){var s=arguments[e];if(null!=s)for(var o in s)s.hasOwnProperty(o)&&(n[o]=s[o])}return n};function ps(t){for(var i in t)delete t[i]}"function"==typeof Object.values&&Object.values;function bs(t){for(var i in t)return;return!i}function ms(t){return(ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ws(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function gs(t,i){return(gs=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Ms(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ks(n);return t=e?(t=ks(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ms(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function ks(t){return(ks=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Es=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&gs(t,i)}(r,Qe);var t,i,n,e=Ms(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).eventTarget_=t,i.pendingRemovals_=null,i.dispatching_=null,i.listeners_=null,i}return t=r,(i=[{key:"addEventListener",value:function(t,i){var n;t&&i&&(-1===(t=(n=this.listeners_||(this.listeners_={}))[t]||(n[t]=[])).indexOf(i)&&t.push(i))}},{key:"dispatchEvent",value:function(t){var i="string"==typeof t,n=i?t:t.type,e=this.listeners_&&this.listeners_[n];if(e){var r=i?new vs(t):t;r.target||(r.target=this.eventTarget_||this);var s,i=this.dispatching_||(this.dispatching_={}),t=this.pendingRemovals_||(this.pendingRemovals_={});n in i||(i[n]=0,t[n]=0),++i[n];for(var o=0,u=e.length;o<u;++o)if(!1===(s="handleEvent"in e[o]?e[o].handleEvent(r):e[o].call(this,r))||r.propagationStopped){s=!1;break}if(0==--i[n]){var h=t[n];for(delete t[n];h--;)this.removeEventListener(n,nr);delete i[n]}return s}}},{key:"disposeInternal",value:function(){this.listeners_&&ps(this.listeners_)}},{key:"getListeners",value:function(t){return this.listeners_&&this.listeners_[t]||void 0}},{key:"hasListener",value:function(t){return!!this.listeners_&&(t?t in this.listeners_:0<Object.keys(this.listeners_).length)}},{key:"removeEventListener",value:function(t,i){var n=this.listeners_&&this.listeners_[t];!n||-1!==(i=n.indexOf(i))&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=nr,++this.pendingRemovals_[t]):(n.splice(i,1),0===n.length&&delete this.listeners_[t]))}}])&&ws(t.prototype,i),n&&ws(t,n),r}(),Os="change",Rs="error",Ts="load",Ss="resize";function js(t,i,n,e,r){var s;e&&e!==t&&(n=n.bind(e)),r&&(s=n,n=function(){t.removeEventListener(i,n),s.apply(this,arguments)});r={target:t,type:i,listener:n};return t.addEventListener(i,n),r}function As(t,i,n,e){return js(t,i,n,e,!0)}function xs(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),ps(t))}function Cs(t){return(Cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ls(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _s(t,i){return(_s=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Is(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ps(n);return t=e?(t=Ps(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Cs(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ps(t){return(Ps=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}gt=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&_s(t,i)}(r,Es);var t,i,n,e=Is(r);function r(){var t;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this)).on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return t=r,(i=[{key:"changed",value:function(){++this.revision_,this.dispatchEvent(Os)}},{key:"getRevision",value:function(){return this.revision_}},{key:"onInternal",value:function(t,i){if(Array.isArray(t)){for(var n=t.length,e=new Array(n),r=0;r<n;++r)e[r]=js(this,t[r],i);return e}return js(this,t,i)}},{key:"onceInternal",value:function(t,i){if(Array.isArray(t))for(var n=t.length,e=new Array(n),r=0;r<n;++r)e[r]=As(this,t[r],i);else e=As(this,t,i);return i.ol_key=e}},{key:"unInternal",value:function(t,i){var n=i.ol_key;if(n)!function(t){if(Array.isArray(t))for(var i=0,n=t.length;i<n;++i)xs(t[i]);else xs(t)}(n);else if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)this.removeEventListener(t[e],i);else this.removeEventListener(t,i)}}])&&Ls(t.prototype,i),n&&Ls(t,n),r}();gt.prototype.on,gt.prototype.once,gt.prototype.un;var Bs=gt;function Fs(t){return(Fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ns(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ds(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Hs(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Us(t,i)}function Us(t,i){return(Us=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Vs(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=zs(n);return t=e?(t=zs(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Fs(t)&&"function"!=typeof t?Gs(i):t}}function Gs(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zs(t){return(zs=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qs=function(){Hs(r,vs);var e=Vs(r);function r(t,i,n){return Ds(this,r),(t=e.call(this,t)).key=i,t.oldValue=n,t}return r}(),Zs=function(){Hs(r,Bs);var t,i,n,e=Vs(r);function r(t){var i;return Ds(this,r),(i=e.call(this)).on,i.once,i.un,sr(Gs(i)),i.values_=null,void 0!==t&&i.setProperties(t),i}return t=r,(i=[{key:"get",value:function(t){var i;return i=this.values_&&this.values_.hasOwnProperty(t)?this.values_[t]:i}},{key:"getKeys",value:function(){return this.values_&&Object.keys(this.values_)||[]}},{key:"getProperties",value:function(){return this.values_&&ys({},this.values_)||{}}},{key:"hasProperties",value:function(){return!!this.values_}},{key:"notify",value:function(t,i){var n="change:".concat(t);this.hasListener(n)&&this.dispatchEvent(new qs(n,t,i)),this.hasListener(n=ds)&&this.dispatchEvent(new qs(n,t,i))}},{key:"addChangeListener",value:function(t,i){this.addEventListener("change:".concat(t),i)}},{key:"removeChangeListener",value:function(t,i){this.removeEventListener("change:".concat(t),i)}},{key:"set",value:function(t,i,n){var e=this.values_||(this.values_={});n?e[t]=i:(n=e[t])!==(e[t]=i)&&this.notify(t,n)}},{key:"setProperties",value:function(t,i){for(var n in t)this.set(n,t[n],i)}},{key:"applyProperties",value:function(t){t.values_&&ys(this.values_||(this.values_={}),t.values_)}},{key:"unset",value:function(t,i){var n;this.values_&&t in this.values_&&(n=this.values_[t],delete this.values_[t],bs(this.values_)&&(this.values_=null),i||this.notify(t,n))}}])&&Ns(t.prototype,i),n&&Ns(t,n),r}(),Ys={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Xs(t){return(Xs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ws(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Qs(t,i,n){return(Qs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=$s(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Ks(t,i){return(Ks=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Js(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=$s(n);return t=e?(t=$s(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Xs(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function $s(t){return($s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var to=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ks(t,i)}(r,Zs);var t,i,n,e=Js(r);function r(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).on,i.once,i.un,i.background_=t.background;var n=ys({},t);return"object"===Xs(t.properties)&&(delete n.properties,ys(n,t.properties)),n[Ys.OPACITY]=void 0!==t.opacity?t.opacity:1,mr("number"==typeof n[Ys.OPACITY],64),n[Ys.VISIBLE]=void 0===t.visible||t.visible,n[Ys.Z_INDEX]=t.zIndex,n[Ys.MAX_RESOLUTION]=void 0!==t.maxResolution?t.maxResolution:1/0,n[Ys.MIN_RESOLUTION]=void 0!==t.minResolution?t.minResolution:0,n[Ys.MIN_ZOOM]=void 0!==t.minZoom?t.minZoom:-1/0,n[Ys.MAX_ZOOM]=void 0!==t.maxZoom?t.maxZoom:1/0,i.className_=void 0!==n.className?n.className:"ol-layer",delete n.className,i.setProperties(n),i.state_=null,i}return t=r,(i=[{key:"getBackground",value:function(){return this.background_}},{key:"getClassName",value:function(){return this.className_}},{key:"getLayerState",value:function(t){var i=this.state_||{layer:this,managed:void 0===t||t},t=this.getZIndex();return i.opacity=Zr(Math.round(100*this.getOpacity())/100,0,1),i.visible=this.getVisible(),i.extent=this.getExtent(),i.zIndex=void 0!==t||i.managed?t:1/0,i.maxResolution=this.getMaxResolution(),i.minResolution=Math.max(this.getMinResolution(),0),i.minZoom=this.getMinZoom(),i.maxZoom=this.getMaxZoom(),this.state_=i}},{key:"getLayersArray",value:er},{key:"getLayerStatesArray",value:function(t){return er()}},{key:"getExtent",value:function(){return this.get(Ys.EXTENT)}},{key:"getMaxResolution",value:function(){return this.get(Ys.MAX_RESOLUTION)}},{key:"getMinResolution",value:function(){return this.get(Ys.MIN_RESOLUTION)}},{key:"getMinZoom",value:function(){return this.get(Ys.MIN_ZOOM)}},{key:"getMaxZoom",value:function(){return this.get(Ys.MAX_ZOOM)}},{key:"getOpacity",value:function(){return this.get(Ys.OPACITY)}},{key:"getSourceState",value:function(){return er()}},{key:"getVisible",value:function(){return this.get(Ys.VISIBLE)}},{key:"getZIndex",value:function(){return this.get(Ys.Z_INDEX)}},{key:"setBackground",value:function(t){this.background_=t,this.changed()}},{key:"setExtent",value:function(t){this.set(Ys.EXTENT,t)}},{key:"setMaxResolution",value:function(t){this.set(Ys.MAX_RESOLUTION,t)}},{key:"setMinResolution",value:function(t){this.set(Ys.MIN_RESOLUTION,t)}},{key:"setMaxZoom",value:function(t){this.set(Ys.MAX_ZOOM,t)}},{key:"setMinZoom",value:function(t){this.set(Ys.MIN_ZOOM,t)}},{key:"setOpacity",value:function(t){mr("number"==typeof t,64),this.set(Ys.OPACITY,t)}},{key:"setVisible",value:function(t){this.set(Ys.VISIBLE,t)}},{key:"setZIndex",value:function(t){this.set(Ys.Z_INDEX,t)}},{key:"disposeInternal",value:function(){this.state_&&(this.state_.layer=null,this.state_=null),Qs($s(r.prototype),"disposeInternal",this).call(this)}}])&&Ws(t.prototype,i),n&&Ws(t,n),r}(),io="prerender",no="postrender",eo="precompose",ro="rendercomplete",so={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};function oo(t){return(oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uo(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ho(t,i,n){return(ho="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=fo(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function ao(t,i){return(ao=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function co(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=fo(n);return t=e?(t=fo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==oo(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function fo(t){return(fo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function lo(t,i){if(t.visible){var n=i.resolution;if(!(n<t.minResolution||n>=t.maxResolution)){i=i.zoom;return i>t.minZoom&&i<=t.maxZoom}}}var vo=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ao(t,i)}(r,to);var t,i,n,e=co(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=ys({},t);delete i.source,(i=e.call(this,i)).on,i.once,i.un,i.mapPrecomposeKey_=null,i.mapRenderKey_=null,i.sourceChangeKey_=null,i.renderer_=null,i.rendered=!1,t.render&&(i.render=t.render),t.map&&i.setMap(t.map),i.addChangeListener(Ys.SOURCE,i.handleSourcePropertyChange_);t=t.source||null;return i.setSource(t),i}return t=r,(i=[{key:"getLayersArray",value:function(t){t=t||[];return t.push(this),t}},{key:"getLayerStatesArray",value:function(t){t=t||[];return t.push(this.getLayerState()),t}},{key:"getSource",value:function(){return this.get(Ys.SOURCE)||null}},{key:"getRenderSource",value:function(){return this.getSource()}},{key:"getSourceState",value:function(){var t=this.getSource();return t?t.getState():so.UNDEFINED}},{key:"handleSourceChange_",value:function(){this.changed()}},{key:"handleSourcePropertyChange_",value:function(){this.sourceChangeKey_&&(xs(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=js(t,Os,this.handleSourceChange_,this)),this.changed()}},{key:"getFeatures",value:function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(t){return t([])})}},{key:"getData",value:function(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}},{key:"render",value:function(t,i){var n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,i)}},{key:"unrender",value:function(){this.rendered=!1}},{key:"setMapInternal",value:function(t){t||this.unrender(),this.set(Ys.MAP,t)}},{key:"getMapInternal",value:function(){return this.get(Ys.MAP)}},{key:"setMap",value:function(t){this.mapPrecomposeKey_&&(xs(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(xs(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=js(t,eo,function(t){var t=t.frameState.layerStatesArray,i=this.getLayerState(!1);mr(!t.some(function(t){return t.layer===i.layer}),67),t.push(i)},this),this.mapRenderKey_=js(this,Os,t.render,t),this.changed())}},{key:"setSource",value:function(t){this.set(Ys.SOURCE,t)}},{key:"getRenderer",value:function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}},{key:"hasRenderer",value:function(){return!!this.renderer_}},{key:"createRenderer",value:function(){return null}},{key:"disposeInternal",value:function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),ho(fo(r.prototype),"disposeInternal",this).call(this)}}])&&uo(t.prototype,i),n&&uo(t,n),r}();function yo(t,i){for(var n=!0,e=t.length-1;0<=e;--e)if(t[e]!=i[e]){n=!1;break}return n}function po(t,i,n){var e=i.getExtent(),r=0;return i.canWrapX()&&(t[0]<e[0]||t[0]>e[2])&&(n=n||Vr(e),r=Math.floor((t[0]-e[0])/n)),r}function bo(t){return(bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mo(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function wo(t,i){return(wo=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function go(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Mo(n);return t=e?(t=Mo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==bo(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Mo(t){return(Mo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ko(t,i){fs.expire()}var Eo=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&wo(t,i)}(r,Qe);var t,i,n,e=go(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).map_=t,i}return t=r,(i=[{key:"dispatchRenderEvent",value:function(t,i){er()}},{key:"calculateMatrices2D",value:function(t){var i=t.viewState,n=t.coordinateToPixelTransform,e=t.pixelToCoordinateTransform;Mr(n,t.size[0]/2,t.size[1]/2,1/i.resolution,-1/i.resolution,-i.rotation,-i.center[0],-i.center[1]),kr(e,n)}},{key:"forEachFeatureAtCoordinate",value:function(t,i,n,e,r,s,o,u){var h,a=i.viewState;function c(t,i,n,e){return r.call(s,i,t?n:null,e)}var f,l,v,d=a.projection,y=(f=t.slice(),(l=d).canWrapX()&&(v=Vr(l.getExtent()),(l=po(f,l,v))&&(f[0]-=l*v)),f),p=[[0,0]];d.canWrapX()&&e&&(d=Vr(d.getExtent()),p.push([-d,0],[d,0]));for(var b=i.layerStatesArray,m=b.length,w=[],g=[],M=0;M<p.length;M++)for(var k=m-1;0<=k;--k){var E=b[k],O=E.layer;if(O.hasRenderer()&&lo(E,a)&&o.call(u,O)){var R=O.getRenderer(),O=O.getSource();if(R&&O&&(O=O.getWrapX()?y:t,E=c.bind(null,E.managed),g[0]=O[0]+p[M][0],g[1]=O[1]+p[M][1],h=R.forEachFeatureAtCoordinate(g,i,n,E,w)),h)return h}}if(0!==w.length){var T=1/w.length;return w.forEach(function(t,i){return t.distanceSq+=i*T}),w.sort(function(t,i){return t.distanceSq-i.distanceSq}),w.some(function(t){return h=t.callback(t.feature,t.layer,t.geometry)}),h}}},{key:"forEachLayerAtPixel",value:function(t,i,n,e,r){return er()}},{key:"hasFeatureAtCoordinate",value:function(t,i,n,e,r,s){return void 0!==this.forEachFeatureAtCoordinate(t,i,n,e,ir,this,r,s)}},{key:"getMap",value:function(){return this.map_}},{key:"renderFrame",value:function(t){er()}},{key:"scheduleExpireIconCache",value:function(t){fs.canExpireCache()&&t.postRenderFunctions.push(ko)}}])&&mo(t.prototype,i),n&&mo(t,n),r}();function Oo(t){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ro(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function To(t,i,n){return(To="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Ao(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function So(t,i){return(So=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function jo(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ao(n);return t=e?(t=Ao(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Oo(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ao(t){return(Ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var xo=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&So(t,i)}(r,Eo);var t,i,n,e=jo(r);function r(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this,t)).children_=[],t.renderedVisible_=!0,t}return t=r,(i=[{key:"disposeInternal",value:function(){To(Ao(r.prototype),"disposeInternal",this).call(this)}},{key:"renderFrame",value:function(t){this.calculateMatrices2D(t);for(var i=t.layerStatesArray.sort(function(t,i){return t.zIndex-i.zIndex}),n=t.viewState,e=[],r=null,s=this.children_.length=0,o=i.length;s<o;++s){var u=i[s];t.layerIndex=s;var h=u.layer,a=h.getSourceState();!lo(u,n)||a!=so.READY&&a!=so.UNDEFINED?h.unrender():(a=h.render(t,r))&&(a!==r&&(this.children_.push(a),r=a),"getDeclutter"in h&&e.push(h))}for(var c=e.length-1;0<=c;--c)e[c].renderDeclutter(t);this.scheduleExpireIconCache(t)}}])&&Ro(t.prototype,i),n&&Ro(t,n),r}(),Co="add",Lo="remove";function _o(t){return(_o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Io(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Po(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Bo(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Fo(t,i)}function Fo(t,i){return(Fo=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function No(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Do(n);return t=e?(t=Do(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==_o(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Do(t){return(Do=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ho="length",Uo=function(){Bo(r,vs);var e=No(r);function r(t,i,n){return Po(this,r),(t=e.call(this,t)).element=i,t.index=n,t}return r}(),Vo=function(){Bo(o,Zs);var t,i,n,s=No(o);function o(t,i){var n;if(Po(this,o),(n=s.call(this)).on,n.once,n.un,n.unique_=!!(i||{}).unique,n.array_=t||[],n.unique_)for(var e=0,r=n.array_.length;e<r;++e)n.assertUnique_(n.array_[e],e);return n.updateLength_(),n}return t=o,(i=[{key:"clear",value:function(){for(;0<this.getLength();)this.pop()}},{key:"extend",value:function(t){for(var i=0,n=t.length;i<n;++i)this.push(t[i]);return this}},{key:"forEach",value:function(t){for(var i=this.array_,n=0,e=i.length;n<e;++n)t(i[n],n,i)}},{key:"getArray",value:function(){return this.array_}},{key:"item",value:function(t){return this.array_[t]}},{key:"getLength",value:function(){return this.get(Ho)}},{key:"insertAt",value:function(t,i){this.unique_&&this.assertUnique_(i),this.array_.splice(t,0,i),this.updateLength_(),this.dispatchEvent(new Uo(Co,i,t))}},{key:"pop",value:function(){return this.removeAt(this.getLength()-1)}},{key:"push",value:function(t){this.unique_&&this.assertUnique_(t);var i=this.getLength();return this.insertAt(i,t),this.getLength()}},{key:"remove",value:function(t){for(var i=this.array_,n=0,e=i.length;n<e;++n)if(i[n]===t)return this.removeAt(n)}},{key:"removeAt",value:function(t){var i=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Uo(Lo,i,t)),i}},{key:"setAt",value:function(t,i){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(i,t);var e=this.array_[t];this.array_[t]=i,this.dispatchEvent(new Uo(Lo,e,t)),this.dispatchEvent(new Uo(Co,i,t))}else{for(var r=n;r<t;++r)this.insertAt(r,void 0);this.insertAt(t,i)}}},{key:"updateLength_",value:function(){this.set(Ho,this.array_.length)}},{key:"assertUnique_",value:function(t,i){for(var n=0,e=this.array_.length;n<e;++n)if(this.array_[n]===t&&n!==i)throw new br(58)}}])&&Io(t.prototype,i),n&&Io(t,n),o}();function Go(t){return(Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zo(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function qo(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Zo(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Yo(t,i)}function Yo(t,i){return(Yo=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Xo(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Wo(n);return t=e?(t=Wo(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Go(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Wo(t){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Qo=function(){Zo(e,vs);var n=Xo(e);function e(t,i){return qo(this,e),(t=n.call(this,t)).layer=i,t}return e}(),Ko={LAYERS:"layers"},Jo=function(){Zo(r,to);var t,i,n,e=Xo(r);function r(t){qo(this,r);var i=t||{},t=ys({},i);delete t.layers;i=i.layers;return(t=e.call(this,t)).on,t.once,t.un,t.layersListenerKeys_=[],t.listenerKeys_={},t.addChangeListener(Ko.LAYERS,t.handleLayersChanged_),i?Array.isArray(i)?i=new Vo(i.slice(),{unique:!0}):mr("function"==typeof i.getArray,43):i=new Vo(void 0,{unique:!0}),t.setLayers(i),t}return t=r,(i=[{key:"handleLayerChange_",value:function(){this.changed()}},{key:"handleLayersChanged_",value:function(){this.layersListenerKeys_.forEach(xs),this.layersListenerKeys_.length=0;var t,i=this.getLayers();for(t in this.layersListenerKeys_.push(js(i,Co,this.handleLayersAdd_,this),js(i,Lo,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[t].forEach(xs);ps(this.listenerKeys_);for(var n=i.getArray(),e=0,r=n.length;e<r;e++){var s=n[e];this.registerLayerListeners_(s),this.dispatchEvent(new Qo("addlayer",s))}this.changed()}},{key:"registerLayerListeners_",value:function(t){var i=[js(t,ds,this.handleLayerChange_,this),js(t,Os,this.handleLayerChange_,this)];t instanceof r&&i.push(js(t,"addlayer",this.handleLayerGroupAdd_,this),js(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[sr(t)]=i}},{key:"handleLayerGroupAdd_",value:function(t){this.dispatchEvent(new Qo("addlayer",t.layer))}},{key:"handleLayerGroupRemove_",value:function(t){this.dispatchEvent(new Qo("removelayer",t.layer))}},{key:"handleLayersAdd_",value:function(t){t=t.element;this.registerLayerListeners_(t),this.dispatchEvent(new Qo("addlayer",t)),this.changed()}},{key:"handleLayersRemove_",value:function(t){var i=t.element,t=sr(i);this.listenerKeys_[t].forEach(xs),delete this.listenerKeys_[t],this.dispatchEvent(new Qo("removelayer",i)),this.changed()}},{key:"getLayers",value:function(){return this.get(Ko.LAYERS)}},{key:"setLayers",value:function(t){var i=this.getLayers();if(i)for(var n=i.getArray(),e=0,r=n.length;e<r;++e)this.dispatchEvent(new Qo("removelayer",n[e]));this.set(Ko.LAYERS,t)}},{key:"getLayersArray",value:function(t){var i=void 0!==t?t:[];return this.getLayers().forEach(function(t){t.getLayersArray(i)}),i}},{key:"getLayerStatesArray",value:function(t){var i=void 0!==t?t:[],n=i.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(i)});var e=this.getLayerState(),r=e.zIndex;t||void 0!==e.zIndex||(r=0);for(var s=n,o=i.length;s<o;s++){var u=i[s];u.opacity*=e.opacity,u.visible=u.visible&&e.visible,u.maxResolution=Math.min(u.maxResolution,e.maxResolution),u.minResolution=Math.max(u.minResolution,e.minResolution),u.minZoom=Math.max(u.minZoom,e.minZoom),u.maxZoom=Math.min(u.maxZoom,e.maxZoom),void 0!==e.extent&&(void 0!==u.extent?u.extent=Dr(u.extent,e.extent):u.extent=e.extent),void 0===u.zIndex&&(u.zIndex=r)}return i}},{key:"getSourceState",value:function(){return so.READY}}])&&zo(t.prototype,i),n&&zo(t,n),r}();function $o(t){return($o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tu(t,i){return(tu=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function iu(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=nu(n);return t=e?(t=nu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==$o(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function nu(t){return(nu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var eu=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&tu(t,i)}(r,vs);var e=iu(r);function r(t,i,n){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this,t)).map=i,t.frameState=void 0!==n?n:null,t}return r}(),ru="postrender",su="movestart",ou="moveend",uu={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};function hu(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var au=function(){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),this.priorityFunction_=t,this.keyFunction_=i,this.elements_=[],this.priorities_=[],this.queuedElements_={}}var t,i,e;return t=n,(i=[{key:"clear",value:function(){this.elements_.length=0,this.priorities_.length=0,ps(this.queuedElements_)}},{key:"dequeue",value:function(){var t=this.elements_,i=this.priorities_,n=t[0];1==t.length?(t.length=0,i.length=0):(t[0]=t.pop(),i[0]=i.pop(),this.siftUp_(0));i=this.keyFunction_(n);return delete this.queuedElements_[i],n}},{key:"enqueue",value:function(t){mr(!(this.keyFunction_(t)in this.queuedElements_),31);var i=this.priorityFunction_(t);return i!=1/0&&(this.elements_.push(t),this.priorities_.push(i),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}},{key:"getCount",value:function(){return this.elements_.length}},{key:"getLeftChildIndex_",value:function(t){return 2*t+1}},{key:"getRightChildIndex_",value:function(t){return 2*t+2}},{key:"getParentIndex_",value:function(t){return t-1>>1}},{key:"heapify_",value:function(){for(var t=(this.elements_.length>>1)-1;0<=t;t--)this.siftUp_(t)}},{key:"isEmpty",value:function(){return 0===this.elements_.length}},{key:"isKeyQueued",value:function(t){return t in this.queuedElements_}},{key:"isQueued",value:function(t){return this.isKeyQueued(this.keyFunction_(t))}},{key:"siftUp_",value:function(t){for(var i=this.elements_,n=this.priorities_,e=i.length,r=i[t],s=n[t],o=t;t<e>>1;){var u=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<e&&n[h]<n[u]?h:u;i[t]=i[u],n[t]=n[u],t=u}i[t]=r,n[t]=s,this.siftDown_(o,t)}},{key:"siftDown_",value:function(t,i){for(var n=this.elements_,e=this.priorities_,r=n[i],s=e[i];t<i;){var o=this.getParentIndex_(i);if(!(e[o]>s))break;n[i]=n[o],e[i]=e[o],i=o}n[i]=r,e[i]=s}},{key:"reprioritize",value:function(){for(var t,i,n=this.priorityFunction_,e=this.elements_,r=this.priorities_,s=0,o=e.length,u=0;u<o;++u)(i=n(t=e[u]))==1/0?delete this.queuedElements_[this.keyFunction_(t)]:(r[s]=i,e[s++]=t);e.length=s,r.length=s,this.heapify_()}}])&&hu(t.prototype,i),e&&hu(t,e),n}(),cu=0,fu=1,lu=2,vu=3,du=4;function yu(t){return(yu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pu(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function bu(t,i,n){return(bu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Mu(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function mu(t,i){return(mu=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function wu(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Mu(n);return t=e?(t=Mu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==yu(t)&&"function"!=typeof t?gu(i):t}}function gu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mu(t){return(Mu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ku=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&mu(t,i)}(r,au);var t,i,n,e=wu(r);function r(i,t){var n;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this,function(t){return i.apply(null,t)},function(t){return t[0].getKey()})).boundHandleTileChange_=n.handleTileChange.bind(gu(n)),n.tileChangeCallback_=t,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return t=r,(i=[{key:"enqueue",value:function(t){var i=bu(Mu(r.prototype),"enqueue",this).call(this,t);return i&&t[0].addEventListener(Os,this.boundHandleTileChange_),i}},{key:"getTilesLoading",value:function(){return this.tilesLoading_}},{key:"handleTileChange",value:function(t){var i=t.target,t=i.getState();t!==lu&&t!==vu&&t!==du||(i.removeEventListener(Os,this.boundHandleTileChange_),(i=i.getKey())in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[i],--this.tilesLoading_),this.tileChangeCallback_())}},{key:"loadMoreTiles",value:function(t,i){for(var n,e,r=0;this.tilesLoading_<t&&r<i&&0<this.getCount();)e=(n=this.dequeue()[0]).getKey(),n.getState()!==cu||e in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[e]=!0,++this.tilesLoading_,++r,n.load())}}])&&pu(t.prototype,i),n&&pu(t,n),r}();jt={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};var Eu={};Eu[jt.RADIANS]=6370997/(2*Math.PI),Eu[jt.DEGREES]=2*Math.PI*6370997/360,Eu[jt.FEET]=.3048,Eu[jt.METERS]=1,Eu[jt.USFEET]=1200/3937;var Ou=jt,Ru=0,Tu=1,Su={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},ju=42,Au=256;function xu(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Cu=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}var t,n,e;return t=i,(n=[{key:"canWrapX",value:function(){return this.canWrapX_}},{key:"getCode",value:function(){return this.code_}},{key:"getExtent",value:function(){return this.extent_}},{key:"getUnits",value:function(){return this.units_}},{key:"getMetersPerUnit",value:function(){return this.metersPerUnit_||Eu[this.units_]}},{key:"getWorldExtent",value:function(){return this.worldExtent_}},{key:"getAxisOrientation",value:function(){return this.axisOrientation_}},{key:"isGlobal",value:function(){return this.global_}},{key:"setGlobal",value:function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}},{key:"getDefaultTileGrid",value:function(){return this.defaultTileGrid_}},{key:"setDefaultTileGrid",value:function(t){this.defaultTileGrid_=t}},{key:"setExtent",value:function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}},{key:"setWorldExtent",value:function(t){this.worldExtent_=t}},{key:"setGetPointResolution",value:function(t){this.getPointResolutionFunc_=t}},{key:"getPointResolutionFunc",value:function(){return this.getPointResolutionFunc_}}])&&xu(t.prototype,n),e&&xu(t,e),i}();function Lu(t){return(Lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _u(t,i){return(_u=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Iu(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Pu(n);return t=e?(t=Pu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Lu(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Pu(t){return(Pu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bu=6378137,Fu=Math.PI*Bu,Nu=[-Fu,-Fu,Fu,Fu],Du=[-180,-85,180,85],Hu=Bu*Math.log(Math.tan(Math.PI/2)),A=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&_u(t,i)}(n,Cu);var i=Iu(n);function n(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n),i.call(this,{code:t,units:Ou.METERS,extent:Nu,global:!0,worldExtent:Du,getPointResolution:function(t,i){return t/Yr(i[1]/Bu)}})}return n}(),Uu=[new A("EPSG:3857"),new A("EPSG:102100"),new A("EPSG:102113"),new A("EPSG:900913"),new A("http://www.opengis.net/def/crs/EPSG/0/3857"),new A("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Vu(t,i,n){var e=t.length,r=1<n?n:2,s=i;void 0===s&&(s=2<r?t.slice():new Array(e));for(var o=0;o<e;o+=r){s[o]=Fu*t[o]/180;var u=Bu*Math.log(Math.tan(Math.PI*(+t[o+1]+90)/360));Hu<u?u=Hu:u<-Hu&&(u=-Hu),s[o+1]=u}return s}function Gu(t,i,n){var e=t.length,r=1<n?n:2,s=i;void 0===s&&(s=2<r?t.slice():new Array(e));for(var o=0;o<e;o+=r)s[o]=180*t[o]/Fu,s[o+1]=360*Math.atan(Math.exp(t[o+1]/Bu))/Math.PI-90;return s}function zu(t){return(zu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qu(t,i){return(qu=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Zu(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Yu(n);return t=e?(t=Yu(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==zu(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Yu(t){return(Yu=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Xu=[-180,-90,180,90],Wu=6378137*Math.PI/180,D=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&qu(t,i)}(e,Cu);var n=Zu(e);function e(t,i){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),n.call(this,{code:t,units:Ou.DEGREES,extent:Xu,axisOrientation:i,global:!0,metersPerUnit:Wu,worldExtent:Xu})}return e}(),Qu=[new D("CRS:84"),new D("EPSG:4326","neu"),new D("urn:ogc:def:crs:OGC:1.3:CRS84"),new D("urn:ogc:def:crs:OGC:2:84"),new D("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new D("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new D("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],Ku={};var Ju={};function $u(t,i,n){t=t.getCode(),i=i.getCode();t in Ju||(Ju[t]={}),Ju[t][i]=n}var th={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var ih=!0;function nh(t){ih=!(void 0===t||t)}function eh(t,i,n){var e;if(void 0!==i){for(var r=0,s=t.length;r<s;++r)i[r]=t[r];e=i}else e=t.slice();return e}function rh(t,i,n){if(void 0!==i&&t!==i){for(var e=0,r=t.length;e<r;++e)i[e]=t[e];t=i}return t}function sh(t){var i,n;i=t.getCode(),n=t,Ku[i]=n,$u(t,t,eh)}function oh(t){return"string"==typeof t?Ku[i=t]||Ku[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var i}function uh(t){t.forEach(sh),t.forEach(function(i){t.forEach(function(t){i!==t&&$u(i,t,eh)})})}function hh(t,i){return t?"string"==typeof t?oh(t):t:oh(i)}function ah(t,i){if(t===i)return!0;var n=t.getUnits()===i.getUnits();return(t.getCode()===i.getCode()||ch(t,i)===eh)&&n}function ch(t,i){var n,t=t.getCode(),i=i.getCode();return(i=i,n=(t=t)in Ju&&i in Ju[t]?Ju[t][i]:n)||rh}function fh(t,i){return ch(oh(t),oh(i))}function lh(t,i,n){return fh(i,n)(t,void 0,t.length)}function vh(t,i,n,e){return qr(t,fh(i,n),void 0,e)}var dh,yh,ph,bh=null;function mh(t,i){return bh?lh(t,i,bh):t}function wh(t,i){return bh?lh(t,bh,i):(ih&&!yo(t,[0,0])&&-180<=t[0]&&t[0]<=180&&-90<=t[1]&&t[1]<=90&&(ih=!1,console.warn("Call useGeographic() ol/proj once to work with [longitude, latitude] coordinates.")),t)}function gh(t,i){return bh?vh(t,bh,i):t}function Mh(a,c,f){return function(t,i,n,e,r){if(t){if(!i&&!c)return t;var s=c?0:n[0]*i,o=c?0:n[1]*i,u=r?r[0]:0,h=r?r[1]:0,n=a[0]+s/2+u,r=a[2]-s/2+u,s=a[1]+o/2+h,u=a[3]-o/2+h;r<n&&(r=n=(r+n)/2),u<s&&(u=s=(u+s)/2);o=Zr(t[0],n,r),h=Zr(t[1],s,u);return e&&f&&i&&(o+=-(i=30*i)*Math.log(1+Math.max(0,n-t[0])/i)+i*Math.log(1+Math.max(0,t[0]-r)/i),h+=-i*Math.log(1+Math.max(0,s-t[1])/i)+i*Math.log(1+Math.max(0,t[1]-u)/i)),[o,h]}}}function kh(t){return t}function Eh(h,a,c,f,l){return function(t,i,n,e){if(void 0!==t){o=f?(r=h,s=n,o=l,u=Vr(n=f)/s[0],s=Nr(n)/s[1],o?Math.min(r,Math.max(u,s)):Math.min(r,Math.min(u,s))):h;return(void 0===c||c)&&e?(r=t,u=o,s=a,e=Math.min(r,u),e*=Math.log(1+50*Math.max(0,r/u-1))/50+1,s&&(e=Math.max(e,s),e/=Math.log(1+50*Math.max(0,s/r-1))/50+1),Zr(e,s/2,2*u)):Zr(t,a,o)}var r,s,o,u}}function Oh(t){if(void 0!==t)return 0}function Rh(t){if(void 0!==t)return t}function Th(t){return Math.pow(t,3)}function Sh(t){return 1-Th(1-t)}function jh(t){return 3*t*t-2*t*t*t}function Ah(t){return(Ah="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xh(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ch(t,i){return(Ch=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Lh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=_h(n);return t=e?(t=_h(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Ah(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function _h(t){return(_h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}uh(Uu),uh(Qu),dh=Uu,yh=Vu,ph=Gu,Qu.forEach(function(i){dh.forEach(function(t){$u(i,t,yh),$u(t,i,ph)})});function Ih(t,i){setTimeout(function(){t(i)},0)}function Ph(t,i,n,e,r){var s=Math.cos(-r),o=Math.sin(-r),r=t[0]*s-t[1]*o,t=t[1]*s+t[0]*o;return[(r+=(i[0]/2-n[0])*e)*s-(t+=(n[1]-i[1]/2)*e)*(o=-o),t*s+r*o]}var Bh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Ch(t,i)}(r,Zs);var t,i,n,e=Lh(r);function r(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).on,i.once,i.un;t=ys({},t);return i.hints_=[0,0],i.animations_=[],i.updateAnimationKey_,i.projection_=hh(t.projection,"EPSG:3857"),i.viewportSize_=[100,100],i.targetCenter_=null,i.targetResolution_,i.targetRotation_,i.nextCenter_=null,i.nextResolution_,i.nextRotation_,i.cancelAnchor_=void 0,t.center&&(t.center=wh(t.center,i.projection_)),t.extent&&(t.extent=gh(t.extent,i.projection_)),t.projection&&nh(),i.applyOptions_(t),i}return t=r,(i=[{key:"applyOptions_",value:function(t){var i,n=ys({},t);for(i in Su)delete n[i];this.setProperties(n,!0);var e=function(t){var i=void 0!==t.minZoom?t.minZoom:0,n=void 0!==t.maxZoom?t.maxZoom:28,e=void 0!==t.zoomFactor?t.zoomFactor:2,r=void 0!==t.multiWorld&&t.multiWorld,s=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,o=void 0!==t.showFullExtent&&t.showFullExtent,u=hh(t.projection,"EPSG:3857"),h=u.getExtent(),a=t.constrainOnlyCenter,c=t.extent;r||c||!u.isGlobal()||(a=!1,c=h);var f=(h?Math.max(Vr(h),Nr(h)):360*Eu[Ou.DEGREES]/u.getMetersPerUnit())/Au/Math.pow(2,0),r=f/Math.pow(2,28);void 0!==(h=t.maxResolution)?i=0:h=f/Math.pow(e,i);void 0===(u=t.minResolution)&&(u=void 0!==t.maxZoom?void 0!==t.maxResolution?h/Math.pow(e,n):f/Math.pow(e,n):r);return n=i+Math.floor(Math.log(h/u)/Math.log(e)),u=h/Math.pow(e,n-i),{constraint:Eh(h,u,s,!a&&c,o),maxResolution:h,minResolution:u,minZoom:i,zoomFactor:e}}(t);this.maxResolution_=e.maxResolution,this.minResolution_=e.minResolution,this.zoomFactor_=e.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=e.minZoom;var r=function(t){if(void 0!==t.extent){var i=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint;return Mh(t.extent,t.constrainOnlyCenter,i)}i=hh(t.projection,"EPSG:3857");if(!0!==t.multiWorld&&i.isGlobal()){i=i.getExtent().slice();return i[0]=-1/0,i[2]=1/0,Mh(i,!1,!1)}return kh}(t),s=e.constraint,e=function(t){{if(void 0===t.enableRotation||t.enableRotation){t=t.constrainRotation;return void 0===t||!0===t?function(t){var n=t||Wr(5);return function(t,i){return i?t:void 0!==t?Math.abs(t)<=n?0:t:void 0}}():!1!==t&&"number"==typeof t?function(t){var n=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/n+.5)*n:void 0}}(t):Rh}return Oh}}(t);this.constraints_={center:r,resolution:s,rotation:e},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}},{key:"padding",get:function(){return this.padding_},set:function(t){var i=this.padding_;this.padding_=t;var n,e=this.getCenter();e&&(n=t||[0,0,0,0],i=i||[0,0,0,0],t=this.getResolution(),this.setCenterInternal([e[0]+t/2*(n[3]-i[3]+i[1]-n[1]),e[1]-t/2*(n[0]-i[0]+i[2]-n[2])]))}},{key:"getUpdatedOptions_",value:function(t){var i=this.getProperties();return void 0!==i.resolution?i.resolution=this.getResolution():i.zoom=this.getZoom(),i.center=this.getCenterInternal(),i.rotation=this.getRotation(),ys({},i,t)}},{key:"animate",value:function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var i=new Array(arguments.length),n=0;n<i.length;++n){var e=arguments[n];e.center&&((e=ys({},e)).center=wh(e.center,this.getProjection())),e.anchor&&((e=ys({},e)).anchor=wh(e.anchor,this.getProjection())),i[n]=e}this.animateInternal.apply(this,i)}},{key:"animateInternal",value:function(t){var i,n=arguments.length;1<n&&"function"==typeof arguments[n-1]&&(i=arguments[n-1],--n);for(var e=0;e<n&&!this.isDef();++e){var r=arguments[e];r.center&&this.setCenterInternal(r.center),void 0!==r.zoom?this.setZoom(r.zoom):r.resolution&&this.setResolution(r.resolution),void 0!==r.rotation&&this.setRotation(r.rotation)}if(e!==n){for(var s=Date.now(),o=this.targetCenter_.slice(),u=this.targetResolution_,h=this.targetRotation_,a=[];e<n;++e){var c=arguments[e],f={start:s,complete:!1,anchor:c.anchor,duration:void 0!==c.duration?c.duration:1e3,easing:c.easing||jh,callback:i};c.center&&(f.sourceCenter=o,f.targetCenter=c.center.slice(),o=f.targetCenter),void 0!==c.zoom?(f.sourceResolution=u,f.targetResolution=this.getResolutionForZoom(c.zoom),u=f.targetResolution):c.resolution&&(f.sourceResolution=u,f.targetResolution=c.resolution,u=f.targetResolution),void 0!==c.rotation&&(f.sourceRotation=h,c=Qr(c.rotation-h+Math.PI,2*Math.PI)-Math.PI,f.targetRotation=h+c,h=f.targetRotation),!function(t){if(t.sourceCenter&&t.targetCenter&&!yo(t.sourceCenter,t.targetCenter))return!1;return t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation}(f)?s+=f.duration:f.complete=!0,a.push(f)}this.animations_.push(a),this.setHint(Ru,1),this.updateAnimations_()}else i&&Ih(i,!0)}},{key:"getAnimating",value:function(){return 0<this.hints_[Ru]}},{key:"getInteracting",value:function(){return 0<this.hints_[Tu]}},{key:"cancelAnimations",value:function(){var t;this.setHint(Ru,-this.hints_[Ru]);for(var i=0,n=this.animations_.length;i<n;++i){var e=this.animations_[i];if(e[0].callback&&Ih(e[0].callback,!1),!t)for(var r=0,s=e.length;r<s;++r){var o=e[r];if(!o.complete){t=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}},{key:"updateAnimations_",value:function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var t=Date.now(),i=!1,n=this.animations_.length-1;0<=n;--n){for(var e,r=this.animations_[n],s=!0,o=0,u=r.length;o<u;++o){var h=r[o];if(!h.complete){var a=t-h.start,c=0<h.duration?a/h.duration:1;1<=c?(h.complete=!0,c=1):s=!1;var f,l,v,d=h.easing(c);if(h.sourceCenter&&(f=h.sourceCenter[0],l=h.sourceCenter[1],a=h.targetCenter[0],c=h.targetCenter[1],this.nextCenter_=h.targetCenter,this.targetCenter_=[f+d*(a-f),l+d*(c-l)]),h.sourceResolution&&h.targetResolution&&(v=1===d?h.targetResolution:h.sourceResolution+d*(h.targetResolution-h.sourceResolution),h.anchor&&(l=this.getViewportSize_(this.getRotation()),l=this.constraints_.resolution(v,0,l,!0),this.targetCenter_=this.calculateCenterZoom(l,h.anchor)),this.nextResolution_=h.targetResolution,this.targetResolution_=v,this.applyTargetState_(!0)),void 0!==h.sourceRotation&&void 0!==h.targetRotation&&(v=1===d?Qr(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+d*(h.targetRotation-h.sourceRotation),h.anchor&&(d=this.constraints_.rotation(v,!0),this.targetCenter_=this.calculateCenterRotate(d,h.anchor)),this.nextRotation_=h.targetRotation,this.targetRotation_=v),this.applyTargetState_(!0),i=!0,!h.complete)break}}s&&(this.animations_[n]=null,this.setHint(Ru,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN,(e=r[0].callback)&&Ih(e,!0))}this.animations_=this.animations_.filter(Boolean),i&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}}},{key:"calculateCenterRotate",value:function(t,i){var n,e,r,s=this.getCenterInternal();return void 0!==s&&(n=[s[0]-i[0],s[1]-i[1]],e=n,r=t-this.getRotation(),s=Math.cos(r),t=Math.sin(r),r=e[0]*s-e[1]*t,t=e[1]*s+e[0]*t,e[0]=r,e[1]=t,t=i,(i=n)[0]+=+t[0],i[1]+=+t[1]),n}},{key:"calculateCenterZoom",value:function(t,i){var n,e=this.getCenterInternal(),r=this.getResolution();return n=void 0!==e&&void 0!==r?[i[0]-t*(i[0]-e[0])/r,i[1]-t*(i[1]-e[1])/r]:n}},{key:"getViewportSize_",value:function(t){var i=this.viewportSize_;if(t){var n=i[0],e=i[1];return[Math.abs(n*Math.cos(t))+Math.abs(e*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(e*Math.cos(t))]}return i}},{key:"setViewportSize",value:function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}},{key:"getCenter",value:function(){var t=this.getCenterInternal();return t&&mh(t,this.getProjection())}},{key:"getCenterInternal",value:function(){return this.get(Su.CENTER)}},{key:"getConstraints",value:function(){return this.constraints_}},{key:"getConstrainResolution",value:function(){return this.get("constrainResolution")}},{key:"getHints",value:function(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}},{key:"calculateExtent",value:function(t){var i=this.calculateExtentInternal(t);return t=i,i=this.getProjection(),bh?vh(t,i,bh):t}},{key:"calculateExtentInternal",value:function(t){var i=t||this.getViewportSizeMinusPadding_(),n=this.getCenterInternal();mr(n,1);var e=this.getResolution();mr(void 0!==e,2);t=this.getRotation();return mr(void 0!==t,3),Fr(n,e,t,i)}},{key:"getMaxResolution",value:function(){return this.maxResolution_}},{key:"getMinResolution",value:function(){return this.minResolution_}},{key:"getMaxZoom",value:function(){return this.getZoomForResolution(this.minResolution_)}},{key:"setMaxZoom",value:function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}},{key:"getMinZoom",value:function(){return this.getZoomForResolution(this.maxResolution_)}},{key:"setMinZoom",value:function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}},{key:"setConstrainResolution",value:function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}},{key:"getProjection",value:function(){return this.projection_}},{key:"getResolution",value:function(){return this.get(Su.RESOLUTION)}},{key:"getResolutions",value:function(){return this.resolutions_}},{key:"getResolutionForExtent",value:function(t,i){return this.getResolutionForExtentInternal(gh(t,this.getProjection()),i)}},{key:"getResolutionForExtentInternal",value:function(t,i){var n=i||this.getViewportSizeMinusPadding_(),i=Vr(t)/n[0],n=Nr(t)/n[1];return Math.max(i,n)}},{key:"getResolutionForValueFunction",value:function(t){var i=t||2,n=this.getConstrainedResolution(this.maxResolution_),t=this.minResolution_,e=Math.log(n/t)/Math.log(i);return function(t){return n/Math.pow(i,t*e)}}},{key:"getRotation",value:function(){return this.get(Su.ROTATION)}},{key:"getValueForResolutionFunction",value:function(t){var i=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),t=this.minResolution_,e=Math.log(n/t)/i;return function(t){return Math.log(n/t)/i/e}}},{key:"getViewportSizeMinusPadding_",value:function(t){var i=this.getViewportSize_(t),t=this.padding_;return i=t?[i[0]-t[1]-t[3],i[1]-t[0]-t[2]]:i}},{key:"getState",value:function(){var t,i=this.getProjection(),n=this.getResolution(),e=this.getRotation(),r=this.getCenterInternal(),s=this.padding_;return s&&(t=this.getViewportSizeMinusPadding_(),r=Ph(r,this.getViewportSize_(),[t[0]/2+s[3],t[1]/2+s[0]],n,e)),{center:r.slice(0),projection:void 0!==i?i:null,resolution:n,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:e,zoom:this.getZoom()}}},{key:"getZoom",value:function(){var t,i=this.getResolution();return t=void 0!==i?this.getZoomForResolution(i):t}},{key:"getZoomForResolution",value:function(t){var i,n,e=this.minZoom_||0;return n=this.resolutions_?(n=Je(this.resolutions_,t,1),i=this.resolutions_[e=n],n==this.resolutions_.length-1?2:i/this.resolutions_[n+1]):(i=this.maxResolution_,this.zoomFactor_),e+Math.log(i/t)/Math.log(n)}},{key:"getResolutionForZoom",value:function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var i=Zr(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(n,Zr(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}},{key:"fit",value:function(t,i){this.fitInternal(t,i)}},{key:"rotatedExtentForGeometry",value:function(t){for(var i=this.getRotation(),n=Math.cos(i),e=Math.sin(-i),r=t.getFlatCoordinates(),s=t.getStride(),o=1/0,u=1/0,h=-1/0,a=-1/0,c=0,f=r.length;c<f;c+=s)var l=r[c]*n-r[c+1]*e,v=r[c]*e+r[c+1]*n,o=Math.min(o,l),u=Math.min(u,v),h=Math.max(h,l),a=Math.max(a,v);return[o,u,h,a]}},{key:"fitInternal",value:function(t,i){var n=i||{},e=(e=n.size)||this.getViewportSizeMinusPadding_(),r=void 0!==n.padding?n.padding:[0,0,0,0],s=void 0!==n.nearest&&n.nearest,i=void 0!==n.minResolution?n.minResolution:void 0!==n.maxZoom?this.getResolutionForZoom(n.maxZoom):0,t=this.rotatedExtentForGeometry(t),e=this.getResolutionForExtentInternal(t,[e[0]-r[1]-r[3],e[1]-r[0]-r[2]]),e=isNaN(e)?i:Math.max(e,i);e=this.getConstrainedResolution(e,s?0:1);i=this.getRotation(),s=Math.sin(i),i=Math.cos(i),t=Br(t);t[0]+=(r[1]-r[3])/2*e,t[1]+=(r[0]-r[2])/2*e;r=t[0]*i-t[1]*s,s=t[1]*i+t[0]*s,r=this.getConstrainedCenter([r,s],e),s=n.callback||nr;void 0!==n.duration?this.animateInternal({resolution:e,center:r,duration:n.duration,easing:n.easing},s):(this.targetResolution_=e,this.targetCenter_=r,this.applyTargetState_(!1,!0),Ih(s,!0))}},{key:"centerOn",value:function(t,i,n){this.centerOnInternal(wh(t,this.getProjection()),i,n)}},{key:"centerOnInternal",value:function(t,i,n){this.setCenterInternal(Ph(t,i,n,this.getResolution(),this.getRotation()))}},{key:"calculateCenterShift",value:function(t,i,n,e){var r,s=this.padding_;return s&&t&&(r=Ph(t,e,[(r=this.getViewportSizeMinusPadding_(-n))[0]/2+s[3],r[1]/2+s[0]],i,n),r=[t[0]-r[0],t[1]-r[1]]),r}},{key:"isDef",value:function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}},{key:"adjustCenter",value:function(t){var i=mh(this.targetCenter_,this.getProjection());this.setCenter([i[0]+t[0],i[1]+t[1]])}},{key:"adjustCenterInternal",value:function(t){var i=this.targetCenter_;this.setCenterInternal([i[0]+t[0],i[1]+t[1]])}},{key:"adjustResolution",value:function(t,i){i=i&&wh(i,this.getProjection());this.adjustResolutionInternal(t,i)}},{key:"adjustResolutionInternal",value:function(t,i){var n=this.getAnimating()||this.getInteracting(),e=this.getViewportSize_(this.getRotation()),n=this.constraints_.resolution(this.targetResolution_*t,0,e,n);i&&(this.targetCenter_=this.calculateCenterZoom(n,i)),this.targetResolution_*=t,this.applyTargetState_()}},{key:"adjustZoom",value:function(t,i){this.adjustResolution(Math.pow(this.zoomFactor_,-t),i)}},{key:"adjustRotation",value:function(t,i){i=i&&wh(i,this.getProjection()),this.adjustRotationInternal(t,i)}},{key:"adjustRotationInternal",value:function(t,i){var n=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,n);i&&(this.targetCenter_=this.calculateCenterRotate(n,i)),this.targetRotation_+=t,this.applyTargetState_()}},{key:"setCenter",value:function(t){this.setCenterInternal(t&&wh(t,this.getProjection()))}},{key:"setCenterInternal",value:function(t){this.targetCenter_=t,this.applyTargetState_()}},{key:"setHint",value:function(t,i){return this.hints_[t]+=i,this.changed(),this.hints_[t]}},{key:"setResolution",value:function(t){this.targetResolution_=t,this.applyTargetState_()}},{key:"setRotation",value:function(t){this.targetRotation_=t,this.applyTargetState_()}},{key:"setZoom",value:function(t){this.setResolution(this.getResolutionForZoom(t))}},{key:"applyTargetState_",value:function(t,i){var n=this.getAnimating()||this.getInteracting()||i,e=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(e),i=this.constraints_.resolution(this.targetResolution_,0,r,n),r=this.constraints_.center(this.targetCenter_,i,r,n,this.calculateCenterShift(this.targetCenter_,i,e,r));this.get(Su.ROTATION)!==e&&this.set(Su.ROTATION,e),this.get(Su.RESOLUTION)!==i&&(this.set(Su.RESOLUTION,i),this.set("zoom",this.getZoom(),!0)),r&&this.get(Su.CENTER)&&yo(this.get(Su.CENTER),r)||this.set(Su.CENTER,r),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}},{key:"resolveConstraints",value:function(t,i,n){var e=void 0!==t?t:200,r=i||0,t=this.constraints_.rotation(this.targetRotation_),i=this.getViewportSize_(t),r=this.constraints_.resolution(this.targetResolution_,r,i),i=this.constraints_.center(this.targetCenter_,r,i,!1,this.calculateCenterShift(this.targetCenter_,r,t,i));if(0===e&&!this.cancelAnchor_)return this.targetResolution_=r,this.targetRotation_=t,this.targetCenter_=i,void this.applyTargetState_();n=n||(0===e?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,this.getResolution()===r&&this.getRotation()===t&&this.getCenterInternal()&&yo(this.getCenterInternal(),i)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:t,center:i,resolution:r,duration:e,easing:Sh,anchor:n}))}},{key:"beginInteraction",value:function(){this.resolveConstraints(0),this.setHint(Tu,1)}},{key:"endInteraction",value:function(t,i,n){n=n&&wh(n,this.getProjection());this.endInteractionInternal(t,i,n)}},{key:"endInteractionInternal",value:function(t,i,n){this.setHint(Tu,-1),this.resolveConstraints(t,i,n)}},{key:"getConstrainedCenter",value:function(t,i){var n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,i||this.getResolution(),n)}},{key:"getConstrainedZoom",value:function(t,i){t=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(t,i))}},{key:"getConstrainedResolution",value:function(t,i){var n=i||0,i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,i)}}])&&xh(t.prototype,i),n&&xh(t,n),r}();function Fh(t,i){return Array.isArray(t)?t:(void 0===i?i=[t,t]:(i[0]=t,i[1]=t),i)}function Nh(t){return(Nh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dh(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Hh(t,i,n){return(Hh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=zh(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Uh(t,i){return(Uh=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Vh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=zh(n);return t=e?(t=zh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Nh(t)&&"function"!=typeof t?Gh(i):t}}function Gh(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zh(t){return(zh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qh(t){t instanceof vo?t.setMapInternal(null):t instanceof Jo&&t.getLayers().forEach(qh)}var Zh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Uh(t,i)}(u,Zs);var t,i,n,o=Vh(u);function u(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u),(i=o.call(this)).on,i.once,i.size_=t.size,void 0===i.size_&&(i.size_=[2e3,2e3]),i.un;var n,e,r,e=(e={},r=(n=t).layers&&"function"==typeof n.layers.getLayers?n.layers:new Jo({layers:n.layers}),e[uu.LAYERGROUP]=r,e[uu.TARGET]=n.target,e[uu.VIEW]=n.view instanceof Bh?n.view:new Bh,{values:e});i.renderComplete_,i.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,i.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:ur,i.postRenderTimeoutHandle_,i.animationDelayKey_,i.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(Gh(i)),i.coordinateToPixelTransform_=wr(),i.pixelToCoordinateTransform_=wr(),i.frameIndex_=0,i.frameState_=null,i.previousExtent_=null,i.viewPropertyListenerKey_=null,i.viewChangeListenerKey_=null,i.layerGroupPropertyListenerKeys_=null,i.moveTolerance_=t.moveTolerance,i.targetChangeHandlerKeys_=null,i.overlayIdIndex_={},i.renderer_=null,i.postRenderFunctions_=[],i.tileQueue_=new ku(i.getTilePriority.bind(Gh(i)),i.handleTileChange_.bind(Gh(i))),i.addChangeListener(uu.VIEW,i.handleViewChanged_),i.addChangeListener(uu.TARGET,i.handleTargetChanged_),i.setProperties(e.values);var s=Gh(i);return!t.view||t.view instanceof Bh||t.view.then(function(t){s.setView(new Bh(t))}),i}return t=u,(i=[{key:"createRenderer",value:function(){throw new Error("Use a map type that has a createRenderer method")}},{key:"addLayer",value:function(t){this.getLayerGroup().getLayers().push(t)}},{key:"handleLayerAdd_",value:function(t){!function t(i,n){if(i instanceof vo)i.setMapInternal(n);else if(i instanceof Jo)for(var e=i.getLayers().getArray(),r=0,s=e.length;r<s;++r)t(e[r],n)}(t.layer,this)}},{key:"addOverlay",value:function(t){this.getOverlays().push(t)}},{key:"addOverlayInternal_",value:function(t){var i=t.getId();void 0!==i&&(this.overlayIdIndex_[i.toString()]=t),t.setMap(this)}},{key:"disposeInternal",value:function(){this.setTarget(null),Hh(zh(u.prototype),"disposeInternal",this).call(this)}},{key:"getAllLayers",value:function(){var n=[];return function i(t){t.forEach(function(t){t instanceof Jo?i(t.getLayers()):n.push(t)})}(this.getLayers()),n}},{key:"getTarget",value:function(){return this.get(uu.TARGET)}},{key:"getOverlays",value:function(){return this.overlays_}},{key:"getOverlayById",value:function(t){t=this.overlayIdIndex_[t.toString()];return void 0!==t?t:null}},{key:"getLayerGroup",value:function(){return this.get(uu.LAYERGROUP)}},{key:"setLayers",value:function(t){var i=this.getLayerGroup();t instanceof Vo?i.setLayers(t):((i=i.getLayers()).clear(),i.extend(t))}},{key:"getLayers",value:function(){return this.getLayerGroup().getLayers()}},{key:"getLoadingOrNotReady",value:function(){for(var t=this.getLayerGroup().getLayerStatesArray(),i=0,n=t.length;i<n;++i){var e=t[i].layer;if(!e.getRenderer().ready)return!0;e=e.getSource();if(e&&e.loading)return!0}return!1}},{key:"getRenderer",value:function(){return this.renderer_}},{key:"getSize",value:function(){return this.size_}},{key:"getView",value:function(){return this.get(uu.VIEW)}},{key:"getOverlayContainer",value:function(){return this.overlayContainer_}},{key:"getOverlayContainerStopEvent",value:function(){return this.overlayContainerStopEvent_}},{key:"getTilePriority",value:function(t,i,n,e){return r=this.frameState_,t=t,i=i,n=n,e=e,r&&i in r.wantedTiles&&r.wantedTiles[i][t.getKey()]?(t=r.viewState.center,r=n[0]-t[0],t=n[1]-t[1],65536*Math.log(e)+Math.sqrt(r*r+t*t)/e):1/0;var r}},{key:"handlePostRender",value:function(){var t,i,n,e=this.frameState_,r=this.tileQueue_;r.isEmpty()||(n=i=this.maxTilesLoading_,!e||((t=e.viewHints)[Ru]||t[Tu])&&(i=(t=8<Date.now()-e.time)?0:8,n=t?0:2),r.getTilesLoading()<i&&(r.reprioritize(),r.loadMoreTiles(i,n))),e&&this.hasListener(ro)&&!e.animate&&this.renderComplete_&&this.renderer_.dispatchRenderEvent(ro,e);for(var s=this.postRenderFunctions_,o=0,u=s.length;o<u;++o)s[o](this,e);s.length=0}},{key:"handleTargetChanged_",value:function(){this.renderer_||(this.renderer_=this.createRenderer()),this.targetChangeHandlerKeys_=[js(document,Ss,this.updateSize,this)],this.updateSize()}},{key:"handleTileChange_",value:function(){this.render()}},{key:"handleViewPropertyChanged_",value:function(){this.render()}},{key:"handleViewChanged_",value:function(){this.viewPropertyListenerKey_&&(xs(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(xs(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=js(t,ds,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=js(t,Os,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}},{key:"isRendered",value:function(){return!!this.frameState_}},{key:"render",value:function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}},{key:"removeLayer",value:function(t){return this.getLayerGroup().getLayers().remove(t)}},{key:"handleLayerRemove_",value:function(t){qh(t.layer)}},{key:"removeOverlay",value:function(t){return this.getOverlays().remove(t)}},{key:"renderFrame_",value:function(t){var i,n=this,e=this.getSize(),r=this.getView(),s=this.frameState_,o=null;void 0!==e&&(0<(i=e)[0]&&0<i[1])&&r&&r.isDef()&&(i=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),r=r.getState(),o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Fr(r.center,r.resolution,r.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:r,viewHints:i,wantedTiles:{},mapId:sr(this),renderTargets:{}},r.nextCenter&&r.nextResolution&&(i=isNaN(r.nextRotation)?r.rotation:r.nextRotation,o.nextExtent=Fr(r.nextCenter,r.nextResolution,i,e))),this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),!s||this.previousExtent_&&(zr(this.previousExtent_)||Lr(o.extent,this.previousExtent_))||(this.dispatchEvent(new eu(su,this,s)),this.previousExtent_=Cr(this.previousExtent_)),!this.previousExtent_||o.viewHints[Ru]||o.viewHints[Tu]||Lr(o.extent,this.previousExtent_)||(this.dispatchEvent(new eu(ou,this,o)),e=o.extent,(s=this.previousExtent_)?(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3]):e.slice())),this.dispatchEvent(new eu(ru,this,o)),this.renderComplete_=!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){n.postRenderTimeoutHandle_=void 0,n.handlePostRender()},0))}},{key:"setSize",value:function(t){this.set(uu.SIZE,t)}},{key:"setTarget",value:function(t){this.set(uu.TARGET,t)}},{key:"setView",value:function(t){var i;!t||t instanceof Bh?this.set(uu.VIEW,t):(this.set(uu.VIEW,new Bh),i=this,t.then(function(t){i.setView(new Bh(t))}))}},{key:"updateSize",value:function(){var t=this.size_;this.setSize(t),this.updateViewportSize_()}},{key:"updateViewportSize_",value:function(){var t,i=this.getView();i&&(t=this.size_,i.setViewportSize(t))}}])&&Dh(t.prototype,i),n&&Dh(t,n),u}();function Yh(t){return(Yh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xh(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Wh(t,i){return(Wh=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Qh(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Kh(n);return t=e?(t=Kh(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Yh(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Kh(t){return(Kh=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jh=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Wh(t,i)}(r,Zh);var t,i,n,e=Qh(r);function r(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),t=ys({},t),e.call(this,t)}return t=r,(i=[{key:"createRenderer",value:function(){return new xo(this)}}])&&Xh(t.prototype,i),n&&Xh(t,n),r}();function $h(t){return($h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ta(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ia(t,i){return(ia=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function na(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ea(n);return t=e?(t=ea(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==$h(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function ea(t){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ra=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ia(t,i)}(s,Es);var t,i,n,r=na(s);function s(t,i,n){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s);var e=n||{};return(n=r.call(this)).tileCoord=t,n.state=i,n.interimTile=null,n.key="",n.transition_=void 0===e.transition?250:e.transition,n.transitionStarts_={},n.interpolate=!!e.interpolate,n}return t=s,(i=[{key:"changed",value:function(){this.dispatchEvent(Os)}},{key:"release",value:function(){}},{key:"getKey",value:function(){return this.key+"/"+this.tileCoord}},{key:"getInterimTile",value:function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==lu)return this.transition_=0,t}while(t=t.interimTile);return this}},{key:"refreshInterimChain",value:function(){if(this.interimTile){var t=this.interimTile,i=this;do{if(t.getState()==lu){t.interimTile=null;break}}while(t.getState()!=fu&&t.getState()==cu?i.interimTile=t.interimTile:i=t,t=i.interimTile)}}},{key:"getTileCoord",value:function(){return this.tileCoord}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(t){if(this.state!==vu&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}},{key:"load",value:function(){er()}},{key:"getAlpha",value:function(t,i){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(n){if(-1===n)return 1}else this.transitionStarts_[t]=n=i;n=i-n+1e3/60;return n>=this.transition_?1:Th(n/this.transition_)}},{key:"inTransition",value:function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}},{key:"endTransition",value:function(t){this.transition_&&(this.transitionStarts_[t]=-1)}}])&&ta(t.prototype,i),n&&ta(t,n),s}();var sa={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function oa(t,i,n){var t=t,e=!0,r=!1,s=!1,o=[As(t,Ts,function(){s=!0,r||i()})];return t.src&&ar?(r=!0,t.decode().then(function(){e&&i()}).catch(function(t){e&&(s?i:n)()})):o.push(As(t,Rs,n)),function(){e=!1,o.forEach(xs)}}function ua(t){return(ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ha(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function aa(t,i){return(aa=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function ca(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=fa(n);return t=e?(t=fa(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ua(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function fa(t){return(fa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var la=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&aa(t,i)}(u,ra);var t,i,n,o=ca(u);function u(t,i,n,e,r,s){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u),(s=o.call(this,t,i,s)).crossOrigin_=e,s.src_=n,s.key=n,s.image_=new Image,null!==e&&(s.image_.crossOrigin=e),s.unlisten_=null,s.tileLoadFunction_=r,s}return t=u,(i=[{key:"getImage",value:function(){return this.image_}},{key:"setImage",value:function(t){this.image_=t,this.state=lu,this.unlistenImage_(),this.changed()}},{key:"handleImageError_",value:function(){this.state=vu,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()}},{key:"handleImageLoad_",value:function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=lu:this.state=du,this.unlistenImage_(),this.changed()}},{key:"load",value:function(){this.state==vu&&(this.state=cu,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==cu&&(this.state=fu,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=oa(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}},{key:"unlistenImage_",value:function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}])&&ha(t.prototype,i),n&&ha(t,n),u}();function va(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var da=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}var t,n,e;return t=i,(n=[{key:"canExpireCache",value:function(){return 0<this.highWaterMark&&this.getCount()>this.highWaterMark}},{key:"expireCache",value:function(t){for(;this.canExpireCache();)this.pop()}},{key:"clear",value:function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}},{key:"containsKey",value:function(t){return this.entries_.hasOwnProperty(t)}},{key:"forEach",value:function(t){for(var i=this.oldest_;i;)t(i.value_,i.key_,this),i=i.newer}},{key:"get",value:function(t,i){t=this.entries_[t];return mr(void 0!==t,15),t===this.newest_?t.value_:(t===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(t.newer.older=t.older,t.older.newer=t.newer),t.newer=null,t.older=this.newest_,this.newest_.newer=t,(this.newest_=t).value_)}},{key:"remove",value:function(t){var i=this.entries_[t];return mr(void 0!==i,15),i===this.newest_?(this.newest_=i.older,this.newest_&&(this.newest_.newer=null)):i===this.oldest_?(this.oldest_=i.newer,this.oldest_&&(this.oldest_.older=null)):(i.newer.older=i.older,i.older.newer=i.newer),delete this.entries_[t],--this.count_,i.value_}},{key:"getCount",value:function(){return this.count_}},{key:"getKeys",value:function(){for(var t=new Array(this.count_),i=0,n=this.newest_;n;n=n.older)t[i++]=n.key_;return t}},{key:"getValues",value:function(){for(var t=new Array(this.count_),i=0,n=this.newest_;n;n=n.older)t[i++]=n.value_;return t}},{key:"peekLast",value:function(){return this.oldest_.value_}},{key:"peekLastKey",value:function(){return this.oldest_.key_}},{key:"peekFirstKey",value:function(){return this.newest_.key_}},{key:"pop",value:function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}},{key:"replace",value:function(t,i){this.get(t),this.entries_[t].value_=i}},{key:"set",value:function(t,i){mr(!(t in this.entries_),16);i={key_:t,newer:null,older:this.newest_,value_:i};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}},{key:"setSize",value:function(t){this.highWaterMark=t}}])&&va(t.prototype,n),e&&va(t,e),i}();function ya(t,i,n,e){return void 0!==e?(e[0]=t,e[1]=i,e[2]=n,e):[t,i,n]}function pa(t,i,n){return t+"/"+i+"/"+n}function ba(t){return(ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ma(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function wa(t,i){return(wa=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function ga(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ma(n);return t=e?(t=Ma(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ba(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ma(t){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ka=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&wa(t,i)}(r,da);var t,i,n,e=ga(r);function r(){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),e.apply(this,arguments)}return t=r,(i=[{key:"expireCache",value:function(t){for(;this.canExpireCache();){if(this.peekLast().getKey()in t)break;this.pop().release()}}},{key:"pruneExceptNewestZ",value:function(){var t,n;0!==this.getCount()&&(t=this.peekFirstKey(),n=t.split("/").map(Number)[0],this.forEach(function(t){var i;t.tileCoord[0]!==n&&(this.remove(pa((i=t.tileCoord)[0],i[1],i[2])),t.release())}.bind(this)))}}])&&ma(t.prototype,i),n&&ma(t,n),r}(),Ea="tileloadstart",Oa="tileloadend",Ra="tileloaderror";function Ta(t){return(Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sa(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ja(t,i){return(ja=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Aa(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ca(n);return t=e?(t=Ca(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Ta(t)&&"function"!=typeof t?xa(i):t}}function xa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ca(t){return(Ca=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function La(i){return i?Array.isArray(i)?function(t){return i}:"function"==typeof i?i:function(t){return[i]}:null}var _a=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ja(t,i)}(r,Zs);var t,i,n,e=Aa(r);function r(t){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).projection=oh(t.projection),i.attributions_=La(t.attributions),i.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,i.loading=!1,i.state_=void 0!==t.state?t.state:so.READY,i.wrapX_=void 0!==t.wrapX&&t.wrapX,i.interpolate_=!!t.interpolate,i.viewResolver=null,i.viewRejector=null;var n=xa(i);return i.viewPromise_=new Promise(function(t,i){n.viewResolver=t,n.viewRejector=i}),i}return t=r,(i=[{key:"getAttributions",value:function(){return this.attributions_}},{key:"getAttributionsCollapsible",value:function(){return this.attributionsCollapsible_}},{key:"getProjection",value:function(){return this.projection}},{key:"getResolutions",value:function(){return er()}},{key:"getView",value:function(){return this.viewPromise_}},{key:"getState",value:function(){return this.state_}},{key:"getWrapX",value:function(){return this.wrapX_}},{key:"getInterpolate",value:function(){return this.interpolate_}},{key:"refresh",value:function(){this.changed()}},{key:"setAttributions",value:function(t){this.attributions_=La(t),this.changed()}},{key:"setState",value:function(t){this.state_=t,this.changed()}}])&&Sa(t.prototype,i),n&&Sa(t,n),r}();function Ia(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Pa=function(){function r(t,i,n,e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),this.minX=t,this.maxX=i,this.minY=n,this.maxY=e}var t,i,n;return t=r,(i=[{key:"contains",value:function(t){return this.containsXY(t[1],t[2])}},{key:"containsTileRange",value:function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}},{key:"containsXY",value:function(t,i){return this.minX<=t&&t<=this.maxX&&this.minY<=i&&i<=this.maxY}},{key:"equals",value:function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}},{key:"extend",value:function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}},{key:"getHeight",value:function(){return this.maxY-this.minY+1}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight()]}},{key:"getWidth",value:function(){return this.maxX-this.minX+1}},{key:"intersects",value:function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}])&&Ia(t.prototype,i),n&&Ia(t,n),r}();function Ba(t,i,n,e,r){return void 0!==r?(r.minX=t,r.maxX=i,r.minY=n,r.maxY=e,r):new Pa(t,i,n,e)}var Fa=Pa;function Na(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Da=[0,0,0],Ha=function(){function h(t){var n,e,r,i;if(!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,h),this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,mr((n=this.resolutions_,e=!0,r=function(t,i){return i-t}||Ke,n.every(function(t,i){if(0===i)return!0;t=r(n[i-1],t);return!(0<t||e&&0===t)})),17),!t.origins)for(var s=0,o=this.resolutions_.length-1;s<o;++s)if(i){if(this.resolutions_[s]/this.resolutions_[s+1]!==i){i=void 0;break}}else i=this.resolutions_[s]/this.resolutions_[s+1];this.zoomFactor_=i,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,mr(this.origins_.length==this.resolutions_.length,20));var u=t.extent;void 0===u||this.origin_||this.origins_||(this.origin_=Hr(u)),mr(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,mr(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Au,mr(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==u?u:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,i){t=new Fa(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));return u&&(i=this.getTileRangeForExtentAndZ(u,i),t.minX=Math.max(i.minX,t.minX),t.maxX=Math.min(i.maxX,t.maxX),t.minY=Math.max(i.minY,t.minY),t.maxY=Math.min(i.maxY,t.maxY)),t},this):u&&this.calculateTileRanges_(u)}var t,i,n;return t=h,(i=[{key:"forEachTileCoord",value:function(t,i,n){for(var e=this.getTileRangeForExtentAndZ(t,i),r=e.minX,s=e.maxX;r<=s;++r)for(var o=e.minY,u=e.maxY;o<=u;++o)n([i,r,o])}},{key:"forEachTileCoordParentTileRange",value:function(t,i,n,e){var r,s,o=null,u=t[0]-1;for(2===this.zoomFactor_?(r=t[1],s=t[2]):o=this.getTileCoordExtent(t,e);u>=this.minZoom;){if(i(u,2===this.zoomFactor_?Ba(r=Math.floor(r/2),r,s=Math.floor(s/2),s,n):this.getTileRangeForExtentAndZ(o,u,n)))return!0;--u}return!1}},{key:"getExtent",value:function(){return this.extent_}},{key:"getMaxZoom",value:function(){return this.maxZoom}},{key:"getMinZoom",value:function(){return this.minZoom}},{key:"getOrigin",value:function(t){return this.origin_||this.origins_[t]}},{key:"getResolution",value:function(t){return this.resolutions_[t]}},{key:"getResolutions",value:function(){return this.resolutions_}},{key:"getTileCoordChildTileRange",value:function(t,i,n){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var e=2*t[1],r=2*t[2];return Ba(e,1+e,r,1+r,i)}n=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,i)}return null}},{key:"getTileRangeForTileCoordAndZ",value:function(t,i,n){if(i>this.maxZoom||i<this.minZoom)return null;var e=t[0],r=t[1],s=t[2];if(i===e)return Ba(r,s,r,s,n);if(this.zoomFactor_){var o=Math.pow(this.zoomFactor_,i-e),u=Math.floor(r*o),h=Math.floor(s*o);return i<e?Ba(u,u,h,h,n):Ba(u,Math.floor(o*(r+1))-1,h,Math.floor(o*(s+1))-1,n)}t=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(t,i,n)}},{key:"getTileRangeExtent",value:function(t,i,n){var e=this.getOrigin(t),r=this.getResolution(t),s=Fh(this.getTileSize(t),this.tmpSize_),o=e[0]+i.minX*s[0]*r,t=e[0]+(i.maxX+1)*s[0]*r;return xr(o,e[1]+i.minY*s[1]*r,t,e[1]+(i.maxY+1)*s[1]*r,n)}},{key:"getTileRangeForExtentAndZ",value:function(t,i,n){var e=Da;this.getTileCoordForXYAndZ_(t[0],t[3],i,!1,e);var r=e[1],s=e[2];return this.getTileCoordForXYAndZ_(t[2],t[1],i,!0,e),Ba(r,e[1],s,e[2],n)}},{key:"getTileCoordCenter",value:function(t){var i=this.getOrigin(t[0]),n=this.getResolution(t[0]),e=Fh(this.getTileSize(t[0]),this.tmpSize_);return[i[0]+(t[1]+.5)*e[0]*n,i[1]-(t[2]+.5)*e[1]*n]}},{key:"getTileCoordExtent",value:function(t,i){var n=this.getOrigin(t[0]),e=this.getResolution(t[0]),r=Fh(this.getTileSize(t[0]),this.tmpSize_),s=n[0]+t[1]*r[0]*e,t=n[1]-(t[2]+1)*r[1]*e;return xr(s,t,s+r[0]*e,t+r[1]*e,i)}},{key:"getTileCoordForCoordAndResolution",value:function(t,i,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],i,!1,n)}},{key:"getTileCoordForXYAndResolution_",value:function(t,i,n,e,r){var s=this.getZForResolution(n),o=n/this.getResolution(s),u=this.getOrigin(s),h=Fh(this.getTileSize(s),this.tmpSize_),t=o*(t-u[0])/n/h[0],h=o*(u[1]-i)/n/h[1],h=e?(t=$r(t,5)-1,$r(h,5)-1):(t=Jr(t,5),Jr(h,5));return ya(s,t,h,r)}},{key:"getTileCoordForXYAndZ_",value:function(t,i,n,e,r){var s=this.getOrigin(n),o=this.getResolution(n),u=Fh(this.getTileSize(n),this.tmpSize_),t=(t-s[0])/o/u[0],u=(s[1]-i)/o/u[1],u=e?(t=$r(t,5)-1,$r(u,5)-1):(t=Jr(t,5),Jr(u,5));return ya(n,t,u,r)}},{key:"getTileCoordForCoordAndZ",value:function(t,i,n){return this.getTileCoordForXYAndZ_(t[0],t[1],i,!1,n)}},{key:"getTileCoordResolution",value:function(t){return this.resolutions_[t[0]]}},{key:"getTileSize",value:function(t){return this.tileSize_||this.tileSizes_[t]}},{key:"getFullTileRange",value:function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}},{key:"getZForResolution",value:function(t,i){return Zr(Je(this.resolutions_,t,i||0),this.minZoom,this.maxZoom)}},{key:"calculateTileRanges_",value:function(t){for(var i=this.resolutions_.length,n=new Array(i),e=this.minZoom;e<i;++e)n[e]=this.getTileRangeForExtentAndZ(t,e);this.fullTileRanges_=n}}])&&Na(t.prototype,i),n&&Na(t,n),h}();function Ua(t){var i,n,e,r=t.getDefaultTileGrid();return r||(r=function(t,i,n,e){e=void 0!==e?e:Er.TOP_LEFT,i=Va(t,i,n);return new Ha({extent:t,origin:function(t,i){var n;return i===Er.BOTTOM_LEFT?n=Ir(t):i===Er.BOTTOM_RIGHT?n=Pr(t):i===Er.TOP_LEFT?n=Hr(t):i===Er.TOP_RIGHT?n=Ur(t):mr(!1,13),n}(t,e),resolutions:i,tileSize:n})}(Ga(t),i,n,e),t.setDefaultTileGrid(r)),r}function Va(t,i,n,e){for(var r=void 0!==i?i:ju,i=Nr(t),t=Vr(t),n=Fh(void 0!==n?n:Au),s=0<e?e:Math.max(t/n[0],i/n[1]),o=r+1,u=new Array(o),h=0;h<o;++h)u[h]=s/Math.pow(2,h);return u}function Ga(t){var i=(t=oh(t)).getExtent();return i=!i?xr(-(t=180*Eu[Ou.DEGREES]/t.getMetersPerUnit()),-t,t,t):i}function za(t){return(za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qa(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Za(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Ya(t,i,n){return(Ya="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Ka(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Xa(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Wa(t,i)}function Wa(t,i){return(Wa=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Qa(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ka(n);return t=e?(t=Ka(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==za(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ka(t){return(Ka=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=function(){Xa(r,_a);var t,i,n,e=Qa(r);function r(t){var i;qa(this,r),(i=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})).on,i.once,i.un,i.opaque_=void 0!==t.opaque&&t.opaque,i.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,i.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;return i.tileGrid&&Fh(i.tileGrid.getTileSize(i.tileGrid.getMinZoom()),[256,256]),i.tileCache=new ka(t.cacheSize||0),i.tmpSize=[0,0],i.key_=t.key||"",i.tileOptions={transition:t.transition,interpolate:t.interpolate},i.zDirection=t.zDirection||0,i}return t=r,(i=[{key:"canExpireCache",value:function(){return this.tileCache.canExpireCache()}},{key:"expireCache",value:function(t,i){t=this.getTileCacheForProjection(t);t&&t.expireCache(i)}},{key:"forEachLoadedTile",value:function(t,i,n,e){var r=this.getTileCacheForProjection(t);if(!r)return!1;for(var s,o,u=!0,h=n.minX;h<=n.maxX;++h)for(var a=n.minY;a<=n.maxY;++a)s=pa(i,h,a),o=!1,(o=r.containsKey(s)?(o=(s=r.get(s)).getState()===lu)&&!1!==e(s):o)||(u=!1);return u}},{key:"getGutterForProjection",value:function(t){return 0}},{key:"getKey",value:function(){return this.key_}},{key:"setKey",value:function(t){this.key_!==t&&(this.key_=t,this.changed())}},{key:"getOpaque",value:function(t){return this.opaque_}},{key:"getResolutions",value:function(){return this.tileGrid?this.tileGrid.getResolutions():null}},{key:"getTile",value:function(t,i,n,e,r){return er()}},{key:"getTileGrid",value:function(){return this.tileGrid}},{key:"getTileGridForProjection",value:function(t){return this.tileGrid||Ua(t)}},{key:"getTileCacheForProjection",value:function(t){return mr(ah(this.getProjection(),t),68),this.tileCache}},{key:"getTilePixelRatio",value:function(t){return this.tilePixelRatio_}},{key:"getTilePixelSize",value:function(t,i,n){n=this.getTileGridForProjection(n),i=this.getTilePixelRatio(i),n=Fh(n.getTileSize(t),this.tmpSize);return 1==i?n:(t=n,n=i,(i=void 0===(i=this.tmpSize)?[0,0]:i)[0]=t[0]*n+.5|0,i[1]=t[1]*n+.5|0,i)}},{key:"getTileCoordForTileUrlFunction",value:function(t,i){var n,e,r,s=void 0!==i?i:this.getProjection(),o=this.getTileGridForProjection(s);return this.getWrapX()&&s.isGlobal()&&(n=o,r=s,i=(e=t)[0],s=n.getTileCoordCenter(e),t=Tr(r=Ga(r),s)?e:(e=Vr(r),r=Math.ceil((r[0]-s[0])/e),s[0]+=e*r,n.getTileCoordForCoordAndZ(s,i))),function(t,i){var n=t[0],e=t[1],t=t[2];if(!(i.getMinZoom()>n||n>i.getMaxZoom())){n=i.getFullTileRange(n);return!n||n.containsXY(e,t)}}(t,o)?t:null}},{key:"clear",value:function(){this.tileCache.clear()}},{key:"refresh",value:function(){this.clear(),Ya(Ka(r.prototype),"refresh",this).call(this)}},{key:"updateCacheSize",value:function(t,i){i=this.getTileCacheForProjection(i);t>i.highWaterMark&&(i.highWaterMark=t)}},{key:"useTile",value:function(t,i,n,e){}}])&&Za(t.prototype,i),n&&Za(t,n),r}(),Ja=function(){Xa(e,vs);var n=Qa(e);function e(t,i){return qa(this,e),(t=n.call(this,t)).tile=i,t}return e}(),$a=q;function tc(t,i){for(var r,n=t.length,e=new Array(n),s=0;s<n;++s)e[s]=function(e,r){var s=/\{z\}/g,o=/\{x\}/g,u=/\{y\}/g,h=/\{-y\}/g;return function(i,t,n){if(i)return e.replace(s,i[0].toString()).replace(o,i[1].toString()).replace(u,i[2].toString()).replace(h,function(){var t=i[0],t=r.getFullTileRange(t);return mr(t,55),(t.getHeight()-i[2]-1).toString()})}}(t[s],i);return 1!==(r=e).length?function(t,i,n){if(t){e=Qr(((e=t)[1]<<e[0])+e[2],r.length);return r[e](t,i,n)}var e}:r[0]}function ic(t){return(ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ec(t,i){return(ec=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function rc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=sc(n);return t=e?(t=sc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ic(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function sc(t){return(sc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&ec(t,i)}(r,$a);var t,i,n,e=rc(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})).generateTileUrlFunction_=i.tileUrlFunction===r.prototype.tileUrlFunction,i.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(i.tileUrlFunction=t.tileUrlFunction),i.urls=null,t.urls?i.setUrls(t.urls):t.url&&i.setUrl(t.url),i.tileLoadingKeys_={},i}return t=r,(i=[{key:"getTileLoadFunction",value:function(){return this.tileLoadFunction}},{key:"getTileUrlFunction",value:function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}},{key:"getUrls",value:function(){return this.urls}},{key:"handleTileChange",value:function(t){var i,n=t.target,e=sr(n),t=n.getState();t==fu?(this.tileLoadingKeys_[e]=!0,i=Ea):e in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[e],i=t==vu?Ra:t==lu?Oa:void 0),null!=i&&this.dispatchEvent(new Ja(i,n))}},{key:"setTileLoadFunction",value:function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}},{key:"setTileUrlFunction",value:function(t,i){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==i?this.setKey(i):this.changed()}},{key:"setUrl",value:function(t){t=function(t){var i=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){for(var e=n[1].charCodeAt(0),r=n[2].charCodeAt(0),s=e;s<=r;++s)i.push(t.replace(n[0],String.fromCharCode(s)));return i}if(n=/\{(\d+)-(\d+)\}/.exec(t)){for(var o=parseInt(n[2],10),u=parseInt(n[1],10);u<=o;u++)i.push(t.replace(n[0],u.toString()));return i}return i.push(t),i}(t);this.urls=t,this.setUrls(t)}},{key:"setUrls",value:function(t){var i=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(tc(t,this.tileGrid),i):this.setKey(i)}},{key:"tileUrlFunction",value:function(t,i,n){}},{key:"useTile",value:function(t,i,n){n=pa(t,i,n);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}])&&nc(t.prototype,i),n&&nc(t,n),r}();function uc(t){return(uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function ac(t,i,n){return(ac="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=lc(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function cc(t,i){return(cc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function fc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=lc(n);return t=e?(t=lc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==uc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function lc(t){return(lc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vc(t,i){t.getImage().src=i}var dc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&cc(t,i)}(r,oc);var t,i,n,e=fc(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=void 0===t.imageSmoothing||t.imageSmoothing;return void 0!==t.interpolate&&(i=t.interpolate),(i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction||vc,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:i,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})).crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,i.tileClass=void 0!==t.tileClass?t.tileClass:la,i.tileCacheForProjection={},i.tileGridForProjection={},i.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,i.renderReprojectionEdges_=!1,i}return t=r,(i=[{key:"canExpireCache",value:function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}},{key:"expireCache",value:function(t,i){var n,e=this.getTileCacheForProjection(t);for(n in this.tileCache.expireCache(this.tileCache==e?i:{}),this.tileCacheForProjection){var r=this.tileCacheForProjection[n];r.expireCache(r==e?i:{})}}},{key:"getGutterForProjection",value:function(t){return this.getProjection()&&t&&!ah(this.getProjection(),t)?0:this.getGutter()}},{key:"getGutter",value:function(){return 0}},{key:"getKey",value:function(){var t=ac(lc(r.prototype),"getKey",this).call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t}},{key:"getOpaque",value:function(t){return!(this.getProjection()&&t&&!ah(this.getProjection(),t))&&ac(lc(r.prototype),"getOpaque",this).call(this,t)}},{key:"getTileGridForProjection",value:function(t){var i=this.getProjection();if(!this.tileGrid||i&&!ah(i,t)){i=sr(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Ua(t)),this.tileGridForProjection[i]}return this.tileGrid}},{key:"getTileCacheForProjection",value:function(t){var i=this.getProjection();if(!i||ah(i,t))return this.tileCache;t=sr(t);return t in this.tileCacheForProjection||(this.tileCacheForProjection[t]=new ka(this.tileCache.highWaterMark)),this.tileCacheForProjection[t]}},{key:"createTile_",value:function(t,i,n,e,r,s){i=[t,i,n],n=this.getTileCoordForTileUrlFunction(i,r),r=n?this.tileUrlFunction(n,e,r):void 0,r=new this.tileClass(i,void 0!==r?cu:du,void 0!==r?r:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return r.key=s,r.addEventListener(Os,this.handleTileChange.bind(this)),r}},{key:"getTile",value:function(t,i,n,e,r){var s=this.getProjection();return this.getTileInternal(t,i,n,e,s||r)}},{key:"getTileInternal",value:function(t,i,n,e,r){var s,o=null,u=pa(t,i,n),h=this.getKey();return this.tileCache.containsKey(u)?(o=this.tileCache.get(u)).key!=h&&(s=o,o=this.createTile_(t,i,n,e,r,h),s.getState()==cu?o.interimTile=s.interimTile:o.interimTile=s,o.refreshInterimChain(),this.tileCache.replace(u,o)):(o=this.createTile_(t,i,n,e,r,h),this.tileCache.set(u,o)),o}},{key:"setRenderReprojectionEdges",value:function(t){if(this.renderReprojectionEdges_!=t){for(var i in this.renderReprojectionEdges_=t,this.tileCacheForProjection)this.tileCacheForProjection[i].clear();this.changed()}}}])&&hc(t.prototype,i),n&&hc(t,n),r}();function yc(t){return(yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pc(t,i){return(pc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function bc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=mc(n);return t=e?(t=mc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==yc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function mc(t){return(mc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var wc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&pc(t,i)}(o,dc);var s=bc(o);function o(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,o);var i=t||{},n=void 0===i.imageSmoothing||i.imageSmoothing;void 0!==i.interpolate&&(n=i.interpolate);var e,r=void 0!==i.projection?i.projection:"EPSG:3857",e=void 0!==i.tileGrid?i.tileGrid:(t={extent:Ga(r),maxResolution:i.maxResolution,maxZoom:i.maxZoom,minZoom:i.minZoom,tileSize:i.tileSize},e={extent:t=(e=t||{}).extent||oh("EPSG:3857").getExtent(),minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Va(t,e.maxZoom,e.tileSize,e.maxResolution)},new Ha(e));return s.call(this,{attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:n,opaque:i.opaque,projection:r,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:e,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:void 0===i.wrapX||i.wrapX,transition:i.transition,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection})}return o}();function gc(t){return(gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mc(t,i){return(Mc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function kc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Ec(n);return t=e?(t=Ec(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==gc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Ec(t){return(Ec=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Oc='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',Rc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Mc(t,i)}(e,wc);var n=kc(e);function e(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e);var i=t||{},t=void 0!==i.attributions?i.attributions:[Oc];return n.call(this,{attributions:t,attributionsCollapsible:!1,cacheSize:i.cacheSize,crossOrigin:void 0!==i.crossOrigin?i.crossOrigin:"anonymous",interpolate:void 0!==i.interpolate?i.interpolate:void 0===i.imageSmoothing||i.imageSmoothing,maxZoom:void 0!==i.maxZoom?i.maxZoom:19,opaque:void 0===i.opaque||i.opaque,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileLoadFunction:i.tileLoadFunction,transition:i.transition,url:void 0!==i.url?i.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",wrapX:i.wrapX,zDirection:i.zDirection})}return e}(),Tc="preload",Sc="useInterimTilesOnError";function jc(t){return(jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ac(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function xc(t,i,n){return(xc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=_c(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Cc(t,i){return(Cc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Lc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=_c(n);return t=e?(t=_c(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==jc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function _c(t){return(_c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ic=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Cc(t,i)}(r,vo);var t,i,n,e=Lc(r);function r(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r);var i=t||{},t=ys({},i);return delete t.preload,delete t.useInterimTilesOnError,(t=e.call(this,t)).on,t.once,t.un,t.setPreload(void 0!==i.preload?i.preload:0),t.setUseInterimTilesOnError(void 0===i.useInterimTilesOnError||i.useInterimTilesOnError),t}return t=r,(i=[{key:"getPreload",value:function(){return this.get(Tc)}},{key:"setPreload",value:function(t){this.set(Tc,t)}},{key:"getUseInterimTilesOnError",value:function(){return this.get(Sc)}},{key:"setUseInterimTilesOnError",value:function(t){this.set(Sc,t)}},{key:"getData",value:function(t){return xc(_c(r.prototype),"getData",this).call(this,t)}}])&&Ac(t.prototype,i),n&&Ac(t,n),r}();function Pc(t){return(Pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Fc(t,i,n){return(Fc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Uc(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Nc(t,i){return(Nc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Dc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Uc(n);return t=e?(t=Uc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Pc(t)&&"function"!=typeof t?Hc(i):t}}function Hc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Uc(t){return(Uc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Vc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Nc(t,i)}(r,Bs);var t,i,n,e=Dc(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).ready=!0,i.boundHandleImageChange_=i.handleImageChange_.bind(Hc(i)),i.layer_=t,i.declutterExecutorGroup=null,i}return t=r,(i=[{key:"getFeatures",value:function(t){return er()}},{key:"getData",value:function(t){return null}},{key:"prepareFrame",value:function(t){return er()}},{key:"renderFrame",value:function(t,i){return er()}},{key:"loadedTileCallback",value:function(t,i,n){t[i]||(t[i]={}),t[i][n.tileCoord.toString()]=n}},{key:"createLoadedTileFinder",value:function(e,r,s){return function(t,i){var n=this.loadedTileCallback.bind(this,s,t);return e.forEachLoadedTile(r,t,i,n)}.bind(this)}},{key:"forEachFeatureAtCoordinate",value:function(t,i,n,e,r){}},{key:"getDataAtPixel",value:function(t,i,n){return null}},{key:"getLayer",value:function(){return this.layer_}},{key:"handleFontsChanged",value:function(){}},{key:"handleImageChange_",value:function(t){t.target.getState()===sa.LOADED&&this.renderIfReadyAndVisible()}},{key:"loadImage",value:function(t){var i=t.getState();return i!=sa.LOADED&&i!=sa.ERROR&&t.addEventListener(Os,this.boundHandleImageChange_),i==sa.IDLE&&(t.load(),i=t.getState()),i==sa.LOADED}},{key:"renderIfReadyAndVisible",value:function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==so.READY&&t.changed()}},{key:"disposeInternal",value:function(){delete this.layer_,Fc(Uc(r.prototype),"disposeInternal",this).call(this)}}])&&Bc(t.prototype,i),n&&Bc(t,n),r}();function Gc(t){return(Gc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zc(t,i){return(zc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function qc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Zc(n);return t=e?(t=Zc(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Gc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Zc(t){return(Zc=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Yc=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&zc(t,i)}(s,vs);var r=qc(s);function s(t,i,n,e){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),(t=r.call(this,t)).inversePixelTransform=i,t.frameState=n,t.context=e,t}return s}();function Xc(t){return(Xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wc(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Qc(t,i,n){return(Qc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=$c(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Kc(t,i){return(Kc=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Jc(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=$c(n);return t=e?(t=$c(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Xc(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function $c(t){return($c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var tf=null;var nf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Kc(t,i)}(r,Vc);var t,i,n,e=Jc(r);function r(t){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this,t)).container=null,t.renderedResolution,t.tempTransform=wr(),t.pixelTransform=wr(),t.inversePixelTransform=wr(),t.context=null,t.containerReused=!1,t.pixelContext_=null,t.frameState=null,t}return t=r,(i=[{key:"getImageData",value:function(t,i,n){var e,r;tf||((e=document.createElement("canvas")).width=1,e.height=1,tf=e.getContext("2d")),tf.clearRect(0,0,1,1);try{tf.drawImage(t,i,n,1,1,0,0,1,1),r=tf.getImageData(0,0,1,1).data}catch(t){return null}return r}},{key:"getBackground",value:function(t){var i=this.getLayer().getBackground();return(i="function"==typeof i?i(t.viewState.resolution):i)||void 0}},{key:"useContainer",value:function(t,i,n,e){var r,s,o,u,h,a=this.getLayer().getClassName();t&&t.className===a&&""===t.style.opacity&&1===n&&(!e||t.style.backgroundColor&&tr(us(t.style.backgroundColor),us(e)))&&((n=t.firstElementChild)instanceof HTMLCanvasElement&&(r=n.getContext("2d"))),r&&r.canvas.style.transform===i?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),this.container||((t=document.createElement("div")).className=a,(a=t.style).position="absolute",a.width="100%",a.height="100%",e&&(a.backgroundColor=e),u=u&&u.length?u.shift():hr?new OffscreenCanvas(s||300,o||300):document.createElement("canvas"),s&&(u.width=s),o&&(u.height=o),h=(r=u.getContext("2d",h)).canvas,t.appendChild(h),(a=h.style).position="absolute",a.left="0",a.transformOrigin="top left",this.container=t,this.context=r)}},{key:"clipUnrotated",value:function(t,i,n){var e=Hr(n),r=Ur(n),s=Pr(n),n=Ir(n);gr(i.coordinateToPixelTransform,e),gr(i.coordinateToPixelTransform,r),gr(i.coordinateToPixelTransform,s),gr(i.coordinateToPixelTransform,n);i=this.inversePixelTransform;gr(i,e),gr(i,r),gr(i,s),gr(i,n),t.save(),t.beginPath(),t.moveTo(Math.round(e[0]),Math.round(e[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(n[0]),Math.round(n[1])),t.clip()}},{key:"dispatchRenderEvent_",value:function(t,i,n){var e=this.getLayer();e.hasListener(t)&&(i=new Yc(t,this.inversePixelTransform,n,i),e.dispatchEvent(i))}},{key:"preRender",value:function(t,i){this.frameState=i,this.dispatchRenderEvent_(io,t,i)}},{key:"postRender",value:function(t,i){this.dispatchRenderEvent_(no,t,i)}},{key:"getRenderTransform",value:function(t,i,n,e,r,s,o){i=e/i,o=-t[0]+o,t=-t[1];return Mr(this.tempTransform,r/2,s/2,i,-i,-n,o,t)}},{key:"getDataAtPixel",value:function(t,i,n){var e=gr(this.inversePixelTransform,t.slice()),r=this.context,s=this.getLayer().getExtent();if(s&&!Tr(s,gr(i.pixelToCoordinateTransform,t.slice())))return null;var o,s=Math.round(e[0]),i=Math.round(e[1]),t=this.pixelContext_;t||((e=document.createElement("canvas")).width=1,e.height=1,t=e.getContext("2d"),this.pixelContext_=t),t.clearRect(0,0,1,1);try{t.drawImage(r.canvas,s,i,1,1,0,0,1,1),o=t.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?(this.pixelContext_=null,new Uint8Array):o}return 0===o[3]?null:o}},{key:"disposeInternal",value:function(){delete this.frameState,Qc($c(r.prototype),"disposeInternal",this).call(this)}}])&&Wc(t.prototype,i),n&&Wc(t,n),r}();function ef(t){return(ef="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function sf(t,i,n){return(sf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=hf(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function of(t,i){return(of=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function uf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=hf(n);return t=e?(t=hf(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==ef(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function hf(t){return(hf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var af=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&of(t,i)}(r,nf);var t,i,n,e=uf(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this,t)).extentChanged=!0,i.renderedExtent_=null,i.renderedPixelRatio,i.renderedProjection=null,i.renderedRevision,i.renderedTiles=[],i.newTiles_=!1,i.tmpExtent=Ar(),i.tmpTileRange_=new Fa(0,0,0,0),i.thirdMap_=t.thirdMap_,i.layercount_=t.layercount_,i}return t=r,(i=[{key:"isDrawableTile",value:function(t){var i=this.getLayer(),t=t.getState(),i=i.getUseInterimTilesOnError();return t==lu||t==du||t==vu&&!i}},{key:"getTile",value:function(t,i,n,e){var r=e.pixelRatio,s=e.viewState.projection,e=this.getLayer(),s=e.getSource().getTile(t,i,n,r,s);return s.getState()==vu&&(e.getUseInterimTilesOnError()?0<e.getPreload()&&(this.newTiles_=!0):s.setState(lu)),s=!this.isDrawableTile(s)?s.getInterimTile():s}},{key:"getData",value:function(t){var i=this.frameState;if(!i)return null;var n=this.getLayer(),e=gr(i.pixelToCoordinateTransform,t.slice()),t=n.getExtent();if(t&&!Tr(t,e))return null;for(var r=i.pixelRatio,s=i.viewState.projection,t=i.viewState,o=n.getRenderSource(),u=o.getTileGridForProjection(t.projection),h=o.getTilePixelRatio(i.pixelRatio),a=u.getZForResolution(t.resolution);a>=u.getMinZoom();--a){var c=u.getTileCoordForCoordAndZ(e,a),f=o.getTile(a,c[1],c[2],r,s);if(!(f instanceof la))return null;if(f.getState()===lu){var l=u.getOrigin(a),v=Fh(u.getTileSize(a)),d=u.getResolution(a),y=Math.floor(h*((e[0]-l[0])/d-c[1]*v[0])),v=Math.floor(h*((l[1]-e[1])/d-c[2]*v[1]));return this.getImageData(f.getImage(),y,v)}}return null}},{key:"loadedTileCallback",value:function(t,i,n){return!!this.isDrawableTile(n)&&sf(hf(r.prototype),"loadedTileCallback",this).call(this,t,i,n)}},{key:"prepareFrame",value:function(t){return!!this.getLayer().getSource()}},{key:"renderFrame",value:function(t,i){var n=t.layerStatesArray[t.layerIndex],e=t.viewState,r=e.projection,s=e.resolution,o=e.center,u=e.rotation,h=t.pixelRatio,a=this.getLayer(),c=a.getSource(),f=c.getRevision(),l=c.getTileGridForProjection(r),v=l.getZForResolution(s,c.zDirection),d=l.getResolution(v),y=t.extent;n.extent&&gh(n.extent,r)&&(y=Dr(y,gh(n.extent,r)));var p=c.getTilePixelRatio(h),b=Math.round(t.size[0]*p),m=Math.round(t.size[1]*p);u&&(m=b=Math.round(Math.sqrt(b*b+m*m)));var w=d*b/2/p,e=d*m/2/p,g=[o[0]-w,o[1]-e,o[0]+w,o[1]+e],M=l.getTileRangeForExtentAndZ(y,v),k={};k[v]={};var E=this.createLoadedTileFinder(c,r,k),O=this.tmpExtent,R=this.tmpTileRange_;this.newTiles_=!1;for(var T=M.minX;T<=M.maxX;++T)for(var S=M.minY;S<=M.maxY;++S){var j=this.getTile(v,T,S,t);if(this.isDrawableTile(j)){var A=sr(this);if(j.getState()==lu&&(x=(k[v][j.tileCoord.toString()]=j).inTransition(A),this.newTiles_||!x&&-1!==this.renderedTiles.indexOf(j)||(this.newTiles_=!0)),1===j.getAlpha(A,t.time))continue}var x=l.getTileCoordChildTileRange(j.tileCoord,R,O),A=!1;(A=x?E(v+1,x):A)||l.forEachTileCoordParentTileRange(j.tileCoord,E,R,O)}var C=d/s;Mr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/p,1/p,u,-b/2,-m/2),kr(this.inversePixelTransform,this.pixelTransform),Mr(this.tempTransform,b/2,m/2,C,C,0,-b/2,-m/2),this.renderedTiles.length=0;var L,_=Object.keys(k).map(Number);_.sort(Ke),1!==n.opacity||this.containerReused&&!c.getOpaque(t.viewState.projection)?L=[]:_=_.reverse();for(var I=[],P=_.length-1;0<=P;--P){var B,F=_[P],N=c.getTilePixelSize(F,h,r),D=l.getResolution(F)/d,H=N[0]*D*C,U=N[1]*D*C,V=l.getTileCoordForCoordAndZ(Hr(g),F),D=l.getTileCoordExtent(V),G=gr(this.tempTransform,[p*(D[0]-g[0])/d,p*(g[3]-D[3])/d]),z=p*c.getGutterForProjection(r),q=k[F];for(B in q){var Z=q[B],Y=Z.tileCoord,X=V[1]-Y[1],W=Math.round(G[0]-(X-1)*H),Q=V[2]-Y[2],K=Math.round(G[1]-(Q-1)*U),J=Math.round(G[0]-X*H),Y=Math.round(G[1]-Q*U),X=W-J,Q=K-Y,W=v===F,K=W&&1!==Z.getAlpha(sr(this),t.time);this.drawTileImage(Z,t,J,Y,X,Q,z,W,I),L&&!K?this.renderedTiles.unshift(Z):this.renderedTiles.push(Z),this.updateUsedTiles(t.usedTiles,c,Z)}}return this.renderedRevision=f,this.renderedResolution=d,this.extentChanged=!this.renderedExtent_||!Lr(this.renderedExtent_,g),this.renderedExtent_=g,this.renderedPixelRatio=h,this.renderedProjection=r,this.manageTilePyramid(t,c,l,h,r,y,v,a.getPreload()),this.scheduleExpireCache(t,c),this.thirdMap_&&(1===this.layercount_?this.thirdMap_.Te&&this.thirdMap_.Te(I):this.thirdMap_.Se&&this.thirdMap_.Se(I)),this.container}},{key:"drawTileImage",value:function(t,i,n,e,r,s,o,u,h){var a,c,f=this.getTileImage(t);f&&(a=sr(this),c=u?t.getAlpha(a,i.time):1,h.push({image:f,x:n,y:e,w:r,h:s,frameState:i}),1!==c?i.animate=!0:u&&t.endTransition(a))}},{key:"getTileImage",value:function(t){return t.getImage()}},{key:"scheduleExpireCache",value:function(t,i){i.canExpireCache()&&(i=function(t,i,n){var e=sr(t);e in n.usedTiles&&t.expireCache(n.viewState.projection,n.usedTiles[e])}.bind(null,i),t.postRenderFunctions.push(i))}},{key:"updateUsedTiles",value:function(t,i,n){i=sr(i);i in t||(t[i]={}),t[i][n.getKey()]=!0}},{key:"manageTilePyramid",value:function(t,i,n,e,r,s,o,u,h){var a=sr(i);a in t.wantedTiles||(t.wantedTiles[a]={});for(var c,f,l,v,d,y=t.wantedTiles[a],p=t.tileQueue,b=0,m=n.getMinZoom();m<=o;++m)for(f=n.getTileRangeForExtentAndZ(s,m,f),l=n.getResolution(m),v=f.minX;v<=f.maxX;++v)for(d=f.minY;d<=f.maxY;++d)o-m<=u?(++b,(c=i.getTile(m,v,d,e,r)).getState()==cu&&(y[c.getKey()]=!0,p.isKeyQueued(c.getKey())||p.enqueue([c,a,n.getTileCoordCenter(c.tileCoord),l])),void 0!==h&&h(c)):i.useTile(m,v,d,r);i.updateCacheSize(b,r)}}])&&rf(t.prototype,i),n&&rf(t,n),r}();function cf(t){return(cf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ff(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function lf(t,i){return(lf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function vf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=df(n);return t=e?(t=df(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==cf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function df(t){return(df=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var yf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&lf(t,i)}(r,Ic);var t,i,n,e=vf(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this,t)).layercount_=t.layercount,i.thirdMap_=t.thirdMap,i}return t=r,(i=[{key:"createRenderer",value:function(){return new af(this)}}])&&ff(t.prototype,i),n&&ff(t,n),r}(),pf={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function bf(t,i,n,e,r,s){for(var o=s||[],u=0,h=i;h<n;h+=e){var a=t[h],c=t[h+1];o[u++]=r[0]*a+r[2]*c+r[4],o[u++]=r[1]*a+r[3]*c+r[5]}return s&&o.length!=u&&(o.length=u),o}function mf(t){return(mf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function gf(t,i){return(gf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Mf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=kf(n);return t=e?(t=kf(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==mf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function kf(t){return(kf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ef=wr(),Of=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&gf(t,i)}(u,Zs);var t,i,n,o=Mf(u);function u(){var t,i,n,e,r,s;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,u),(t=o.call(this)).extent_=Ar(),t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=(s=!(i=function(t,i,n){if(!n)return this.getSimplifiedGeometry(i);var e=this.clone();return e.applyTransform(n),e.getSimplifiedGeometry(i)}),function(){var t=Array.prototype.slice.call(arguments);return s&&this===r&&tr(t,e)||(s=!0,r=this,e=t,n=i.apply(this,arguments)),n}),t}return t=u,(i=[{key:"simplifyTransformed",value:function(t,i){return this.simplifyTransformedInternal(this.getRevision(),t,i)}},{key:"clone",value:function(){return er()}},{key:"closestPointXY",value:function(t,i,n,e){return er()}},{key:"containsXY",value:function(t,i){var n=this.getClosestPoint([t,i]);return n[0]===t&&n[1]===i}},{key:"getClosestPoint",value:function(t,i){i=i||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i}},{key:"intersectsCoordinate",value:function(t){return this.containsXY(t[0],t[1])}},{key:"computeExtent",value:function(t){return er()}},{key:"getExtent",value:function(t){var i;return this.extentRevision_!=this.getRevision()&&(i=this.computeExtent(this.extent_),(isNaN(i[0])||isNaN(i[1]))&&Cr(i),this.extentRevision_=this.getRevision()),i=this.extent_,(t=t)?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}},{key:"rotate",value:function(t,i){er()}},{key:"scale",value:function(t,i,n){er()}},{key:"simplify",value:function(t){return this.getSimplifiedGeometry(t*t)}},{key:"getSimplifiedGeometry",value:function(t){return er()}},{key:"getType",value:function(){return er()}},{key:"applyTransform",value:function(t){er()}},{key:"intersectsExtent",value:function(t){return er()}},{key:"translate",value:function(t,i){er()}},{key:"transform",value:function(t,s){var o=oh(t),t=o.getUnits()==Ou.TILE_PIXELS?function(t,i,n){var e=o.getExtent(),r=o.getWorldExtent(),e=Nr(r)/Nr(e);return Mr(Ef,r[0],r[3],e,-e,0,0,0),bf(t,0,t.length,n,Ef,i),fh(o,s)(t,i,n)}:fh(o,s);return this.applyTransform(t),this}}])&&wf(t.prototype,i),n&&wf(t,n),u}();function Rf(t){return(Rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Sf(t,i){return(Sf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function jf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Af(n);return t=e?(t=Af(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Rf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Af(t){return(Af=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xf(t){var i;return t==pf.XY?i=2:t==pf.XYZ||t==pf.XYM?i=3:t==pf.XYZM&&(i=4),i}var Cf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Sf(t,i)}(r,Of);var t,i,n,e=jf(r);function r(){var t;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(t=e.call(this)).layout=pf.XY,t.stride=2,t.flatCoordinates=null,t}return t=r,(i=[{key:"computeExtent",value:function(t){return i=this.flatCoordinates,n=0,e=this.flatCoordinates.length,r=this.stride,_r(Cr(t),i,n,e,r);var i,n,e,r}},{key:"getCoordinates",value:function(){return er()}},{key:"getFirstCoordinate",value:function(){return this.flatCoordinates.slice(0,this.stride)}},{key:"getFlatCoordinates",value:function(){return this.flatCoordinates}},{key:"getLastCoordinate",value:function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}},{key:"getLayout",value:function(){return this.layout}},{key:"getSimplifiedGeometry",value:function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var i=this.getSimplifiedGeometryInternal(t);return i.getFlatCoordinates().length<this.flatCoordinates.length?i:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}},{key:"getSimplifiedGeometryInternal",value:function(t){return this}},{key:"getStride",value:function(){return this.stride}},{key:"setFlatCoordinates",value:function(t,i){this.stride=xf(t),this.layout=t,this.flatCoordinates=i}},{key:"setCoordinates",value:function(t,i){er()}},{key:"setLayout",value:function(t,i,n){var e;if(t)e=xf(t);else{for(var r=0;r<n;++r){if(0===i.length)return this.layout=pf.XY,void(this.stride=2);i=i[0]}t=function(t){var i;2==t?i=pf.XY:3==t?i=pf.XYZ:4==t&&(i=pf.XYZM);return i}(e=i.length)}this.layout=t,this.stride=e}},{key:"applyTransform",value:function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}},{key:"rotate",value:function(t,i){var n,e=this.getFlatCoordinates();e&&(n=this.getStride(),function(t,i,n,e,r,s,o){for(var u=o||[],h=Math.cos(r),a=Math.sin(r),c=s[0],f=s[1],l=0,v=i;v<n;v+=e){var d=t[v]-c,y=t[v+1]-f;u[l++]=c+d*h-y*a,u[l++]=f+d*a+y*h;for(var p=v+2;p<v+e;++p)u[l++]=t[p]}o&&u.length!=l&&(u.length=l)}(e,0,e.length,n,t,i,e),this.changed())}},{key:"scale",value:function(t,i,n){var e=i;void 0===e&&(e=t);var r=(r=n)||Br(this.getExtent()),i=this.getFlatCoordinates();i&&(n=this.getStride(),function(t,i,n,e,r,s,o,u){for(var h=u||[],a=o[0],c=o[1],f=0,l=i;l<n;l+=e){var v=t[l]-a,d=t[l+1]-c;h[f++]=a+r*v,h[f++]=c+s*d;for(var y=l+2;y<l+e;++y)h[f++]=t[y]}u&&h.length!=f&&(h.length=f)}(i,0,i.length,n,t,e,r,i),this.changed())}},{key:"translate",value:function(t,i){var n,e=this.getFlatCoordinates();e&&(n=this.getStride(),function(t,i,n,e,r,s,o){for(var u=o||[],h=0,a=i;a<n;a+=e){u[h++]=t[a]+r,u[h++]=t[a+1]+s;for(var c=a+2;c<a+e;++c)u[h++]=t[c]}o&&u.length!=h&&(u.length=h)}(e,0,e.length,n,t,i,e),this.changed())}}])&&Tf(t.prototype,i),n&&Tf(t,n),r}();function Lf(t,i,n,e,r,s,o){var u,h,a,c=t[i],f=t[i+1],l=t[n]-c,v=t[n+1]-f;if(0==l&&0==v)u=i;else{var d=((r-c)*l+(s-f)*v)/(l*l+v*v);if(1<d)u=n;else{if(0<d){for(var y=0;y<e;++y)o[y]=(h=t[i+y],a=t[n+y],h+d*(a-h));return void(o.length=e)}u=i}}for(var p=0;p<e;++p)o[p]=t[u+p];o.length=e}function _f(t,i,n,e,r){var s=t[i],o=t[i+1];for(i+=e;i<n;i+=e){var u=t[i],h=t[i+1],a=Xr(s,o,u,h);r<a&&(r=a),s=u,o=h}return r}function If(t,i,n,e,r){for(var s=0,o=n.length;s<o;++s){var u=n[s];r=_f(t,i,u,e,r),i=u}return r}function Pf(t,i,n,e,r,s,o,u,h,a,c){if(i==n)return a;var f,l;if(0===r){if((l=Xr(o,u,t[i],t[i+1]))<a){for(f=0;f<e;++f)h[f]=t[i+f];return h.length=e,l}return a}for(var v=c||[NaN,NaN],d=i+e;d<n;)if(Lf(t,d-e,d,e,o,u,v),(l=Xr(o,u,v[0],v[1]))<a){for(a=l,f=0;f<e;++f)h[f]=v[f];d+=h.length=e}else d+=e*Math.max((Math.sqrt(l)-Math.sqrt(a))/r|0,1);if(s&&(Lf(t,n-e,i,e,o,u,v),(l=Xr(o,u,v[0],v[1]))<a)){for(a=l,f=0;f<e;++f)h[f]=v[f];h.length=e}return a}function Bf(t,i,n,e,r,s,o,u,h,a,c){for(var f=c||[NaN,NaN],l=0,v=n.length;l<v;++l){var d=n[l];a=Pf(t,i,d,e,r,s,o,u,h,a,f),i=d}return a}function Ff(t,i,n,e){for(var r=0,s=n.length;r<s;++r)for(var o=n[r],u=0;u<e;++u)t[i++]=o[u];return i}function Nf(t,i,n,e,r){for(var s=r||[],o=0,u=0,h=n.length;u<h;++u){var a=Ff(t,i,n[u],e);i=s[o++]=a}return s.length=o,s}function Df(t,i,n,e,r,s,o){var u=(n-i)/e;if(u<3){for(;i<n;i+=e)s[o++]=t[i],s[o++]=t[i+1];return o}var h=new Array(u);h[0]=1,h[u-1]=1;for(var a,c,f,l,v,d,y=[i,n-e],p=0;0<y.length;){for(var b=y.pop(),m=y.pop(),w=0,g=t[m],M=t[m+1],k=t[b],E=t[b+1],O=m+e;O<b;O+=e){var R=t[O],T=t[O+1],S=(a=R,c=T,d=v=l=void 0,d=(f=E)-(S=M),0==(v=(R=k)-(T=g))&&0==d||(1<(l=((a-T)*v+(c-S)*d)/(v*v+d*d))?(T=R,S=f):0<l&&(T+=v*l,S+=d*l)),Xr(a,c,T,S));w<S&&(p=O,w=S)}r<w&&(h[(p-i)/e]=1,m+e<p&&y.push(m,p),p+e<b&&y.push(p,b))}for(var j=0;j<u;++j)h[j]&&(s[o++]=t[i+j*e],s[o++]=t[i+j*e+1]);return o}function Hf(t,i){return i*Math.round(t/i)}function Uf(t,i,n,e,r,s,o,u){for(var h=0,a=n.length;h<a;++h){var c=n[h];o=function(t,i,n,e,r,s,o){if(i==n)return o;var u,h=Hf(t[i],r),a=Hf(t[i+1],r);i+=e,s[o++]=h,s[o++]=a;do{if(u=Hf(t[i],r),d=Hf(t[i+1],r),(i+=e)==n)return s[o++]=u,s[o++]=d,o}while(u==h&&d==a);for(;i<n;){var c,f,l,v,d,y=Hf(t[i],r),p=Hf(t[i+1],r);i+=e,y==u&&p==d||(u=((c=u-h)*(v=p-a)==(f=d-a)*(l=y-h)&&(c<0&&l<c||c==l||0<c&&c<l)&&(f<0&&v<f||f==v||0<f&&f<v)||(h=s[o++]=u,a=s[o++]=d),y),d=p)}return s[o++]=u,s[o++]=d,o}(t,i,c,e,r,s,o),u.push(o),i=c}return o}function Vf(t,i,n,e,r){for(var s=void 0!==r?r:[],o=0,u=i;u<n;u+=e)s[o++]=t.slice(u,u+e);return s.length=o,s}function Gf(t,i,n,e,r){for(var s=void 0!==r?r:[],o=0,u=0,h=n.length;u<h;++u){var a=n[u];s[o++]=Vf(t,i,a,e,s[o]),i=a}return s.length=o,s}function zf(t,i,n,e){for(var r=0,s=t[n-e],o=t[n-e+1];i<n;i+=e){var u=t[i],h=t[i+1];r+=o*u-s*h,s=u,o=h}return r/2}function qf(t,i,n,e){for(var r=0,s=0,o=n.length;s<o;++s){var u=n[s];r+=zf(t,i,u,e),i=u}return r}function Zf(t){return(Zf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yf(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Xf(t,i){return(Xf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Wf(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Qf(n);return t=e?(t=Qf(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Zf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Qf(t){return(Qf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Kf=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Xf(t,i)}(r,Cf);var t,i,n,e=Wf(r);function r(t,i){var n;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this)).maxDelta_=-1,n.maxDeltaRevision_=-1,void 0===i||Array.isArray(t[0])?n.setCoordinates(t,i):n.setFlatCoordinates(i,t),n}return t=r,(i=[{key:"clone",value:function(){return new r(this.flatCoordinates.slice(),this.layout)}},{key:"closestPointXY",value:function(t,i,n,e){return e<Rr(this.getExtent(),t,i)?e:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(_f(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,i,n,e))}},{key:"getArea",value:function(){return zf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getCoordinates",value:function(){return Vf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getSimplifiedGeometryInternal",value:function(t){var i=[];return i.length=Df(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new r(i,pf.XY)}},{key:"getType",value:function(){return th.LINEAR_RING}},{key:"intersectsExtent",value:function(t){return!1}},{key:"setCoordinates",value:function(t,i){this.setLayout(i,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ff(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&Yf(t.prototype,i),n&&Yf(t,n),r}();function Jf(t){return(Jf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $f(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function tl(t,i){return(tl=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function il(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=nl(n);return t=e?(t=nl(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Jf(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function nl(t){return(nl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var el=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&tl(t,i)}(r,Cf);var t,i,n,e=il(r);function r(t,i){var n;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(n=e.call(this)).setCoordinates(t,i),n}return t=r,(i=[{key:"clone",value:function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,i,n,e){var r=this.flatCoordinates,i=Xr(t,i,r[0],r[1]);if(i<e){for(var s=this.stride,o=0;o<s;++o)n[o]=r[o];return n.length=s,i}return e}},{key:"getCoordinates",value:function(){return this.flatCoordinates?this.flatCoordinates.slice():[]}},{key:"computeExtent",value:function(t){return i=this.flatCoordinates,n=t,t=i[0],i=i[1],xr(t,i,t,i,n);var i,n}},{key:"getType",value:function(){return th.POINT}},{key:"intersectsExtent",value:function(t){return Sr(t,this.flatCoordinates[0],this.flatCoordinates[1])}},{key:"setCoordinates",value:function(t,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,i,n){for(var e=0,r=n.length;e<r;++e)t[i++]=n[e];return i}(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&$f(t.prototype,i),n&&$f(t,n),r}();function rl(i,n,e,r,t){var s,o;return!((t=(o=function(t){return!sl(i,n,e,r,t[0],t[1])})(Ir(s=t)))||((t=o(Pr(s)))||(t=o(Ur(s)))||!!(t=o(Hr(s))))&&t)}function sl(t,i,n,e,r,s){for(var o=0,u=t[n-e],h=t[n-e+1];i<n;i+=e){var a=t[i],c=t[i+1];h<=s?s<c&&0<(a-u)*(s-h)-(r-u)*(c-h)&&o++:c<=s&&(a-u)*(s-h)-(r-u)*(c-h)<0&&o--,u=a,h=c}return 0!==o}function ol(t,i,n,e,r,s){if(0===n.length)return!1;if(!sl(t,i,n[0],e,r,s))return!1;for(var o=1,u=n.length;o<u;++o)if(sl(t,n[o-1],n[o],e,r,s))return!1;return!0}function ul(t,i,n,e,r,s,o){for(var u,h,a,c=r[s+1],f=[],l=0,v=n.length;l<v;++l)for(var d=n[l],y=t[d-e],p=t[d-e+1],b=i;b<d;b+=e)g=t[b],a=t[b+1],(c<=p&&a<=c||p<=c&&c<=a)&&f.push(h=(c-p)/(a-p)*(g-y)+y),y=g,p=a;var m=NaN,w=-1/0;for(f.sort(Ke),y=f[0],b=1,u=f.length;b<u;++b){var g=f[b],M=Math.abs(g-y);w<M&&ol(t,i,n,e,h=(y+g)/2,c)&&(m=h,w=M),y=g}return isNaN(m)&&(m=r[s]),o?(o.push(m,c,w),o):[m,c,w]}function hl(t,i,n,e,v){var r,s,o=_r(Ar(),t,i,n,e);return Gr(v,o)&&(s=o,(r=v)[0]<=s[0]&&s[2]<=r[2]&&r[1]<=s[1]&&s[3]<=r[3]||(o[0]>=v[0]&&o[2]<=v[2]||(o[1]>=v[1]&&o[3]<=v[3]||function(t,i,n,e,r){var s;for(i+=e;i<n;i+=e)if(s=r(t.slice(i-e,i),t.slice(i,i+e)))return s;return}(t,i,n,e,function(t,i){return r=i,c=!1,f=jr(n=v,e=t),l=jr(n,r),f===Or.INTERSECTING||l===Or.INTERSECTING?c=!0:(s=n[0],o=n[1],u=n[2],i=n[3],t=e[0],n=e[1],e=r[0],t=((r=r[1])-n)/(e-t),(c=!(c=!(c=l&Or.ABOVE&&!(f&Or.ABOVE)?s<=(h=e-(r-i)/t)&&h<=u:c)&&l&Or.RIGHT&&!(f&Or.RIGHT)?o<=(a=r-(e-u)*t)&&a<=i:c)&&l&Or.BELOW&&!(f&Or.BELOW)?s<=(h=e-(r-o)/t)&&h<=u:c)||!(l&Or.LEFT)||f&Or.LEFT||(c=o<=(a=r-(e-s)*t)&&a<=i)),c;var n,e,r,s,o,u,h,a,c,f,l}))))}function al(t,i,n,e,r){if(s=t,o=i,u=n[0],!(hl(s,o,u,h=e,i=r)||(sl(s,o,u,h,i[0],i[1])||(sl(s,o,u,h,i[0],i[3])||(sl(s,o,u,h,i[2],i[1])||!!sl(s,o,u,h,i[2],i[3]))))))return!1;var s,o,u,h;if(1===n.length)return!0;for(var a=1,c=n.length;a<c;++a)if(rl(t,n[a-1],n[a],e,r)&&!hl(t,n[a-1],n[a],e,r))return!1;return!0}function cl(t,i,n,e){for(var r=0,s=t[n-e],o=t[n-e+1];i<n;i+=e){var u=t[i],h=t[i+1];r+=(u-s)*(h+o),s=u,o=h}return 0===r?void 0:0<r}function fl(t,i,n,e,r){for(var s=void 0!==r&&r,o=0,u=n.length;o<u;++o){var h=n[o],a=cl(t,i,h,e);if(0===o){if(s&&a||!s&&!a)return}else if(s&&!a||!s&&a)return;i=h}return 1}function ll(t,i,n,e,r){for(var s=void 0!==r&&r,o=0,u=n.length;o<u;++o){var h=n[o],a=cl(t,i,h,e);(0===o?s&&a||!s&&!a:s&&!a||!s&&a)&&function(t,i,n,e){for(;i<n-e;){for(var r=0;r<e;++r){var s=t[i+r];t[i+r]=t[n-e+r],t[n-e+r]=s}i+=e,n-=e}}(t,i,h,e),i=h}return i}function vl(t){return(vl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function yl(t,i){return(yl=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function pl(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=bl(n);return t=e?(t=bl(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==vl(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function bl(t){return(bl=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ml=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&yl(t,i)}(s,Cf);var t,i,n,r=pl(s);function s(t,i,n){var e;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),(e=r.call(this)).ends_=[],e.flatInteriorPointRevision_=-1,e.flatInteriorPoint_=null,e.maxDelta_=-1,e.maxDeltaRevision_=-1,e.orientedRevision_=-1,e.orientedFlatCoordinates_=null,void 0!==i&&n?(e.setFlatCoordinates(i,t),e.ends_=n):e.setCoordinates(t,i),e}return t=s,(i=[{key:"appendLinearRing",value:function(t){this.flatCoordinates?$e(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}},{key:"clone",value:function(){var t=new s(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,i,n,e){return e<Rr(this.getExtent(),t,i)?e:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(If(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Bf(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,i,n,e))}},{key:"containsXY",value:function(t,i){return ol(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,i)}},{key:"getArea",value:function(){return qf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}},{key:"getCoordinates",value:function(t){var i;return void 0!==t?ll(i=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):i=this.flatCoordinates,Gf(i,0,this.ends_,this.stride)}},{key:"getEnds",value:function(){return this.ends_}},{key:"getFlatInteriorPoint",value:function(){var t;return this.flatInteriorPointRevision_!=this.getRevision()&&(t=Br(this.getExtent()),this.flatInteriorPoint_=ul(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()),this.flatInteriorPoint_}},{key:"getInteriorPoint",value:function(){return new el(this.getFlatInteriorPoint(),pf.XYM)}},{key:"getLinearRingCount",value:function(){return this.ends_.length}},{key:"getLinearRing",value:function(t){return t<0||this.ends_.length<=t?null:new Kf(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}},{key:"getLinearRings",value:function(){for(var t=this.layout,i=this.flatCoordinates,n=this.ends_,e=[],r=0,s=0,o=n.length;s<o;++s){var u=n[s],h=new Kf(i.slice(r,u),t);e.push(h),r=u}return e}},{key:"getOrientedFlatCoordinates",value:function(){var t;return this.orientedRevision_!=this.getRevision()&&(fl(t=this.flatCoordinates,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ll(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()),this.orientedFlatCoordinates_}},{key:"getSimplifiedGeometryInternal",value:function(t){var i=[],n=[];return i.length=Uf(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),i,0,n),new s(i,pf.XY,n)}},{key:"getType",value:function(){return th.POLYGON}},{key:"intersectsExtent",value:function(t){return al(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}},{key:"setCoordinates",value:function(t,i){this.setLayout(i,t,2),this.flatCoordinates||(this.flatCoordinates=[]);t=Nf(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===t.length?0:t[t.length-1],this.changed()}}])&&dl(t.prototype,i),n&&dl(t,n),s}();function wl(t){var i=t[0],n=t[1],e=t[2],t=t[3],n=[i,n,i,t,e,t,e,n,i,n];return new ml(n,pf.XY,[n.length])}function gl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}gt=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.je=void 0!==(t=t||{}).width?t.width:2500,this.Ae=void 0!==t.length?t.length:2500,this.xe=void 0!==t.offset?t.offset:1,this.Ce=void 0===t.visible||t.visible,this.Hi=void 0!==t.mode?t.mode:Ze.AMAP_VECTOR,this.Le=!1,this._e=null,this.Ie=t.offlineUrl,void 0!==this.Ie&&(this.Le=!0),this.Pe=t.imageType,void 0===this.Pe&&(this.Pe="png"),this.Be=.4*this.je,this.Fe=.9*this.je,this.Ne=null,this.De=new Si,this.De.background=new Ci(13426943),this.De.fog=new Pi(13426943,this.Be,this.Fe),this.He=new Xe,this.De.add(this.He),this.Ue=new Ge,this.Ve=null,this.Ge=this.xe,this.ze=null,this.qe=new ne(new Jt(0,1,0),0),this.Ze=!1,this.Ye=this.Ye.bind(this),this.Xe=this.Xe.bind(this),this.We=[]}var t,n,e;return t=i,(n=[{key:"visible",get:function(){return this.Ce},set:function(t){this.Ce=t,this.De.visible=this.Ce,this.Ve.enableUpdateRender()}},{key:"addTo",value:function(t){this.Ve=t,this.Ve.getRenderManager().setTileLayScene(this.De),this.Ge=this.Ve.getFloor(this.Ve.getVisibleLevels()[0]).height-this.xe,this.O(),t.enableUpdateRender()}},{key:"remove",value:function(){this.dispose(),this.Ve.off("resize",this.Ye),this.Ve.off("viewChanged",this.Ye),this.Ve.off("viewModeChanged",this.Xe),this.Ve.off("visibleLevelsLoaded",this.Ye),this.Ve.off("zoom",this.Ye),this.Ve=null,this.Ze=!1}},{key:"dispose",value:function(){this.ze&&this.ze.dispose(),this.ze=null;for(var t=0;t<this.We.length;t++)this.We[t].parent&&this.We[t].parent.remove(this.We[t]);this.He.parent&&this.He.parent.remove(this.He),this.We.length=0,this.Ve.getRenderManager().setTileLayScene(void 0),this.Ve.enableUpdateRender()}}])&&gl(t.prototype,n),e&&gl(t,e),i}();Object.assign(gt.prototype,{O:function(){var t;this.Ze||(this.Ne=this.Ve.getContainer(),this.ze=this.Qe(),this.Ke(),this.Ve.camera.far=1e3*Ye.CAMERA_FAR,this.Ve.camera.updateProjectionMatrix(),(t=this.Ve.getZoomRange())[0]<5&&(t=[5,t[1]],this.Ve.setZoomRange(t)),this.Ve.on("resize",this.Ye),this.Ve.on("viewChanged",this.Ye),this.Ve.on("viewModeChanged",this.Xe),this.Ve.on("visibleLevelsLoaded",this.Ye),this.Ve.on("zoom",this.Ye),this.Ze=!0)},Ye:function(t){var i;"viewChanged"===t.type?(i=this.Ve.getCenter(),this._e.x===i.x&&this._e.y===i.y||this.Ke(t)):"visibleLevelsLoaded"===t.type?this.Je():"zoom"===t.type&&this.Ke()},Se:function(t){if(0!==this.We.length)for(var r=this,i=0;i<t.length;i++){var n,e=function(t){for(var i=null,n=0;n<r.We.length;n++){var e=r.We[n].imageinfo;if(t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h&&!r.We[n].isCovered){i=r.We[n];break}}return i}(t[i]);null!==e&&((n=new Wn({map:new Jn(function(t,i){var n=document.createElement("canvas");n.width=256,n.height=256;var e=n.getContext("2d");return e.drawImage(t,0,0,256,256),e.drawImage(i,0,0,256,256),n}(e.imageinfo.image,t[i].image)),depthWrite:!1})).polygonOffset=!0,n.polygonOffsetFactor=1,n.polygonOffsetUnits=4,n.map.minFilter=cn,n.needsUpdate=!0,e.material=n,e.isCovered=!0)}},Te:function(t){var i,n,e;this.Ve&&(this.$e(t),e=1,i=this.Ve.getContainer().clientWidth,n=this.Ve.getContainer().clientHeight,t=Math.max(i,n)/Math.min(i,n),"OrthographicCamera"===(i=this.Ve.camera).type?(e=1/i.zoom*t,this.De.fog.near=1e4*this.Be,this.De.fog.far=1e4*this.Fe):(e=(n=this.Ue.ray.distanceToPlane(this.qe))*Math.tan(i.fov*Ye.DEG2RAD/2)*2*t/(this.je/2),t<1.5&&(t=1.5),t=n*Math.tan(i.fov*Ye.DEG2RAD/2)*2*t/(this.je/2),this.De.fog.near=this.Be*t,this.De.fog.far=this.Fe*t),this.He.scale.set(e,e,e),this.Ve.getRenderManager().render())},$e:function(t){for(var i=0;i<this.We.length;i++)this.We[i].visible=!1;if(0===this.We.length)for(var n=0;n<t.length;n++){var e=new Zn(256,256),r=new Wn({map:new Jn(m(t[n].image)),depthWrite:!1});r.polygonOffset=!0,r.polygonOffsetFactor=1,r.polygonOffsetUnits=4;r=new He(e,r);r.material.map.minFilter=cn,r.material.needsUpdate=!0,r.src=t[n].image.src,r.imageinfo=t[n],r.scale.set(t[n].w/256,t[n].h/256,1),r.position.x=t[n].x+t[n].w/2-this.je/2,r.position.z=t[n].y+t[n].h/2-this.Ae/2,r.rotation.x=-Math.PI/2,this.He.add(r),this.We.push(r)}else{for(var s=[],o=[],u=0;u<t.length;u++){var h,a=function(t,i){for(var n=null,e=0;e<t.length;e++)if(t[e].src===i){n=e;break}return n}(this.We,t[u].image.src);null!==a&&((h=this.We[a]).scale.set(t[u].w/256,t[u].h/256,1),h.imageinfo=t[u],h.position.x=t[u].x+t[u].w/2-this.je/2,h.position.z=t[u].y+t[u].h/2-this.Ae/2,h.visible=!0,s.push(h),this.We.splice(a,1),o.push(u))}t=b(o,t);for(var c=o.length=0;c<t.length&&0!==this.We.length;c++){var f=this.We.splice(0,1)[0];f.material.map.dispose(),f.material.dispose();var l=new Wn({map:new Jn(m(t[c].image)),depthWrite:!1});l.polygonOffset=!0,l.polygonOffsetFactor=1,l.polygonOffsetUnits=4,l.map.minFilter=cn,l.needsUpdate=!0,f.material=l,f.scale.set(t[c].w/256,t[c].h/256,1),f.position.x=t[c].x+t[c].w/2-this.je/2,f.position.z=t[c].y+t[c].h/2-this.Ae/2,f.src=t[c].image.src,f.imageinfo=t[c],f.visible=!0,s.push(f),o.push(c)}t=b(o,t);for(var v=0;v<t.length;v++){var d=new Zn(256,256),y=new Wn({map:new Jn(m(t[v].image)),depthWrite:!1});y.polygonOffset=!0,y.polygonOffsetFactor=1,y.polygonOffsetUnits=4;y=new He(d,y);y.material.map.minFilter=cn,y.material.needsUpdate=!0,y.src=t[v].image.src,y.scale.set(t[v].w/256,t[v].h/256,1),y.position.x=t[v].x+t[v].w/2-this.je/2,y.position.z=t[v].y+t[v].h/2-this.Ae/2,y.rotation.x=-Math.PI/2,y.imageinfo=t[v],this.He.add(y),s.push(y)}if(0<this.We.length){for(var p=0;p<this.We.length;p++)this.We[p].parent&&this.We[p].parent.remove(this.We[p]);this.We.length=0}this.We=s}function b(t,i){for(var n=[],e=0;e<i.length;e++)!function(t,i){for(var n=!0,e=0;e<t.length;e++)if(t[e]===i){n=!1;break}return n}(t,e)||n.push(i[e]);return n}function m(t){var i=document.createElement("canvas");return i.width=256,i.height=256,i.getContext("2d").drawImage(t,0,0,256,256),i}this.He.position.y=this.Ge},Qe:function(){var e=this,t=oh("EPSG:3857");if(this.Hi===Ze.AMAP_SATELLITE||this.Hi===Ze.AMAP_VECTOR){var i={url:this.tr(),crossOrigin:"anonymous",maxZoom:19,thirdMap:this};this.Hi===Ze.AMAP_SATELLITE&&(i.maxZoom=18),s=new wc(i)}else if(this.Hi===Ze.BAIDU_VECTOR||this.Hi===Ze.BAIDU_SATELLITE){for(var n=[],r=0;r<19;r++)n[r]=Math.pow(2,18-r);var i=new Ha({origin:[0,0],resolutions:n}),s=new dc({projection:t,crossOrigin:"anonymous",tileGrid:i,tileUrlFunction:function(t){if(!t)return"";var i=t[0],n=t[1],t=-t[2]-1;return e.ir(n=n<0?"M"+-n:n,t=t<0?"M"+-t:t,i)}})}else this.Hi===Ze.OSM?s=new Rc:(s=new wc({url:this.nr()[0],crossOrigin:"anonymous",tileSize:[512,512],maxZoom:18}),o=new wc({url:this.nr()[1],crossOrigin:"anonymous",tileSize:[512,512],maxZoom:18}));s=new Jh({size:[this.je,this.Ae],view:new Bh({projection:t}),layers:[new yf({layercount:1,source:s,thirdMap:this}),new yf({layercount:2,source:o,thirdMap:this})]});s.setTarget(this.Ne);var o=wl([this.Ve.x-this.je/4,(this.Ve.y-this.Ge)/4,this.Ve.x+this.je/4,this.Ve.y+this.Ge/4]);return s.getView().fit(o),s},tr:function(){var t;if(this.Le)t=this.Ie+"/{z}/{x}/{y}."+this.Pe;else switch(this.Hi){case Ze.AMAP_SATELLITE:t="http://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=6&x={x}&y={y}&z={z}";break;case Ze.AMAP_VECTOR:default:t="https://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=2&style=7&x={x}&y={y}&z={z}"}return t},ir:function(t,i,n){var e;switch(this.Hi){case Ze.BAIDU_SATELLITE:e="https://gss0.bdstatic.com/5bwHcj7lABFY8t_jkk_Z1zRvfdw6buu/it/u=x="+t+";y="+i+";z="+n+";v=009;type=sate&fm=46&udt=20210415&scaler=2";break;case Ze.BAIDU_VECTOR:default:e="https://maponline"+parseInt(4*Math.random())+".bdimg.com/tile/?qt=vtile&x="+t+"&y="+i+"&z="+n+"&styles=pl&scaler=2&udt=20210415&from=jsapi2_0&scaler=2"}return e},nr:function(){var t;switch(this.Hi){case Ze.TD_SATELLITE:(t=[]).push("http://t{0-7}.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&Layer=img&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=9a8b557e9db74e442bd9544001392255"),t.push("https://t{0-7}.tianditu.gov.cn/cia_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cia&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=9a8b557e9db74e442bd9544001392255");break;case Ze.TD_VECTOR:default:(t=[]).push("http://t{0-7}.tianditu.gov.cn/vec_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&Layer=vec&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=9a8b557e9db74e442bd9544001392255"),t.push("https://t{0-7}.tianditu.gov.cn/cva_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=cva&STYLE=default&TILEMATRIXSET=w&FORMAT=png&TILECOL={x}&TILEROW={y}&TILEMATRIX={z}&tk=9a8b557e9db74e442bd9544001392255")}return t},er:function(){this.rr.setSize(this.Ve.getContainer().clientWidth,this.Ve.getContainer().clientHeight)},Xe:function(){var t=this.Ve.camera,i=this.Ve.getContainer().clientWidth,n=this.Ve.getContainer().clientHeight,n=Math.max(i,n)/Math.min(i,n);t.far===Ye.CAMERA_FAR&&(t.far=1e3*Ye.CAMERA_FAR,t.updateProjectionMatrix()),"OrthographicCamera"===t.type?(this.De.fog.near=1e4*this.Be,this.De.fog.far=1e4*this.Fe):(n<1.5&&(n=1.5),n=this.Ue.ray.distanceToPlane(this.qe)*Math.tan(t.fov*Ye.DEG2RAD/2)*2*n/(this.je/2),this.De.fog.near=this.Be*n,this.De.fog.far=this.Fe*n)},Ke:function(t){var i,n,e,r;this.sr&&t&&t.target&&t.target.target&&t.target.target.x===this.sr.x&&t.target.target.z===this.sr.z||(t&&t.target&&t.target.target&&(this.sr={x:t.target.target.x,y:t.target.target.y,z:t.target.target.z}),e=new Jt(0,0,.5),n=this.Ve.camera,this.Ue.setFromCamera(e,n),i=new Jt,this.Ue.ray.intersectPlane(this.qe,i),r=1,t=this.Ve.getContainer().clientWidth,e=this.Ve.getContainer().clientHeight,e=Math.max(t,e)/Math.min(t,e),r="OrthographicCamera"===n.type?1/n.zoom*e:this.Ue.ray.distanceToPlane(this.qe)*Math.tan(n.fov*Ye.DEG2RAD/2)*2*e/(this.je/2),n=i.x+this.Ve.x,e=-i.z+this.Ve.y,r=this.je/2*r,this.He.position.x=i.x,this.He.position.z=i.z,r=wl([n-r,e-r,n+r,e+r]),this.ze.getView().fit(r),r=this.Ve.getCenter(),this._e={x:r.x,y:r.y})},Je:function(){this.Ge=this.Ve.getFloor(this.Ve.getVisibleLevels()[0]).height-this.xe,this.He.position.y=this.Ge}});jt=gt;function Ml(t){try{i=new URL(t,"http://fakehost.com/")}catch(t){return null}var t=i.pathname.split("/").pop(),i=t.lastIndexOf(".");return-1===i||i===t.length-1?null:t.substring(i+1)}function kl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var El=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxSize=800,this.minSize=600,this.unloadPercent=.05,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadPriorityCallback=null;var i=this.itemSet;this.defaultPriorityCallback=function(t){return i.get(t)}}var i,n,e;return i=t,(n=[{key:"isFull",value:function(){return this.itemSet.size>=this.maxSize}},{key:"add",value:function(t,i){var n=this.itemSet;if(n.has(t))return!1;if(this.isFull())return!1;var e=this.usedSet,r=this.itemList,s=this.callbacks;return r.push(t),e.add(t),n.set(t,Date.now()),s.set(t,i),!0}},{key:"remove",value:function(t){var i=this.usedSet,n=this.itemSet,e=this.itemList,r=this.callbacks;if(n.has(t)){r.get(t)(t);var s=e.indexOf(t);return e.splice(s,1),i.delete(t),n.delete(t),r.delete(t),!0}return!1}},{key:"markUsed",value:function(t){var i=this.itemSet,n=this.usedSet;i.has(t)&&!n.has(t)&&(i.set(t,Date.now()),n.add(t))}},{key:"markAllUnused",value:function(){this.usedSet.clear()}},{key:"unloadUnusedContent",value:function(){var t=this.unloadPercent,i=this.minSize,n=this.itemList,e=this.itemSet,r=this.usedSet,s=this.callbacks,o=n.length-r.size,u=n.length-i,h=this.unloadPriorityCallback||this.defaultPriorityCallback;if(0<u&&0<o){n.sort(function(t,i){var n=r.has(t),e=r.has(i);return n&&e?0:n||e?n?1:-1:h(i)-h(t)});for(var u=Math.min(u,o),t=Math.max(i*t,u*t),o=Math.min(t,o),o=Math.ceil(o),a=n.splice(0,o),c=0,f=a.length;c<f;c++){var l=a[c];s.get(l)(l),e.delete(l),s.delete(l)}}}},{key:"scheduleUnload",value:function(){var t=this,i=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.scheduled||(this.scheduled=!0,Promise.resolve().then(function(){t.scheduled=!1,t.unloadUnusedContent(),i&&t.markAllUnused()}))}}])&&kl(i.prototype,n),e&&kl(i,e),t}();function Ol(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Rl=function(){function i(){var t=this;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=function(){throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=function(t){requestAnimationFrame(t)},this.or=function(){t.tryRunJobs(),t.scheduled=!1}}var t,n,e;return t=i,(n=[{key:"sort",value:function(){var t=this.priorityCallback;this.items.sort(t)}},{key:"add",value:function(r,s){var o=this;return new Promise(function(t,i){var n=o.items,e=o.callbacks;n.push(r),e.set(r,function(){return s.apply(void 0,arguments).then(t).catch(i)}),o.autoUpdate&&o.scheduleJobRun()})}},{key:"remove",value:function(t){var i=this.items,n=this.callbacks,e=i.indexOf(t);-1!==e&&(i.splice(e,1),n.delete(t))}},{key:"tryRunJobs",value:function(){var t=this;this.sort();for(var i=this.items,n=this.callbacks,e=this.maxJobs,r=this.currJobs;r<e&&0<i.length;){r++;var s=i.pop(),o=n.get(s);n.delete(s),o(s).then(function(){t.currJobs--,t.autoUpdate&&t.scheduleJobRun()}).catch(function(){t.currJobs--,t.autoUpdate&&t.scheduleJobRun()})}this.currJobs=r}},{key:"scheduleJobRun",value:function(){this.scheduled||(this.schedulingCallback(this.or),this.scheduled=!0)}}])&&Ol(t.prototype,n),e&&Ol(t,e),i}(),Tl=3,Sl=4,jl=6378137;function Al(t){return t===Tl||t===Sl}function xl(t,i){return t.ur===i&&t.hr}function Cl(t,i){t.ur!==i&&(t.ur=i,t.hr=!1,t.ar=!1,t.cr=!1,t.fr=!1,t.lr=!1,t.vr=1/0,t.dr=1/0,t.yr=!1,t.pr=!1)}function Ll(t,i,n,e,r){var s=1<arguments.length&&void 0!==i?i:null,o=2<arguments.length&&void 0!==n?n:null,e=3<arguments.length&&void 0!==e?e:null,u=4<arguments.length&&void 0!==r?r:0;if(s&&s(t,e,u))o&&o(t,e,u);else{for(var h=t.children,a=0,c=h.length;a<c;a++)Ll(h[a],s,o,t,u+1);o&&o(t,e,u)}}function _l(t,i){var n=i.stats,e=i.frameCount,r=i.errorTarget,s=i.maxDepth,o=i.loadSiblings,u=i.lruCache,h=i.stopAtEmptyTiles;if(Cl(t,e),!1===i.tileInView(t))return!1;if(t.hr=!0,u.markUsed(t),t.ar=!0,n.inFrustum++,(h||!t.br)&&!t.mr){if(i.calculateError(t),t.vr<=r)return!0;if(0<i.maxDepth&&t.wr+1>=s)return!0}for(var a=!1,c=t.children,f=0,l=c.length;f<l;f++)var v=_l(c[f],i),a=a||v;if(a&&o)for(var d=0,y=c.length;d<y;d++)!function t(i,n,e){if(Cl(i,n),i.hr=!0,e.markUsed(i),i.br)for(var r=i.children,s=0,o=r.length;s<o;s++)t(r[s],n,e)}(c[d],e,u);return!0}function Il(t,i){var n=i.stats,e=i.frameCount;if(xl(t,e)){var r=t.parent,s=r?r.gr:-1;t.gr=s;var o=i.lruCache;if(t.cr)return t.gr++,void(t.Mr===Tl?(t.ar&&(t.fr=!0,n.visible++),t.lr=!0,n.active++):o.isFull()||t.br&&!t.mr||i.requestTileContents(t));var u=(i.errorTarget+1)*i.errorThreshold,h=t.vr<=u,a=h||"ADD"===t.refine,c=!t.br,f=c||t.mr,r=Al(t.Mr)&&f,s=t.yr,l=t.children,u=t.pr;if(a&&c&&t.gr++,a&&!r&&!o.isFull()&&f&&i.requestTileContents(t),(h&&!u&&!s&&r||"ADD"===t.refine&&r)&&(t.ar&&(t.fr=!0,n.visible++),t.lr=!0,n.active++),"ADD"!==t.refine&&h&&!u&&r)for(var v=0,d=l.length;v<d;v++){var y=l[v];xl(y,e)&&!o.isFull()&&(y.gr=t.gr+1,function t(i,n,e){if(!i.br||i.mr&&!Al(i.Mr))e.requestTileContents(i);else for(var r=i.children,s=0,o=r.length;s<o;s++){var u=r[s];u.gr=n,t(u,n,e)}}(y,y.gr,i))}else for(var p=0,b=l.length;p<b;p++){var m=l[p];xl(m,e)&&Il(m,i)}}}function Pl(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}function Bl(o,t){var u=1<arguments.length&&void 0!==t?t:{};return new Promise(function(i,n){var t=u.method||"GET",e=u.responseType||"json",r=u.xhr||new XMLHttpRequest;r.addEventListener("timeout",function(){n({errorType:"timeout_error",xhr:r})}),r.addEventListener("error",function(t){n({errorType:"onerror",xhr:r,error:t})});var s={arraybuffer:"arrayBuffer",json:"json"};r.addEventListener("load",function(){var t;200===r.status||0===r.status||201===r.status?(Pl(t={},s[e],function(){return r.response}),Pl(t,"ok",!0),i(t)):n({errorType:"loadError",xhr:r})}),"POST"===t?(r.open("POST",o,!0),r.responseType=e,r.setRequestHeader("Accept","application/json"),r.send(JSON.parse(u.data))):(r.open("GET",o,!0),r.responseType=e,r.send())})}function Fl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Nl=function(t,i){return t.wr!==i.wr?t.wr>i.wr?-1:1:t.ar!==i.ar?t.ar?1:-1:t.hr!==i.hr?t.hr?1:-1:t.vr!==i.vr?t.vr>i.vr?1:-1:t.dr!==i.dr?t.dr>i.dr?-1:1:0},Dl=function(t){return 1/(t.gr+1)},Hl=function(){function e(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.tileSets={},this.rootURL=t,this.fetchOptions={},this.preprocessURL=null;var i=new El;i.unloadPriorityCallback=Dl;var n=new Rl;n.maxJobs=4,n.priorityCallback=Nl;t=new Rl;t.maxJobs=1,t.priorityCallback=Nl,this.lruCache=i,this.downloadQueue=n,this.parseQueue=t,this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this.errorTarget=6,this.errorThreshold=1/0,this.loadSiblings=!0,this.displayActiveTiles=!1,this.maxDepth=1/0,this.stopAtEmptyTiles=!0}var t,i,n;return t=e,(i=[{key:"rootTileSet",get:function(){var t=this.tileSets[this.rootURL];return!t||t instanceof Promise?null:t}},{key:"root",get:function(){var t=this.rootTileSet;return t?t.root:null}},{key:"traverse",value:function(t,i){var n=this.tileSets[this.rootURL];n&&n.root&&Ll(n.root,t,i)}},{key:"update",value:function(){var t=this.stats,i=this.lruCache,n=this.tileSets,e=n[this.rootURL];this.rootURL in n?e&&e.root&&(e=e.root,t.inFrustum=0,t.used=0,t.active=0,t.visible=0,this.frameCount++,_l(e,this),function t(i,n){var e=n.stats,r=n.frameCount;if(xl(i,r)){e.used++;for(var s=i.children,o=!1,u=0,h=s.length;u<h;u++)var a=s[u],o=o||xl(a,r);if(o){for(var c=!1,f=!0,l=0,v=s.length;l<v;l++){var d=s[l];t(d,n),c=c||d.kr||d.yr,xl(d,r)&&(d=d.pr||!d.br&&Al(d.Mr)||d.mr&&d.Mr===Sl,f=f&&d)}i.yr=c,i.pr=f}else i.cr=!0}}(e,this),Il(e,this),function t(i,n){var e=xl(i,n.frameCount);if(e||i.Er){var r=!1,s=!1;e&&(r=i.lr,s=n.displayActiveTiles&&i.lr||i.fr),i.br||i.Mr!==Tl||(i.Or!==r&&n.setTileActive(i,r),i.kr!==s&&n.setTileVisible(i,s)),i.Or=r,i.kr=s,i.Er=e;for(var o=i.children,u=0,h=o.length;u<h;u++)t(o[u],n)}}(e,this),i.scheduleUnload()):this.loadRootTileSet(this.rootURL)}},{key:"parseTile",value:function(t,i,n){return null}},{key:"disposeTile",value:function(t){}},{key:"preprocessNode",value:function(t,i,n){t.content&&(!("uri"in t.content)&&"url"in t.content&&(t.content.uri=t.content.url,delete t.content.url),t.content.uri&&(t.content.uri=new URL(t.content.uri,n+"/").toString()),t.content.boundingVolume&&!("box"in t.content.boundingVolume||"sphere"in t.content.boundingVolume||"region"in t.content.boundingVolume)&&delete t.content.boundingVolume),t.parent=i,t.children=t.children||[],t.content&&t.content.uri?(n=Ml(t.content.uri),n=Boolean(n&&"json"===n.toLowerCase()),t.mr=n,t.br=n):(t.mr=!1,t.br=!0),t.dr=1/0,t.vr=1/0,t.ar=!1,t.cr=!1,t.Er=!1,t.hr=!1,t.kr=!1,t.fr=!1,t.yr=!1,t.pr=!1,t.Or=!1,t.lr=!1,t.Mr=0,t.Rr=0,t.Tr=null,t.gr=-1,null===i?(t.wr=0,t.refine=t.refine||"REPLACE"):(t.wr=i.wr+1,t.refine=t.refine||i.refine)}},{key:"setTileActive",value:function(t,i){}},{key:"setTileVisible",value:function(t,i){}},{key:"calculateError",value:function(t){return 0}},{key:"tileInView",value:function(t){return!0}},{key:"resetFailedTiles",value:function(){var t=this.stats;0!==t.failed&&(this.traverse(function(t){t.Mr===Sl&&(t.Mr=0)}),t.failed=0)}},{key:"fetchTileSet",value:function(e,t){var r=this,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Bl(e,t).then(function(t){if(t.ok)return t.json();throw new Error('TilesRenderer: Failed to load tileset "'.concat(e,'" with status ').concat(t.status," : ").concat(t.statusText))}).then(function(t){var i=t.asset.version;console.assert("1.0"===i||"0.0"===i,'asset.version is expected to be a string of "1.0" or "0.0"');var n=e.replace(/\/[^\/]*\/?$/,""),n=new URL(n,window.location.href).toString();return Ll(t.root,function(t,i){return r.preprocessNode(t,i,n)},null,s,s?s.wr:0),t})}},{key:"loadRootTileSet",value:function(i){var n=this.tileSets;if(i in n)return n[i]instanceof Error?Promise.reject(n[i]):Promise.resolve(n[i]);var t=this.fetchTileSet(this.preprocessURL?this.preprocessURL(i):i,this.fetchOptions).then(function(t){n[i]=t});return t.catch(function(t){console.error(t),n[i]=t}),n[i]=t}},{key:"requestTileContents",value:function(i){var e,n,r,s,o,u,h,t,a=this;0===i.Mr&&(e=this.stats,n=this.lruCache,r=this.downloadQueue,s=this.parseQueue,o=i.mr,n.add(i,function(t){1===t.Mr?(t.Tr.abort(),t.Tr=null):o?t.children.length=0:a.disposeTile(t),1===t.Mr?e.downloading--:2===t.Mr&&e.parsing--,t.Mr=0,t.Rr++,s.remove(t),r.remove(t)}),i.Rr++,u=i.Rr,h=new XMLHttpRequest,e.downloading++,i.Tr={abort:h.abort.bind(h)},i.Mr=1,t=function(t){i.Rr===u&&("AbortError"!==t.name?(s.remove(i),r.remove(i),2===i.Mr?e.parsing--:1===i.Mr&&e.downloading--,e.failed++,console.error('TilesRenderer : Failed to load tile at url "'.concat(i.content.uri,'".')),console.error(t),i.Mr=Sl):n.remove(i))},(o?r.add(i,function(t){if(t.Rr!==u)return Promise.resolve();var i=a.preprocessURL?a.preprocessURL(t.content.uri):t.content.uri;return a.fetchTileSet(i,Object.assign({xhr:h,responseType:"json"},a.fetchOptions),t)}).then(function(t){i.Rr===u&&(e.downloading--,i.Tr=null,i.Mr=Tl,i.children.push(t.root))}):r.add(i,function(t){return t.Rr!==u?Promise.resolve():Bl(a.preprocessURL?a.preprocessURL(t.content.uri):t.content.uri,Object.assign({xhr:h,responseType:"arraybuffer"},a.fetchOptions))}).then(function(t){if(i.Rr===u){if(t.ok)return t.arrayBuffer();throw new Error("Failed to load model with error code ".concat(t.status))}}).then(function(n){if(i.Rr===u)return e.downloading--,e.parsing++,i.Tr=null,i.Mr=2,s.add(i,function(t){if(t.Rr!==u)return Promise.resolve();var i=Ml(t.content.uri);return a.parseTile(n,t,i)})}).then(function(){i.Rr===u&&(e.parsing--,i.Mr=Tl,i.kr&&a.setTileVisible(i,!0),i.Or&&a.setTileActive(i,!0))})).catch(t))}},{key:"dispose",value:function(){var i=this.lruCache;this.traverse(function(t){i.remove(t)}),this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}}])&&Fl(t.prototype,i),n&&Fl(t,n),e}();function Ul(t){return(Ul="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vl(t,i,n){return(Vl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=ql(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Gl(t,i){return(Gl=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function zl(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ql(n);return t=e?(t=ql(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Ul(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function ql(t){return(ql=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zl(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function Yl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Xl(t,i,n){return i&&Yl(t.prototype,i),n&&Yl(t,n),t}var Wl=function(){function r(t,i,n,e){Zl(this,r),this.buffer=t,this.binOffset=i+n,this.binLength=e;e=null;e=0!==n?(n=new Uint8Array(t,i,n),JSON.parse((n=n,(new TextDecoder).decode(n)))):{},this.header=e}return Xl(r,[{key:"getKeys",value:function(){return Object.keys(this.header)}},{key:"getData",value:function(t,i){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=this.header;if(!(t in r))return null;var s=r[t];if(s instanceof Object){if(Array.isArray(s))return s;var o,u,h=this.buffer,a=this.binOffset,c=this.binLength,f=s.byteOffset||0,r=s.type||e,n=s.componentType||n;if("type"in s&&e&&s.type!==e)throw new Error("FeatureTable: Specified type does not match expected type.");switch(r){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error('FeatureTable : Feature type not provided for "'.concat(t,'".'))}var l=a+f,v=i*o;switch(n){case"BYTE":u=new Int8Array(h,l,v);break;case"UNSIGNED_BYTE":u=new Uint8Array(h,l,v);break;case"SHORT":u=new Int16Array(h,l,v);break;case"UNSIGNED_SHORT":u=new Uint16Array(h,l,v);break;case"INT":u=new Int32Array(h,l,v);break;case"UNSIGNED_INT":u=new Uint32Array(h,l,v);break;case"FLOAT":u=new Float32Array(h,l,v);break;case"DOUBLE":u=new Float64Array(h,l,v);break;default:throw new Error('FeatureTable : Feature component type not provided for "'.concat(t,'".'))}if(a+c<l+v*u.BYTES_PER_ELEMENT)throw new Error("FeatureTable: Feature data read outside binary body length.");return u}return s}}]),r}(),Ql=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Gl(t,i)}(o,Wl);var s=zl(o);function o(t,i,n,e,r){return Zl(this,o),(r=s.call(this,t,n,e,r)).batchSize=i,r}return Xl(o,[{key:"getData",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return Vl(ql(o.prototype),"getData",this).call(this,t,this.batchSize,i,n)}}]),o}();function Kl(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}var Jl=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.fetchOptions={},this.workingPath=""}var i,n,e;return i=t,(n=[{key:"load",value:function(i){var n=this;return fetch(i,this.fetchOptions).then(function(t){if(!t.ok)throw new Error('Failed to load file "'.concat(i,'" with status ').concat(t.status," : ").concat(t.statusText));return t.arrayBuffer()}).then(function(t){return""===n.workingPath&&(n.workingPath=n.workingPathForURL(i)),n.parse(t)})}},{key:"resolveExternalURL",value:function(t){return/^[^\\/]/.test(t)?this.workingPath+"/"+t:t}},{key:"workingPathForURL",value:function(t){t=t.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}},{key:"parse",value:function(t){throw new Error("LoaderBase: Parse not implemented.")}}])&&Kl(i.prototype,n),e&&Kl(i,e),t}();function $l(t){var i=t instanceof DataView?t:new DataView(t);if("{"===String.fromCharCode(i.getUint8(0)))return null;for(var n="",e=0;e<4;e++)n+=String.fromCharCode(i.getUint8(e));return n}function tv(t){return(tv="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function iv(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function nv(t,i){return(nv=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function ev(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=rv(n);return t=e?(t=rv(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==tv(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function rv(t){return(rv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var sv=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&nv(t,i)}(r,Jl);var t,i,n,e=ev(r);function r(){return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),e.apply(this,arguments)}return t=r,(i=[{key:"parse",value:function(t){var i=new DataView(t),n=$l(i);console.assert("b3dm"===n);var e=i.getUint32(4,!0);console.assert(1===e);var r=i.getUint32(8,!0);console.assert(r===t.byteLength);var s=i.getUint32(12,!0),o=i.getUint32(16,!0),u=i.getUint32(20,!0),n=i.getUint32(24,!0),i=t.slice(28,28+s+o),i=new Wl(i,0,s,o),s=28+s+o,o=t.slice(s,s+u+n),o=new Ql(o,i.getData("BATCH_LENGTH"),0,u,n),n=s+u+n;return{version:e,featureTable:i,batchTable:o,glbBytes:new Uint8Array(t,n,r-n)}}}])&&iv(t.prototype,i),n&&iv(t,n),r}();function ov(t,i,n){var e=this,r=!1,s=0,o=0,u=void 0,h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=n,this.itemStart=function(t){o++,!1===r&&void 0!==e.onStart&&e.onStart(t,s,o),r=!0},this.itemEnd=function(t){s++,void 0!==e.onProgress&&e.onProgress(t,s,o),s===o&&(r=!1,void 0!==e.onLoad&&e.onLoad())},this.itemError=function(t){void 0!==e.onError&&e.onError(t)},this.resolveURL=function(t){return u?u(t):t},this.setURLModifier=function(t){return u=t,this},this.addHandler=function(t,i){return h.push(t,i),this},this.removeHandler=function(t){t=h.indexOf(t);return-1!==t&&h.splice(t,2),this},this.getHandler=function(t){for(var i=0,n=h.length;i<n;i+=2){var e=h[i],r=h[i+1];if(e.global&&(e.lastIndex=0),e.test(t))return r}return null},this.isLoaded=function(){return s===o}}var uv=new ov;function hv(t,i){Ti.call(this),this.type="Light",this.color=new Ci(t),this.intensity=void 0!==i?i:1,this.receiveShadow=void 0}hv.prototype=Object.assign(Object.create(Ti.prototype),{constructor:hv,isLight:!0,copy:function(t){return Ti.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this}});var av=new Bn,cv=new Jt;function fv(t,i,n,e,r,s){this.planes=[void 0!==t?t:new ne,void 0!==i?i:new ne,void 0!==n?n:new ne,void 0!==e?e:new ne,void 0!==r?r:new ne,void 0!==s?s:new ne]}function lv(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Ji(512,512),this.map=null,this.mapPass=null,this.matrix=new oi,this.Sr=new fv,this.jr=new Ji(1,1),this.Ar=1,this.xr=[new Ki(0,0,1,1)]}function vv(){Ti.call(this),this.type="Camera",this.matrixWorldInverse=new oi,this.projectionMatrix=new oi,this.projectionMatrixInverse=new oi}function dv(t,i,n,e,r,s){vv.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==i?i:1,this.top=void 0!==n?n:1,this.bottom=void 0!==e?e:-1,this.near=void 0!==r?r:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()}function yv(){lv.call(this,new dv(-5,5,5,-5,.5,500))}function pv(t,i){hv.call(this,t,i),this.type="DirectionalLight",this.position.copy(Ti.DefaultUp),this.updateMatrix(),this.target=new Ti,this.shadow=new yv}Object.assign(fv.prototype,{set:function(t,i,n,e,r,s){var o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(n),o[3].copy(e),o[4].copy(r),o[5].copy(s),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var i=this.planes,n=0;n<6;n++)i[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){var i=this.planes,n=t.elements,e=n[0],r=n[1],s=n[2],o=n[3],u=n[4],h=n[5],a=n[6],c=n[7],f=n[8],l=n[9],v=n[10],d=n[11],y=n[12],p=n[13],t=n[14],n=n[15];return i[0].setComponents(o-e,c-u,d-f,n-y).normalize(),i[1].setComponents(o+e,c+u,d+f,n+y).normalize(),i[2].setComponents(o+r,c+h,d+l,n+p).normalize(),i[3].setComponents(o-r,c-h,d-l,n-p).normalize(),i[4].setComponents(o-s,c-a,d-v,n-t).normalize(),i[5].setComponents(o+s,c+a,d+v,n+t).normalize(),this},intersectsObject:function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),av.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(av)},intersectsSprite:function(t){return av.center.set(0,0,0),av.radius=.7071067811865476,av.applyMatrix4(t.matrixWorld),this.intersectsSphere(av)},intersectsSphere:function(t){for(var i=this.planes,n=t.center,e=-t.radius,r=0;r<6;r++)if(i[r].distanceToPoint(n)<e)return!1;return!0},intersectsBox:function(t){for(var i=this.planes,n=0;n<6;n++){var e=i[n];if(cv.x=(0<e.normal.x?t.max:t.min).x,cv.y=(0<e.normal.y?t.max:t.min).y,cv.z=(0<e.normal.z?t.max:t.min).z,e.distanceToPoint(cv)<0)return!1}return!0},containsPoint:function(t){for(var i=this.planes,n=0;n<6;n++)if(i[n].distanceToPoint(t)<0)return!1;return!0}}),Object.assign(lv.prototype,{Cr:new oi,Lr:new Jt,_r:new Jt,getViewportCount:function(){return this.Ar},getFrustum:function(){return this.Sr},updateMatrices:function(t){var i=this.camera,n=this.matrix,e=this.Cr,r=this._r,s=this.Lr;s.setFromMatrixPosition(t.matrixWorld),i.position.copy(s),r.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(r),i.updateMatrixWorld(),e.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this.Sr.setFromProjectionMatrix(e),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(i.projectionMatrix),n.multiply(i.matrixWorldInverse)},getViewport:function(t){return this.xr[t]},getFrameExtents:function(){return this.jr},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)}}),vv.prototype=Object.assign(Object.create(Ti.prototype),{constructor:vv,isCamera:!0,copy:function(t,i){return Ti.prototype.copy.call(this,t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Jt),this.updateMatrixWorld(!0);var i=this.matrixWorld.elements;return t.set(-i[8],-i[9],-i[10]).normalize()},updateMatrixWorld:function(t){Ti.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,i){Ti.prototype.updateWorldMatrix.call(this,t,i),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),dv.prototype=Object.assign(Object.create(vv.prototype),{constructor:dv,isOrthographicCamera:!0,copy:function(t,i){return vv.prototype.copy.call(this,t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,i,n,e,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=e,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,e=(this.top+this.bottom)/2,r=n-t,s=n+t,n=e+i,t=e-i;null!==this.view&&this.view.enabled&&(e=(this.right-this.left)/this.view.fullWidth/this.zoom,i=(this.top-this.bottom)/this.view.fullHeight/this.zoom,s=(r+=e*this.view.offsetX)+e*this.view.width,t=(n-=i*this.view.offsetY)-i*this.view.height),this.projectionMatrix.makeOrthographic(r,s,n,t,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}),yv.prototype=Object.assign(Object.create(lv.prototype),{constructor:yv,isDirectionalLightShadow:!0,updateMatrices:function(t){lv.prototype.updateMatrices.call(this,t)}}),pv.prototype=Object.assign(Object.create(hv.prototype),{constructor:pv,isDirectionalLight:!0,copy:function(t){return hv.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});var bv={enabled:!1,files:{},add:function(t,i){!1!==this.enabled&&(this.files[t]=i)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function mv(t){zv.call(this,t)}function wv(t){zv.call(this,t)}function gv(t){Xn.call(this),this.type="ShadowMaterial",this.color=new Ci(0),this.transparent=!0,this.setValues(t)}function Mv(t){Xn.call(this),this.type="SpriteMaterial",this.color=new Ci(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}function kv(t){var i,n={};for(i in t)for(var e in n[i]={},t[i]){var r=t[i][e];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?n[i][e]=r.clone():Array.isArray(r)?n[i][e]=r.slice():n[i][e]=r}return n}mv.prototype=Object.assign(Object.create(zv.prototype),{constructor:mv,load:function(i,t,n,e){void 0!==this.path&&(i=this.path+i),i=this.manager.resolveURL(i);var r=this,s=bv.get(i);if(void 0!==s)return r.manager.itemStart(i),setTimeout(function(){t&&t(s),r.manager.itemEnd(i)},0),s;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function u(){o.removeEventListener("load",u,!1),o.removeEventListener("error",h,!1),bv.add(i,this),t&&t(this),r.manager.itemEnd(i)}function h(t){o.removeEventListener("load",u,!1),o.removeEventListener("error",h,!1),e&&e(t),r.manager.itemError(i),r.manager.itemEnd(i)}return o.addEventListener("load",u,!1),o.addEventListener("error",h,!1),"data:"!==i.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(i),o.src=i,o}}),wv.prototype=Object.assign(Object.create(zv.prototype),{constructor:wv,load:function(i,n,t,e){var r=new Kn,s=new mv(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(i,function(t){r.image=t;t=0<i.search(/\.jpe?g($|\?)/i)||0===i.search(/^data\:image\/jpeg/);r.format=t?vn:dn,r.needsUpdate=!0,void 0!==n&&n(r)},t,e),r}}),((gv.prototype=Object.create(Xn.prototype)).constructor=gv).prototype.isShadowMaterial=!0,gv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this},((Mv.prototype=Object.create(Xn.prototype)).constructor=Mv).prototype.isSpriteMaterial=!0,Mv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var Ev="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",Ov="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n";function Rv(t){Xn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ev,this.fragmentShader=Ov,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Tv(t){Rv.call(this,t),this.type="RawShaderMaterial"}function Sv(t){Xn.call(this),this.type="PointsMaterial",this.color=new Ci(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}function jv(t){Xn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ci(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function Av(t){jv.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ji(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function xv(t){Xn.call(this),this.type="MeshPhongMaterial",this.color=new Ci(16777215),this.specular=new Ci(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Cv(t){Xn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ci(16777215),this.specular=new Ci(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Lv(t){Xn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function _v(t){Xn.call(this),this.type="MeshLambertMaterial",this.color=new Ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Iv(t){Xn.call(this),this.type="MeshDepthMaterial",this.depthPacking=wn,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Pv(t){Xn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Jt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}function Bv(t){Xn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ci(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=gn,this.normalScale=new Ji(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Fv(t){Xn.call(this),this.type="LineBasicMaterial",this.color=new Ci(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}function Nv(t){Fv.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}function Dv(t){zv.call(this,t),this.textures={}}((Rv.prototype=Object.create(Xn.prototype)).constructor=Rv).prototype.isShaderMaterial=!0,Rv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=kv(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},((Tv.prototype=Object.create(Rv.prototype)).constructor=Tv).prototype.isRawShaderMaterial=!0,((Sv.prototype=Object.create(Xn.prototype)).constructor=Sv).prototype.isPointsMaterial=!0,Sv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this},((jv.prototype=Object.create(Xn.prototype)).constructor=jv).prototype.isMeshStandardMaterial=!0,jv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},((Av.prototype=Object.create(jv.prototype)).constructor=Av).prototype.isMeshPhysicalMaterial=!0,Av.prototype.copy=function(t){return jv.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new Ci).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},((xv.prototype=Object.create(Xn.prototype)).constructor=xv).prototype.isMeshPhongMaterial=!0,xv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Cv.prototype=Object.create(Xn.prototype)).constructor=Cv).prototype.isMeshToonMaterial=!0,Cv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Lv.prototype=Object.create(Xn.prototype)).constructor=Lv).prototype.isMeshNormalMaterial=!0,Lv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((_v.prototype=Object.create(Xn.prototype)).constructor=_v).prototype.isMeshLambertMaterial=!0,_v.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Iv.prototype=Object.create(Xn.prototype)).constructor=Iv).prototype.isMeshDepthMaterial=!0,Iv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},((Pv.prototype=Object.create(Xn.prototype)).constructor=Pv).prototype.isMeshDistanceMaterial=!0,Pv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this},((Bv.prototype=Object.create(Xn.prototype)).constructor=Bv).prototype.isMeshMatcapMaterial=!0,Bv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},((Fv.prototype=Object.create(Xn.prototype)).constructor=Fv).prototype.isLineBasicMaterial=!0,Fv.prototype.copy=function(t){return Xn.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},((Nv.prototype=Object.create(Fv.prototype)).constructor=Nv).prototype.isLineDashedMaterial=!0,Nv.prototype.copy=function(t){return Fv.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this},Dv.prototype=Object.assign(Object.create(zv.prototype),{constructor:Dv,load:function(t,i,n,e){var r=this,s=new Zv(r.manager);s.setPath(r.path),s.load(t,function(t){i(r.parse(JSON.parse(t)))},n,e)},parse:function(t){var i=this.textures;function n(t){return void 0===i[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),i[t]}var e,r=new h[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new Ci).setHex(t.sheen)),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=0<t.vertexColors:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var s in t.uniforms){var o=t.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=(new Ci).setHex(o.value);break;case"v2":r.uniforms[s].value=(new Ji).fromArray(o.value);break;case"v3":r.uniforms[s].value=(new Jt).fromArray(o.value);break;case"v4":r.uniforms[s].value=(new Ki).fromArray(o.value);break;case"m3":r.uniforms[s].value=(new li).fromArray(o.value);case"m4":r.uniforms[s].value=(new oi).fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var u in t.extensions)r.extensions[u]=t.extensions[u];return void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale&&(e=t.normalScale,!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new Ji).fromArray(e)),void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Ji).fromArray(t.clearcoatNormalScale)),r},setTextures:function(t){return this.textures=t,this}});var Hv,Uv,Vv,Gv;function zv(t){this.manager=void 0!==t?t:uv,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(zv.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}}),Object.assign(zv.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(t,i,n){for(var e=[],r=0;r<t.length;++r)e[r]=this.createMaterial(t[r],i,n);return e},createMaterial:(Hv={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},Uv=new Ci,Vv=new wv,Gv=new Dv,function(t,o,u){var h={};function i(t,i,n,e,r){var s=o+t,t=(new ov).getHandler(s),s=null!==t?t.load(s):(Vv.setCrossOrigin(u),Vv.load(s));void 0!==i&&(s.repeat.fromArray(i),1!==i[0]&&(s.wrapS=1e3),1!==i[1]&&(s.wrapT=1e3)),void 0!==n&&s.offset.fromArray(n),void 0!==e&&("repeat"===e[0]&&(s.wrapS=1e3),"mirror"===e[0]&&(s.wrapS=1002),"repeat"===e[1]&&(s.wrapT=1e3),"mirror"===e[1]&&(s.wrapT=1002)),void 0!==r&&(s.anisotropy=r);r=Y.generateUUID();return h[r]=s,r}var n,e={uuid:Y.generateUUID(),type:"MeshLambertMaterial"};for(n in t){var r=t[n];switch(n){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":e.name=r;break;case"blending":e.blending=Hv[r];break;case"colorAmbient":case"mapAmbient":break;case"colorDiffuse":e.color=Uv.fromArray(r).getHex();break;case"colorSpecular":e.specular=Uv.fromArray(r).getHex();break;case"colorEmissive":e.emissive=Uv.fromArray(r).getHex();break;case"specularCoef":e.shininess=r;break;case"shading":"basic"===r.toLowerCase()&&(e.type="MeshBasicMaterial"),"phong"===r.toLowerCase()&&(e.type="MeshPhongMaterial"),"standard"===r.toLowerCase()&&(e.type="MeshStandardMaterial");break;case"mapDiffuse":e.map=i(r,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":e.emissiveMap=i(r,t.mapEmissiveRepeat,t.mapEmissiveOffset,t.mapEmissiveWrap,t.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":e.lightMap=i(r,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":e.aoMap=i(r,t.mapAORepeat,t.mapAOOffset,t.mapAOWrap,t.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":e.bumpMap=i(r,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy);break;case"mapBumpScale":e.bumpScale=r;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":e.normalMap=i(r,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy);break;case"mapNormalFactor":e.normalScale=r;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":e.specularMap=i(r,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":e.metalnessMap=i(r,t.mapMetalnessRepeat,t.mapMetalnessOffset,t.mapMetalnessWrap,t.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":e.roughnessMap=i(r,t.mapRoughnessRepeat,t.mapRoughnessOffset,t.mapRoughnessWrap,t.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":e.alphaMap=i(r,t.mapAlphaRepeat,t.mapAlphaOffset,t.mapAlphaWrap,t.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":e.side=1;break;case"doubleSided":e.side=2;break;case"transparency":e.opacity=r;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":e[n]=r;break;case"vertexColors":!0===r&&(e.vertexColors=2),"face"===r&&(e.vertexColors=1)}}return"MeshBasicMaterial"===e.type&&delete e.emissive,"MeshPhongMaterial"!==e.type&&delete e.specular,e.opacity<1&&(e.transparent=!0),Gv.setTextures(h),Gv.parse(e)})});var qv={};function Zv(t){zv.call(this,t)}Zv.prototype=Object.assign(Object.create(zv.prototype),{constructor:Zv,load:function(o,t,i,n){void 0===o&&(o=""),void 0!==this.path&&(o=this.path+o),o=this.manager.resolveURL(o);var u=this,e=bv.get(o);if(void 0!==e)return u.manager.itemStart(o),setTimeout(function(){t&&t(e),u.manager.itemEnd(o)},0),e;if(void 0===qv[o]){var r=o.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var s=r[1],h=!!r[2],a=r[3],a=decodeURIComponent(a);h&&(a=atob(a));try{var c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":for(var f=new Uint8Array(a.length),l=0;l<a.length;l++)f[l]=a.charCodeAt(l);v="blob"===c?new Blob([f.buffer],{type:s}):f.buffer;break;case"document":var v=(new DOMParser).parseFromString(a,s);break;case"json":v=JSON.parse(a);break;default:v=a}setTimeout(function(){t&&t(v),u.manager.itemEnd(o)},0)}catch(t){setTimeout(function(){n&&n(t),u.manager.itemError(o),u.manager.itemEnd(o)},0)}}else{qv[o]=[],qv[o].push({onLoad:t,onProgress:i,onError:n});var d,y=new XMLHttpRequest;for(d in y.open("GET",o,!0),y.addEventListener("load",function(t){var i=this.response,n=qv[o];if(delete qv[o],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),bv.add(o,i);for(var e=0,r=n.length;e<r;e++)(s=n[e]).onLoad&&s.onLoad(i);u.manager.itemEnd(o)}else{for(var s,e=0,r=n.length;e<r;e++)(s=n[e]).onError&&s.onError(t);u.manager.itemError(o),u.manager.itemEnd(o)}},!1),y.addEventListener("progress",function(t){for(var i=qv[o],n=0,e=i.length;n<e;n++){var r=i[n];r.onProgress&&r.onProgress(t)}},!1),y.addEventListener("error",function(t){var i=qv[o];delete qv[o];for(var n=0,e=i.length;n<e;n++){var r=i[n];r.onError&&r.onError(t)}u.manager.itemError(o),u.manager.itemEnd(o)},!1),y.addEventListener("abort",function(t){var i=qv[o];delete qv[o];for(var n=0,e=i.length;n<e;n++){var r=i[n];r.onError&&r.onError(t)}u.manager.itemError(o),u.manager.itemEnd(o)},!1),void 0!==this.responseType&&(y.responseType=this.responseType),void 0!==this.withCredentials&&(y.withCredentials=this.withCredentials),y.overrideMimeType&&y.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)y.setRequestHeader(d,this.requestHeader[d]);y.send(null)}return u.manager.itemStart(o),y}qv[o].push({onLoad:t,onProgress:i,onError:n})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var Yv=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var i="",n=0,e=t.length;n<e;n++)i+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(i))}catch(t){return i}},Xv=function(t){var i=t.lastIndexOf("/");return-1===i?"./":t.substr(0,i+1)};function Wv(t,i,n,e){vv.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==e?e:2e3,this.focus=10,this.aspect=void 0!==i?i:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Qv(){lv.call(this,new Wv(90,1,.5,500)),this.jr=new Ji(4,2),this.Ar=6,this.xr=[new Ki(2,1,1,1),new Ki(0,1,1,1),new Ki(3,1,1,1),new Ki(1,1,1,1),new Ki(3,0,1,1),new Ki(1,0,1,1)],this.Ir=[new Jt(1,0,0),new Jt(-1,0,0),new Jt(0,0,1),new Jt(0,0,-1),new Jt(0,1,0),new Jt(0,-1,0)],this.Pr=[new Jt(0,1,0),new Jt(0,1,0),new Jt(0,1,0),new Jt(0,1,0),new Jt(0,0,1),new Jt(0,0,-1)]}function Kv(t,i,n,e){hv.call(this,t,i),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==e?e:1,this.shadow=new Qv}function Jv(){lv.call(this,new Wv(50,1,.5,500))}function $v(t,i,n,e,r,s){hv.call(this,t,i),this.type="SpotLight",this.position.copy(Ti.DefaultUp),this.updateMatrix(),this.target=new Ti,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==e?e:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==s?s:1,this.shadow=new Jv}function td(t,i,n,e){this.parameterPositions=t,this.Br=0,this.resultBuffer=void 0!==e?e:new i.constructor(n),this.sampleValues=i,this.valueSize=n}function id(t,i){this.array=t,this.stride=i,this.count=void 0!==t?t.length/i:0,this.usage=En,this.updateRange={offset:0,count:-1},this.version=0}Wv.prototype=Object.assign(Object.create(vv.prototype),{constructor:Wv,isPerspectiveCamera:!0,copy:function(t,i){return vv.prototype.copy.call(this,t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){t=.5*this.getFilmHeight()/t;this.fov=2*Y.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Y.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Y.RAD2DEG*Math.atan(Math.tan(.5*Y.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,i,n,e,r,s){this.aspect=t/i,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=n,this.view.offsetY=e,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t,i=this.near,n=i*Math.tan(.5*Y.DEG2RAD*this.fov)/this.zoom,e=2*n,r=this.aspect*e,s=-.5*r,o=this.view;null!==this.view&&this.view.enabled&&(t=o.fullWidth,u=o.fullHeight,s+=o.offsetX*r/t,n-=o.offsetY*e/u,r*=o.width/t,e*=o.height/u);var u=this.filmOffset;0!==u&&(s+=i*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,n,n-e,i,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}),Qv.prototype=Object.assign(Object.create(lv.prototype),{constructor:Qv,isPointLightShadow:!0,updateMatrices:function(t,i){void 0===i&&(i=0);var n=this.camera,e=this.matrix,r=this.Lr,s=this._r,o=this.Cr;r.setFromMatrixPosition(t.matrixWorld),n.position.copy(r),s.copy(n.position),s.add(this.Ir[i]),n.up.copy(this.Pr[i]),n.lookAt(s),n.updateMatrixWorld(),e.makeTranslation(-r.x,-r.y,-r.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this.Sr.setFromProjectionMatrix(o)}}),Kv.prototype=Object.assign(Object.create(hv.prototype),{constructor:Kv,isPointLight:!0,copy:function(t){return hv.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Jv.prototype=Object.assign(Object.create(lv.prototype),{constructor:Jv,isSpotLightShadow:!0,updateMatrices:function(t){var i=this.camera,n=2*Y.RAD2DEG*t.angle,e=this.mapSize.width/this.mapSize.height,r=t.distance||i.far;n===i.fov&&e===i.aspect&&r===i.far||(i.fov=n,i.aspect=e,i.far=r,i.updateProjectionMatrix()),lv.prototype.updateMatrices.call(this,t)}}),$v.prototype=Object.assign(Object.create(hv.prototype),{constructor:$v,isSpotLight:!0,copy:function(t){return hv.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Object.assign(td.prototype,{evaluate:function(t){var i,n=this.parameterPositions,e=this.Br,r=n[e],s=n[e-1];t:{i:{n:{e:if(!(t<r)){for(var o=e+2;;){if(void 0===r){if(t<s)break e;return e=n.length,this.Br=e,this.afterEnd_(e-1,t,s)}if(e===o)break;if(s=r,t<(r=n[++e]))break i}i=n.length;break n}if(s<=t)break t;var u=n[1];t<u&&(e=2,s=u);for(o=e-2;;){if(void 0===s)return this.Br=0,this.beforeStart_(0,t,r);if(e===o)break;if(r=s,(s=n[--e-1])<=t)break i}i=e,e=0}for(;e<i;){var h=e+i>>>1;t<n[h]?i=h:e=1+h}if(r=n[e],void 0===(s=n[e-1]))return this.Br=0,this.beforeStart_(0,t,r);if(void 0===r)return e=n.length,this.Br=e,this.afterEnd_(e-1,s,t)}this.Br=e,this.intervalChanged_(e,s,r)}return this.interpolate_(e,s,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var i=this.resultBuffer,n=this.sampleValues,e=this.valueSize,r=t*e,s=0;s!==e;++s)i[s]=n[r+s];return i},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(td.prototype,{beforeStart_:td.prototype.copySampleValue_,afterEnd_:td.prototype.copySampleValue_}),Object.defineProperty(id.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(id.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,i,n){t*=this.stride,n*=i.stride;for(var e=0,r=this.stride;e<r;e++)this.array[t+e]=i.array[n+e];return this},set:function(t,i){return this.array.set(t,i=void 0===i?0:i),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var nd=new Jt;function ed(t,i,n,e){this.data=t,this.itemSize=i,this.offset=n,this.normalized=!0===e}function rd(t,i){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),He.call(this,t,i),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new oi,this.bindMatrixInverse=new oi}Object.defineProperties(ed.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(ed.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var i=0,n=this.data.count;i<n;i++)nd.x=this.getX(i),nd.y=this.getY(i),nd.z=this.getZ(i),nd.applyMatrix4(t),this.setXYZ(i,nd.x,nd.y,nd.z);return this},setX:function(t,i){return this.data.array[t*this.data.stride+this.offset]=i,this},setY:function(t,i){return this.data.array[t*this.data.stride+this.offset+1]=i,this},setZ:function(t,i){return this.data.array[t*this.data.stride+this.offset+2]=i,this},setW:function(t,i){return this.data.array[t*this.data.stride+this.offset+3]=i,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=i,this.data.array[t+1]=n,this},setXYZ:function(t,i,n,e){return t=t*this.data.stride+this.offset,this.data.array[t+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=e,this},setXYZW:function(t,i,n,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=i,this.data.array[t+1]=n,this.data.array[t+2]=e,this.data.array[t+3]=r,this}}),rd.prototype=Object.assign(Object.create(He.prototype),{constructor:rd,isSkinnedMesh:!0,bind:function(t,i){this.skeleton=t,void 0===i&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.getInverse(i)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Ki,i=this.geometry.attributes.skinWeight,n=0,e=i.count;n<e;n++){t.x=i.getX(n),t.y=i.getY(n),t.z=i.getZ(n),t.w=i.getW(n);var r=1/t.manhattanLength();r!=1/0?t.multiplyScalar(r):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){He.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var sd=new Jt,od=new Jt,ud=new oi,hd=new ce,ad=new Bn;function cd(t,i,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Ti.call(this),this.type="Line",this.geometry=void 0!==t?t:new qn,this.material=void 0!==i?i:new Fv}cd.prototype=Object.assign(Object.create(Ti.prototype),{constructor:cd,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var i=t.attributes.position,n=[0],e=1,r=i.count;e<r;e++)sd.fromBufferAttribute(i,e-1),od.fromBufferAttribute(i,e),n[e]=n[e-1],n[e]+=sd.distanceTo(od);t.setAttribute("lineDistance",new _n(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var s=t.vertices;(n=t.lineDistances)[0]=0;for(e=1,r=s.length;e<r;e++)n[e]=n[e-1],n[e]+=s[e-1].distanceTo(s[e])}return this},raycast:function(t,i){var n=this.geometry,e=this.matrixWorld,r=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),ad.copy(n.boundingSphere),ad.applyMatrix4(e),ad.radius+=r,!1!==t.ray.intersectsSphere(ad)){ud.getInverse(e),hd.copy(t.ray).applyMatrix4(ud);var r=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=r*r,o=new Jt,u=new Jt,h=new Jt,a=new Jt,c=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var r=n.index,f=n.attributes.position.array;if(null!==r)for(var l=r.array,v=0,d=l.length-1;v<d;v+=c){var y=l[v],p=l[v+1];o.fromArray(f,3*y),u.fromArray(f,3*p),s<hd.distanceSqToSegment(o,u,a,h)||(a.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(a))<t.near||b>t.far||i.push({distance:b,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this}))}else for(v=0,d=f.length/3-1;v<d;v+=c)o.fromArray(f,3*v),u.fromArray(f,3*v+3),s<hd.distanceSqToSegment(o,u,a,h)||(a.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(a))<t.near||b>t.far||i.push({distance:b,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this}))}else if(n.isGeometry)for(var b,m=n.vertices,w=m.length,v=0;v<w-1;v+=c)s<hd.distanceSqToSegment(m[v],m[v+1],a,h)||(a.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(a))<t.near||b>t.far||i.push({distance:b,point:h.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this}))}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var fd=new Jt,ld=new Jt;function vd(t,i){cd.call(this,t,i),this.type="LineSegments"}function dd(t,i){cd.call(this,t,i),this.type="LineLoop"}vd.prototype=Object.assign(Object.create(cd.prototype),{constructor:vd,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var i=t.attributes.position,n=[],e=0,r=i.count;e<r;e+=2)fd.fromBufferAttribute(i,e),ld.fromBufferAttribute(i,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+fd.distanceTo(ld);t.setAttribute("lineDistance",new _n(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(var s=t.vertices,n=t.lineDistances,e=0,r=s.length;e<r;e+=2)fd.copy(s[e]),ld.copy(s[e+1]),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+fd.distanceTo(ld);return this}}),dd.prototype=Object.assign(Object.create(cd.prototype),{constructor:dd,isLineLoop:!0});var yd=new oi,pd=new ce,bd=new Bn,md=new Jt;function wd(t,i){Ti.call(this),this.type="Points",this.geometry=void 0!==t?t:new qn,this.material=void 0!==i?i:new Sv,this.updateMorphTargets()}function gd(t,i,n,e,r,s,o){var u=pd.distanceSqToPoint(t);u<n&&(n=new Jt,pd.closestPointToPoint(t,n),n.applyMatrix4(e),(e=r.ray.origin.distanceTo(n))<r.near||e>r.far||s.push({distance:e,distanceToRay:Math.sqrt(u),point:n,index:i,face:null,object:o}))}function Md(t,i,n,e){td.call(this,t,i,n,e),this.Fr=-0,this.Nr=-0,this.Dr=-0,this.Hr=-0}function kd(t,i,n,e){td.call(this,t,i,n,e)}function Ed(t,i,n,e){td.call(this,t,i,n,e)}wd.prototype=Object.assign(Object.create(Ti.prototype),{constructor:wd,isPoints:!0,raycast:function(t,i){var n=this.geometry,e=this.matrixWorld,r=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),bd.copy(n.boundingSphere),bd.applyMatrix4(e),bd.radius+=r,!1!==t.ray.intersectsSphere(bd)){yd.getInverse(e),pd.copy(t.ray).applyMatrix4(yd);var r=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=r*r;if(n.isBufferGeometry){var r=n.index,o=n.attributes.position.array;if(null!==r)for(var u=r.array,h=0,a=u.length;h<a;h++){var c=u[h];md.fromArray(o,3*c),gd(md,c,s,e,t,i,this)}else for(var h=0,f=o.length/3;h<f;h++)md.fromArray(o,3*h),gd(md,h,s,e,t,i,this)}else for(var l=n.vertices,h=0,f=l.length;h<f;h++)gd(l[h],h,s,e,t,i,this)}},updateMorphTargets:function(){var t,i,n,e=this.geometry;if(e.isBufferGeometry){var r=e.morphAttributes,s=Object.keys(r);if(0<s.length){var o=r[s[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,i=o.length;t<i;t++)n=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Md.prototype=Object.assign(Object.create(td.prototype),{constructor:Md,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,i,n){var e=this.parameterPositions,r=t-2,s=t+1,o=e[r],u=e[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=t,o=2*i-n;break;case 2402:o=i+e[r=e.length-2]-e[r+1];break;default:r=t,o=n}if(void 0===u)switch(this.getSettings_().endingEnd){case 2401:s=t,u=2*n-i;break;case 2402:u=n+e[s=1]-e[0];break;default:s=t-1,u=i}var h=.5*(n-i),a=this.valueSize;this.Fr=h/(i-o),this.Dr=h/(u-n),this.Nr=r*a,this.Hr=s*a},interpolate_:function(t,i,n,e){for(var r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,u=t*o,h=u-o,a=this.Nr,c=this.Hr,f=this.Fr,t=this.Dr,n=(n-i)/(e-i),e=n*n,i=e*n,l=-f*i+2*f*e-f*n,v=(1+f)*i+(-1.5-2*f)*e+(-.5+f)*n+1,d=(-1-t)*i+(1.5+t)*e+.5*n,y=t*i-t*e,p=0;p!==o;++p)r[p]=l*s[a+p]+v*s[h+p]+d*s[u+p]+y*s[c+p];return r}}),kd.prototype=Object.assign(Object.create(td.prototype),{constructor:kd,interpolate_:function(t,i,n,e){for(var r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,u=t*o,h=u-o,a=(n-i)/(e-i),c=1-a,f=0;f!==o;++f)r[f]=s[h+f]*c+s[u+f]*a;return r}}),Ed.prototype=Object.assign(Object.create(td.prototype),{constructor:Ed,interpolate_:function(t){return this.copySampleValue_(t-1)}});var Od={arraySlice:function(t,i,n){return Od.isTypedArray(t)?new t.constructor(t.subarray(i,void 0!==n?n:t.length)):t.slice(i,n)},convertArray:function(t,i,n){return!t||!n&&t.constructor===i?t:"number"==typeof i.BYTES_PER_ELEMENT?new i(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(n){for(var t=n.length,i=new Array(t),e=0;e!==t;++e)i[e]=e;return i.sort(function(t,i){return n[t]-n[i]}),i},sortedArray:function(t,i,n){for(var e=t.length,r=new t.constructor(e),s=0,o=0;o!==e;++s)for(var u=n[s]*i,h=0;h!==i;++h)r[o++]=t[u+h];return r},flattenJSON:function(t,i,n,e){for(var r=1,s=t[0];void 0!==s&&void 0===s[e];)s=t[r++];if(void 0!==s){var o=s[e];if(void 0!==o)if(Array.isArray(o))for(;void 0!==(o=s[e])&&(i.push(s.time),n.push.apply(n,o)),s=t[r++],void 0!==s;);else if(void 0!==o.toArray)for(;void 0!==(o=s[e])&&(i.push(s.time),o.toArray(n,n.length)),s=t[r++],void 0!==s;);else for(;void 0!==(o=s[e])&&(i.push(s.time),n.push(o)),s=t[r++],void 0!==s;);}},subclip:function(t,i,n,e,r){r=r||30;var s=t.clone();s.name=i;for(var o=[],u=0;u<s.tracks.length;++u){for(var h=s.tracks[u],a=h.getValueSize(),c=[],f=[],l=0;l<h.times.length;++l){var v=h.times[l]*r;if(!(v<n||e<=v)){c.push(h.times[l]);for(var d=0;d<a;++d)f.push(h.values[l*a+d])}}0!==c.length&&(h.times=Od.convertArray(c,h.times.constructor),h.values=Od.convertArray(f,h.values.constructor),o.push(h))}s.tracks=o;for(var y=1/0,u=0;u<s.tracks.length;++u)y>s.tracks[u].times[0]&&(y=s.tracks[u].times[0]);for(u=0;u<s.tracks.length;++u)s.tracks[u].shift(-1*y);return s.resetDuration(),s}};function Rd(t,i,n,e){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===i||0===i.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Od.convertArray(i,this.TimeBufferType),this.values=Od.convertArray(n,this.ValueBufferType),this.setInterpolation(e||this.DefaultInterpolation)}function Td(t,i,n,e){Rd.call(this,t,i,n,e)}function Sd(t,i,n,e){td.call(this,t,i,n,e)}function jd(t,i,n,e){Rd.call(this,t,i,n,e)}function Ad(t,i,n,e){Rd.call(this,t,i,n,e)}function xd(t,i,n){Rd.call(this,t,i,n)}function Cd(t,i,n,e){Rd.call(this,t,i,n,e)}function Ld(t,i,n,e){Rd.call(this,t,i,n,e)}function _d(t,i,n){this.name=t,this.tracks=n,this.duration=void 0!==i?i:-1,this.uuid=Y.generateUUID(),this.duration<0&&this.resetDuration()}function Id(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var i,n,e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Td;case"vector":case"vector2":case"vector3":case"vector4":return Ad;case"color":return Cd;case"quaternion":return jd;case"bool":case"boolean":return xd;case"string":return Ld}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);return void 0===t.times&&(Od.flattenJSON(t.keys,i=[],n=[],"value"),t.times=i,t.values=n),void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}function Pd(){Ti.call(this),this.type="Bone"}Object.assign(Rd.prototype,{constructor:Rd,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:pn,InterpolantFactoryMethodDiscrete:function(t){return new Ed(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new kd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Md(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var i;switch(t){case yn:i=this.InterpolantFactoryMethodDiscrete;break;case pn:i=this.InterpolantFactoryMethodLinear;break;case 2302:i=this.InterpolantFactoryMethodSmooth}if(void 0!==i)return this.createInterpolant=i,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return yn;case this.InterpolantFactoryMethodLinear:return pn;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var i=this.times,n=0,e=i.length;n!==e;++n)i[n]+=t;return this},scale:function(t){if(1!==t)for(var i=this.times,n=0,e=i.length;n!==e;++n)i[n]*=t;return this},trim:function(t,i){for(var n,e=this.times,r=e.length,s=0,o=r-1;s!==r&&e[s]<t;)++s;for(;-1!==o&&e[o]>i;)--o;return++o,0===s&&o===r||(o<=s&&(s=(o=Math.max(o,1))-1),n=this.getValueSize(),this.times=Od.arraySlice(e,s,o),this.values=Od.arraySlice(this.values,s*n,o*n)),this},validate:function(){var t=!0,i=this.getValueSize();i-Math.floor(i)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,e=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var s=null,o=0;o!==r;o++){var u=n[o];if("number"==typeof u&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,u),t=!1;break}if(null!==s&&u<s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,u,s),t=!1;break}s=u}if(void 0!==e&&Od.isTypedArray(e))for(var o=0,h=e.length;o!==h;++o){var a=e[o];if(isNaN(a)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,a),t=!1;break}}return t},optimize:function(){for(var t=Od.arraySlice(this.times),i=Od.arraySlice(this.values),n=this.getValueSize(),e=2302===this.getInterpolation(),r=1,s=t.length-1,o=1;o<s;++o){var u=!1,h=t[o];if(h!==t[o+1]&&(1!==o||h!==h[0]))if(e)u=!0;else for(var a=o*n,c=a-n,f=a+n,l=0;l!==n;++l){var v=i[a+l];if(v!==i[c+l]||v!==i[f+l]){u=!0;break}}if(u){if(o!==r){t[r]=t[o];for(var d=o*n,y=r*n,l=0;l!==n;++l)i[y+l]=i[d+l]}++r}}if(0<s){t[r]=t[s];for(d=s*n,y=r*n,l=0;l!==n;++l)i[y+l]=i[d+l];++r}return r!==t.length?(this.times=Od.arraySlice(t,0,r),this.values=Od.arraySlice(i,0,r*n)):(this.times=t,this.values=i),this},clone:function(){var t=Od.arraySlice(this.times,0),i=Od.arraySlice(this.values,0),i=new this.constructor(this.name,t,i);return i.createInterpolant=this.createInterpolant,i}}),Td.prototype=Object.assign(Object.create(Rd.prototype),{constructor:Td,ValueTypeName:"number"}),Sd.prototype=Object.assign(Object.create(td.prototype),{constructor:Sd,interpolate_:function(t,i,n,e){for(var r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,u=t*o,h=(n-i)/(e-i),a=u+o;u!==a;u+=4)Wt.slerpFlat(r,0,s,u-o,s,u,h);return r}}),jd.prototype=Object.assign(Object.create(Rd.prototype),{constructor:jd,ValueTypeName:"quaternion",DefaultInterpolation:pn,InterpolantFactoryMethodLinear:function(t){return new Sd(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Ad.prototype=Object.assign(Object.create(Rd.prototype),{constructor:Ad,ValueTypeName:"vector"}),xd.prototype=Object.assign(Object.create(Rd.prototype),{constructor:xd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:yn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Cd.prototype=Object.assign(Object.create(Rd.prototype),{constructor:Cd,ValueTypeName:"color"}),Ld.prototype=Object.assign(Object.create(Rd.prototype),{constructor:Ld,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:yn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(_d,{parse:function(t){for(var i=[],n=t.tracks,e=1/(t.fps||1),r=0,s=n.length;r!==s;++r)i.push(Id(n[r]).scale(e));return new _d(t.name,t.duration,i)},CreateFromMorphTargetSequence:function(t,i,n,e){for(var r=i.length,s=[],o=0;o<r;o++){var u=[];(a=[]).push((o+r-1)%r,o,(o+1)%r),u.push(0,1,0);var h=Od.getKeyframeOrder(a),a=Od.sortedArray(a,1,h),u=Od.sortedArray(u,1,h);e||0!==a[0]||(a.push(r),u.push(u[0])),s.push(new Td(".morphTargetInfluences["+i[o].name+"]",a,u).scale(1/n))}return new _d(t,-1,s)},findByName:function(t,i){var n=t;Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations);for(var e=0;e<n.length;e++)if(n[e].name===i)return n[e];return null},CreateClipsFromMorphTargetSequences:function(t,i,n){for(var e={},r=/^([\w-]*?)([\d]+)$/,s=0,o=t.length;s<o;s++){var u=t[s],h=u.name.match(r);h&&1<h.length&&((h=e[a=h[1]])||(e[a]=h=[]),h.push(u))}var a,c=[];for(a in e)c.push(_d.CreateFromMorphTargetSequence(a,e[a],i,n));return c},parseAnimation:function(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(t,i,n,e,r){var s;0!==n.length&&(Od.flattenJSON(n,s=[],n=[],e),0!==s.length&&r.push(new t(i,s,n)))},e=[],r=t.name||"default",s=t.length||-1,o=t.fps||30,u=t.hierarchy||[],h=0;h<u.length;h++){var a=u[h].keys;if(a&&0!==a.length)if(a[0].morphTargets){for(var c,f={},l=0;l<a.length;l++)if(a[l].morphTargets)for(var v=0;v<a[l].morphTargets.length;v++)f[a[l].morphTargets[v]]=-1;for(c in f){for(var d=[],y=[],v=0;v!==a[l].morphTargets.length;++v){var p=a[l];d.push(p.time),y.push(p.morphTarget===c?1:0)}e.push(new Td(".morphTargetInfluence["+c+"]",d,y))}s=f.length*(o||1)}else{var b=".bones["+i[h].name+"]";n(Ad,b+".position",a,"pos",e),n(jd,b+".quaternion",a,"rot",e),n(Ad,b+".scale",a,"scl",e)}}return 0===e.length?null:new _d(r,s,e)}}),Object.assign(_d.prototype,{resetDuration:function(){for(var t=0,i=0,n=this.tracks.length;i!==n;++i)var e=this.tracks[i],t=Math.max(t,e.times[e.times.length-1]);return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new _d(this.name,this.duration,t)}}),Pd.prototype=Object.assign(Object.create(Ti.prototype),{constructor:Pd,isBone:!0});var A="\\[\\]\\.:\\/",Bd=new RegExp("["+A+"]","g"),D="[^"+A+"]",q="[^"+A.replace("\\.","")+"]",gt=/((?:WC+[\/:])*)/.source.replace("WC",D),A=/(WCOD+)?/.source.replace("WCOD",q),q=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",D),D=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",D),Fd=new RegExp("^"+gt+A+q+D+"$"),Nd=["material","materials","bones"];function Dd(t,i,n){n=n||Hd.parseTrackName(i);this.Ur=t,this.Vr=t.subscribe_(i,n)}function Hd(t,i,n){this.path=i,this.parsedPath=n||Hd.parseTrackName(i),this.node=Hd.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(Dd.prototype,{getValue:function(t,i){this.bind();var n=this.Ur.nCachedObjects_,n=this.Vr[n];void 0!==n&&n.getValue(t,i)},setValue:function(t,i){for(var n=this.Vr,e=this.Ur.nCachedObjects_,r=n.length;e!==r;++e)n[e].setValue(t,i)},bind:function(){for(var t=this.Vr,i=this.Ur.nCachedObjects_,n=t.length;i!==n;++i)t[i].bind()},unbind:function(){for(var t=this.Vr,i=this.Ur.nCachedObjects_,n=t.length;i!==n;++i)t[i].unbind()}}),Object.assign(Hd,{Composite:Dd,create:function(t,i,n){return new(t&&t.isAnimationObjectGroup?Hd.Composite:Hd)(t,i,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Bd,"")},parseTrackName:function(t){var i=Fd.exec(t);if(!i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},e=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==e&&-1!==e&&(i=n.nodeName.substring(e+1),-1!==Nd.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,e),n.objectName=i)),null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,r){if(!r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){var i=t.skeleton.getBoneByName(r);if(void 0!==i)return i}if(t.children){t=function t(i){for(var n=0;n<i.length;n++){var e=i[n];if(e.name===r||e.uuid===r)return e;e=t(e.children);if(e)return e}return null}(t.children);if(t)return t}return null}}),Object.assign(Hd.prototype,{Gr:function(){},zr:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,i){t[i]=this.node[this.propertyName]},function(t,i){for(var n=this.resolvedProperty,e=0,r=n.length;e!==r;++e)t[i++]=n[e]},function(t,i){t[i]=this.resolvedProperty[this.propertyIndex]},function(t,i){this.resolvedProperty.toArray(t,i)}],SetterByBindingTypeAndVersioning:[[function(t,i){this.targetObject[this.propertyName]=t[i]},function(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0},function(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){for(var n=this.resolvedProperty,e=0,r=n.length;e!==r;++e)n[e]=t[i++]},function(t,i){for(var n=this.resolvedProperty,e=0,r=n.length;e!==r;++e)n[e]=t[i++];this.targetObject.needsUpdate=!0},function(t,i){for(var n=this.resolvedProperty,e=0,r=n.length;e!==r;++e)n[e]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){this.resolvedProperty[this.propertyIndex]=t[i]},function(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0},function(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){this.resolvedProperty.fromArray(t,i)},function(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0},function(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,i){this.bind(),this.getValue(t,i)},setValue:function(t,i){this.bind(),this.setValue(t,i)},bind:function(){var t=this.node,i=this.parsedPath,n=i.objectName,e=i.propertyName,r=i.propertyIndex;if(t||(t=Hd.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=t),this.getValue=this.Gr,this.setValue=this.zr,t){if(n){var s=i.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(var t=t.skeleton.bones,o=0;o<t.length;o++)if(t[o].name===s){s=o;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==s){if(void 0===t[s])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[s]}}var u=t[e];if(void 0!==u){var h=this.Versioning.None;void 0!==(this.targetObject=t).needsUpdate?h=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(h=this.Versioning.MatrixWorldNeedsUpdate);var a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===e){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===r){r=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===r){r=o;break}}}a=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=r}else void 0!==u.fromArray&&void 0!==u.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(a=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=e;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][h]}else{i=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+e+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this.qr,this.setValue=this.Zr}}),Object.assign(Hd.prototype,{qr:Hd.prototype.getValue,Zr:Hd.prototype.setValue});var Ud=new oi,Vd=new oi;function Gd(t,i){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===i)this.calculateInverses();else if(this.bones.length===i.length)this.boneInverses=i.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,e=this.bones.length;n<e;n++)this.boneInverses.push(new oi)}}function zd(t){return(zd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.assign(Gd.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,i=this.bones.length;t<i;t++){var n=new oi;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){for(var t,i=0,n=this.bones.length;i<n;i++)(t=this.bones[i])&&t.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,n=this.bones.length;i<n;i++)(t=this.bones[i])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,i=this.boneInverses,n=this.boneMatrices,e=this.boneTexture,r=0,s=t.length;r<s;r++){var o=t[r]?t[r].matrixWorld:Vd;Ud.multiplyMatrices(o,i[r]),Ud.toArray(n,16*r)}void 0!==e&&(e.needsUpdate=!0)},clone:function(){return new Gd(this.bones,this.boneInverses)},getBoneByName:function(t){for(var i=0,n=this.bones.length;i<n;i++){var e=this.bones[i];if(e.name===t)return e}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}});var qd=function(){function t(t){zv.call(this,t),this.dracoLoader=null,this.ddsLoader=null}function e(){var n={};return{get:function(t){return n[t]},add:function(t,i){n[t]=i},remove:function(t){delete n[t]},removeAll:function(){n={}}}}t.prototype=Object.assign(Object.create(zv.prototype),{constructor:t,load:function(n,e,t,i){var r=this,s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Xv(n);r.manager.itemStart(n);function o(t){i?i(t):console.error(t),r.manager.itemError(n),r.manager.itemEnd(n)}var u=new Zv(r.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),"use-credentials"===r.crossOrigin&&u.setWithCredentials(!0),u.load(n,function(i){try{r.parse(i,s,function(t){e(t,i),r.manager.itemEnd(n)},o)}catch(t){o(t)}},t,o)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},parse:function(t,i,n,e){var r,s={};if("string"==typeof t)r=t;else if(Yv(new Uint8Array(t,0,4))===y){try{s[f.KHR_BINARY_GLTF]=new p(t)}catch(t){return void(e&&e(t))}r=s[f.KHR_BINARY_GLTF].content}else r=Yv(new Uint8Array(t));var o=JSON.parse(r);if(void 0===o.asset||o.asset.version[0]<2)e&&e(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(o.extensionsUsed)for(var u=0;u<o.extensionsUsed.length;++u){var h=o.extensionsUsed[u],a=o.extensionsRequired||[];switch(h){case f.KHR_LIGHTS_PUNCTUAL:s[h]=new l(o);break;case f.KHR_MATERIALS_CLEARCOAT:s[h]=new d;break;case f.KHR_MATERIALS_UNLIT:s[h]=new v;break;case f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[h]=new w;break;case f.KHR_DRACO_MESH_COMPRESSION:s[h]=new b(o,this.dracoLoader);break;case f.MSFT_TEXTURE_DDS:s[h]=new c(this.ddsLoader);break;case f.KHR_TEXTURE_TRANSFORM:s[h]=new m;break;case f.KHR_MESH_QUANTIZATION:s[h]=new g;break;default:0<=a.indexOf(h)&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}new z(o,s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(n,e)}}});var f={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function c(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=f.MSFT_TEXTURE_DDS,this.ddsLoader=t}function l(t){this.name=f.KHR_LIGHTS_PUNCTUAL;t=t.extensions&&t.extensions[f.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function v(){this.name=f.KHR_MATERIALS_UNLIT}function d(){this.name=f.KHR_MATERIALS_CLEARCOAT}l.prototype.loadLight=function(t){var i,n=this.lightDefs[t],e=new Ci(16777215);void 0!==n.color&&e.fromArray(n.color);var r=void 0!==n.range?n.range:0;switch(n.type){case"directional":(i=new pv(e)).target.position.set(0,0,-1),i.add(i.target);break;case"point":(i=new Kv(e)).distance=r;break;case"spot":(i=new $v(e)).distance=r,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,i.angle=n.spot.outerConeAngle,i.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return i.position.set(0,0,0),i.decay=2,void 0!==n.intensity&&(i.intensity=n.intensity),i.name=n.name||"light_"+t,Promise.resolve(i)},v.prototype.getMaterialType=function(){return Wn},v.prototype.extendParams=function(t,i,n){var e=[];t.color=new Ci(1,1,1),t.opacity=1;var r=i.pbrMetallicRoughness;return r&&(Array.isArray(r.baseColorFactor)&&(i=r.baseColorFactor,t.color.fromArray(i),t.opacity=i[3]),void 0!==r.baseColorTexture&&e.push(n.assignTexture(t,"map",r.baseColorTexture))),Promise.all(e)},d.prototype.getMaterialType=function(){return Av},d.prototype.extendParams=function(t,i,n){var e=[],i=i.extensions[this.name];return void 0!==i.clearcoatFactor&&(t.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&e.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&e.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(e.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale&&(i=i.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Ji(i,i))),Promise.all(e)};var y="glTF",u=12,h={JSON:1313821514,BIN:5130562};function p(t){this.name=f.KHR_BINARY_GLTF,this.content=null,this.body=null;var i=new DataView(t,0,u);if(this.header={magic:Yv(new Uint8Array(t.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==y)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(t,u),e=0;e<n.byteLength;){var r=n.getUint32(e,!0);e+=4;var s,o=n.getUint32(e,!0);e+=4,o===h.JSON?(s=new Uint8Array(t,u+e,r),this.content=Yv(s)):o===h.BIN&&(this.body=t.slice(o=u+e,o+r)),e+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function b(t,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=f.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=i,this.dracoLoader.preload()}function m(){this.name=f.KHR_TEXTURE_TRANSFORM}function a(t){jv.call(this),this.isGLTFSpecularGlossinessMaterial=!0;["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n");var n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),e=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),s=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),o={specular:{value:(new Ci).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this.Yr=o,this.onBeforeCompile=function(t){for(var i in o)t.uniforms[i]=o[i];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",r),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",s)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(t){o.specular.value=t}},specularMap:{get:function(){return o.specularMap.value},set:function(t){o.specularMap.value=t}},glossiness:{get:function(){return o.glossiness.value},set:function(t){o.glossiness.value=t}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(t){(o.glossinessMap.value=t)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function w(){return{name:f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return a},extendParams:function(t,i,n){var e=i.extensions[this.name];t.color=new Ci(1,1,1),t.opacity=1;var r=[];return Array.isArray(e.diffuseFactor)&&(i=e.diffuseFactor,t.color.fromArray(i),t.opacity=i[3]),void 0!==e.diffuseTexture&&r.push(n.assignTexture(t,"map",e.diffuseTexture)),t.emissive=new Ci(0,0,0),t.glossiness=void 0!==e.glossinessFactor?e.glossinessFactor:1,t.specular=new Ci(1,1,1),Array.isArray(e.specularFactor)&&t.specular.fromArray(e.specularFactor),void 0!==e.specularGlossinessTexture&&(e=e.specularGlossinessTexture,r.push(n.assignTexture(t,"glossinessMap",e)),r.push(n.assignTexture(t,"specularMap",e))),Promise.all(r)},createMaterial:function(t){var i=new a(t);return i.fog=!0,i.color=t.color,i.map=void 0===t.map?null:t.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=void 0===t.aoMap?null:t.aoMap,i.aoMapIntensity=1,i.emissive=t.emissive,i.emissiveIntensity=1,i.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,i.bumpMap=void 0===t.bumpMap?null:t.bumpMap,i.bumpScale=1,i.normalMap=void 0===t.normalMap?null:t.normalMap,i.normalMapType=gn,t.normalScale&&(i.normalScale=t.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=void 0===t.specularMap?null:t.specularMap,i.specular=t.specular,i.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,i.glossiness=t.glossiness,i.alphaMap=null,i.envMap=void 0===t.envMap?null:t.envMap,i.envMapIntensity=1,i.refractionRatio=.98,i}}}function g(){this.name=f.KHR_MESH_QUANTIZATION}function T(t,i,n,e){td.call(this,t,i,n,e)}b.prototype.decodePrimitive=function(t,i){var n,e=this.json,r=this.dracoLoader,s=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,u={},h={},a={};for(n in o){var c=_[n]||n.toLowerCase();u[c]=o[n]}for(n in t.attributes){var f,l,c=_[n]||n.toLowerCase();void 0!==o[n]&&(f=e.accessors[t.attributes[n]],l=A[f.componentType],a[c]=l,h[c]=!0===f.normalized)}return i.getDependency("bufferView",s).then(function(t){return new Promise(function(e){r.decodeDracoFile(t,function(t){for(var i in t.attributes){var n=t.attributes[i],i=h[i];void 0!==i&&(n.normalized=i)}e(t)},u,a)})})},m.prototype.extendTexture=function(t,i){return t=t.clone(),void 0!==i.offset&&t.offset.fromArray(i.offset),void 0!==i.rotation&&(t.rotation=i.rotation),void 0!==i.scale&&t.repeat.fromArray(i.scale),void 0!==i.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},((a.prototype=Object.create(jv.prototype)).constructor=a).prototype.copy=function(t){return jv.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},((T.prototype=Object.create(td.prototype)).constructor=T).prototype.beforeStart_=T.prototype.copySampleValue_=function(t){for(var i=this.resultBuffer,n=this.sampleValues,e=this.valueSize,r=t*e*3+e,s=0;s!==e;s++)i[s]=n[r+s];return i},T.prototype.afterEnd_=T.prototype.copySampleValue_,T.prototype.interpolate_=function(t,i,n,e){for(var r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,u=2*o,h=3*o,a=e-i,e=(n-i)/a,n=e*e,i=n*e,c=t*h,f=c-h,l=-2*i+3*n,v=i-n,d=1-l,y=v-n+e,p=0;p!==o;p++){var b=s[f+p+o],m=s[f+p+u]*a,w=s[c+p+o],g=s[c+p]*a;r[p]=d*b+y*m+l*w+v*g}return r};var M=0,k=1,E=2,O=3,R=4,S=5,j=6,A={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},x={9728:1003,9729:cn,9984:1004,9985:1007,9986:1005,9987:fn},C={33071:an,33648:1002,10497:1e3},L={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},I={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},P={CUBICSPLINE:void 0,LINEAR:pn,STEP:yn},B="OPAQUE",F="MASK",N="BLEND",D={"image/png":dn,"image/jpeg":vn};function H(t,i){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}function U(t,i,n){for(var e in n.extensions)void 0===t[e]&&(i.userData.gltfExtensions=i.userData.gltfExtensions||{},i.userData.gltfExtensions[e]=n.extensions[e])}function V(t,i){void 0!==i.extras&&("object"===zd(i.extras)?Object.assign(t.userData,i.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+i.extras))}function G(t){for(var i="",n=Object.keys(t).sort(),e=0,r=n.length;e<r;e++)i+=n[e]+":"+t[n[e]]+";";return i}function z(t,i,n){this.json=t||{},this.extensions=i||{},this.options=n||{},this.cache=new e,this.primitiveCache={},this.textureLoader=new wv(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Zv(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function q(n,t,e){var i,r,s=t.attributes,o=[];for(i in s){var u=_[i]||i.toLowerCase();u in n.attributes||o.push(function(t,i){return e.getDependency("accessor",t).then(function(t){n.setAttribute(i,t)})}(s[i],u))}return void 0===t.indices||n.index||(r=e.getDependency("accessor",t.indices).then(function(t){n.setIndex(t)}),o.push(r)),V(n,t),function(t,i,n){var e=i.attributes,r=new Wi;if(void 0!==e.POSITION){var s=(l=n.json.accessors[e.POSITION]).min,o=l.max;if(void 0!==s&&void 0!==o){r.set(new Jt(s[0],s[1],s[2]),new Jt(o[0],o[1],o[2]));var u=i.targets;if(void 0!==u){for(var h=new Jt,a=new Jt,c=0,f=u.length;c<f;c++){var l,v=u[c];void 0!==v.POSITION&&(s=(l=n.json.accessors[v.POSITION]).min,o=l.max,void 0!==s&&void 0!==o?(a.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),a.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),a.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),h.max(a)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}r.expandByVector(h)}t.boundingBox=r;i=new Bn;r.getCenter(i.center),i.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=i}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(n,t,e),Promise.all(o).then(function(){return void 0!==t.targets?function(n,t,i){for(var e=!1,r=!1,s=0,o=t.length;s<o;s++)if(void 0!==(c=t[s]).POSITION&&(e=!0),void 0!==c.NORMAL&&(r=!0),e&&r)break;if(!e&&!r)return Promise.resolve(n);for(var u=[],h=[],s=0,o=t.length;s<o;s++){var a,c=t[s];e&&(a=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):n.attributes.position,u.push(a)),r&&(a=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):n.attributes.normal,h.push(a))}return Promise.all([Promise.all(u),Promise.all(h)]).then(function(t){var i=t[0],t=t[1];return e&&(n.morphAttributes.position=i),r&&(n.morphAttributes.normal=t),n.morphTargetsRelative=!0,n})}(n,t.targets,e):n})}function Z(t,i){var n=t.getIndex();if(null===n){var e=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var s=0;s<r.count;s++)e.push(s);t.setIndex(e),n=t.getIndex()}var o=n.count-2,u=[];if(i===bn)for(s=1;s<=o;s++)u.push(n.getX(0)),u.push(n.getX(s)),u.push(n.getX(s+1));else for(s=0;s<o;s++)s%2==0?(u.push(n.getX(s)),u.push(n.getX(s+1)),u.push(n.getX(s+2))):(u.push(n.getX(s+2)),u.push(n.getX(s+1)),u.push(n.getX(s)));u.length/3!=o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");t=t.clone();return t.setIndex(u),t}return z.prototype.parse=function(i,t){var n=this,e=this.json,r=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(t){t={scene:t[0][e.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:e.asset,parser:n,userData:{}};U(r,t,e),V(t,e),i(t)}).catch(t)},z.prototype.markDefs=function(){for(var t=this.json.nodes||[],i=this.json.skins||[],n=this.json.meshes||[],e={},r={},s=0,o=i.length;s<o;s++)for(var u=i[s].joints,h=0,a=u.length;h<a;h++)t[u[h]].isBone=!0;for(var c=0,f=t.length;c<f;c++){var l=t[c];void 0!==l.mesh&&(void 0===e[l.mesh]&&(e[l.mesh]=r[l.mesh]=0),e[l.mesh]++,void 0!==l.skin&&(n[l.mesh].isSkinnedMesh=!0))}this.json.meshReferences=e,this.json.meshUses=r},z.prototype.getDependency=function(t,i){var n=t+":"+i,e=this.cache.get(n);if(!e){switch(t){case"scene":e=this.loadScene(i);break;case"node":e=this.loadNode(i);break;case"mesh":e=this.loadMesh(i);break;case"accessor":e=this.loadAccessor(i);break;case"bufferView":e=this.loadBufferView(i);break;case"buffer":e=this.loadBuffer(i);break;case"material":e=this.loadMaterial(i);break;case"texture":e=this.loadTexture(i);break;case"skin":e=this.loadSkin(i);break;case"animation":e=this.loadAnimation(i);break;case"camera":e=this.loadCamera(i);break;case"light":e=this.extensions[f.KHR_LIGHTS_PUNCTUAL].loadLight(i);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,e)}return e},z.prototype.getDependencies=function(n){var e,t,i=this.cache.get(n);return i||(t=(e=this).json[n+("mesh"===n?"es":"s")]||[],i=Promise.all(t.map(function(t,i){return e.getDependency(n,i)})),this.cache.add(n,i)),i},z.prototype.loadBuffer=function(t){var n=this.json.buffers[t],e=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===t)return Promise.resolve(this.extensions[f.KHR_BINARY_GLTF].body);var r=this.options;return new Promise(function(t,i){e.load(H(n.uri,r.path),t,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})},z.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){var i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)})},z.prototype.loadAccessor=function(t){var b=this,m=this.json,w=this.json.accessors[t];if(void 0===w.bufferView&&void 0===w.sparse)return Promise.resolve(null);t=[];return void 0!==w.bufferView?t.push(this.getDependency("bufferView",w.bufferView)):t.push(null),void 0!==w.sparse&&(t.push(this.getDependency("bufferView",w.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",w.sparse.values.bufferView))),Promise.all(t).then(function(t){var i,n,e,r=t[0],s=L[w.type],o=A[w.componentType],u=o.BYTES_PER_ELEMENT,h=w.byteOffset||0,a=void 0!==w.bufferView?m.bufferViews[w.bufferView].byteStride:void 0,c=!0===w.normalized,f=a&&a!==u*s?(i=Math.floor(h/a),n="InterleavedBuffer:"+w.bufferView+":"+w.componentType+":"+i+":"+w.count,(e=b.cache.get(n))||(e=new id(new o(r,i*a,w.count*a/u),a/u),b.cache.add(n,e)),new ed(e,s,h%a/u,c)):new Rn(null===r?new o(w.count*s):new o(r,h,w.count*s),s,c);if(void 0!==w.sparse){var u=A[w.sparse.indices.componentType],h=w.sparse.indices.byteOffset||0,c=w.sparse.values.byteOffset||0,l=new u(t[1],h,w.sparse.count*L.SCALAR),v=new o(t[2],c,w.sparse.count*s);null!==r&&(f=new Rn(f.array.slice(),f.itemSize,f.normalized));for(var d=0,y=l.length;d<y;d++){var p=l[d];if(f.setX(p,v[d*s]),2<=s&&f.setY(p,v[d*s+1]),3<=s&&f.setZ(p,v[d*s+2]),4<=s&&f.setW(p,v[d*s+3]),5<=s)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})},z.prototype.loadTexture=function(t){var i=this,n=this.json,r=this.options,s=this.textureLoader,e=self.URL||self.webkitURL,o=n.textures[t],u=o.extensions||{},h=u[f.MSFT_TEXTURE_DDS]?n.images[u[f.MSFT_TEXTURE_DDS].source]:n.images[o.source],a=h.uri,c=!1;return void 0!==h.bufferView&&(a=i.getDependency("bufferView",h.bufferView).then(function(t){c=!0;t=new Blob([t],{type:h.mimeType});return a=e.createObjectURL(t)})),Promise.resolve(a).then(function(n){var e=(e=r.manager.getHandler(n))||(u[f.MSFT_TEXTURE_DDS]?i.extensions[f.MSFT_TEXTURE_DDS].ddsLoader:s);return new Promise(function(t,i){e.load(H(n,r.path),t,void 0,i)})}).then(function(t){!0===c&&e.revokeObjectURL(a),t.flipY=!1,o.name&&(t.name=o.name),h.mimeType in D&&(t.format=D[h.mimeType]);var i=(n.samplers||{})[o.sampler]||{};return t.magFilter=x[i.magFilter]||cn,t.minFilter=x[i.minFilter]||fn,t.wrapS=C[i.wrapS]||1e3,t.wrapT=C[i.wrapT]||1e3,t})},z.prototype.assignTexture=function(n,e,r){var s=this;return this.getDependency("texture",r.index).then(function(t){if(!t.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":t.format=vn}var i;void 0===r.texCoord||0==r.texCoord||"aoMap"===e&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+e+" not yet supported."),!s.extensions[f.KHR_TEXTURE_TRANSFORM]||(i=void 0!==r.extensions?r.extensions[f.KHR_TEXTURE_TRANSFORM]:void 0)&&(t=s.extensions[f.KHR_TEXTURE_TRANSFORM].extendTexture(t,i)),n[e]=t})},z.prototype.assignFinalMaterial=function(t){var i,n,e,r=t.geometry,s=t.material,o=void 0!==r.attributes.tangent,u=void 0!==r.attributes.color,h=void 0===r.attributes.normal,a=!0===t.isSkinnedMesh,c=0<Object.keys(r.morphAttributes).length,f=c&&void 0!==r.morphAttributes.normal;t.isPoints?(n="PointsMaterial:"+s.uuid,(i=this.cache.get(n))||(i=new Sv,Xn.prototype.copy.call(i,s),i.color.copy(s.color),i.map=s.map,i.sizeAttenuation=!1,this.cache.add(n,i)),s=i):t.isLine&&(n="LineBasicMaterial:"+s.uuid,(e=this.cache.get(n))||(e=new Fv,Xn.prototype.copy.call(e,s),e.color.copy(s.color),this.cache.add(n,e)),s=e),(o||u||h||a||c)&&(n="ClonedMaterial:"+s.uuid+":",s.isGLTFSpecularGlossinessMaterial&&(n+="specular-glossiness:"),a&&(n+="skinning:"),o&&(n+="vertex-tangents:"),u&&(n+="vertex-colors:"),h&&(n+="flat-shading:"),c&&(n+="morph-targets:"),f&&(n+="morph-normals:"),(e=this.cache.get(n))||(e=s.clone(),a&&(e.skinning=!0),o&&(e.vertexTangents=!0),u&&(e.vertexColors=!0),h&&(e.flatShading=!0),c&&(e.morphTargets=!0),f&&(e.morphNormals=!0),this.cache.add(n,e)),s=e),s.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",new Rn(r.attributes.uv.array,2)),s.normalScale&&!o&&(s.normalScale.y=-s.normalScale.y),s.clearcoatNormalScale&&!o&&(s.clearcoatNormalScale.y=-s.clearcoatNormalScale.y),t.material=s},z.prototype.loadMaterial=function(t){var i,n,e=this.json,r=this.extensions,s=e.materials[t],o={},u=s.extensions||{},e=[];u[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]?(t=r[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS],i=t.getMaterialType(),e.push(t.extendParams(o,s,this))):u[f.KHR_MATERIALS_UNLIT]?(n=r[f.KHR_MATERIALS_UNLIT],i=n.getMaterialType(),e.push(n.extendParams(o,s,this))):(i=jv,h=s.pbrMetallicRoughness||{},o.color=new Ci(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)&&(o.color.fromArray(n=h.baseColorFactor),o.opacity=n[3]),void 0!==h.baseColorTexture&&e.push(this.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(e.push(this.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),e.push(this.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))),!0===s.doubleSided&&(o.side=nn);var h=s.alphaMode||B;return h===N?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===F&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&i!==Wn&&(e.push(this.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Ji(1,1),void 0!==s.normalTexture.scale&&o.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&i!==Wn&&(e.push(this.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&i!==Wn&&(o.emissive=(new Ci).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&i!==Wn&&e.push(this.assignTexture(o,"emissiveMap",s.emissiveTexture)),u[f.KHR_MATERIALS_CLEARCOAT]&&(h=r[f.KHR_MATERIALS_CLEARCOAT],i=h.getMaterialType(),e.push(h.extendParams(o,{extensions:u},this))),Promise.all(e).then(function(){var t=i===a?r[f.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new i(o);return s.name&&(t.name=s.name),t.map&&(t.map.encoding=3001),t.emissiveMap&&(t.emissiveMap.encoding=3001),V(t,s),s.extensions&&U(r,t,s),t})},z.prototype.loadGeometries=function(t){var n=this,e=this.extensions,i=this.primitiveCache;for(var r=[],s=0,o=t.length;s<o;s++){var u=t[s],h=(h=void 0,a=(h=(a=u).extensions&&a.extensions[f.KHR_DRACO_MESH_COMPRESSION])?"draco:"+h.bufferView+":"+h.indices+":"+G(h.attributes):a.indices+":"+G(a.attributes)+":"+a.mode),a=i[h];a?r.push(a.promise):(a=u.extensions&&u.extensions[f.KHR_DRACO_MESH_COMPRESSION]?function(i){return e[f.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(i,n).then(function(t){return q(t,i,n)})}(u):q(new qn,u,n),i[h]={primitive:u,promise:a},r.push(a))}return Promise.all(r)},z.prototype.loadMesh=function(f){for(var l=this,v=this.json.meshes[f],d=v.primitives,t=[],i=0,n=d.length;i<n;i++){var e=void 0===d[i].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new jv({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:$i})),e.DefaultMaterial):this.getDependency("material",d[i].material);t.push(e)}return t.push(l.loadGeometries(d)),Promise.all(t).then(function(t){for(var i=t.slice(0,t.length-1),n=t[t.length-1],e=[],r=0,s=n.length;r<s;r++){var o,u=n[r],h=d[r],a=i[r];if(h.mode===R||h.mode===S||h.mode===j||void 0===h.mode)!0!==(o=new(!0===v.isSkinnedMesh?rd:He)(u,a)).isSkinnedMesh||o.geometry.attributes.skinWeight.normalized||o.normalizeSkinWeights(),h.mode===S?o.geometry=Z(o.geometry,1):h.mode===j&&(o.geometry=Z(o.geometry,bn));else if(h.mode===k)o=new vd(u,a);else if(h.mode===O)o=new cd(u,a);else if(h.mode===E)o=new dd(u,a);else{if(h.mode!==M)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);o=new wd(u,a)}0<Object.keys(o.geometry.morphAttributes).length&&function(t,i){if(t.updateMorphTargets(),void 0!==i.weights)for(var n=0,e=i.weights.length;n<e;n++)t.morphTargetInfluences[n]=i.weights[n];if(i.extras&&Array.isArray(i.extras.targetNames)){var r=i.extras.targetNames;if(t.morphTargetInfluences.length===r.length){t.morphTargetDictionary={};for(n=0,e=r.length;n<e;n++)t.morphTargetDictionary[r[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(o,v),o.name=v.name||"mesh_"+f,1<n.length&&(o.name+="_"+r),V(o,v),l.assignFinalMaterial(o),e.push(o)}if(1===e.length)return e[0];for(var c=new Xe,r=0,s=e.length;r<s;r++)c.add(e[r]);return c})},z.prototype.loadCamera=function(t){var i,n=this.json.cameras[t],t=n[n.type];if(t)return"perspective"===n.type?i=new Wv(Y.radToDeg(t.yfov),t.aspectRatio||1,t.znear||1,t.zfar||2e6):"orthographic"===n.type&&(i=new dv(t.xmag/-2,t.xmag/2,t.ymag/2,t.ymag/-2,t.znear,t.zfar)),n.name&&(i.name=n.name),V(i,n),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")},z.prototype.loadSkin=function(t){var t=this.json.skins[t],i={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(t){return i.inverseBindMatrices=t,i})},z.prototype.loadAnimation=function(O){for(var R=this.json.animations[O],t=[],i=[],n=[],e=[],r=[],s=0,o=R.channels.length;s<o;s++){var u=R.channels[s],h=R.samplers[u.sampler],a=u.target,c=void 0!==a.node?a.node:a.id,f=void 0!==R.parameters?R.parameters[h.input]:h.input,u=void 0!==R.parameters?R.parameters[h.output]:h.output;t.push(this.getDependency("node",c)),i.push(this.getDependency("accessor",f)),n.push(this.getDependency("accessor",u)),e.push(h),r.push(a)}return Promise.all([Promise.all(t),Promise.all(i),Promise.all(n),Promise.all(e),Promise.all(r)]).then(function(t){for(var i=t[0],n=t[1],e=t[2],r=t[3],s=t[4],o=[],u=0,h=i.length;u<h;u++){var a,c=i[u],f=n[u],l=e[u],v=r[u],d=s[u];if(void 0!==c){switch(c.updateMatrix(),c.matrixAutoUpdate=!0,I[d.path]){case I.weights:a=Td;break;case I.rotation:a=jd;break;case I.position:case I.scale:default:a=Ad}var y=c.name||c.uuid,p=void 0!==v.interpolation?P[v.interpolation]:pn,b=[];I[d.path]===I.weights?c.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&b.push(t.name||t.uuid)}):b.push(y);var m,w=l.array;if(l.normalized){if(w.constructor===Int8Array)m=1/127;else if(w.constructor===Uint8Array)m=1/255;else if(w.constructor==Int16Array)m=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");m=1/65535}for(var g=new Float32Array(w.length),M=0,k=w.length;M<k;M++)g[M]=w[M]*m;w=g}for(M=0,k=b.length;M<k;M++){var E=new a(b[M]+"."+I[d.path],f.array,w,p);"CUBICSPLINE"===v.interpolation&&(E.createInterpolant=function(t){return new T(this.times,this.values,this.getValueSize()/3,t)},E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(E)}}}return new _d(R.name||"animation_"+O,void 0,o)})},z.prototype.loadNode=function(t){var i=this.json,s=this.extensions,n=this,e=i.meshReferences,r=i.meshUses,o=i.nodes[t];return t=[],void 0!==o.mesh&&t.push(n.getDependency("mesh",o.mesh).then(function(t){var i,n;return 1<e[o.mesh]?(i=r[o.mesh]++,(n=t.clone()).name+="_instance_"+i):n=t,void 0!==o.weights&&n.traverse(function(t){if(t.isMesh)for(var i=0,n=o.weights.length;i<n;i++)t.morphTargetInfluences[i]=o.weights[i]}),n})),void 0!==o.camera&&t.push(n.getDependency("camera",o.camera)),o.extensions&&o.extensions[f.KHR_LIGHTS_PUNCTUAL]&&void 0!==o.extensions[f.KHR_LIGHTS_PUNCTUAL].light&&t.push(n.getDependency("light",o.extensions[f.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(t).then(function(t){var i,n=!0===o.isBone?new Pd:1<t.length?new Xe:1===t.length?t[0]:new Ti;if(n!==t[0])for(var e=0,r=t.length;e<r;e++)n.add(t[e]);return o.name&&(n.userData.name=o.name,n.name=Hd.sanitizeNodeName(o.name)),V(n,o),o.extensions&&U(s,n,o),void 0!==o.matrix?((i=new oi).fromArray(o.matrix),n.applyMatrix4(i)):(void 0!==o.translation&&n.position.fromArray(o.translation),void 0!==o.rotation&&n.quaternion.fromArray(o.rotation),void 0!==o.scale&&n.scale.fromArray(o.scale)),n})},z.prototype.loadScene=function(t){var i=this.json,n=this.extensions,t=this.json.scenes[t],e=new Si;t.name&&(e.name=t.name),V(e,t),t.extensions&&U(n,e,t);for(var r=t.nodes||[],s=[],o=0,u=r.length;o<u;o++)s.push(function o(t,u,h,a){var c=h.nodes[t];return a.getDependency("node",t).then(function(t){return void 0===c.skin?t:a.getDependency("skin",c.skin).then(function(t){for(var i=[],n=0,e=(u=t).joints.length;n<e;n++)i.push(a.getDependency("node",u.joints[n]));return Promise.all(i)}).then(function(o){return t.traverse(function(t){if(t.isMesh){for(var i=[],n=[],e=0,r=o.length;e<r;e++){var s=o[e];s?(i.push(s),s=new oi,void 0!==u.inverseBindMatrices&&s.fromArray(u.inverseBindMatrices.array,16*e),n.push(s)):console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',u.joints[e])}t.bind(new Gd(i,n),t.matrixWorld)}}),t});var u}).then(function(t){u.add(t);var i=[];if(c.children)for(var n=c.children,e=0,r=n.length;e<r;e++){var s=n[e];i.push(o(s,t,h,a))}return Promise.all(i)})}(r[o],e,i,this));return Promise.all(s).then(function(){return e})},t}();function Zd(t){return(Zd="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yd(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Xd(t,i,n){return(Xd="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Kd(t)););return t}(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Wd(t,i){return(Wd=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function Qd(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Kd(n);return t=e?(t=Kd(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Zd(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function Kd(t){return(Kd=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jd=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Wd(t,i)}(s,sv);var t,i,n,e=Qd(s);function s(){var t,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:uv;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),(t=e.call(this)).manager=i,t.adjustmentTransform=new oi,t}return t=s,(i=[{key:"parse",value:function(t){var e=this,u=Xd(Kd(s.prototype),"parse",this).call(this,t),r=u.glbBytes.slice().buffer;return new Promise(function(s,t){var i=e.manager,n=e.fetchOptions,i=i.getHandler("path.gltf")||new qd(i);"include"===n.credentials&&"cors"===n.mode&&i.setCrossOrigin("use-credentials"),"credentials"in n&&i.setWithCredentials("include"===n.credentials),n.headers&&i.setRequestHeader(n.headers);n=e.workingPath;!/[\\/]$/.test(n)&&n.length&&(n+="/");var o=e.adjustmentTransform;i.parse(r,n,function(t){var i=u.batchTable,n=u.featureTable,e=t.scene,r=n.getData("RTC_CENTER");r&&(e.position.x+=r[0],e.position.y+=r[1],e.position.z+=r[2]),t.scene.updateMatrix(),t.scene.matrix.multiply(o),t.scene.matrix.decompose(t.scene.position,t.scene.quaternion,t.scene.scale),t.batchTable=i,t.featureTable=n,e.batchTable=i,e.featureTable=n,s(t)},t)})}}])&&Yd(t.prototype,i),n&&Yd(t,n),s}();function $d(t){return($d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ty(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function iy(t,i){return(iy=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function ny(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=ey(n);return t=e?(t=ey(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==$d(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function ey(t){return(ey=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ry=new oi,sy=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&iy(t,i)}(r,Xe);var t,i,n,e=ny(r);function r(t){var i;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,r),(i=e.call(this)).name="TilesRenderer.TilesGroup",i.tilesRenderer=t,i}return t=r,(i=[{key:"raycast",value:function(t,i){this.tilesRenderer.optimizeRaycast&&this.tilesRenderer.raycast(t,i)}},{key:"updateMatrixWorld",value:function(t){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||t){null===this.parent?ry.copy(this.matrix):ry.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;for(var i=ry.elements,n=this.matrixWorld.elements,e=!1,r=0;r<16;r++){var s=i[r],o=n[r];if(Math.abs(s-o)>Number.EPSILON){e=!0;break}}if(e){this.matrixWorld.copy(ry);for(var u=this.children,h=0,a=u.length;h<a;h++)u[h].updateMatrixWorld()}}}}])&&ty(t.prototype,i),n&&ty(t,n),r}();function oy(t,i,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==i?i:0,this.theta=void 0!==n?n:0,this}function uy(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function hy(t){var i=t.x,n=t.y,e=t.z;t.x=e,t.y=i,t.z=n}Object.assign(oy.prototype,{set:function(t,i,n){return this.radius=t,this.phi=i,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,i,n){return this.radius=Math.sqrt(t*t+i*i+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Y.clamp(i/this.radius,-1,1))),this}});var ay=new oy,cy=new Jt,fy=new Jt,ly=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.radius=new Jt(t,i,n)}var t,i,n;return t=e,(i=[{key:"getCartographicToPosition",value:function(t,i,n,e){var r=this.radius;ay.set(1,-t+Math.PI/2,i),cy.setFromSpherical(ay).normalize(),hy(cy),fy.copy(cy),fy.x*=Math.pow(r.x,2),fy.y*=Math.pow(r.y,2),fy.z*=Math.pow(r.z,2);r=Math.sqrt(cy.dot(fy));return fy.divideScalar(r),e.copy(fy).addScaledVector(cy,n)}},{key:"getCartographicToNormal",value:function(t,i,n){return ay.set(1,-t+Math.PI/2,i),n.setFromSpherical(ay).normalize(),hy(n),n}},{key:"getPositionToNormal",value:function(t,i){var n=this.radius;return i.copy(t),i.x/=Math.pow(n.x,2),i.y/=Math.pow(n.y,2),i.z/=Math.pow(n.z,2),i.normalize(),i}}])&&uy(t.prototype,i),n&&uy(t,n),e}();function vy(t){return(vy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dy(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],e=!0,r=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!i||n.length!==i);e=!0);}catch(t){r=!0,s=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw s}}return n}}(t,i)||function(t,i){if(t){if("string"==typeof t)return yy(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yy(t,i):void 0}}(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yy(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function py(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function by(t,i){return(by=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function my(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=wy(n);return t=e?(t=wy(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==vy(t)&&"function"!=typeof t?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(i):t}}function wy(t){return(wy=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var gy=Math.PI,My=gy/2,ky=new Jt,Ey=new Jt,Oy=new Jt,Ry=new oi,Ty=0,Sy=[];function jy(){Ty=0}var Ay=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&by(t,i)}(c,ly);var t,i,n,a=my(c);function c(t,i,n){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:-My,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:My,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0,o=6<arguments.length&&void 0!==arguments[6]?arguments[6]:2*gy,u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0,h=8<arguments.length&&void 0!==arguments[8]?arguments[8]:0;return function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,c),(n=a.call(this,t,i,n)).latStart=e,n.latEnd=r,n.lonStart=s,n.lonEnd=o,n.heightStart=u,n.heightEnd=h,n}return t=c,(i=[{key:"_getPoints",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i=this.latStart,n=this.latEnd,e=this.lonStart,r=this.lonEnd,s=this.heightStart,o=this.heightEnd,u=Y.mapLinear(.5,0,1,i,n),h=Y.mapLinear(.5,0,1,e,r),a=Math.floor(e/My)*My,c=[[-gy/2,0],[gy/2,0],[0,a],[0,a+gy/2],[0,a+gy],[0,a+3*gy/2],[i,r],[n,r],[i,e],[n,e],[0,e],[0,r],[u,h],[i,h],[n,h],[u,e],[u,r]],f=[],l=c.length,v=0;v<=1;v++)for(var d=Y.mapLinear(v,0,1,s,o),y=0,p=l;y<p;y++){var b=dy(c[y],2),m=b[0],w=b[1];i<=m&&m<=n&&e<=w&&w<=r&&(b=function(t){return 0<arguments.length&&void 0!==t&&t?(Sy[Ty]||(Sy[Ty]=new Jt),Sy[++Ty-1]):new Jt}(t),f.push(b),this.getCartographicToPosition(m,w,d,b))}return f}},{key:"getBoundingBox",value:function(t,i){jy();var n=this.latStart,e=this.latEnd,r=this.lonStart,s=this.lonEnd;e-n<gy/2?(e=Y.mapLinear(.5,0,1,n,e),s=Y.mapLinear(.5,0,1,r,s),this.getCartographicToNormal(e,s,Oy),Ey.set(0,0,1),ky.crossVectors(Ey,Oy),Ey.crossVectors(ky,Oy)):(ky.set(1,0,0),Ey.set(0,1,0),Oy.set(0,0,1)),i.makeBasis(ky,Ey,Oy),Ry.copy(i).invert();for(var o=this.Xr(!0),u=0,h=o.length;u<h;u++)o[u].applyMatrix4(Ry);t.makeEmpty(),t.setFromPoints(o)}},{key:"getBoundingSphere",value:function(t,i){jy();var n=this.Xr(!0);t.makeEmpty(),t.setFromPoints(n,i)}}])&&py(t.prototype,i),n&&py(t,n),c}(),xy=new Bn,Cy=new oi,Ly=new Jt,_y=new Jt,Iy=new ce,Py=[];function By(t,i){return t.distance-i.distance}function Fy(t,i,n){t.traverse(function(t){Object.getPrototypeOf(t).raycast.call(t,i,n)})}function Ny(t){return(Ny="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dy(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],e=!0,r=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(e=(o=u.next()).done)&&(n.push(o.value),!i||n.length!==i);e=!0);}catch(t){r=!0,s=t}finally{try{e||null==u.return||u.return()}finally{if(r)throw s}}return n}}(t,i)||function(t,i){if(t){if("string"==typeof t)return Hy(t,i);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hy(t,i):void 0}}(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hy(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function Uy(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function Vy(t,i,n){return(Vy="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,n){t=Yy(t,i);if(t){i=Object.getOwnPropertyDescriptor(t,i);return i.get?i.get.call(n):i.value}})(t,i,n||t)}function Gy(t,i){return(Gy=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function zy(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,i=Xy(n);return t=e?(t=Xy(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),i=this,!(t=t)||"object"!==Ny(t)&&"function"!=typeof t?qy(i):t}}function qy(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Zy(t,i,n,e){return(Zy="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,i,n,e){var r,t=Yy(t,i);if(t){if((r=Object.getOwnPropertyDescriptor(t,i)).set)return r.set.call(e,n),!0;if(!r.writable)return!1}if(r=Object.getOwnPropertyDescriptor(e,i)){if(!r.writable)return!1;r.value=n,Object.defineProperty(e,i,r)}else n=n,!void((i=i)in(e=e)?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n);return!0})(t,i,n,e)}function Yy(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=Xy(t)););return t}function Xy(t){return(Xy=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Wy=Symbol("INITIAL_FRUSTUM_CULLED"),Qy=new oi,Ky=new oi,Jy=new Jt,$y=new Jt,tp=new Jt,ip=new Jt,np=new Jt(1,0,0),ep=new Jt(0,1,0);function rp(t,i){t.traverse(function(t){t.frustumCulled=t[Wy]&&i})}var sp=function(){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&Gy(t,i)}(p,Hl);var t,i,n,o=zy(p);function p(){var i;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,p);for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];(i=o.call.apply(o,[this].concat(n))).group=new sy(qy(i)),i.cameras=[],i.cameraMap=new Map,i.cameraInfo=[],i.activeTiles=new Set,i.visibleTiles=new Set,i.Wr=!0,i.optimizeRaycast=!0,i.onLoadTileSet=null,i.onLoadModel=null,i.onDisposeModel=null,i.onTileVisibilityChange=null;var r=new ov;r.setURLModifier(function(t){return i.preprocessURL?i.preprocessURL(t):t}),i.manager=r;var s=qy(i);return i.Qr=function(t,i){s.optimizeRaycast||Object.getPrototypeOf(this).raycast.call(this,t,i)},i}return t=p,(i=[{key:"autoDisableRendererCulling",get:function(){return this.Wr},set:function(i){this.Wr!==i&&(function(t,i,n,e,r){if(!Zy(t,i,n,e||t)&&r)throw new Error("failed to set property")}(Xy(p.prototype),"_autoDisableRendererCulling",i,this,!0),this.forEachLoadedModel(function(t){rp(t,!i)}))}},{key:"getBounds",value:function(t){if(!this.root)return!1;var i=this.root.cached,n=i.box,i=i.boxTransform;return!!n&&(t.copy(n),t.applyMatrix4(i),!0)}},{key:"getOrientedBounds",value:function(t,i){if(!this.root)return!1;var n=this.root.cached,e=n.box,n=n.boxTransform;return!!e&&(t.copy(e),i.copy(n),!0)}},{key:"getBoundingSphere",value:function(t){if(!this.root)return!1;var i=this.root.cached.sphere;return!!i&&(t.copy(i),!0)}},{key:"forEachLoadedModel",value:function(n){this.traverse(function(t){var i=t.cached.scene;i&&n(i,t)})}},{key:"raycast",value:function(t,i){var n;this.root&&(t.firstHitOnly?(n=function t(i,n,e,r){if(e.has(i)){if(Fy(i.cached.scene,r,Py),0<Py.length){1<Py.length&&Py.sort(By);var s=Py[0];return Py.length=0,s}return null}for(var o=[],u=i.children,h=0,a=u.length;h<a;h++){var c=u[h],f=c.cached,l=n.matrixWorld;Cy.copy(l),(l=f.sphere)&&(xy.copy(l),xy.applyMatrix4(Cy),!r.ray.intersectsSphere(xy))||(l=f.box,f=f.boxTransform,l&&(Cy.multiply(f).invert(),Iy.copy(r.ray),Iy.applyMatrix4(Cy),Iy.intersectBox(l,Ly)&&(_y.setFromMatrixScale(Cy),f=_y.x,1e-6<Math.abs(Math.max(_y.x-_y.y,_y.x-_y.z))&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when raycasting."),o.push(l={distance:1/0,tile:null}),l.distance=Ly.distanceToSquared(Iy.origin)*f*f,l.tile=c)))}o.sort(By);for(var v=1/0,d=null,y=0,p=o.length;y<p;y++){var b=o[y];if(v<b.distance)break;var m=b.tile,w=m.cached.scene,b=null;e.has(m)?(Fy(w,r,Py),0<Py.length&&(1<Py.length&&Py.sort(By),b=Py[0])):b=t(m,n,e,r),b&&((m=b.distance*b.distance)<v&&(v=m,d=b),Py.length=0)}return d}(this.root,this.group,this.activeTiles,t))&&i.push(n):function t(i,n,e,r,s){var o=i.cached,u=n.matrixWorld;Cy.copy(u);var h=o.sphere;if((!h||(xy.copy(h),xy.applyMatrix4(Cy),r.ray.intersectsSphere(xy)))&&(u=o.box,h=o.boxTransform,!u||(Cy.multiply(h).invert(),Iy.copy(r.ray).applyMatrix4(Cy),Iy.intersectsBox(u))))if(o=o.scene,e.has(i))Fy(o,r,s);else for(var a=i.children,c=0,f=a.length;c<f;c++)t(a[c],n,e,r,s)}(this.root,this.group,this.activeTiles,t,i))}},{key:"hasCamera",value:function(t){return this.cameraMap.has(t)}},{key:"setCamera",value:function(t){var i=this.cameras,n=this.cameraMap;return!n.has(t)&&(n.set(t,new Ji),i.push(t),!0)}},{key:"setResolution",value:function(t,i,n){var e=this.cameraMap;return!!e.has(t)&&(i instanceof Ji?e.get(t).copy(i):e.get(t).set(i,n),!0)}},{key:"setResolutionFromRenderer",value:function(t,i){var n=this.cameraMap;if(!n.has(t))return!1;t=n.get(t);return i.getSize(t),t.multiplyScalar(i.getPixelRatio()),!0}},{key:"deleteCamera",value:function(t){var i=this.cameras,n=this.cameraMap;if(n.has(t)){var e=i.indexOf(t);return i.splice(e,1),n.delete(t),!0}return!1}},{key:"fetchTileSet",value:function(i){for(var n=this,t=arguments.length,e=new Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];var s=(s=Vy(Xy(p.prototype),"fetchTileSet",this)).call.apply(s,[this,i].concat(e));return s.then(function(t){n.onLoadTileSet&&Promise.resolve().then(function(){n.onLoadTileSet(t,i)}).catch(function(t){})}).catch(function(t){}),s}},{key:"update",value:function(){var t=this.group,i=this.cameras,n=this.cameraMap,e=this.cameraInfo;if(0!==i.length){for(;e.length>i.length;)e.pop();for(;e.length<i.length;)e.push({frustum:new fv,isOrthographic:!1,sseDenominator:-1,position:new Jt,invScale:-1,pixelSize:0});Ky.copy(t.matrixWorld).invert(),Jy.setFromMatrixScale(Ky);var r=Jy.x;1e-6<Math.abs(Math.max(Jy.x-Jy.y,Jy.x-Jy.z))&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(var s=0,o=e.length;s<o;s++){var u=i[s],h=e[s],a=h.frustum,c=h.position,f=n.get(u);0!==f.width&&0!==f.height||console.warn("TilesRenderer: resolution for camera error calculation is not set.");var l,v,d=u.projectionMatrix.elements;h.isOrthographic=1===d[15],h.isOrthographic?(l=2/d[0],v=2/d[5],h.pixelSize=Math.max(v/f.height,l/f.width)):h.sseDenominator=2/d[5]/f.height,h.invScale=r,Qy.copy(t.matrixWorld),Qy.premultiply(u.matrixWorldInverse),Qy.premultiply(u.projectionMatrix),a.setFromProjectionMatrix(Qy),c.set(0,0,0),c.applyMatrix4(u.matrixWorld),c.applyMatrix4(Ky)}Vy(Xy(p.prototype),"update",this).call(this)}else console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}},{key:"preprocessNode",value:function(t,i,n){Vy(Xy(p.prototype),"preprocessNode",this).call(this,t,i,n);var e=new oi;if(t.transform)for(var r=t.transform,s=0;s<16;s++)e.elements[s]=r[s];else e.identity();i&&e.premultiply(i.cached.transform);var o=(new oi).copy(e).invert(),u=null,h=null,a=null;"box"in t.boundingVolume&&(y=t.boundingVolume.box,u=new Wi,h=new oi,a=new oi,$y.set(y[3],y[4],y[5]),tp.set(y[6],y[7],y[8]),ip.set(y[9],y[10],y[11]),c=$y.length(),f=tp.length(),l=ip.length(),$y.normalize(),tp.normalize(),ip.normalize(),0===c&&$y.crossVectors(tp,ip),0===f&&tp.crossVectors($y,ip),0===l&&ip.crossVectors($y,tp),h.set($y.x,tp.x,ip.x,y[0],$y.y,tp.y,ip.y,y[1],$y.z,tp.z,ip.z,y[2],0,0,0,1),h.premultiply(e),a.copy(h).invert(),u.min.set(-c,-f,-l),u.max.set(c,f,l));n=null;"sphere"in t.boundingVolume?(v=t.boundingVolume.sphere,(n=new Bn).center.set(v[0],v[1],v[2]),n.radius=v[3],n.applyMatrix4(e)):"box"in t.boundingVolume&&(d=t.boundingVolume.box,n=new Bn,u.getBoundingSphere(n),n.center.set(d[0],d[1],d[2]),n.applyMatrix4(e));var c,f,l,v,d,y,i=null;"region"in t.boundingVolume&&(c=(y=Dy(t.boundingVolume.region,6))[0],f=y[1],l=y[2],v=y[3],d=y[4],y=y[5],i=new Ay(jl,jl,6356752.314245179,f,v,c,l,d,y),null===n&&(n=new Bn,i.getBoundingSphere(n)),null===u&&(u=new Wi,h=new oi,a=new oi,i.getBoundingBox(u,h),a.copy(h).invert())),t.cached={loadIndex:0,transform:e,transformInverse:o,active:!1,inFrustum:[],box:u,boxTransform:h,boxTransformInverse:a,sphere:n,region:i,scene:null,geometry:null,material:null}}},{key:"parseTile",value:function(t,i,n){var e=this;i.Kr=i.Kr||0,i.Kr++;var r=i.content.uri.split(/[\\\/]/g);r.pop();var s=r.join("/"),o=this.fetchOptions,u=this.manager,h=i.Kr,r=this.rootTileSet.asset&&this.rootTileSet.asset.gltfUpAxis||"y",a=i.cached,c=a.transform;switch(r.toLowerCase()){case"x":Qy.makeRotationAxis(ep,-Math.PI/2);break;case"y":Qy.makeRotationAxis(np,Math.PI/2);break;case"z":Qy.identity()}var f=$l(t)||n;return("b3dm"===f?((u=new Jd(u)).workingPath=s,u.fetchOptions=o,u.adjustmentTransform.copy(Qy),u.parse(t).then(function(t){return t.scene})):(console.warn('TilesRenderer: Content type "'.concat(f,'" not supported.')),Promise.resolve(null))).then(function(t){var r,s,o;i.Kr===h&&(t.updateMatrix(),"glb"!==f&&"gltf"!==f||t.matrix.multiply(Qy),t.matrix.premultiply(c),t.matrix.decompose(t.position,t.quaternion,t.scale),t.traverse(function(t){t[Wy]=t.frustumCulled}),rp(t,!e.autoDisableRendererCulling),(a.scene=t).traverse(function(t){t.raycast=e.Qr}),r=[],s=[],o=[],t.traverse(function(t){if(t.geometry&&s.push(t.geometry),t.material){var i,n=t.material;for(i in r.push(t.material),n){var e=n[i];e&&e.isTexture&&o.push(e)}}}),a.materials=r,a.geometry=s,a.textures=o,e.onLoadModel&&e.onLoadModel(t,i))})}},{key:"disposeTile",value:function(t){var i=t.cached;if(i.scene){for(var n=i.materials,e=i.geometry,r=i.textures,s=i.scene.parent,o=0,u=e.length;o<u;o++)e[o].dispose();for(var h=0,a=n.length;h<a;h++)n[h].dispose();for(var c=0,f=r.length;c<f;c++)r[c].dispose();s&&s.remove(i.scene),this.onDisposeModel&&this.onDisposeModel(i.scene,t),i.scene=null,i.materials=null,i.textures=null,i.geometry=null}this.activeTiles.delete(t),this.visibleTiles.delete(t),t.Kr++}},{key:"setTileVisible",value:function(t,i){var n=t.cached.scene,e=this.visibleTiles,r=this.group;i?(r.add(n),e.add(t),n.updateMatrixWorld(!0)):(r.remove(n),e.delete(t)),this.onTileVisibilityChange&&this.onTileVisibilityChange(n,t,i)}},{key:"setTileActive",value:function(t,i){var n=this.activeTiles;i?n.add(t):n.delete(t)}},{key:"calculateError",value:function(t){for(var i,n,e,r,s=t.cached,o=s.inFrustum,u=this.cameras,h=this.cameraInfo,a=s.sphere,c=s.box,f=s.boxTransformInverse,l=s.transformInverse,v=c&&f,d=-1/0,y=1/0,p=0,b=u.length;p<b;p++)o[p]&&(e=(r=h[p]).invScale,n=void 0,r.isOrthographic?(i=r.pixelSize,n=t.geometricError/(i*e)):(Jy.copy(r.position),e=(v?(Jy.applyMatrix4(f),c.distanceToPoint(Jy)):(Jy.applyMatrix4(l),Math.max(a.distanceToPoint(Jy),0)))*e,r=r.sseDenominator,n=t.geometricError/(e*r),y=Math.min(y,e)),d=Math.max(d,n));t.dr=y,t.vr=d}},{key:"tileInView",value:function(t){var t=t.cached,i=t.sphere,n=t.inFrustum;if(i){for(var e=this.cameraInfo,r=!1,s=0,o=e.length;s<o;s++)e[s].frustum.intersectsSphere(i)?n[s]=r=!0:n[s]=!1;return r}return!0}}])&&Uy(t.prototype,i),n&&Uy(t,n),p}();function op(t,i){hv.call(this,t,i),this.type="AmbientLight",this.castShadow=void 0}function up(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}op.prototype=Object.assign(Object.create(hv.prototype),{constructor:op,isAmbientLight:!0});var hp=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.u=t,this.W=null,this.Jr=null,this.$r=null,this.ts=null,this.createLight=this.createLight.bind(this)}var t,n,e;return t=i,(n=[{key:"createLight",value:function(t,i){var n=this.u.getMapOptions(),e=n.lockedLight,n=n.lightConfig[i];return t.ns=new op(n[1].color,n[1].intensity),t.es=new Ti,t.rs=new pv(n[0].color,n[0].intensity),t.rs.position.set(n[0].position.x,n[0].position.y,n[0].position.z),t.rs.target=t.es,t.ss=new pv(n[2].color,n[2].intensity),t.ss.position.set(n[2].position.x,n[2].position.y,n[2].position.z),t.ss.target=t.es,this.W=t,this.Jr=i,e&&(this.os=this.os.bind(this),this.u.on("viewChanged",this.os)),this}}])&&up(t.prototype,n),e&&up(t,e),i}();Object.assign(hp.prototype,{us:function(t){var i=new oy;return i.setFromVector3(t),i.theta},hs:function(t,i){var n=new oy;n.setFromVector3(t),n.theta=i;i=new Jt;i.setFromSpherical(n),t.copy(i)},os:function(){var t,i,n;this.W&&(n=this.us(this.u.camera.position),null===this.$r&&(t=this.us(this.W.rs.position),i=this.us(this.W.ss.position),this.$r=t-n,this.ts=i-n),i=n+this.$r,this.hs(this.W.rs.position,i),n=n+this.ts,this.hs(this.W.ss.position,n))},as:function(){this.u.getMapOptions().lockedLight&&this.u.off("viewChanged",this.os)}});var ap=n(0),cp={NAME_KEY_ERROR:0,MAP_ID_URL_ERROR:2,THEME_ID_URL_ERROR:4,LICENSE_ERROR:8,PATH_ERROR:404,INFO:32,DEFAULT_LEVEL_ERROR:64};function fp(t){return(fp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lp(i,t){var n,e=Object.keys(i);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(i),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})),e.push.apply(e,n)),e}function vp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lp(Object(r),!0).forEach(function(t){var i,n;i=e,t=r[n=t],n in i?Object.defineProperty(i,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[n]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lp(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}gt=function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.cs=vp({data:null,method:"GET",responseType:"json"},i),this.fs=null};Object.assign(gt.prototype,{ls:function(t,i,n){var e=this.cs,r=e.data,s=e.method,o=e.url,u=e.responseType,h=e.header,a=null;if((a=new("undefined"!=typeof XMLHttpRequest?XMLHttpRequest:ap.a.global().fengmap.XMLHttpRequest)).responseType=u,a.open(s,o),"object"==fp(h))for(var c in h)a.setRequestHeader(c,h[c]);a.addEventListener("load",function(){200===a.status||0===a.status||201===a.status?t&&t(a.response):i&&(404===a.status?i(cp.PATH_ERROR):2069===a.response.error_code?i(cp.NAME_KEY_ERROR):2063===a.response.error_code?i(cp.MAP_ID_URL_ERROR):400===a.response.error_code?i(cp.THEME_ID_URL_ERROR):i(a.response))}),a.addEventListener("timeout",function(t){n&&n(t)}),a.addEventListener("error",function(t){i&&i(t)}),a.send(JSON.stringify(r)),this.fs=a},as:function(){this.fs&&this.fs.abort&&(this.fs.abort(),this.fs=null)}});var dp=gt;var yp=function(t){return null!=t};function pp(t){var i;this.name="DeveloperError",this.message=t;try{throw new Error}catch(t){i=t.stack}this.stack=i}yp(Object.create)&&((pp.prototype=Object.create(Error.prototype)).constructor=pp),pp.prototype.toString=function(){var t="".concat(this.name,": ").concat(this.message);return yp(this.stack)&&(t+="\n".concat(this.stack.toString())),t},pp.throwInstantiationError=function(){throw new pp("This function defines an interface and should not be called directly.")};var bp=pp;function mp(t){return(mp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var wp={};function gp(t,i,n){return"Expected ".concat(n," to be typeof ").concat(i,", actual typeof was ").concat(t)}wp.typeOf={},wp.defined=function(t,i){if(!yp(i))throw new bp("".concat(t," is required, actual value was undefined"))},wp.typeOf.func=function(t,i){if("function"!=typeof i)throw new bp(gp(mp(i),"function",t))},wp.typeOf.string=function(t,i){if("string"!=typeof i)throw new bp(gp(mp(i),"string",t))},wp.typeOf.number=function(t,i){if("number"!=typeof i)throw new bp(gp(mp(i),"number",t))},wp.typeOf.number.lessThan=function(t,i,n){if(wp.typeOf.number(t,i),n<=i)throw new bp("Expected ".concat(t," to be less than ").concat(n,", actual value was ").concat(i))},wp.typeOf.number.lessThanOrEquals=function(t,i,n){if(wp.typeOf.number(t,i),n<i)throw new bp("Expected ".concat(t," to be less than or equal to ").concat(n,", actual value was ").concat(i))},wp.typeOf.number.greaterThan=function(t,i,n){if(wp.typeOf.number(t,i),i<=n)throw new bp("Expected ".concat(t," to be greater than ").concat(n,", actual value was ").concat(i))},wp.typeOf.number.greaterThanOrEquals=function(t,i,n){if(wp.typeOf.number(t,i),i<n)throw new bp("Expected ".concat(t," to be greater than or equal to ").concat(n,", actual value was ").concat(i))},wp.typeOf.object=function(t,i){if("object"!==mp(i))throw new bp(gp(mp(i),"object",t))},wp.typeOf.bool=function(t,i){if("boolean"!=typeof i)throw new bp(gp(mp(i),"boolean",t))},wp.typeOf.bigint=function(t,i){if("bigint"!=typeof i)throw new bp(gp(mp(i),"bigint",t))},wp.typeOf.number.equals=function(t,i,n,e){if(wp.typeOf.number(t,n),wp.typeOf.number(i,e),n!==e)throw new bp("".concat(t," must be equal to ").concat(i,", the actual values are ").concat(n," and ").concat(e))};var Mp=wp;function kp(t,i){return null!=t?t:i}kp.EMPTY_OBJECT=Object.freeze({});var Ep=kp,Op={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,EPSILON21:1e-21,GRAVITATIONALPARAMETER:3986004418e5,SOLAR_RADIUS:6955e5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};Op.sign=Ep(Math.sign,function(t){return 0===(t=+t)||t!=t?t:0<t?1:-1}),Op.signNotZero=function(t){return t<0?-1:1},Op.toSNorm=function(t,i){return i=Ep(i,255),Math.round((.5*Op.clamp(t,-1,1)+.5)*i)},Op.fromSNorm=function(t,i){return i=Ep(i,255),Op.clamp(t,0,i)/i*2-1},Op.normalize=function(t,i,n){return 0===(n=Math.max(n-i,0))?0:Op.clamp((t-i)/n,0,1)},Op.sinh=Ep(Math.sinh,function(t){return(Math.exp(t)-Math.exp(-t))/2}),Op.cosh=Ep(Math.cosh,function(t){return(Math.exp(t)+Math.exp(-t))/2}),Op.lerp=function(t,i,n){return(1-n)*t+n*i},Op.PI=Math.PI,Op.ONE_OVER_PI=1/Math.PI,Op.PI_OVER_TWO=Math.PI/2,Op.PI_OVER_THREE=Math.PI/3,Op.PI_OVER_FOUR=Math.PI/4,Op.PI_OVER_SIX=Math.PI/6,Op.THREE_PI_OVER_TWO=3*Math.PI/2,Op.TWO_PI=2*Math.PI,Op.ONE_OVER_TWO_PI=1/(2*Math.PI),Op.RADIANS_PER_DEGREE=Math.PI/180,Op.DEGREES_PER_RADIAN=180/Math.PI,Op.RADIANS_PER_ARCSECOND=Op.RADIANS_PER_DEGREE/3600,Op.toRadians=function(t){if(!yp(t))throw new bp("degrees is required.");return t*Op.RADIANS_PER_DEGREE},Op.toDegrees=function(t){if(!yp(t))throw new bp("radians is required.");return t*Op.DEGREES_PER_RADIAN},Op.convertLongitudeRange=function(t){if(!yp(t))throw new bp("angle is required.");var i=Op.TWO_PI,t=t-Math.floor(t/i)*i;return t<-Math.PI?t+i:t>=Math.PI?t-i:t},Op.clampToLatitudeRange=function(t){if(!yp(t))throw new bp("angle is required.");return Op.clamp(t,-1*Op.PI_OVER_TWO,Op.PI_OVER_TWO)},Op.negativePiToPi=function(t){if(!yp(t))throw new bp("angle is required.");return t>=-Op.PI&&t<=Op.PI?t:Op.zeroToTwoPi(t+Op.PI)-Op.PI},Op.zeroToTwoPi=function(t){if(!yp(t))throw new bp("angle is required.");if(0<=t&&t<=Op.TWO_PI)return t;var i=Op.mod(t,Op.TWO_PI);return Math.abs(i)<Op.EPSILON14&&Math.abs(t)>Op.EPSILON14?Op.TWO_PI:i},Op.mod=function(t,i){if(!yp(t))throw new bp("m is required.");if(!yp(i))throw new bp("n is required.");if(0===i)throw new bp("divisor cannot be 0.");return Op.sign(t)===Op.sign(i)&&Math.abs(t)<Math.abs(i)?t:(t%i+i)%i},Op.equalsEpsilon=function(t,i,n,e){if(!yp(t))throw new bp("left is required.");if(!yp(i))throw new bp("right is required.");n=Ep(n,0),e=Ep(e,n);var r=Math.abs(t-i);return r<=e||r<=n*Math.max(Math.abs(t),Math.abs(i))},Op.lessThan=function(t,i,n){if(!yp(t))throw new bp("first is required.");if(!yp(i))throw new bp("second is required.");if(!yp(n))throw new bp("absoluteEpsilon is required.");return t-i<-n},Op.lessThanOrEquals=function(t,i,n){if(!yp(t))throw new bp("first is required.");if(!yp(i))throw new bp("second is required.");if(!yp(n))throw new bp("absoluteEpsilon is required.");return t-i<n},Op.greaterThan=function(t,i,n){if(!yp(t))throw new bp("first is required.");if(!yp(i))throw new bp("second is required.");if(!yp(n))throw new bp("absoluteEpsilon is required.");return n<t-i},Op.greaterThanOrEquals=function(t,i,n){if(!yp(t))throw new bp("first is required.");if(!yp(i))throw new bp("second is required.");if(!yp(n))throw new bp("absoluteEpsilon is required.");return-n<t-i};var Rp=[1];Op.factorial=function(t){if("number"!=typeof t||t<0)throw new bp("A number greater than or equal to 0 is required.");var i=Rp.length;if(i<=t)for(var n=Rp[i-1],e=i;e<=t;e++){var r=n*e;Rp.push(r),n=r}return Rp[t]},Op.incrementWrap=function(t,i,n){if(n=Ep(n,0),!yp(t))throw new bp("n is required.");if(i<=n)throw new bp("maximumValue must be greater than minimumValue.");return t=i<++t?n:t},Op.isPowerOfTwo=function(t){if("number"!=typeof t||t<0||4294967295<t)throw new bp("A number between 0 and (2^32)-1 is required.");return 0!==t&&0==(t&t-1)},Op.nextPowerOfTwo=function(t){if("number"!=typeof t||t<0||2147483648<t)throw new bp("A number between 0 and 2^31 is required.");return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},Op.previousPowerOfTwo=function(t){if("number"!=typeof t||t<0||4294967295<t)throw new bp("A number between 0 and (2^32)-1 is required.");return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t=((t|=t>>32)>>>0)-(t>>>1)},Op.clamp=function(t,i,n){return Mp.typeOf.number("value",t),Mp.typeOf.number("min",i),Mp.typeOf.number("max",n),t<i?i:n<t?n:t},Op.nextRandomNumber=function(){return randomNumberGenerator.random()},Op.randomBetween=function(t,i){return Op.nextRandomNumber()*(i-t)+t},Op.acosClamped=function(t){if(!yp(t))throw new bp("value is required.");return Math.acos(Op.clamp(t,-1,1))},Op.asinClamped=function(t){if(!yp(t))throw new bp("value is required.");return Math.asin(Op.clamp(t,-1,1))},Op.chordLength=function(t,i){if(!yp(t))throw new bp("angle is required.");if(!yp(i))throw new bp("radius is required.");return 2*i*Math.sin(.5*t)},Op.logBase=function(t,i){if(!yp(t))throw new bp("number is required.");if(!yp(i))throw new bp("base is required.");return Math.log(t)/Math.log(i)},Op.cbrt=Ep(Math.cbrt,function(t){var i=Math.pow(Math.abs(t),1/3);return t<0?-i:i}),Op.log2=Ep(Math.log2,function(t){return Math.log(t)*Math.LOG2E}),Op.fog=function(t,i){i*=t;return 1-Math.exp(-i*i)},Op.fastApproximateAtan=function(t){return Mp.typeOf.number("x",t),t*(-.1784*Math.abs(t)-.0663*t*t+1.0301)},Op.fastApproximateAtan2=function(t,i){Mp.typeOf.number("x",t),Mp.typeOf.number("y",i);var n=Math.abs(t),e=Math.abs(i),r=Math.max(n,e),r=Math.min(n,e)/r;if(isNaN(r))throw new bp("either x or y must be nonzero");return n=Op.fastApproximateAtan(r),n=Math.abs(i)>Math.abs(t)?Op.PI_OVER_TWO-n:n,n=t<0?Op.PI-n:n,n=i<0?-n:n};var Tp=Op;function Sp(t,i,n){this.x=Ep(t,0),this.y=Ep(i,0),this.z=Ep(n,0)}Sp.fromSpherical=function(t,i){Mp.typeOf.object("spherical",t),yp(i)||(i=new Sp);var n=t.clock,e=t.cone,r=Ep(t.magnitude,1),t=r*Math.sin(e);return i.x=t*Math.cos(n),i.y=t*Math.sin(n),i.z=r*Math.cos(e),i},Sp.fromElements=function(t,i,n,e){return yp(e)?(e.x=t,e.y=i,e.z=n,e):new Sp(t,i,n)},Sp.fromCartesian4=Sp.clone=function(t,i){if(yp(t))return yp(i)?(i.x=t.x,i.y=t.y,i.z=t.z,i):new Sp(t.x,t.y,t.z)},Sp.packedLength=3,Sp.pack=function(t,i,n){return Mp.typeOf.object("value",t),Mp.defined("array",i),n=Ep(n,0),i[n++]=t.x,i[n++]=t.y,i[n]=t.z,i},Sp.unpack=function(t,i,n){return Mp.defined("array",t),i=Ep(i,0),(n=!yp(n)?new Sp:n).x=t[i++],n.y=t[i++],n.z=t[i],n},Sp.packArray=function(t,i){Mp.defined("array",t);var n=t.length,e=3*n;if(yp(i)){if(!Array.isArray(i)&&i.length!==e)throw new bp("If result is a typed array, it must have exactly array.length * 3 elements");i.length!==e&&(i.length=e)}else i=new Array(e);for(var r=0;r<n;++r)Sp.pack(t[r],i,3*r);return i},Sp.unpackArray=function(t,i){if(Mp.defined("array",t),Mp.typeOf.number.greaterThanOrEquals("array.length",t.length,3),t.length%3!=0)throw new bp("array length must be a multiple of 3.");var n=t.length;yp(i)?i.length=n/3:i=new Array(n/3);for(var e=0;e<n;e+=3){var r=e/3;i[r]=Sp.unpack(t,e,i[r])}return i},Sp.fromArray=Sp.unpack,Sp.maximumComponent=function(t){return Mp.typeOf.object("cartesian",t),Math.max(t.x,t.y,t.z)},Sp.minimumComponent=function(t){return Mp.typeOf.object("cartesian",t),Math.min(t.x,t.y,t.z)},Sp.minimumByComponent=function(t,i,n){return Mp.typeOf.object("first",t),Mp.typeOf.object("second",i),Mp.typeOf.object("result",n),n.x=Math.min(t.x,i.x),n.y=Math.min(t.y,i.y),n.z=Math.min(t.z,i.z),n},Sp.maximumByComponent=function(t,i,n){return Mp.typeOf.object("first",t),Mp.typeOf.object("second",i),Mp.typeOf.object("result",n),n.x=Math.max(t.x,i.x),n.y=Math.max(t.y,i.y),n.z=Math.max(t.z,i.z),n},Sp.clamp=function(t,i,n,e){Mp.typeOf.object("value",t),Mp.typeOf.object("min",i),Mp.typeOf.object("max",n),Mp.typeOf.object("result",e);var r=Tp.clamp(t.x,i.x,n.x),s=Tp.clamp(t.y,i.y,n.y),n=Tp.clamp(t.z,i.z,n.z);return e.x=r,e.y=s,e.z=n,e},Sp.magnitudeSquared=function(t){return Mp.typeOf.object("cartesian",t),t.x*t.x+t.y*t.y+t.z*t.z},Sp.magnitude=function(t){return Math.sqrt(Sp.magnitudeSquared(t))};var jp=new Sp;Sp.distance=function(t,i){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Sp.subtract(t,i,jp),Sp.magnitude(jp)},Sp.distanceSquared=function(t,i){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Sp.subtract(t,i,jp),Sp.magnitudeSquared(jp)},Sp.normalize=function(t,i){Mp.typeOf.object("cartesian",t),Mp.typeOf.object("result",i);var n=Sp.magnitude(t);if(i.x=t.x/n,i.y=t.y/n,i.z=t.z/n,isNaN(i.x)||isNaN(i.y)||isNaN(i.z))throw new bp("normalized result is not a number");return i},Sp.dot=function(t,i){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),t.x*i.x+t.y*i.y+t.z*i.z},Sp.multiplyComponents=function(t,i,n){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Mp.typeOf.object("result",n),n.x=t.x*i.x,n.y=t.y*i.y,n.z=t.z*i.z,n},Sp.divideComponents=function(t,i,n){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Mp.typeOf.object("result",n),n.x=t.x/i.x,n.y=t.y/i.y,n.z=t.z/i.z,n},Sp.add=function(t,i,n){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Mp.typeOf.object("result",n),n.x=t.x+i.x,n.y=t.y+i.y,n.z=t.z+i.z,n},Sp.subtract=function(t,i,n){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Mp.typeOf.object("result",n),n.x=t.x-i.x,n.y=t.y-i.y,n.z=t.z-i.z,n},Sp.multiplyByScalar=function(t,i,n){return Mp.typeOf.object("cartesian",t),Mp.typeOf.number("scalar",i),Mp.typeOf.object("result",n),n.x=t.x*i,n.y=t.y*i,n.z=t.z*i,n},Sp.divideByScalar=function(t,i,n){return Mp.typeOf.object("cartesian",t),Mp.typeOf.number("scalar",i),Mp.typeOf.object("result",n),n.x=t.x/i,n.y=t.y/i,n.z=t.z/i,n},Sp.negate=function(t,i){return Mp.typeOf.object("cartesian",t),Mp.typeOf.object("result",i),i.x=-t.x,i.y=-t.y,i.z=-t.z,i},Sp.abs=function(t,i){return Mp.typeOf.object("cartesian",t),Mp.typeOf.object("result",i),i.x=Math.abs(t.x),i.y=Math.abs(t.y),i.z=Math.abs(t.z),i};var Ap=new Sp;Sp.lerp=function(t,i,n,e){return Mp.typeOf.object("start",t),Mp.typeOf.object("end",i),Mp.typeOf.number("t",n),Mp.typeOf.object("result",e),Sp.multiplyByScalar(i,n,Ap),e=Sp.multiplyByScalar(t,1-n,e),Sp.add(Ap,e,e)};var xp=new Sp,Cp=new Sp;Sp.angleBetween=function(t,i){Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Sp.normalize(t,xp),Sp.normalize(i,Cp);t=Sp.dot(xp,Cp),i=Sp.magnitude(Sp.cross(xp,Cp,xp));return Math.atan2(i,t)};var Lp=new Sp;Sp.mostOrthogonalAxis=function(t,i){Mp.typeOf.object("cartesian",t),Mp.typeOf.object("result",i);t=Sp.normalize(t,Lp);return Sp.abs(t,t),i=t.x<=t.y?t.x<=t.z?Sp.clone(Sp.UNIT_X,i):Sp.clone(Sp.UNIT_Z,i):t.y<=t.z?Sp.clone(Sp.UNIT_Y,i):Sp.clone(Sp.UNIT_Z,i)},Sp.projectVector=function(t,i,n){Mp.defined("a",t),Mp.defined("b",i),Mp.defined("result",n);t=Sp.dot(t,i)/Sp.dot(i,i);return Sp.multiplyByScalar(i,t,n)},Sp.equals=function(t,i){return t===i||yp(t)&&yp(i)&&t.x===i.x&&t.y===i.y&&t.z===i.z},Sp.equalsArray=function(t,i,n){return t.x===i[n]&&t.y===i[n+1]&&t.z===i[n+2]},Sp.equalsEpsilon=function(t,i,n,e){return t===i||yp(t)&&yp(i)&&Tp.equalsEpsilon(t.x,i.x,n,e)&&Tp.equalsEpsilon(t.y,i.y,n,e)&&Tp.equalsEpsilon(t.z,i.z,n,e)},Sp.cross=function(t,i,n){Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Mp.typeOf.object("result",n);var e=t.x,r=t.y,s=t.z,o=i.x,u=i.y,t=i.z,i=s*o-e*t,o=e*u-r*o;return n.x=r*t-s*u,n.y=i,n.z=o,n},Sp.midpoint=function(t,i,n){return Mp.typeOf.object("left",t),Mp.typeOf.object("right",i),Mp.typeOf.object("result",n),n.x=.5*(t.x+i.x),n.y=.5*(t.y+i.y),n.z=.5*(t.z+i.z),n},Sp.fromDegrees=function(t,i,n,e,r){return Mp.typeOf.number("longitude",t),Mp.typeOf.number("latitude",i),t=Tp.toRadians(t),i=Tp.toRadians(i),Sp.fromRadians(t,i,n,e,r)};var _p=new Sp,Ip=new Sp,Pp=new Sp(40680631590769,40680631590769,40408299984661.445);Sp.fromRadians=function(t,i,n,e,r){Mp.typeOf.number("longitude",t),Mp.typeOf.number("latitude",i),n=Ep(n,0);var s=yp(e)?e.radiiSquared:Pp,e=Math.cos(i);_p.x=e*Math.cos(t),_p.y=e*Math.sin(t),_p.z=Math.sin(i),_p=Sp.normalize(_p,_p),Sp.multiplyComponents(s,_p,Ip);s=Math.sqrt(Sp.dot(_p,Ip));return Ip=Sp.divideByScalar(Ip,s,Ip),_p=Sp.multiplyByScalar(_p,n,_p),yp(r)||(r=new Sp),Sp.add(Ip,_p,r)},Sp.fromDegreesArray=function(t,i,n){if(Mp.defined("coordinates",t),t.length<2||t.length%2!=0)throw new bp("the number of coordinates must be a multiple of 2 and at least 2");var e=t.length;yp(n)?n.length=e/2:n=new Array(e/2);for(var r=0;r<e;r+=2){var s=t[r],o=t[r+1],u=r/2;n[u]=Sp.fromDegrees(s,o,0,i,n[u])}return n},Sp.fromRadiansArray=function(t,i,n){if(Mp.defined("coordinates",t),t.length<2||t.length%2!=0)throw new bp("the number of coordinates must be a multiple of 2 and at least 2");var e=t.length;yp(n)?n.length=e/2:n=new Array(e/2);for(var r=0;r<e;r+=2){var s=t[r],o=t[r+1],u=r/2;n[u]=Sp.fromRadians(s,o,0,i,n[u])}return n},Sp.fromDegreesArrayHeights=function(t,i,n){if(Mp.defined("coordinates",t),t.length<3||t.length%3!=0)throw new bp("the number of coordinates must be a multiple of 3 and at least 3");var e=t.length;yp(n)?n.length=e/3:n=new Array(e/3);for(var r=0;r<e;r+=3){var s=t[r],o=t[r+1],u=t[r+2],h=r/3;n[h]=Sp.fromDegrees(s,o,u,i,n[h])}return n},Sp.fromRadiansArrayHeights=function(t,i,n){if(Mp.defined("coordinates",t),t.length<3||t.length%3!=0)throw new bp("the number of coordinates must be a multiple of 3 and at least 3");var e=t.length;yp(n)?n.length=e/3:n=new Array(e/3);for(var r=0;r<e;r+=3){var s=t[r],o=t[r+1],u=t[r+2],h=r/3;n[h]=Sp.fromRadians(s,o,u,i,n[h])}return n},Sp.ZERO=Object.freeze(new Sp(0,0,0)),Sp.ONE=Object.freeze(new Sp(1,1,1)),Sp.UNIT_X=Object.freeze(new Sp(1,0,0)),Sp.UNIT_Y=Object.freeze(new Sp(0,1,0)),Sp.UNIT_Z=Object.freeze(new Sp(0,0,1)),Sp.prototype.clone=function(t){return Sp.clone(this,t)},Sp.prototype.equals=function(t){return Sp.equals(this,t)},Sp.prototype.equalsEpsilon=function(t,i,n){return Sp.equalsEpsilon(this,t,i,n)},Sp.prototype.toString=function(){return"(".concat(this.x,", ").concat(this.y,", ").concat(this.z,")")};var Bp=Sp,Fp=new Bp,Np=new Bp;var Dp=function(t,i,n,e,r){if(!yp(t))throw new bp("cartesian is required.");if(!yp(i))throw new bp("oneOverRadii is required.");if(!yp(n))throw new bp("oneOverRadiiSquared is required.");if(!yp(e))throw new bp("centerToleranceSquared is required.");var s=t.x,o=t.y,u=t.z,h=i.x,a=i.y,i=i.z,c=s*s*h*h,f=o*o*a*a,l=u*u*i*i,h=c+f+l,a=Math.sqrt(1/h),i=Bp.multiplyByScalar(t,a,Fp);if(h<e)return isFinite(a)?Bp.clone(i,r):void 0;var v=n.x,d=n.y,y=n.z;(n=Np).x=i.x*v*2,n.y=i.y*d*2,n.z=i.z*y*2;var p=(1-a)*Bp.magnitude(t)/(.5*Bp.magnitude(n)),b=0;do{var m,w,g,M,k,E,O,b=(O=c*(M=(m=1/(1+(p-=b)*v))*m)+f*(k=(w=1/(1+p*d))*w)+l*(E=(g=1/(1+p*y))*g)-1)/(-2*(c*(M*m)*v+f*(k*w)*d+l*(E*g)*y))}while(Math.abs(O)>Tp.EPSILON12);return yp(r)?(r.x=s*m,r.y=o*w,r.z=u*g,r):new Bp(s*m,o*w,u*g)};function Hp(t,i,n){this.longitude=Ep(t,0),this.latitude=Ep(i,0),this.height=Ep(n,0)}Hp.fromRadians=function(t,i,n,e){return Mp.typeOf.number("longitude",t),Mp.typeOf.number("latitude",i),n=Ep(n,0),yp(e)?(e.longitude=t,e.latitude=i,e.height=n,e):new Hp(t,i,n)},Hp.fromDegrees=function(t,i,n,e){return Mp.typeOf.number("longitude",t),Mp.typeOf.number("latitude",i),t=Tp.toRadians(t),i=Tp.toRadians(i),Hp.fromRadians(t,i,n,e)};var Up=new Bp,Vp=new Bp,Gp=new Bp,zp=new Bp(1/6378137,1/6378137,1/6356752.314245179),qp=new Bp(1/40680631590769,1/40680631590769,1/40408299984661.445),Zp=Tp.EPSILON1;Hp.fromCartesian=function(t,i,n){var e=yp(i)?i.oneOverRadii:zp,r=yp(i)?i.oneOverRadiiSquared:qp,i=yp(i)?i.vs:Zp,e=Dp(t,e,r,i,Vp);if(yp(e)){i=Bp.multiplyComponents(e,r,Up),i=Bp.normalize(i,i),r=Bp.subtract(t,e,Gp),e=Math.atan2(i.y,i.x),i=Math.asin(i.z),r=Tp.sign(Bp.dot(r,t))*Bp.magnitude(r);return yp(n)?(n.longitude=e,n.latitude=i,n.height=r,n):new Hp(e,i,r)}},Hp.toCartesian=function(t,i,n){return Mp.defined("cartographic",t),Bp.fromRadians(t.longitude,t.latitude,t.height,i,n)},Hp.clone=function(t,i){if(yp(t))return yp(i)?(i.longitude=t.longitude,i.latitude=t.latitude,i.height=t.height,i):new Hp(t.longitude,t.latitude,t.height)},Hp.equals=function(t,i){return t===i||yp(t)&&yp(i)&&t.longitude===i.longitude&&t.latitude===i.latitude&&t.height===i.height},Hp.equalsEpsilon=function(t,i,n){return n=Ep(n,0),t===i||yp(t)&&yp(i)&&Math.abs(t.longitude-i.longitude)<=n&&Math.abs(t.latitude-i.latitude)<=n&&Math.abs(t.height-i.height)<=n},Hp.ZERO=Object.freeze(new Hp(0,0,0)),Hp.prototype.clone=function(t){return Hp.clone(this,t)},Hp.prototype.equals=function(t){return Hp.equals(this,t)},Hp.prototype.equalsEpsilon=function(t,i){return Hp.equalsEpsilon(this,t,i)},Hp.prototype.toString=function(){return"(".concat(this.longitude,", ").concat(this.latitude,", ").concat(this.height,")")};var Yp=Hp;function Xp(t){this.ds=6378137,this.ys=1/this.ds}Object.defineProperties(Xp.prototype,{ellipsoid:{get:function(){return this.bs}}}),Xp.mercatorAngleToGeodeticLatitude=function(t){return Tp.PI_OVER_TWO-2*Math.atan(Math.exp(-t))},Xp.geodeticLatitudeToMercatorAngle=function(t){Xp.MaximumLatitude<t?t=Xp.MaximumLatitude:t<-Xp.MaximumLatitude&&(t=-Xp.MaximumLatitude);t=Math.sin(t);return.5*Math.log((1+t)/(1-t))},Xp.MaximumLatitude=Xp.mercatorAngleToGeodeticLatitude(Math.PI),Xp.prototype.project=function(t,i){var n=this.ds,e=t.longitude*n,n=Xp.geodeticLatitudeToMercatorAngle(t.latitude)*n,t=t.height;return yp(i)?(i.x=e,i.y=n,i.z=t,i):new Bp(e,n,t)},Xp.prototype.unproject=function(t,i){if(!yp(t))throw new bp("cartesian is required");var n=this.ys,e=t.x*n,n=Xp.mercatorAngleToGeodeticLatitude(t.y*n),t=t.z;return yp(i)?(i.longitude=e,i.latitude=n,i.height=t,i):new Yp(e,n,t)};var Wp=Xp;function Qp(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}A=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.ms=void 0!==(t=t||{}).url?t.url:"",this.xe=null!=t.offset?parseFloat(t.offset):1,this.Ge=this.xe,this.ws=null==t.isClamp||t.isClamp,this.Ne=null,this.u=null,this.gs=null,this.rr=null,this.De=new Si,this.Ms=null,this.R=this.R.bind(this),this.Ye=this.Ye.bind(this),this.Ze=!1,this.ks=null,this.Es=null,this.Os=null,this.Rs=null,this.Ts=null,this.Ss=null,this.js=null,this.As=null,this.xs=!0}var t,n,e;return t=i,(n=[{key:"visible",get:function(){return this.Ce},set:function(t){this.Ce=t,this.De.visible=this.Ce,this.u.enableUpdateRender()}},{key:"addTo",value:function(t){this.u=t,this.Ge=this.u.getFloor(this.u.getVisibleLevels()[0]).height-this.xe,this.u.getRenderManager().set3DTilesLayerSceneArr(this.De),this.O(),this.Cs(),this.xs=!0}},{key:"remove",value:function(){for(var t=this.u.getRenderManager().get3DTilesLayerSceneArr(),i=t.length-1;0<=i;i--)t[i]===this.De&&t.splice(i,1);0==t.length&&(this.u.off("update",this.R),this.u.off("viewModeChanged",this.Ye),this.u.off("visibleLevelsLoaded",this.Ye),this.Ze=!1),this.u.enableUpdateRender(),0==t.length&&(this.u=null),this.Es&&(this.Es.dispose(),this.Es=null)}}])&&Qp(t.prototype,n),e&&Qp(t,e),i}();Object.assign(A.prototype,{O:function(){this.Ze||(this.Ms=new hp(this.u).createLight(this,"FMExternalModelLayer"),this.Ne=this.u.getContainer(),this.u.on("update",this.R),this.u.on("viewModeChanged",this.Ye),this.u.on("visibleLevelsLoaded",this.Ye),this.u.camera.far=1e3*Ye.CAMERA_FAR,this.u.camera.updateProjectionMatrix(),this.Ls(this.ms),this.Ze=!0)},Cs:function(){this.De.add(this.rs),this.De.add(this.ns),this.De.add(this.ss)},Ls:function(t){var i=this;new dp({method:"GET",responseType:"json",url:t}).ls(function(t){i.Os=t.root.transform,i.js=new oi,i.Rs=i._s(),i.Ts=new oi,i.Ts.makeTranslation(i.Rs.offsetX,i.Rs.offsetY,i.Ge),i.gs=i.u.camera,i.rr=i.u.getRenderManager().renderer,i.Is(),i.Ps()},function(t){})},Is:function(){this.ks=new Xe,this.ks.rotation.set(0,0,0),this.De.add(this.ks)},Ps:function(){var s=this,o=this;this.Es=new sp(this.ms),this.Es.fetchOptions.mode="cors",this.Es.onLoadModel=function(t){t.traverse(function(t){t.isMesh&&(t.material.map.encoding=mn)}),o.xs=!0},this.Es.onDisposeModel=function(t){t.traverse(function(t){t.isMesh&&t.material.dispose()}),o.xs=!0},this.Es.onLoadTileSet=function(){var t,i=new Wi,n=new oi,e=new oi;e.fromArray(o.Os),s.Es.getOrientedBounds(i,n)&&(t=(r=(new Jt).setFromMatrixPosition(e)).length());var e=r.normalize(),r=new Jt(0,1,0),r=s.rotationBetweenDirections(e,r);s.Es.group.quaternion.x=r.x,s.Es.group.quaternion.y=r.y,s.Es.group.quaternion.z=r.z,s.Es.group.quaternion.w=r.w,s.Es.group.position.y=-t,o.xs=!0},this.ks.add(this.Es.group),this.ks.position.x=o.Rs.offsetX,this.ks.position.z=o.Rs.offsetY,this.ks.position.y=o.Ge,this.ks.rotation.y=Tp.PI-Tp.PI/20},rotationBetweenDirections:function(t,i){var n=new Wt,e=(new Jt).crossVectors(t,i);return n.x=e.x,n.y=e.y,n.z=e.z,n.w=1+t.clone().dot(i),n.normalize(),n},_s:function(){var t=this.u.getCenter(),i=this.Os[12],n=this.Os[13],e=this.Os[14],e=new Bp(i,n,e),e=Yp.fromCartesian(e),e=(new Wp).project(e);return{offsetX:e.x-t.x,offsetY:t.y-e.y}},R:function(){this.Es&&(this.Es.setCamera(this.gs),this.Es.setResolutionFromRenderer(this.gs,this.rr),this.Es.update(),this.xs&&(null!=this.u&&this.u.enableUpdateRender(),this.xs=!1))},Ye:function(t){"viewModeChanged"==t.type&&(this.Es.deleteCamera(this.gs),this.gs=this.u.camera,this.gs.far===Ye.CAMERA_FAR&&(this.gs.far=1e3*Ye.CAMERA_FAR,this.gs.updateProjectionMatrix()),this.Es.setCamera(this.gs),this.Es.setResolutionFromRenderer(this.gs,this.rr),this.Es.update()),this.Ge=this.u.getFloor(this.u.getVisibleLevels()[0]).height-this.xe,this.ws&&(this.ks.position.y=this.Ge)}});var q=A,Kp={Default:1,Legacy:2,Classic:4,Custom:8};function Jp(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}function $p(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}D=function(){function n(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,n);this.Bs=t,this.Fs=i,this.Ns=(Jp(i={},Kp.Default,{FMExtentLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,intensity:.65,position:{x:-100,y:0,z:45},id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}],FMModelLayer:[{name:"DirectionalLight",color:11645361,intensity:.95,position:{x:58,y:65,z:40},id:0},{name:"AmbientLight",color:11645361,intensity:.85,id:1},{name:"DirectionalLight",color:6513507,position:{x:-100,y:0,z:45},intensity:.65,id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:11579568,intensity:.95,position:{x:58,y:65,z:45},id:0},{name:"AmbientLight",color:11579568,intensity:.85,id:1},{name:"DirectionalLight",color:6447714,position:{x:-100,y:0,z:45},intensity:.45,id:2}]}),Jp(i,Kp.Legacy,{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]}),Jp(i,Kp.Classic,{FMExtentLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,intensity:1,position:{x:-.5,y:1,z:-1},id:2}],FMExternalModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.46,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMModelLayer:[{name:"DirectionalLight",color:8947848,intensity:1.2,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:7631988,intensity:1,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}],FMDynamicModelLayer:[{name:"DirectionalLight",color:8947848,intensity:.9,position:{x:-1,y:1,z:1},id:0},{name:"AmbientLight",color:16777215,intensity:.33,id:1},{name:"DirectionalLight",color:3355443,position:{x:-.5,y:1,z:-1},intensity:1,id:2}]}),i)}var t,i,e;return t=n,(i=[{key:"getConfig",value:function(){return this.Bs==Kp.Custom?this.Fs:this.Ns[this.Bs]}}])&&$p(t.prototype,i),e&&$p(t,e),n}();function tb(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}gt=function(){function i(t){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),this.cs=t=t||{},this.Ds=40,void 0!==t.maxWidth&&(this.Ds=t.minWidth),this.Hs=100,void 0!==t.maxWidth&&(this.Hs=t.maxWidth),(this.Ge=void 0)!==t.height&&(this.Ge=t.height),(this.Us=void 0)!==t.fontSize&&(this.Us=t.fontSize),(this.Vs=void 0)!==t.position&&(this.Vs=t.position),this.u=null,this.S=null,this.Gs=[1e7,5e6,2e6,1e6,5e5,2e5,1e5,5e4,25e3,2e4,1e4,5e3,2e3,1e3,500,200,100,50,20,10,5,2,1,.5,.2,.1,.05,.02,.01],this.zs=this.zs.bind(this)}var t,n,e;return t=i,(n=[{key:"addTo",value:function(t){this.u=t,this.O()}},{key:"remove",value:function(){this.u.off("zoom",this.zs),this.u.getContainer().removeChild(this.S)}}])&&tb(t.prototype,n),e&&tb(t,e),i}();Object.assign(gt.prototype,{O:function(){this.S=document.createElement("div"),this.S.classList.add("fm-control-scale-bar-contain"),this.S.style.width=this.Ds+"px",void 0!==this.Ge&&(this.S.style.height=this.Ge+"px"),this.S.style.zIndex=20,void 0===this.Vs&&void 0===this.cs.offset||this.qs(this.Vs,this.cs.offset,this.S),this.u.getContainer().appendChild(this.S);var t=document.createElement("div");t.setAttribute("id","ruleWord"),t.classList.add("fm-control-scale-bar-text"),void 0!==this.Us&&(t.style.fontSize=this.Us+"px"),this.S.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-left1"),this.S.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-left2"),this.S.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-right1"),this.S.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-right2"),this.S.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-bottom1"),this.S.appendChild(t);t=document.createElement("div");t.classList.add("fm-control-scale-bar-bottom2"),this.S.appendChild(t),this.zs(),this.u.on("zoom",this.zs)},qs:function(t,i,n){switch(n.style.left="",n.style.right="",n.style.top="",n.style.bottom="",t){case l.LEFT_TOP:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px";break;case l.RIGHT_TOP:n.style.right=-(i=i||{x:-10,y:10}).x+"px",n.style.top=i.y+"px";break;case l.LEFT_BOTTOM:n.style.left=(i=i||{x:10,y:-10}).x+"px",n.style.bottom=-i.y+"px";break;case l.RIGHT_BOTTOM:n.style.right=-(i=i||{x:-10,y:-10}).x+"px",n.style.bottom=-i.y+"px";break;default:n.style.left=(i=i||{x:10,y:10}).x+"px",n.style.top=i.y+"px"}},zs:function(t){var i={x:document.body.clientWidth/2,y:document.body.clientHeight/2},n={x:i.x+100,y:i.y},i=fengmap.FMUtil.coordsScreenToMap(this.u,i),n=fengmap.FMUtil.coordsScreenToMap(this.u,n),i=Math.sqrt((i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y))/100,n=this.Gs[Math.floor(this.u.getZoom())-1];this.S.style.width=n/i+"px";i="",i=n<1e3&&1<=n?n+"":n<1?1e3*n+"":n/1e3+"";document.getElementById("ruleWord").innerHTML=i}});var A=gt,gt=n(1),ib=n.n(gt);function nb(t,i,n,e,r,s,o,u,h){Kn.call(this,t,i,n,e,r,s,o,u,h),this.format=void 0!==o?o:vn,this.minFilter=void 0!==s?s:cn,this.magFilter=void 0!==r?r:cn,this.generateMipmaps=!1}function eb(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}nb.prototype=Object.assign(Object.create(Kn.prototype),{constructor:nb,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});gt=function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.u=null,this.Zs={},this.Ys=(new Date).getTime(),this.R=this.R.bind(this)}var i,n,e;return i=t,(n=[{key:"replace",value:function(t,i,n){this.getTextureNames(t).indexOf(i)<0?console.error(""):(this.Xs(t.FID,i),0<=n.indexOf(".mp4")||0<=n.indexOf(".webm")||0<=n.indexOf(".ogg")?this.Ws(n,t,i):0<=n.indexOf(".gif")?this.Qs(n,t,i):(0<=n.indexOf(".jpg")||0<=n.indexOf(".png"))&&this.Ks(n,t,i),t.multiMediaTool.replace(i),null===this.u&&(this.u=t.parent.parent.parent.parent,this.u.on("update",this.R)))}},{key:"reset",value:function(t,i){this.Xs(t.FID,i),t.multiMediaTool.reset(i)}},{key:"dispose",value:function(){for(var t in this.Zs){var i=t.split("_");this.reset(this.Zs[t].externalModel,i[1])}this.u.off("update",this.R)}},{key:"getTextureNames",value:function(t){return t.multiMediaTool.textureNames}}])&&eb(i.prototype,n),e&&eb(i,e),t}();Object.assign(gt.prototype,{Xs:function(t,i){var n=this.Zs[t+"_"+i];if(n&&"video"===n.type)document.getElementById(n.texture.video_id).parentNode.removeChild(document.getElementById(n.texture.video_id)),n.texture.dispose();else if(n&&"gif"===n.type)for(var e=0;e<n.canvasArray.length;e++)n.canvasArray[e].getContext("2d").clearRect(0,0,n.canvasArray[e].width,n.canvasArray[e].height);delete this.Zs[t+"_"+i]},Ks:function(t,i,n){var e=this,r=new Image;r.crossOrigin="Anonymous",r.onload=function(){var t=document.createElement("canvas");t.width=512,t.height=512,t.getContext("2d").drawImage(r,0,0,512,512),e.Zs[i.FID+"_"+n]={type:"gif",canvascount:0,externalModel:i,canvasArray:[t],isnewupdate:!0}},r.src=t},Ws:function(t,e,r){var s=this;this.Js=t;var i=null,n=document.createElement("div");n.style.display="none";var o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)});n.setAttribute("id",o+"_div"),n.innerHTML='<video id="'+o+'" loop crossOrigin="anonymous" muted><source src="'+t+'"></video>',document.body.appendChild(n),function t(){var n=document.getElementById(o);n?(null!==i&&clearTimeout(i),n.addEventListener("loadeddata",function(t){var i=new nb(n);i.video_id=o+"_div",i.name=r,e.isGltf&&(i.flipY=!1),s.Zs[e.FID+"_"+r]={type:"video",externalModel:e,texture:i,isnewupdate:!0},n.play()})):i=setTimeout(t,0)}()},Qs:function(t,i,n){var e=this,r=document.createElement("div");r.style.display="none",document.body.appendChild(r);var s=new Image;s.crossOrigin="Anonymous",s.onload=function(){e.Zs[i.FID+"_"+n]={type:"gif",canvascount:0,externalModel:i,canvasArray:[],isnewupdate:!0},r.appendChild(s);var t=new ib.a({gif:s});t.load(function(){e.$s(t,i.FID,n,r)})},s.src=t},$s:function(n,e,r,s){var o=this,u=null,h=n.get_length(),a=1;this.Zs[e+"_"+r].canvascount=0,function t(){{var i;h<a?(document.body.removeChild(s),null!==u&&clearTimeout(u)):(n.move_to(a),(i=document.createElement("canvas")).width=512,i.height=512,i.getContext("2d").drawImage(n.get_canvas(),0,0,512,512),o.Zs[e+"_"+r].canvasArray.push(i),a++,u=setTimeout(t,0))}}()},io:function(u){var r=this,t=u.getRenderNode();function i(t){var i=u.multiMediaTool.oldMaterial[t.name];if(Array.isArray(i))for(var n=0;n<i.length;n++){var e,r=h(t.material[n],i[n]);r&&(r.iscanvasinfo?(e=r.info,t.material[n].map.image=e.canvasArray[e.canvascount],t.material[n].map.needsUpdate=!0):(t.material[n].dispose(),t.material[n]=r))}else{var s,o=h(t.material,i);o&&(o.iscanvasinfo?(s=o.info,t.material.map.image=s.canvasArray[s.canvascount],t.material.map.needsUpdate=!0):(t.material.dispose(),t.material=o))}}function h(t,i){var n="";i.uniforms&&i.uniforms.map&&i.uniforms.map.value?n=i.uniforms.map.value.name:i.map&&(n=""+i.map.name).indexOf(".gif")<0&&n.indexOf(".mp4")<0&&n.indexOf(".webm")<0&&n.indexOf(".ogg")<0&&(n=""+i.name);var e=r.Zs[u.FID+"_"+n];if(!e)return null;if("video"===e.type){if(t.isupdate&&!e.isnewupdate)return null;e.isnewupdate=!1;i=new Wn({map:e.texture.clone()});return i.isBasic=!0,i.isupdate=!0,i.updatename=n,i}if("gif"===e.type){if(!e.canvasArray[e.canvascount])return null;if(t.isupdate&&!e.isnewupdate)return{iscanvasinfo:!0,info:e};e.isnewupdate=!1;e=new Jn(e.canvasArray[e.canvascount]);u.isGltf&&(e.flipY=!1),e.repeat.set(1,1),e.name=n,e.magFilter=cn,e.minFilter=1008;e=new Wn({map:e});return e.updatename=n,e.isBasic=!0,e.isupdate=!0,e}}t&&(u.isGltf?t.traverse(function(t){"Mesh"===t.type&&i(t)}):i(t))},R:function(){var t=(new Date).getTime(),i=t-this.Ys;50<=i&&(this.Ys=t);var n,e,r=[];for(n in this.Zs)(function(t){for(var i=!0,n=0;n<r.length;n++)if(r[n].FID===t){i=!1;break}return i})(n.split("_")[0])&&this.Zs[n]&&r.push(this.Zs[n].externalModel),"gif"===this.Zs[n].type&&50<=i&&((e=this.Zs[n]).canvascount<e.canvasArray.length-1?e.canvascount++:e.canvascount=0);for(var s=0;s<r.length;s++)this.io(r[s])}});var rb,gt=gt,sb=window.fengmap||{},ob={FMCompass:s,FMControlPosition:l,FMZoomControl:v,FMZoomBar:y,FMToolbar:R};for(rb in ob)sb[rb]=ob[rb];var ub,hb={FMNaviMode:T,FMNaviPriority:S,FMLanguageType:j,FMNavigation:Bt,FMNavigationDrive:e,FMNavigationWalk:p};for(ub in hb)sb[ub]=hb[ub];sb.FMTileLayer=jt,sb.FM3DTilesLayer=q,sb.FMTileProvider=Ze,sb.FMLight=D,sb.FMLightMode=Kp,sb.FMScaleBar=A,sb.FMDynamicTextureTool=gt,window.fengmap=sb;i.default=sb}],r.c=e,r.d=function(t,i,n){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"no",{value:!0})},r.t=function(i,t){if(1&t&&(i=r(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.no)return i;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var e in i)r.d(n,e,function(t){return i[t]}.bind(null,e));return n},r.n=function(t){var i=t&&t.no?function(){return t.default}:function(){return t};return r.d(i,"a",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p="",r(r.s=3).default;function r(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return n[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}var n,e});