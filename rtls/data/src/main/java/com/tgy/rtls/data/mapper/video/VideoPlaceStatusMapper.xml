<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tgy.rtls.data.mapper.video.VideoPlaceStatusMapper">
  <resultMap id="BaseResultMap" type="com.tgy.rtls.data.entity.video.VideoPlaceStatus">
    <!--@mbg.generated-->
    <!--@Table video_place_status-->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="place" jdbcType="BIGINT" property="place" />
    <result column="map" jdbcType="BIGINT" property="map" />
    <result column="config_way" jdbcType="BIGINT" property="configWay" />
    <result column="state" jdbcType="SMALLINT" property="state" />
    <result column="license" jdbcType="VARCHAR" property="license" />
    <result column="addTime" jdbcType="TIMESTAMP" property="addTime" />
    <result column="updateTime" jdbcType="TIMESTAMP" property="updateTime" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    <!--@sql select -->v.id, v.name, v.place as `place` ,v.map, v.config_way, v.state, v.license, v.addTime, v.updateTime
    <!--@sql from video_place_status v-->
  </sql>

  <update id="updateBatchById" parameterType="java.util.Map">
    <foreach collection="map.entrySet()" index="key" item="value" separator=";">
      UPDATE video_place_status
      SET
        name = #{value.name},
        map = #{value.map},
        state = #{value.state},
        license = #{value.license},
        updateTime = #{value.updatetime}
      WHERE id = #{key}
    </foreach>
  </update>

  <select id="getPlaceByTime" resultType="com.tgy.rtls.data.entity.video.VideoPlaceStatus">
    select <include refid="Base_Column_List"/>
    from video_place_status v
    where TIMESTAMPDIFF(MINUTE, v.updateTime , NOW()) &lt; #{minute} and place = #{place} and state = 0
  </select>
</mapper>