<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tgy.rtls.data.mapper.equip.CameraMapper">
    <select id="findByAll" resultType="com.tgy.rtls.data.entity.equip.Camera">
        select *,
        (select name from map_2d where id=map)as mapName
        from camera
        where 1=1
        <if test="instanceid!=null and instanceid!=''">
         and instanceid=#{instanceid}
        </if>
        <if test="name!=null and name!=''">
            and name like concat('%',#{name},'%')
        </if>
        and map=#{map}
        order by id desc
    </select>

    <select id="findById"  resultType="com.tgy.rtls.data.entity.equip.Camera">
         select *,
        (select name from map_2d where id=map)as mapName
        from camera
        where id=#{id}
    </select>

   <select id="findByName"  resultType="com.tgy.rtls.data.entity.equip.Camera">
        select *
        from camera
        where `name`=#{name}
       <if test="instanceid!=null and instanceid!=''">
           and instanceid=#{instanceid}
       </if>
    </select>

    <insert id="addCamera" useGeneratedKeys="true" keyProperty="id">
        insert into camera(name,address,x,y,z,map,floor,instanceid)
        values (#{camera.name},#{camera.address},#{camera.x},#{camera.y},#{camera.z},#{camera.map},#{camera.floor},#{camera.instanceid}
<!--        <choose>
            <when test="gateway.username != null and gateway.username != ''">
                #{gateway.username},
            </when>
            <otherwise>
                'admin',
            </otherwise>
        </choose>
        <choose>
            <when test="gateway.password != null and gateway.password != ''">
                #{gateway.password}
            </when>
            <otherwise>
                '123456'
            </otherwise>
        </choose>-->
     )
    </insert>

    <update id="updateCamera">
        update camera
        <set>
            <if test="camera.name!=null and camera.name!=''">
                name=#{camera.name},
            </if>
            <if test="camera.map!=null ">
                map=#{camera.map},
            </if>
            <if test="camera.address!=null and camera.address!=''">
                address=#{camera.address},
            </if>
            <if test="camera.x!=null and camera.x!=''">
                x=#{camera.x},
            </if>
            <if test="camera.y!=null and camera.y!=''">
                y=#{camera.y},
            </if>
            <if test="camera.z!=null and camera.z!=''">
                z=#{camera.z},
            </if>
            <if test="camera.floor!=null and camera.floor!=''">
                floor=#{camera.floor}
            </if>
        </set>
        where id=#{camera.id}
    </update>

 <!--   <update id="updateGatewayConnect">
        update gateway_uwb
        set connect=#{connect}
        where id=#{id}
    </update>-->
    <delete id="delCameraByInstance">
        delete from  camera
         where instanceid=#{instanceid}
  </delete>
    <delete id="delCamera">
        delete from camera
        where id in
        <foreach collection="ids" separator="," close=")" open="(" item="id">
            #{id}
        </foreach>
    </delete>
</mapper>