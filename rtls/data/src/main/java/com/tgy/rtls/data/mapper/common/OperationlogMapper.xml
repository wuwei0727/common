<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tgy.rtls.data.mapper.common.OperationlogMapper">
    <select id="findByAll" resultType="com.tgy.rtls.data.entity.common.Operationlog">
        select *,
        (select membername from member where uid=o.uid
            <if test="userName != null and userName != ''">
                and member.membername like concat('%',#{userName},'%')
            </if>
        )as name
        from operation_log o
        where 1=1
        <if test="startTime!='' and startTime!=null and endTime!='' and endTime!=null">
            and time>#{startTime} and #{endTime}>time
        </if>
        <if test="ip != null and ip != ''">
            and ip like concat('%',#{ip},'%')
        </if>
        order by time desc
    </select>

    <insert id="addOperationlog" >
        insert into operationlog(uid,incident,instanceid)
        value (#{uid},#{incident},#{instanceid})
    </insert>
    <delete id="deleteOperationlog">
       DELETE  FROM operationlog  WHERE instanceid=#{instanceid}
    </delete>

    <insert id="addUserOperationlog">
        insert into operation_log(uid,incident,time,ip)
        values (#{uid},#{incident},#{time},#{ip})
    </insert>
</mapper>