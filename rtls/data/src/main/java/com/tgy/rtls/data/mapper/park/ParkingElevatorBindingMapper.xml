<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tgy.rtls.data.mapper.park.ParkingElevatorBindingMapper">
  <resultMap id="BaseResultMap" type="com.tgy.rtls.data.entity.park.ParkingElevatorBinding">
    <!--@mbg.generated-->
    <!--@Table parking_elevator_binding-->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="x" jdbcType="VARCHAR" property="x" />
    <result column="placeList" jdbcType="VARCHAR" property="placeList" />
    <result column="y" jdbcType="VARCHAR" property="y" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="building" jdbcType="INTEGER" property="building" />
    <result column="mapName" jdbcType="VARCHAR" property="mapName" />
    <result column="mapKey" jdbcType="VARCHAR" property="mapKey" />
    <result column="appName" jdbcType="VARCHAR" property="appName" />
    <result column="fmapID" jdbcType="VARCHAR" property="fmapID" />
    <result column="mapImg" jdbcType="VARCHAR" property="mapImg" />
    <result column="themeImg" jdbcType="VARCHAR" property="themeImg" />
    <result column="floor" jdbcType="INTEGER" property="floor" />
    <result column="floorName" jdbcType="VARCHAR" property="floorName" />
    <result column="map" jdbcType="INTEGER" property="map" />
    <result column="place" jdbcType="VARCHAR" property="place" />
    <result column="fid" jdbcType="VARCHAR" property="fid" />
    <result column="objectType" jdbcType="VARCHAR" property="objectType" />
    <result column="iconType" jdbcType="VARCHAR" property="iconType" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    <!--@sql select -->
      peb.id, peb.map,GROUP_CONCAT(distinct pp.id  SEPARATOR ',') place, peb.x, peb.y,peb.floor,mrf.name floorName,
    peb.fid,peb.`name`,peb.building,
      peb.object_type AS `objectType`,peb.icon_type AS `iconType`,
      m.name AS mapName,m.mapKey,m.appName,m.fmapID,m.mapImg,m.themeImg,
      GROUP_CONCAT(distinct pp.NAME SEPARATOR ',') placeList
    <!--@sql from parking_elevator_binding peb
            left join parking_place pp on peb.id = pp.elevator_id
            left join map_2d m on pp.map = m.id left join map_relevance_floor mrf on mrf.map = m.id
            -->
  </sql>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--@mbg.generated-->
    delete from parking_elevator_binding
    where id = #{id,jdbcType=BIGINT}
  </delete>

  <!--$var desc=1-->
  <select id="getByConditions" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from parking_elevator_binding peb
    left join parking_place pp on peb.id = pp.elevator_id
    left join map_2d m ON peb.map = m.id
    left join map_relevance_floor mrf on mrf.map = m.id AND mrf.level = peb.floor
    where 1=1
    <if test="map != null">
      and peb.map = #{map}
    </if>
    <if test="floorName != null and floorName != ''">
      and mrf.name like concat('%',#{floorName},'%')
    </if>
    <if test="name != null and name != ''">
      and peb.name like concat('%', #{name}, '%')
    </if>
    <if test="objectType != null and objectType != ''">
      and object_type =#{objectType}
    </if>
    <if test="fid != null and fid != ''">
      and peb.fid =#{fid}
    </if>
    <if test="placeName != null and placeName != ''">
      and pp.name like concat('%', #{placeName}, '%')
    </if>
    <if test="building != null and building != ''">
      and peb.building like concat('%',#{building},'%')
    </if>
    <if test="floor != null">
      and peb.floor =#{floor}
    </if>
    <if test="maps != null and maps != ''">
      and m.id in
      <foreach close=")" collection="maps" item="mapids" open="(" separator=",">
        #{mapids}
      </foreach>
    </if>
    group by peb.id desc
    <if test="desc != null and desc != ''">
      order by ${desc} desc
    </if>
  </select>

  <insert id="addParkingElevatorBinding">
    insert into parking_elevator_binding (map, x, y, name,building,floor,fid,object_type,icon_type)
    value(#{map},#{x},#{y},#{name},#{building},#{floor},#{fid},#{objectType},#{iconType});
  </insert>

  <update id="updateParkingElevatorBinding">
    update parking_elevator_binding
    <set>
      <if test="map != null">
        map = #{map},
      </if>
      <if test="x != null and x != ''">
        x = #{x},
      </if>
      <if test="y != null and y != ''">
        y = #{y},
      </if>
      <if test="name != null and name != ''">
        name = #{name},
      </if>
      <if test="building != null and building != ''">
        building = #{building},
      </if>
      <if test="floor != null and floor != ''">
        floor = #{floor},
      </if>
        fid = #{fid},
        object_type = #{objectType},
        icon_type = #{iconType}
    </set>
    where id = #{id}
  </update>

  <select id="getParkingElevatorBindingById" resultMap="BaseResultMap">
    select <include refid="Base_Column_List"/>
    from parking_elevator_binding peb
    left join parking_place pp on peb.id = pp.elevator_id
    left join map_2d m on peb.map = m.id
    left join map_relevance_floor mrf on mrf.map = m.id AND mrf.level = peb.floor
    where 1=1
    <if test="id != null and id!=null ">
      and peb.id = #{id}
    </if>
  </select>
</mapper>